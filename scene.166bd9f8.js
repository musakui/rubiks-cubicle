import{S as je,L as z,_ as U,q as Ft,s as ni,O as E,D as Dt,v as gt,x as S,P as kt,y as Bt,z as P,E as oi,W as Ge,A as Ye,B as re,C as si}from"./vendor.db607760.js";var De=function(r,t){return!r||r.getClassName&&r.getClassName()==="Mesh"?null:r.getClassName&&r.getClassName()==="SubMesh"?r.clone(t):r.clone?r.clone():null};function ai(r){var t=[];do Object.getOwnPropertyNames(r).forEach(function(e){t.indexOf(e)===-1&&t.push(e)});while(r=Object.getPrototypeOf(r));return t}var He=function(){function r(){}return r.DeepCopy=function(t,e,i,n){for(var o=ai(t),s=0,a=o;s<a.length;s++){var u=a[s];if(!(u[0]==="_"&&(!n||n.indexOf(u)===-1))&&!je.EndsWith(u,"Observable")&&!(i&&i.indexOf(u)!==-1)){var h=t[u],f=typeof h;if(f!=="function")try{if(f==="object")if(h instanceof Array){if(e[u]=[],h.length>0)if(typeof h[0]=="object")for(var l=0;l<h.length;l++){var c=De(h[l],e);e[u].indexOf(c)===-1&&e[u].push(c)}else e[u]=h.slice(0)}else e[u]=De(h,e);else e[u]=h}catch(p){z.Warn(p.message)}}}},r}();function ui(){return typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var Vt=function(){function r(){this._xhr=ui()}return r.prototype._injectCustomRequestHeaders=function(){for(var t in r.CustomRequestHeaders){var e=r.CustomRequestHeaders[t];e&&this._xhr.setRequestHeader(t,e)}},Object.defineProperty(r.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(t){this._xhr.onprogress=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(t){this._xhr.responseType=t},enumerable:!1,configurable:!0}),r.prototype.addEventListener=function(t,e,i){this._xhr.addEventListener(t,e,i)},r.prototype.removeEventListener=function(t,e,i){this._xhr.removeEventListener(t,e,i)},r.prototype.abort=function(){this._xhr.abort()},r.prototype.send=function(t){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},r.prototype.open=function(t,e){for(var i=0,n=r.CustomRequestModifiers;i<n.length;i++){var o=n[i];o(this._xhr,e)}return e=e.replace("file:http:","http:"),e=e.replace("file:https:","https:"),this._xhr.open(t,e,!0)},r.prototype.setRequestHeader=function(t,e){this._xhr.setRequestHeader(t,e)},r.prototype.getResponseHeader=function(t){return this._xhr.getResponseHeader(t)},r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r}(),ne=function(){function r(){}return r.FilesToLoad={},r}(),hi=function(){function r(){}return r.ExponentialBackoff=function(t,e){return t===void 0&&(t=3),e===void 0&&(e=500),function(i,n,o){return n.status!==0||o>=t||i.indexOf("file:")!==-1?-1:Math.pow(2,o)*e}},r}(),zt=function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t._setPrototypeOf=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e},t}(Error),Ce=function(r){U(t,r);function t(e,i){var n=r.call(this,e)||this;return n.name="LoadFileError",zt._setPrototypeOf(n,t.prototype),i instanceof Vt?n.request=i:n.file=i,n}return t}(zt),fi=function(r){U(t,r);function t(e,i){var n=r.call(this,e)||this;return n.request=i,n.name="RequestFileError",zt._setPrototypeOf(n,t.prototype),n}return t}(zt),li=function(r){U(t,r);function t(e,i){var n=r.call(this,e)||this;return n.file=i,n.name="ReadFileError",zt._setPrototypeOf(n,t.prototype),n}return t}(zt),H=function(){function r(){}return r._CleanUrl=function(t){return t=t.replace(/#/mg,"%23"),t},r.SetCorsBehavior=function(t,e){if(!(t&&t.indexOf("data:")===0)&&r.CorsBehavior)if(typeof r.CorsBehavior=="string"||this.CorsBehavior instanceof String)e.crossOrigin=r.CorsBehavior;else{var i=r.CorsBehavior(t);i&&(e.crossOrigin=i)}},r.LoadImage=function(t,e,i,n,o){o===void 0&&(o="");var s,a=!1;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)?typeof Blob!="undefined"?(s=URL.createObjectURL(new Blob([t],{type:o})),a=!0):s="data:"+o+";base64,"+je.EncodeArrayBufferToBase64(t):t instanceof Blob?(s=URL.createObjectURL(t),a=!0):(s=r._CleanUrl(t),s=r.PreprocessUrl(t)),typeof Image=="undefined")return r.LoadFile(s,function(v){createImageBitmap(new Blob([v],{type:o})).then(function(y){e(y),a&&URL.revokeObjectURL(s)}).catch(function(y){i&&i("Error while trying to load image: "+t,y)})},void 0,n||void 0,!0,function(v,y){i&&i("Error while trying to load image: "+t,y)}),null;var u=new Image;r.SetCorsBehavior(s,u);var h=function(){u.removeEventListener("load",h),u.removeEventListener("error",f),e(u),a&&u.src&&URL.revokeObjectURL(u.src)},f=function(v){if(u.removeEventListener("load",h),u.removeEventListener("error",f),i){var y=t.toString();i("Error while trying to load image: "+(y.length<32?y:y.slice(0,32)+"..."),v)}a&&u.src&&URL.revokeObjectURL(u.src)};u.addEventListener("load",h),u.addEventListener("error",f);var l=function(){u.src=s},c=function(){n&&n.loadImage(s,u)};if(s.substr(0,5)!=="data:"&&n&&n.enableTexturesOffline)n.open(c,l);else{if(s.indexOf("file:")!==-1){var p=decodeURIComponent(s.substring(5).toLowerCase());if(ne.FilesToLoad[p]){try{var d;try{d=URL.createObjectURL(ne.FilesToLoad[p])}catch{d=URL.createObjectURL(ne.FilesToLoad[p])}u.src=d,a=!0}catch{u.src=""}return u}}l()}return u},r.ReadFile=function(t,e,i,n,o){var s=new FileReader,a={onCompleteObservable:new E,abort:function(){return s.abort()}};return s.onloadend=function(u){return a.onCompleteObservable.notifyObservers(a)},o&&(s.onerror=function(u){o(new li("Unable to read "+t.name,t))}),s.onload=function(u){e(u.target.result)},i&&(s.onprogress=i),n?s.readAsArrayBuffer(t):s.readAsText(t),a},r.LoadFile=function(t,e,i,n,o,s){if(t.indexOf("file:")!==-1){var a=decodeURIComponent(t.substring(5).toLowerCase());a.indexOf("./")===0&&(a=a.substring(2));var u=ne.FilesToLoad[a];if(u)return r.ReadFile(u,e,i,o,s?function(h){return s(void 0,new Ce(h.message,h.file))}:void 0)}return r.RequestFile(t,function(h,f){e(h,f?f.responseURL:void 0)},i,n,o,s?function(h){s(h.request,new Ce(h.message,h.request))}:void 0)},r.RequestFile=function(t,e,i,n,o,s,a){t=r._CleanUrl(t),t=r.PreprocessUrl(t);var u=r.BaseUrl+t,h=!1,f={onCompleteObservable:new E,abort:function(){return h=!0}},l=function(){var d=new Vt,v=null;f.abort=function(){h=!0,d.readyState!==(XMLHttpRequest.DONE||4)&&d.abort(),v!==null&&(clearTimeout(v),v=null)};var y=function(b){d.open("GET",u),a&&a(d),o&&(d.responseType="arraybuffer"),i&&d.addEventListener("progress",i);var m=function(){d.removeEventListener("loadend",m),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};d.addEventListener("loadend",m);var M=function(){if(!h&&d.readyState===(XMLHttpRequest.DONE||4)){if(d.removeEventListener("readystatechange",M),d.status>=200&&d.status<300||d.status===0&&(!Dt.IsWindowObjectExist()||r.IsFileURL())){e(o?d.response:d.responseText,d);return}var R=r.DefaultRetryStrategy;if(R){var D=R(u,d,b);if(D!==-1){d.removeEventListener("loadend",m),d=new Vt,v=setTimeout(function(){return y(b+1)},D);return}}var I=new fi("Error status: "+d.status+" "+d.statusText+" - Unable to load "+u,d);s&&s(I)}};d.addEventListener("readystatechange",M),d.send()};y(0)};if(n&&n.enableSceneOffline){var c=function(d){d&&d.status>400?s&&s(d):l()},p=function(){n&&n.loadFile(r.BaseUrl+t,function(d){h||e(d),f.onCompleteObservable.notifyObservers(f)},i?function(d){h||i(d)}:void 0,c,o)};n.open(p,c)}else l();return f},r.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},r.DefaultRetryStrategy=hi.ExponentialBackoff(),r.BaseUrl="",r.CorsBehavior="anonymous",r.PreprocessUrl=function(t){return t},r}();Ft._FileToolsLoadImage=H.LoadImage.bind(H);Ft._FileToolsLoadFile=H.LoadFile.bind(H);ni._FileToolsLoadFile=H.LoadFile.bind(H);var Pt;(function(r){r[r.Pending=0]="Pending",r[r.Fulfilled=1]="Fulfilled",r[r.Rejected=2]="Rejected"})(Pt||(Pt={}));var ci=function(){function r(){this.count=0,this.target=0,this.results=[]}return r}(),pi=function(){function r(t){var e=this;if(this._state=Pt.Pending,this._children=new Array,this._rejectWasConsumed=!1,!!t)try{t(function(i){e._resolve(i)},function(i){e._reject(i)})}catch(i){this._reject(i)}}return Object.defineProperty(r.prototype,"_result",{get:function(){return this._resultValue},set:function(t){this._resultValue=t,this._parent&&this._parent._result===void 0&&(this._parent._result=t)},enumerable:!1,configurable:!0}),r.prototype.catch=function(t){return this.then(void 0,t)},r.prototype.then=function(t,e){var i=this,n=new r;return n._onFulfilled=t,n._onRejected=e,this._children.push(n),n._parent=this,this._state!==Pt.Pending&&setTimeout(function(){if(i._state===Pt.Fulfilled||i._rejectWasConsumed){var o=n._resolve(i._result);if(o!=null)if(o._state!==void 0){var s=o;n._children.push(s),s._parent=n,n=s}else n._result=o}else n._reject(i._reason)}),n},r.prototype._moveChildren=function(t){var e,i=this;if((e=this._children).push.apply(e,t.splice(0,t.length)),this._children.forEach(function(h){h._parent=i}),this._state===Pt.Fulfilled)for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._resolve(this._result)}else if(this._state===Pt.Rejected)for(var a=0,u=this._children;a<u.length;a++){var s=u[a];s._reject(this._reason)}},r.prototype._resolve=function(t){try{this._state=Pt.Fulfilled;var e=null;if(this._onFulfilled&&(e=this._onFulfilled(t)),e!=null)if(e._state!==void 0){var i=e;i._parent=this,i._moveChildren(this._children),t=i._result}else t=e;this._result=t;for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._resolve(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(a){this._reject(a,!0)}},r.prototype._reject=function(t,e){if(e===void 0&&(e=!1),this._state=Pt.Rejected,this._reason=t,this._onRejected&&!e)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(s){t=s}for(var i=0,n=this._children;i<n.length;i++){var o=n[i];this._rejectWasConsumed?o._resolve(null):o._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},r.resolve=function(t){var e=new r;return e._resolve(t),e},r._RegisterForFulfillment=function(t,e,i){t.then(function(n){return e.results[i]=n,e.count++,e.count===e.target&&e.rootPromise._resolve(e.results),null},function(n){e.rootPromise._state!==Pt.Rejected&&e.rootPromise._reject(n)})},r.all=function(t){var e=new r,i=new ci;if(i.target=t.length,i.rootPromise=e,t.length)for(var n=0;n<t.length;n++)r._RegisterForFulfillment(t[n],i,n);else e._resolve([]);return e},r.race=function(t){var e=new r;if(t.length)for(var i=0,n=t;i<n.length;i++){var o=n[i];o.then(function(s){return e&&(e._resolve(s),e=null),null},function(s){e&&(e._reject(s),e=null)})}return e},r}(),di=function(){function r(){}return r.Apply=function(t){if(t===void 0&&(t=!1),t||typeof Promise=="undefined"){var e=window;e.Promise=pi}},r}(),_i=function(){function r(){}return r.SetImmediate=function(t){Dt.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(t):setTimeout(t,1)},r}(),nt=function(){function r(){}return r.GetClass=function(t){return this.RegisteredTypes&&this.RegisteredTypes[t]?this.RegisteredTypes[t]:null},r.RegisteredTypes={},r}(),de=function(){function r(){}return r.Instantiate=function(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];var e=nt.GetClass(t);if(e)return e;z.Warn(t+" not found, you may have missed an import.");for(var i=t.split("."),n=window||this,o=0,s=i.length;o<s;o++)n=n[i[o]];return typeof n!="function"?null:n},r.RegisteredExternalClasses={},r}(),gi=function(){function r(){}return r.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,i=t==="x"?e:e&3|8;return i.toString(16)})},r}(),K=function(){function r(){}return Object.defineProperty(r,"BaseUrl",{get:function(){return H.BaseUrl},set:function(t){H.BaseUrl=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"DefaultRetryStrategy",{get:function(){return H.DefaultRetryStrategy},set:function(t){H.DefaultRetryStrategy=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"CorsBehavior",{get:function(){return H.CorsBehavior},set:function(t){H.CorsBehavior=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"UseFallbackTexture",{get:function(){return gt.UseFallbackTexture},set:function(t){gt.UseFallbackTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RegisteredExternalClasses",{get:function(){return de.RegisteredExternalClasses},set:function(t){de.RegisteredExternalClasses=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"fallbackTexture",{get:function(){return gt.FallbackTexture},set:function(t){gt.FallbackTexture=t},enumerable:!1,configurable:!0}),r.FetchToRef=function(t,e,i,n,o,s){var a=Math.abs(t)*i%i|0,u=Math.abs(e)*n%n|0,h=(a+u*i)*4;s.r=o[h]/255,s.g=o[h+1]/255,s.b=o[h+2]/255,s.a=o[h+3]/255},r.Mix=function(t,e,i){return t*(1-i)+e*i},r.Instantiate=function(t){return de.Instantiate(t)},r.Slice=function(t,e,i){return t.slice?t.slice(e,i):Array.prototype.slice.call(t,e,i)},r.SliceToArray=function(t,e,i){return Array.isArray(t)?t.slice(e,i):Array.prototype.slice.call(t,e,i)},r.SetImmediate=function(t){_i.SetImmediate(t)},r.IsExponentOfTwo=function(t){var e=1;do e*=2;while(e<t);return e===t},r.FloatRound=function(t){return Math.fround?Math.fround(t):r._tmpFloatArray[0]=t},r.GetFilename=function(t){var e=t.lastIndexOf("/");return e<0?t:t.substring(e+1)},r.GetFolderPath=function(t,e){e===void 0&&(e=!1);var i=t.lastIndexOf("/");return i<0?e?t:"":t.substring(0,i+1)},r.ToDegrees=function(t){return t*180/Math.PI},r.ToRadians=function(t){return t*Math.PI/180},r.MakeArray=function(t,e){return e!==!0&&(t===void 0||t==null)?null:Array.isArray(t)?t:[t]},r.GetPointerPrefix=function(t){var e="pointer";return Dt.IsWindowObjectExist()&&!window.PointerEvent&&Dt.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(e="mouse"),t._badDesktopOS&&!t._badOS&&!(document&&"ontouchend"in document)&&(e="mouse"),e},r.SetCorsBehavior=function(t,e){H.SetCorsBehavior(t,e)},r.CleanUrl=function(t){return t=t.replace(/#/gm,"%23"),t},Object.defineProperty(r,"PreprocessUrl",{get:function(){return H.PreprocessUrl},set:function(t){H.PreprocessUrl=t},enumerable:!1,configurable:!0}),r.LoadImage=function(t,e,i,n,o){return H.LoadImage(t,e,i,n,o)},r.LoadFile=function(t,e,i,n,o,s){return H.LoadFile(t,e,i,n,o,s)},r.LoadFileAsync=function(t,e){return e===void 0&&(e=!0),new Promise(function(i,n){H.LoadFile(t,function(o){i(o)},void 0,void 0,e,function(o,s){n(s)})})},r.LoadScript=function(t,e,i,n){if(!!Dt.IsWindowObjectExist()){var o=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",t),n&&(s.id=n),s.onload=function(){e&&e()},s.onerror=function(a){i&&i("Unable to load script '"+t+"'",a)},o.appendChild(s)}},r.LoadScriptAsync=function(t,e){var i=this;return new Promise(function(n,o){i.LoadScript(t,function(){n()},function(s,a){o(a)})})},r.ReadFileAsDataURL=function(t,e,i){var n=new FileReader,o={onCompleteObservable:new E,abort:function(){return n.abort()}};return n.onloadend=function(s){o.onCompleteObservable.notifyObservers(o)},n.onload=function(s){e(s.target.result)},n.onprogress=i,n.readAsDataURL(t),o},r.ReadFile=function(t,e,i,n,o){return H.ReadFile(t,e,i,n,o)},r.FileAsURL=function(t){var e=new Blob([t]),i=window.URL||window.webkitURL,n=i.createObjectURL(e);return n},r.Format=function(t,e){return e===void 0&&(e=2),t.toFixed(e)},r.DeepCopy=function(t,e,i,n){He.DeepCopy(t,e,i,n)},r.IsEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},r.RegisterTopRootEvents=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch{}}},r.UnregisterTopRootEvents=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.removeEventListener(n.name,n.handler);try{t.parent&&t.parent.removeEventListener(n.name,n.handler)}catch{}}},r.DumpFramebuffer=function(t,e,i,n,o,s){o===void 0&&(o="image/png");for(var a=t*4,u=e/2,h=i.readPixels(0,0,t,e),f=0;f<u;f++)for(var l=0;l<a;l++){var c=l+f*a,p=e-f-1,d=l+p*a,v=h[c];h[c]=h[d],h[d]=v}r._ScreenshotCanvas||(r._ScreenshotCanvas=document.createElement("canvas")),r._ScreenshotCanvas.width=t,r._ScreenshotCanvas.height=e;var y=r._ScreenshotCanvas.getContext("2d");if(y){var b=y.createImageData(t,e),m=b.data;m.set(h),y.putImageData(b,0,0),r.EncodeScreenshotCanvasData(n,o,s)}},r.ToBlob=function(t,e,i){i===void 0&&(i="image/png"),t.toBlob||(t.toBlob=function(n,o,s){var a=this;setTimeout(function(){for(var u=atob(a.toDataURL(o,s).split(",")[1]),h=u.length,f=new Uint8Array(h),l=0;l<h;l++)f[l]=u.charCodeAt(l);n(new Blob([f]))})}),t.toBlob(function(n){e(n)},i)},r.EncodeScreenshotCanvasData=function(t,e,i){if(e===void 0&&(e="image/png"),t){var n=r._ScreenshotCanvas.toDataURL(e);t(n)}else this.ToBlob(r._ScreenshotCanvas,function(o){if("download"in document.createElement("a")){if(!i){var s=new Date,a=(s.getFullYear()+"-"+(s.getMonth()+1)).slice(2)+"-"+s.getDate()+"_"+s.getHours()+"-"+("0"+s.getMinutes()).slice(-2);i="screenshot_"+a+".png"}r.Download(o,i)}else{var u=URL.createObjectURL(o),h=window.open("");if(!h)return;var f=h.document.createElement("img");f.onload=function(){URL.revokeObjectURL(u)},f.src=u,h.document.body.appendChild(f)}},e)},r.Download=function(t,e){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(t,e);return}var i=window.URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=i,n.download=e,n.addEventListener("click",function(){n.parentElement&&n.parentElement.removeChild(n)}),n.click(),window.URL.revokeObjectURL(i)},r.BackCompatCameraNoPreventDefault=function(t){return typeof t[0]=="boolean"?t[0]:typeof t[1]=="boolean"?t[1]:!1},r.CreateScreenshot=function(t,e,i,n,o){throw S.WarnImport("ScreenshotTools")},r.CreateScreenshotAsync=function(t,e,i,n){throw S.WarnImport("ScreenshotTools")},r.CreateScreenshotUsingRenderTarget=function(t,e,i,n,o,s,a,u){throw S.WarnImport("ScreenshotTools")},r.CreateScreenshotUsingRenderTargetAsync=function(t,e,i,n,o,s,a){throw S.WarnImport("ScreenshotTools")},r.RandomId=function(){return gi.RandomId()},r.IsBase64=function(t){return t.length<5?!1:t.substr(0,5)==="data:"},r.DecodeBase64=function(t){for(var e=atob(t.split(",")[1]),i=e.length,n=new Uint8Array(new ArrayBuffer(i)),o=0;o<i;o++)n[o]=e.charCodeAt(o);return n.buffer},r.GetAbsoluteUrl=function(t){var e=document.createElement("a");return e.href=t,e.href},Object.defineProperty(r,"errorsCount",{get:function(){return z.errorsCount},enumerable:!1,configurable:!0}),r.Log=function(t){z.Log(t)},r.Warn=function(t){z.Warn(t)},r.Error=function(t){z.Error(t)},Object.defineProperty(r,"LogCache",{get:function(){return z.LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){z.ClearLogCache()},Object.defineProperty(r,"LogLevels",{set:function(t){z.LogLevels=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"PerformanceLogLevel",{set:function(t){if((t&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel){r.StartPerformanceCounter=r._StartUserMark,r.EndPerformanceCounter=r._EndUserMark;return}if((t&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel){r.StartPerformanceCounter=r._StartPerformanceConsole,r.EndPerformanceCounter=r._EndPerformanceConsole;return}r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled},enumerable:!1,configurable:!0}),r._StartPerformanceCounterDisabled=function(t,e){},r._EndPerformanceCounterDisabled=function(t,e){},r._StartUserMark=function(t,e){if(e===void 0&&(e=!0),!r._performance){if(!Dt.IsWindowObjectExist())return;r._performance=window.performance}!e||!r._performance.mark||r._performance.mark(t+"-Begin")},r._EndUserMark=function(t,e){e===void 0&&(e=!0),!(!e||!r._performance.mark)&&(r._performance.mark(t+"-End"),r._performance.measure(t,t+"-Begin",t+"-End"))},r._StartPerformanceConsole=function(t,e){e===void 0&&(e=!0),!!e&&(r._StartUserMark(t,e),console.time&&console.time(t))},r._EndPerformanceConsole=function(t,e){e===void 0&&(e=!0),!!e&&(r._EndUserMark(t,e),console.timeEnd(t))},Object.defineProperty(r,"Now",{get:function(){return kt.Now},enumerable:!1,configurable:!0}),r.GetClassName=function(t,e){e===void 0&&(e=!1);var i=null;if(!e&&t.getClassName)i=t.getClassName();else{if(t instanceof Object){var n=e?t:Object.getPrototypeOf(t);i=n.constructor.__bjsclassName__}i||(i=typeof t)}return i},r.First=function(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];if(e(o))return o}return null},r.getFullClassName=function(t,e){e===void 0&&(e=!1);var i=null,n=null;if(!e&&t.getClassName)i=t.getClassName();else{if(t instanceof Object){var o=e?t:Object.getPrototypeOf(t);i=o.constructor.__bjsclassName__,n=o.constructor.__bjsmoduleName__}i||(i=typeof t)}return i?(n!=null?n+".":"")+i:null},r.DelayAsync=function(t){return new Promise(function(e){setTimeout(function(){e()},t)})},r.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},r.UseCustomRequestHeaders=!1,r.CustomRequestHeaders=Vt.CustomRequestHeaders,r._tmpFloatArray=new Float32Array(1),r.GetDOMTextContent=Dt.GetDOMTextContent,r.NoneLogLevel=z.NoneLogLevel,r.MessageLogLevel=z.MessageLogLevel,r.WarningLogLevel=z.WarningLogLevel,r.ErrorLogLevel=z.ErrorLogLevel,r.AllLogLevel=z.AllLogLevel,r.IsWindowObjectExist=Dt.IsWindowObjectExist,r.PerformanceNoneLogLevel=0,r.PerformanceUserMarkLogLevel=1,r.PerformanceConsoleLogLevel=2,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}(),vi=function(){function r(t,e,i,n){n===void 0&&(n=0),this.iterations=t,this.index=n-1,this._done=!1,this._fn=e,this._successCallback=i}return r.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},r.prototype.breakLoop=function(){this._done=!0,this._successCallback()},r.Run=function(t,e,i,n){n===void 0&&(n=0);var o=new r(t,e,i,n);return o.executeNext(),o},r.SyncAsyncForLoop=function(t,e,i,n,o,s){return s===void 0&&(s=0),r.Run(Math.ceil(t/e),function(a){o&&o()?a.breakLoop():setTimeout(function(){for(var u=0;u<e;++u){var h=a.index*e+u;if(h>=t)break;if(i(h),o&&o()){a.breakLoop();break}}a.executeNext()},s)},n)},r}();gt.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";di.Apply();var _t=function(){function r(t){this.length=0,this.data=new Array(t),this._id=r._GlobalId++}return r.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},r.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t(this.data[e])},r.prototype.sort=function(t){this.data.sort(t)},r.prototype.reset=function(){this.length=0},r.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},r.prototype.concat=function(t){if(t.length!==0){this.length+t.length>this.data.length&&(this.data.length=(this.length+t.length)*2);for(var e=0;e<t.length;e++)this.data[this.length++]=(t.data||t)[e]}},r.prototype.indexOf=function(t){var e=this.data.indexOf(t);return e>=this.length?-1:e},r.prototype.contains=function(t){return this.indexOf(t)!==-1},r._GlobalId=0,r}(),Nt=function(r){U(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e._duplicateId=0,e}return t.prototype.push=function(e){r.prototype.push.call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(e),!0)},t.prototype.reset=function(){r.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(var i=0;i<e.length;i++){var n=(e.data||e)[i];this.pushNoDuplicate(n)}}},t}(_t),Ee=function(){function r(){this._count=0,this._data={}}return r.prototype.copyFrom=function(t){var e=this;this.clear(),t.forEach(function(i,n){return e.add(i,n)})},r.prototype.get=function(t){var e=this._data[t];if(e!==void 0)return e},r.prototype.getOrAddWithFactory=function(t,e){var i=this.get(t);return i!==void 0||(i=e(t),i&&this.add(t,i)),i},r.prototype.getOrAdd=function(t,e){var i=this.get(t);return i!==void 0?i:(this.add(t,e),e)},r.prototype.contains=function(t){return this._data[t]!==void 0},r.prototype.add=function(t,e){return this._data[t]!==void 0?!1:(this._data[t]=e,++this._count,!0)},r.prototype.set=function(t,e){return this._data[t]===void 0?!1:(this._data[t]=e,!0)},r.prototype.getAndRemove=function(t){var e=this.get(t);return e!==void 0?(delete this._data[t],--this._count,e):null},r.prototype.remove=function(t){return this.contains(t)?(delete this._data[t],--this._count,!0):!1},r.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(r.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),r.prototype.forEach=function(t){for(var e in this._data){var i=this._data[e];t(e,i)}},r.prototype.first=function(t){for(var e in this._data){var i=this._data[e],n=t(e,i);if(n)return n}return null},r}(),yi=function(){function r(){}return r.Eval=function(t,e){return t.match(/\([^\(\)]*\)/g)?t=t.replace(/\([^\(\)]*\)/g,function(i){return i=i.slice(1,i.length-1),r._HandleParenthesisContent(i,e)}):t=r._HandleParenthesisContent(t,e),t==="true"?!0:t==="false"?!1:r.Eval(t,e)},r._HandleParenthesisContent=function(t,e){e=e||function(f){return f==="true"};var i,n=t.split("||");for(var o in n)if(n.hasOwnProperty(o)){var s=r._SimplifyNegation(n[o].trim()),a=s.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=r._SimplifyNegation(a[u].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?i=!e(h.substring(1)):i=e(h):i=h==="true",!i){s="false";break}}if(i||s==="true"){i=!0;break}s!=="true"&&s!=="false"?s[0]==="!"?i=!e(s.substring(1)):i=e(s):i=s==="true"}return i?"true":"false"},r._SimplifyNegation=function(t){return t=t.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),t=t.trim(),t==="!true"?t="false":t==="!false"&&(t="true"),t},r}(),k=function(){function r(){}return r.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return r.HasTags(t)},t.addTags=function(e){return r.AddTagsTo(t,e)},t.removeTags=function(e){return r.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return r.MatchesQuery(t,e)}},r.DisableFor=function(t){delete t._tags,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery},r.HasTags=function(t){if(!t._tags)return!1;var e=t._tags;for(var i in e)if(e.hasOwnProperty(i))return!0;return!1},r.GetTags=function(t,e){if(e===void 0&&(e=!0),!t._tags)return null;if(e){var i=[];for(var n in t._tags)t._tags.hasOwnProperty(n)&&t._tags[n]===!0&&i.push(n);return i.join(" ")}else return t._tags},r.AddTagsTo=function(t,e){if(!!e&&typeof e=="string"){var i=e.split(" ");i.forEach(function(n,o,s){r._AddTagTo(t,n)})}},r._AddTagTo=function(t,e){e=e.trim(),!(e===""||e==="true"||e==="false")&&(e.match(/[\s]/)||e.match(/^([!]|([|]|[&]){2})/)||(r.EnableFor(t),t._tags[e]=!0))},r.RemoveTagsFrom=function(t,e){if(!!r.HasTags(t)){var i=e.split(" ");for(var n in i)r._RemoveTagFrom(t,i[n])}},r._RemoveTagFrom=function(t,e){delete t._tags[e]},r.MatchesQuery=function(t,e){return e===void 0?!0:e===""?r.HasTags(t):yi.Eval(e,function(i){return r.HasTags(t)&&t._tags[i]})},r}(),L=function(){function r(){}return r.WithinEpsilon=function(t,e,i){i===void 0&&(i=1401298e-51);var n=t-e;return-i<=n&&n<=i},r.ToHex=function(t){var e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()},r.Sign=function(t){return t=+t,t===0||isNaN(t)?t:t>0?1:-1},r.Clamp=function(t,e,i){return e===void 0&&(e=0),i===void 0&&(i=1),Math.min(i,Math.max(e,t))},r.Log2=function(t){return Math.log(t)*Math.LOG2E},r.Repeat=function(t,e){return t-Math.floor(t/e)*e},r.Normalize=function(t,e,i){return(t-e)/(i-e)},r.Denormalize=function(t,e,i){return t*(i-e)+e},r.DeltaAngle=function(t,e){var i=r.Repeat(e-t,360);return i>180&&(i-=360),i},r.PingPong=function(t,e){var i=r.Repeat(t,e*2);return e-Math.abs(i-e)},r.SmoothStep=function(t,e,i){var n=r.Clamp(i);return n=-2*n*n*n+3*n*n,e*n+t*(1-n)},r.MoveTowards=function(t,e,i){var n=0;return Math.abs(e-t)<=i?n=e:n=t+r.Sign(e-t)*i,n},r.MoveTowardsAngle=function(t,e,i){var n=r.DeltaAngle(t,e),o=0;return-i<n&&n<i?o=e:(e=t+n,o=r.MoveTowards(t,e,i)),o},r.Lerp=function(t,e,i){return t+(e-t)*i},r.LerpAngle=function(t,e,i){var n=r.Repeat(e-t,360);return n>180&&(n-=360),t+n*r.Clamp(i)},r.InverseLerp=function(t,e,i){var n=0;return t!=e?n=r.Clamp((i-t)/(e-t)):n=0,n},r.Hermite=function(t,e,i,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s;return t*u+i*h+e*f+n*l},r.RandomRange=function(t,e){return t===e?t:Math.random()*(e-t)+t},r.RangeToPercent=function(t,e,i){return(t-e)/(i-e)},r.PercentToRange=function(t,e,i){return(i-e)*t+e},r.NormalizeRadians=function(t){return t-=r.TwoPi*Math.floor((t+Math.PI)/r.TwoPi),t},r.TwoPi=Math.PI*2,r}(),Lt=1/2.2,Ut=2.2,X=.001,et=function(){function r(){}return r.BuildArray=function(t,e){for(var i=[],n=0;n<t;++n)i.push(e());return i},r}(),G=function(){function r(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}return r.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},r.prototype.getClassName=function(){return"Vector2"},r.prototype.getHashCode=function(){var t=this.x|0;return t=t*397^(this.y|0),t},r.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,this},r.prototype.fromArray=function(t,e){return e===void 0&&(e=0),r.FromArrayToRef(t,e,this),this},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},r.prototype.copyFromFloats=function(t,e){return this.x=t,this.y=e,this},r.prototype.set=function(t,e){return this.copyFromFloats(t,e)},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.addToRef=function(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,this},r.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this},r.prototype.addVector3=function(t){return new r(this.x+t.x,this.y+t.y)},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y)},r.prototype.subtractToRef=function(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,this},r.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},r.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},r.prototype.multiply=function(t){return new r(this.x*t.x,this.y*t.y)},r.prototype.multiplyToRef=function(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,this},r.prototype.multiplyByFloats=function(t,e){return new r(this.x*t,this.y*e)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y)},r.prototype.divideToRef=function(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,this},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.negate=function(){return new r(-this.x,-this.y)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(this.x*-1,this.y*-1)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},r.prototype.scale=function(t){var e=new r(0,0);return this.scaleToRef(t,e),e},r.prototype.scaleToRef=function(t,e){return e.x=this.x*t,e.y=this.y*t,this},r.prototype.scaleAndAddToRef=function(t,e){return e.x+=this.x*t,e.y+=this.y*t,this},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},r.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=X),t&&L.WithinEpsilon(this.x,t.x,e)&&L.WithinEpsilon(this.y,t.y,e)},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){var t=this.length();return t===0?this:(this.x/=t,this.y/=t,this)},r.prototype.clone=function(){return new r(this.x,this.y)},r.Zero=function(){return new r(0,0)},r.One=function(){return new r(1,1)},r.FromArray=function(t,e){return e===void 0&&(e=0),new r(t[e],t[e+1])},r.FromArrayToRef=function(t,e,i){i.x=t[e],i.y=t[e+1]},r.CatmullRom=function(t,e,i,n,o){var s=o*o,a=o*s,u=.5*(2*e.x+(-t.x+i.x)*o+(2*t.x-5*e.x+4*i.x-n.x)*s+(-t.x+3*e.x-3*i.x+n.x)*a),h=.5*(2*e.y+(-t.y+i.y)*o+(2*t.y-5*e.y+4*i.y-n.y)*s+(-t.y+3*e.y-3*i.y+n.y)*a);return new r(u,h)},r.Clamp=function(t,e,i){var n=t.x;n=n>i.x?i.x:n,n=n<e.x?e.x:n;var o=t.y;return o=o>i.y?i.y:o,o=o<e.y?e.y:o,new r(n,o)},r.Hermite=function(t,e,i,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t.x*u+i.x*h+e.x*f+n.x*l,p=t.y*u+i.y*h+e.y*f+n.y*l;return new r(c,p)},r.Lerp=function(t,e,i){var n=t.x+(e.x-t.x)*i,o=t.y+(e.y-t.y)*i;return new r(n,o)},r.Dot=function(t,e){return t.x*e.x+t.y*e.y},r.Normalize=function(t){var e=t.clone();return e.normalize(),e},r.Minimize=function(t,e){var i=t.x<e.x?t.x:e.x,n=t.y<e.y?t.y:e.y;return new r(i,n)},r.Maximize=function(t,e){var i=t.x>e.x?t.x:e.x,n=t.y>e.y?t.y:e.y;return new r(i,n)},r.Transform=function(t,e){var i=r.Zero();return r.TransformToRef(t,e,i),i},r.TransformToRef=function(t,e,i){var n=e.m,o=t.x*n[0]+t.y*n[4]+n[12],s=t.x*n[1]+t.y*n[5]+n[13];i.x=o,i.y=s},r.PointInTriangle=function(t,e,i,n){var o=.5*(-i.y*n.x+e.y*(-i.x+n.x)+e.x*(i.y-n.y)+i.x*n.y),s=o<0?-1:1,a=(e.y*n.x-e.x*n.y+(n.y-e.y)*t.x+(e.x-n.x)*t.y)*s,u=(e.x*i.y-e.y*i.x+(e.y-i.y)*t.x+(i.x-e.x)*t.y)*s;return a>0&&u>0&&a+u<2*o*s},r.Distance=function(t,e){return Math.sqrt(r.DistanceSquared(t,e))},r.DistanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},r.Center=function(t,e){var i=t.add(e);return i.scaleInPlace(.5),i},r.DistanceOfPointFromSegment=function(t,e,i){var n=r.DistanceSquared(e,i);if(n===0)return r.Distance(t,e);var o=i.subtract(e),s=Math.max(0,Math.min(1,r.Dot(t.subtract(e),o)/n)),a=e.add(o.multiplyByFloats(s,s));return r.Distance(t,a)},r}(),g=function(){function r(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this._isDirty=!0,this._x=t,this._y=e,this._z=i}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},r.prototype.getClassName=function(){return"Vector3"},r.prototype.getHashCode=function(){var t=this._x|0;return t=t*397^(this._y|0),t=t*397^(this._z|0),t},r.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},r.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,this},r.prototype.fromArray=function(t,e){return e===void 0&&(e=0),r.FromArrayToRef(t,e,this),this},r.prototype.toQuaternion=function(){return N.RotationYawPitchRoll(this._y,this._x,this._z)},r.prototype.addInPlace=function(t){return this.addInPlaceFromFloats(t._x,t._y,t._z)},r.prototype.addInPlaceFromFloats=function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this},r.prototype.add=function(t){return new r(this._x+t._x,this._y+t._y,this._z+t._z)},r.prototype.addToRef=function(t,e){return e.copyFromFloats(this._x+t._x,this._y+t._y,this._z+t._z)},r.prototype.subtractInPlace=function(t){return this.x-=t._x,this.y-=t._y,this.z-=t._z,this},r.prototype.subtract=function(t){return new r(this._x-t._x,this._y-t._y,this._z-t._z)},r.prototype.subtractToRef=function(t,e){return this.subtractFromFloatsToRef(t._x,t._y,t._z,e)},r.prototype.subtractFromFloats=function(t,e,i){return new r(this._x-t,this._y-e,this._z-i)},r.prototype.subtractFromFloatsToRef=function(t,e,i,n){return n.copyFromFloats(this._x-t,this._y-e,this._z-i)},r.prototype.negate=function(){return new r(-this._x,-this._y,-this._z)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},r.prototype.scale=function(t){return new r(this._x*t,this._y*t,this._z*t)},r.prototype.scaleToRef=function(t,e){return e.copyFromFloats(this._x*t,this._y*t,this._z*t)},r.prototype.scaleAndAddToRef=function(t,e){return e.addInPlaceFromFloats(this._x*t,this._y*t,this._z*t)},r.prototype.projectOnPlane=function(t,e){var i=r.Zero();return this.projectOnPlaneToRef(t,e,i),i},r.prototype.projectOnPlaneToRef=function(t,e,i){var n=t.normal,o=t.d,s=B.Vector3[0];this.subtractToRef(e,s),s.normalize();var a=r.Dot(s,n),u=-(r.Dot(e,n)+o)/a,h=s.scaleInPlace(u);e.addToRef(h,i)},r.prototype.equals=function(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z},r.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=X),t&&L.WithinEpsilon(this._x,t._x,e)&&L.WithinEpsilon(this._y,t._y,e)&&L.WithinEpsilon(this._z,t._z,e)},r.prototype.equalsToFloats=function(t,e,i){return this._x===t&&this._y===e&&this._z===i},r.prototype.multiplyInPlace=function(t){return this.x*=t._x,this.y*=t._y,this.z*=t._z,this},r.prototype.multiply=function(t){return this.multiplyByFloats(t._x,t._y,t._z)},r.prototype.multiplyToRef=function(t,e){return e.copyFromFloats(this._x*t._x,this._y*t._y,this._z*t._z)},r.prototype.multiplyByFloats=function(t,e,i){return new r(this._x*t,this._y*e,this._z*i)},r.prototype.divide=function(t){return new r(this._x/t._x,this._y/t._y,this._z/t._z)},r.prototype.divideToRef=function(t,e){return e.copyFromFloats(this._x/t._x,this._y/t._y,this._z/t._z)},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.minimizeInPlace=function(t){return this.minimizeInPlaceFromFloats(t._x,t._y,t._z)},r.prototype.maximizeInPlace=function(t){return this.maximizeInPlaceFromFloats(t._x,t._y,t._z)},r.prototype.minimizeInPlaceFromFloats=function(t,e,i){return t<this._x&&(this.x=t),e<this._y&&(this.y=e),i<this._z&&(this.z=i),this},r.prototype.maximizeInPlaceFromFloats=function(t,e,i){return t>this._x&&(this.x=t),e>this._y&&(this.y=e),i>this._z&&(this.z=i),this},r.prototype.isNonUniformWithinEpsilon=function(t){var e=Math.abs(this._x),i=Math.abs(this._y);if(!L.WithinEpsilon(e,i,t))return!0;var n=Math.abs(this._z);return!L.WithinEpsilon(e,n,t)||!L.WithinEpsilon(i,n,t)},Object.defineProperty(r.prototype,"isNonUniform",{get:function(){var t=Math.abs(this._x),e=Math.abs(this._y);if(t!==e)return!0;var i=Math.abs(this._z);return t!==i},enumerable:!1,configurable:!0}),r.prototype.floor=function(){return new r(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},r.prototype.fract=function(){return new r(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},r.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},r.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},r.prototype.normalize=function(){return this.normalizeFromLength(this.length())},r.prototype.reorderInPlace=function(t){var e=this;return t=t.toLowerCase(),t==="xyz"?this:(B.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(i,n){e[i]=B.Vector3[0][t[n]]}),this)},r.prototype.rotateByQuaternionToRef=function(t,e){return t.toRotationMatrix(B.Matrix[0]),r.TransformCoordinatesToRef(this,B.Matrix[0],e),e},r.prototype.rotateByQuaternionAroundPointToRef=function(t,e,i){return this.subtractToRef(e,B.Vector3[0]),B.Vector3[0].rotateByQuaternionToRef(t,B.Vector3[0]),e.addToRef(B.Vector3[0],i),i},r.prototype.cross=function(t){return r.Cross(this,t)},r.prototype.normalizeFromLength=function(t){return t===0||t===1?this:this.scaleInPlace(1/t)},r.prototype.normalizeToNew=function(){var t=new r(0,0,0);return this.normalizeToRef(t),t},r.prototype.normalizeToRef=function(t){var e=this.length();return e===0||e===1?t.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/e,t)},r.prototype.clone=function(){return new r(this._x,this._y,this._z)},r.prototype.copyFrom=function(t){return this.copyFromFloats(t._x,t._y,t._z)},r.prototype.copyFromFloats=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},r.prototype.set=function(t,e,i){return this.copyFromFloats(t,e,i)},r.prototype.setAll=function(t){return this.x=this.y=this.z=t,this},r.GetClipFactor=function(t,e,i,n){var o=r.Dot(t,i)-n,s=r.Dot(e,i)-n,a=o/(o-s);return a},r.GetAngleBetweenVectors=function(t,e,i){var n=t.normalizeToRef(B.Vector3[1]),o=e.normalizeToRef(B.Vector3[2]),s=r.Dot(n,o),a=B.Vector3[3];return r.CrossToRef(n,o,a),r.Dot(a,i)>0?Math.acos(s):-Math.acos(s)},r.FromArray=function(t,e){return e===void 0&&(e=0),new r(t[e],t[e+1],t[e+2])},r.FromFloatArray=function(t,e){return r.FromArray(t,e)},r.FromArrayToRef=function(t,e,i){i.x=t[e],i.y=t[e+1],i.z=t[e+2]},r.FromFloatArrayToRef=function(t,e,i){return r.FromArrayToRef(t,e,i)},r.FromFloatsToRef=function(t,e,i,n){n.copyFromFloats(t,e,i)},r.Zero=function(){return new r(0,0,0)},r.One=function(){return new r(1,1,1)},r.Up=function(){return new r(0,1,0)},Object.defineProperty(r,"UpReadOnly",{get:function(){return r._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ZeroReadOnly",{get:function(){return r._ZeroReadOnly},enumerable:!1,configurable:!0}),r.Down=function(){return new r(0,-1,0)},r.Forward=function(t){return t===void 0&&(t=!1),new r(0,0,t?-1:1)},r.Backward=function(t){return t===void 0&&(t=!1),new r(0,0,t?1:-1)},r.Right=function(){return new r(1,0,0)},r.Left=function(){return new r(-1,0,0)},r.TransformCoordinates=function(t,e){var i=r.Zero();return r.TransformCoordinatesToRef(t,e,i),i},r.TransformCoordinatesToRef=function(t,e,i){r.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,e,i)},r.TransformCoordinatesFromFloatsToRef=function(t,e,i,n,o){var s=n.m,a=t*s[0]+e*s[4]+i*s[8]+s[12],u=t*s[1]+e*s[5]+i*s[9]+s[13],h=t*s[2]+e*s[6]+i*s[10]+s[14],f=1/(t*s[3]+e*s[7]+i*s[11]+s[15]);o.x=a*f,o.y=u*f,o.z=h*f},r.TransformNormal=function(t,e){var i=r.Zero();return r.TransformNormalToRef(t,e,i),i},r.TransformNormalToRef=function(t,e,i){this.TransformNormalFromFloatsToRef(t._x,t._y,t._z,e,i)},r.TransformNormalFromFloatsToRef=function(t,e,i,n,o){var s=n.m;o.x=t*s[0]+e*s[4]+i*s[8],o.y=t*s[1]+e*s[5]+i*s[9],o.z=t*s[2]+e*s[6]+i*s[10]},r.CatmullRom=function(t,e,i,n,o){var s=o*o,a=o*s,u=.5*(2*e._x+(-t._x+i._x)*o+(2*t._x-5*e._x+4*i._x-n._x)*s+(-t._x+3*e._x-3*i._x+n._x)*a),h=.5*(2*e._y+(-t._y+i._y)*o+(2*t._y-5*e._y+4*i._y-n._y)*s+(-t._y+3*e._y-3*i._y+n._y)*a),f=.5*(2*e._z+(-t._z+i._z)*o+(2*t._z-5*e._z+4*i._z-n._z)*s+(-t._z+3*e._z-3*i._z+n._z)*a);return new r(u,h,f)},r.Clamp=function(t,e,i){var n=new r;return r.ClampToRef(t,e,i,n),n},r.ClampToRef=function(t,e,i,n){var o=t._x;o=o>i._x?i._x:o,o=o<e._x?e._x:o;var s=t._y;s=s>i._y?i._y:s,s=s<e._y?e._y:s;var a=t._z;a=a>i._z?i._z:a,a=a<e._z?e._z:a,n.copyFromFloats(o,s,a)},r.CheckExtends=function(t,e,i){e.minimizeInPlace(t),i.maximizeInPlace(t)},r.Hermite=function(t,e,i,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t._x*u+i._x*h+e._x*f+n._x*l,p=t._y*u+i._y*h+e._y*f+n._y*l,d=t._z*u+i._z*h+e._z*f+n._z*l;return new r(c,p,d)},r.Lerp=function(t,e,i){var n=new r(0,0,0);return r.LerpToRef(t,e,i,n),n},r.LerpToRef=function(t,e,i,n){n.x=t._x+(e._x-t._x)*i,n.y=t._y+(e._y-t._y)*i,n.z=t._z+(e._z-t._z)*i},r.Dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},r.Cross=function(t,e){var i=r.Zero();return r.CrossToRef(t,e,i),i},r.CrossToRef=function(t,e,i){var n=t._y*e._z-t._z*e._y,o=t._z*e._x-t._x*e._z,s=t._x*e._y-t._y*e._x;i.copyFromFloats(n,o,s)},r.Normalize=function(t){var e=r.Zero();return r.NormalizeToRef(t,e),e},r.NormalizeToRef=function(t,e){t.normalizeToRef(e)},r.Project=function(t,e,i,n){var o=new r;return r.ProjectToRef(t,e,i,n,o),o},r.ProjectToRef=function(t,e,i,n,o){var s=n.width,a=n.height,u=n.x,h=n.y,f=B.Matrix[1];O.FromValuesToRef(s/2,0,0,0,0,-a/2,0,0,0,0,.5,0,u+s/2,a/2+h,.5,1,f);var l=B.Matrix[0];return e.multiplyToRef(i,l),l.multiplyToRef(f,l),r.TransformCoordinatesToRef(t,l,o),o},r._UnprojectFromInvertedMatrixToRef=function(t,e,i){r.TransformCoordinatesToRef(t,e,i);var n=e.m,o=t._x*n[3]+t._y*n[7]+t._z*n[11]+n[15];L.WithinEpsilon(o,1)&&i.scaleInPlace(1/o)},r.UnprojectFromTransform=function(t,e,i,n,o){var s=B.Matrix[0];n.multiplyToRef(o,s),s.invert(),t.x=t._x/e*2-1,t.y=-(t._y/i*2-1);var a=new r;return r._UnprojectFromInvertedMatrixToRef(t,s,a),a},r.Unproject=function(t,e,i,n,o,s){var a=r.Zero();return r.UnprojectToRef(t,e,i,n,o,s,a),a},r.UnprojectToRef=function(t,e,i,n,o,s,a){r.UnprojectFloatsToRef(t._x,t._y,t._z,e,i,n,o,s,a)},r.UnprojectFloatsToRef=function(t,e,i,n,o,s,a,u,h){var f=B.Matrix[0];s.multiplyToRef(a,f),f.multiplyToRef(u,f),f.invert();var l=B.Vector3[0];l.x=t/n*2-1,l.y=-(e/o*2-1),l.z=2*i-1,r._UnprojectFromInvertedMatrixToRef(l,f,h)},r.Minimize=function(t,e){var i=t.clone();return i.minimizeInPlace(e),i},r.Maximize=function(t,e){var i=t.clone();return i.maximizeInPlace(e),i},r.Distance=function(t,e){return Math.sqrt(r.DistanceSquared(t,e))},r.DistanceSquared=function(t,e){var i=t._x-e._x,n=t._y-e._y,o=t._z-e._z;return i*i+n*n+o*o},r.Center=function(t,e){var i=t.add(e);return i.scaleInPlace(.5),i},r.RotationFromAxis=function(t,e,i){var n=r.Zero();return r.RotationFromAxisToRef(t,e,i,n),n},r.RotationFromAxisToRef=function(t,e,i,n){var o=B.Quaternion[0];N.RotationQuaternionFromAxisToRef(t,e,i,o),o.toEulerAnglesToRef(n)},r._UpReadOnly=r.Up(),r._ZeroReadOnly=r.Zero(),r}(),Ct=function(){function r(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},r.prototype.getClassName=function(){return"Vector4"},r.prototype.getHashCode=function(){var t=this.x|0;return t=t*397^(this.y|0),t=t*397^(this.z|0),t=t*397^(this.w|0),t},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,this},r.prototype.fromArray=function(t,e){return e===void 0&&(e=0),r.FromArrayToRef(t,e,this),this},r.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},r.prototype.addToRef=function(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,this},r.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},r.prototype.subtract=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},r.prototype.subtractToRef=function(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,this},r.prototype.subtractFromFloats=function(t,e,i,n){return new r(this.x-t,this.y-e,this.z-i,this.w-n)},r.prototype.subtractFromFloatsToRef=function(t,e,i,n,o){return o.x=this.x-t,o.y=this.y-e,o.z=this.z-i,o.w=this.w-n,this},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z,-this.w)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},r.prototype.negateToRef=function(t){return t.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.prototype.scale=function(t){return new r(this.x*t,this.y*t,this.z*t,this.w*t)},r.prototype.scaleToRef=function(t,e){return e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t,this},r.prototype.scaleAndAddToRef=function(t,e){return e.x+=this.x*t,e.y+=this.y*t,e.z+=this.z*t,e.w+=this.w*t,this},r.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},r.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=X),t&&L.WithinEpsilon(this.x,t.x,e)&&L.WithinEpsilon(this.y,t.y,e)&&L.WithinEpsilon(this.z,t.z,e)&&L.WithinEpsilon(this.w,t.w,e)},r.prototype.equalsToFloats=function(t,e,i,n){return this.x===t&&this.y===e&&this.z===i&&this.w===n},r.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},r.prototype.multiply=function(t){return new r(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},r.prototype.multiplyToRef=function(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e.w=this.w*t.w,this},r.prototype.multiplyByFloats=function(t,e,i,n){return new r(this.x*t,this.y*e,this.z*i,this.w*n)},r.prototype.divide=function(t){return new r(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},r.prototype.divideToRef=function(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,e.z=this.z/t.z,e.w=this.w/t.w,this},r.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},r.prototype.minimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},r.prototype.maximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},r.prototype.normalize=function(){var t=this.length();return t===0?this:this.scaleInPlace(1/t)},r.prototype.toVector3=function(){return new g(this.x,this.y,this.z)},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.prototype.copyFromFloats=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},r.prototype.set=function(t,e,i,n){return this.copyFromFloats(t,e,i,n)},r.prototype.setAll=function(t){return this.x=this.y=this.z=this.w=t,this},r.FromArray=function(t,e){return e||(e=0),new r(t[e],t[e+1],t[e+2],t[e+3])},r.FromArrayToRef=function(t,e,i){i.x=t[e],i.y=t[e+1],i.z=t[e+2],i.w=t[e+3]},r.FromFloatArrayToRef=function(t,e,i){r.FromArrayToRef(t,e,i)},r.FromFloatsToRef=function(t,e,i,n,o){o.x=t,o.y=e,o.z=i,o.w=n},r.Zero=function(){return new r(0,0,0,0)},r.One=function(){return new r(1,1,1,1)},r.Normalize=function(t){var e=r.Zero();return r.NormalizeToRef(t,e),e},r.NormalizeToRef=function(t,e){e.copyFrom(t),e.normalize()},r.Minimize=function(t,e){var i=t.clone();return i.minimizeInPlace(e),i},r.Maximize=function(t,e){var i=t.clone();return i.maximizeInPlace(e),i},r.Distance=function(t,e){return Math.sqrt(r.DistanceSquared(t,e))},r.DistanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y,o=t.z-e.z,s=t.w-e.w;return i*i+n*n+o*o+s*s},r.Center=function(t,e){var i=t.add(e);return i.scaleInPlace(.5),i},r.TransformNormal=function(t,e){var i=r.Zero();return r.TransformNormalToRef(t,e,i),i},r.TransformNormalToRef=function(t,e,i){var n=e.m,o=t.x*n[0]+t.y*n[4]+t.z*n[8],s=t.x*n[1]+t.y*n[5]+t.z*n[9],a=t.x*n[2]+t.y*n[6]+t.z*n[10];i.x=o,i.y=s,i.z=a,i.w=t.w},r.TransformNormalFromFloatsToRef=function(t,e,i,n,o,s){var a=o.m;s.x=t*a[0]+e*a[4]+i*a[8],s.y=t*a[1]+e*a[5]+i*a[9],s.z=t*a[2]+e*a[6]+i*a[10],s.w=n},r.FromVector3=function(t,e){return e===void 0&&(e=0),new r(t._x,t._y,t._z,e)},r}(),N=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),this._isDirty=!0,this._x=t,this._y=e,this._z=i,this._w=n}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},r.prototype.getClassName=function(){return"Quaternion"},r.prototype.getHashCode=function(){var t=this._x|0;return t=t*397^(this._y|0),t=t*397^(this._z|0),t=t*397^(this._w|0),t},r.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},r.prototype.equals=function(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w},r.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=X),t&&L.WithinEpsilon(this._x,t._x,e)&&L.WithinEpsilon(this._y,t._y,e)&&L.WithinEpsilon(this._z,t._z,e)&&L.WithinEpsilon(this._w,t._w,e)},r.prototype.clone=function(){return new r(this._x,this._y,this._z,this._w)},r.prototype.copyFrom=function(t){return this.x=t._x,this.y=t._y,this.z=t._z,this.w=t._w,this},r.prototype.copyFromFloats=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},r.prototype.set=function(t,e,i,n){return this.copyFromFloats(t,e,i,n)},r.prototype.add=function(t){return new r(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)},r.prototype.addInPlace=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this},r.prototype.subtract=function(t){return new r(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)},r.prototype.scale=function(t){return new r(this._x*t,this._y*t,this._z*t,this._w*t)},r.prototype.scaleToRef=function(t,e){return e.x=this._x*t,e.y=this._y*t,e.z=this._z*t,e.w=this._w*t,this},r.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.prototype.scaleAndAddToRef=function(t,e){return e.x+=this._x*t,e.y+=this._y*t,e.z+=this._z*t,e.w+=this._w*t,this},r.prototype.multiply=function(t){var e=new r(0,0,0,1);return this.multiplyToRef(t,e),e},r.prototype.multiplyToRef=function(t,e){var i=this._x*t._w+this._y*t._z-this._z*t._y+this._w*t._x,n=-this._x*t._z+this._y*t._w+this._z*t._x+this._w*t._y,o=this._x*t._y-this._y*t._x+this._z*t._w+this._w*t._z,s=-this._x*t._x-this._y*t._y-this._z*t._z+this._w*t._w;return e.copyFromFloats(i,n,o,s),this},r.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},r.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},r.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.conjugate=function(){var t=new r(-this._x,-this._y,-this._z,this._w);return t},r.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},r.prototype.normalize=function(){var t=this.length();if(t===0)return this;var e=1/t;return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},r.prototype.toEulerAngles=function(t){var e=g.Zero();return this.toEulerAnglesToRef(e),e},r.prototype.toEulerAnglesToRef=function(t){var e=this._z,i=this._x,n=this._y,o=this._w,s=o*o,a=e*e,u=i*i,h=n*n,f=n*e-i*o,l=.4999999;return f<-l?(t.y=2*Math.atan2(n,o),t.x=Math.PI/2,t.z=0):f>l?(t.y=2*Math.atan2(n,o),t.x=-Math.PI/2,t.z=0):(t.z=Math.atan2(2*(i*n+e*o),-a-u+h+s),t.x=Math.asin(-2*(e*n-i*o)),t.y=Math.atan2(2*(e*i+n*o),a-u-h+s)),this},r.prototype.toRotationMatrix=function(t){return O.FromQuaternionToRef(this,t),this},r.prototype.fromRotationMatrix=function(t){return r.FromRotationMatrixToRef(t,this),this},r.FromRotationMatrix=function(t){var e=new r;return r.FromRotationMatrixToRef(t,e),e},r.FromRotationMatrixToRef=function(t,e){var i=t.m,n=i[0],o=i[4],s=i[8],a=i[1],u=i[5],h=i[9],f=i[2],l=i[6],c=i[10],p=n+u+c,d;p>0?(d=.5/Math.sqrt(p+1),e.w=.25/d,e.x=(l-h)*d,e.y=(s-f)*d,e.z=(a-o)*d):n>u&&n>c?(d=2*Math.sqrt(1+n-u-c),e.w=(l-h)/d,e.x=.25*d,e.y=(o+a)/d,e.z=(s+f)/d):u>c?(d=2*Math.sqrt(1+u-n-c),e.w=(s-f)/d,e.x=(o+a)/d,e.y=.25*d,e.z=(h+l)/d):(d=2*Math.sqrt(1+c-n-u),e.w=(a-o)/d,e.x=(s+f)/d,e.y=(h+l)/d,e.z=.25*d)},r.Dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},r.AreClose=function(t,e){var i=r.Dot(t,e);return i>=0},r.Zero=function(){return new r(0,0,0,0)},r.Inverse=function(t){return new r(-t._x,-t._y,-t._z,t._w)},r.InverseToRef=function(t,e){return e.set(-t._x,-t._y,-t._z,t._w),e},r.Identity=function(){return new r(0,0,0,1)},r.IsIdentity=function(t){return t&&t._x===0&&t._y===0&&t._z===0&&t._w===1},r.RotationAxis=function(t,e){return r.RotationAxisToRef(t,e,new r)},r.RotationAxisToRef=function(t,e,i){var n=Math.sin(e/2);return t.normalize(),i.w=Math.cos(e/2),i.x=t._x*n,i.y=t._y*n,i.z=t._z*n,i},r.FromArray=function(t,e){return e||(e=0),new r(t[e],t[e+1],t[e+2],t[e+3])},r.FromArrayToRef=function(t,e,i){i.x=t[e],i.y=t[e+1],i.z=t[e+2],i.w=t[e+3]},r.FromEulerAngles=function(t,e,i){var n=new r;return r.RotationYawPitchRollToRef(e,t,i,n),n},r.FromEulerAnglesToRef=function(t,e,i,n){return r.RotationYawPitchRollToRef(e,t,i,n),n},r.FromEulerVector=function(t){var e=new r;return r.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e},r.FromEulerVectorToRef=function(t,e){return r.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e},r.RotationYawPitchRoll=function(t,e,i){var n=new r;return r.RotationYawPitchRollToRef(t,e,i,n),n},r.RotationYawPitchRollToRef=function(t,e,i,n){var o=i*.5,s=e*.5,a=t*.5,u=Math.sin(o),h=Math.cos(o),f=Math.sin(s),l=Math.cos(s),c=Math.sin(a),p=Math.cos(a);n.x=p*f*h+c*l*u,n.y=c*l*h-p*f*u,n.z=p*l*u-c*f*h,n.w=p*l*h+c*f*u},r.RotationAlphaBetaGamma=function(t,e,i){var n=new r;return r.RotationAlphaBetaGammaToRef(t,e,i,n),n},r.RotationAlphaBetaGammaToRef=function(t,e,i,n){var o=(i+t)*.5,s=(i-t)*.5,a=e*.5;n.x=Math.cos(s)*Math.sin(a),n.y=Math.sin(s)*Math.sin(a),n.z=Math.sin(o)*Math.cos(a),n.w=Math.cos(o)*Math.cos(a)},r.RotationQuaternionFromAxis=function(t,e,i){var n=new r(0,0,0,0);return r.RotationQuaternionFromAxisToRef(t,e,i,n),n},r.RotationQuaternionFromAxisToRef=function(t,e,i,n){var o=B.Matrix[0];O.FromXYZAxesToRef(t.normalize(),e.normalize(),i.normalize(),o),r.FromRotationMatrixToRef(o,n)},r.Slerp=function(t,e,i){var n=r.Identity();return r.SlerpToRef(t,e,i,n),n},r.SlerpToRef=function(t,e,i,n){var o,s,a=t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w,u=!1;if(a<0&&(u=!0,a=-a),a>.999999)s=1-i,o=u?-i:i;else{var h=Math.acos(a),f=1/Math.sin(h);s=Math.sin((1-i)*h)*f,o=u?-Math.sin(i*h)*f:Math.sin(i*h)*f}n.x=s*t._x+o*e._x,n.y=s*t._y+o*e._y,n.z=s*t._z+o*e._z,n.w=s*t._w+o*e._w},r.Hermite=function(t,e,i,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t._x*u+i._x*h+e._x*f+n._x*l,p=t._y*u+i._y*h+e._y*f+n._y*l,d=t._z*u+i._z*h+e._z*f+n._z*l,v=t._w*u+i._w*h+e._w*f+n._w*l;return new r(c,p,d,v)},r}(),O=function(){function r(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Bt.MatrixTrackPrecisionChange&&Bt.MatrixTrackedMatrices.push(this),this._m=new Bt.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(r,"Use64Bits",{get:function(){return Bt.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),r.prototype._markAsUpdated=function(){this.updateFlag=r._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},r.prototype._updateIdentityStatus=function(t,e,i,n){e===void 0&&(e=!1),i===void 0&&(i=!1),n===void 0&&(n=!0),this.updateFlag=r._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||i,this._isIdentityDirty=this._isIdentity?!1:e,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:n},r.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var t=this._m;this._isIdentity=t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1}return this._isIdentity},r.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},r.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var t=this._m,e=t[0],i=t[1],n=t[2],o=t[3],s=t[4],a=t[5],u=t[6],h=t[7],f=t[8],l=t[9],c=t[10],p=t[11],d=t[12],v=t[13],y=t[14],b=t[15],m=c*b-y*p,M=l*b-v*p,R=l*y-v*c,D=f*b-d*p,I=f*y-c*d,A=f*v-d*l,x=+(a*m-u*M+h*R),W=-(s*m-u*D+h*I),q=+(s*M-a*D+h*A),Q=-(s*R-a*I+u*A);return e*x+i*W+n*q+o*Q},r.prototype.toArray=function(){return this._m},r.prototype.asArray=function(){return this._m},r.prototype.invert=function(){return this.invertToRef(this),this},r.prototype.reset=function(){return r.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},r.prototype.add=function(t){var e=new r;return this.addToRef(t,e),e},r.prototype.addToRef=function(t,e){for(var i=this._m,n=e._m,o=t.m,s=0;s<16;s++)n[s]=i[s]+o[s];return e._markAsUpdated(),this},r.prototype.addToSelf=function(t){for(var e=this._m,i=t.m,n=0;n<16;n++)e[n]+=i[n];return this._markAsUpdated(),this},r.prototype.invertToRef=function(t){if(this._isIdentity===!0)return r.IdentityToRef(t),this;var e=this._m,i=e[0],n=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],f=e[7],l=e[8],c=e[9],p=e[10],d=e[11],v=e[12],y=e[13],b=e[14],m=e[15],M=p*m-b*d,R=c*m-y*d,D=c*b-y*p,I=l*m-v*d,A=l*b-p*v,x=l*y-v*c,W=+(u*M-h*R+f*D),q=-(a*M-h*I+f*A),Q=+(a*R-u*I+f*x),st=-(a*D-u*A+h*x),Y=i*W+n*q+o*Q+s*st;if(Y===0)return t.copyFrom(this),this;var F=1/Y,$=h*m-b*f,Rt=u*m-y*f,at=u*b-y*h,ut=a*m-v*f,ht=a*b-v*h,ft=a*y-v*u,yt=h*d-p*f,Kt=u*d-c*f,Wt=u*p-c*h,jt=a*d-l*f,Gt=a*p-l*h,Yt=a*c-l*u,Zt=-(n*M-o*R+s*D),Jt=+(i*M-o*I+s*A),$t=-(i*R-n*I+s*x),te=+(i*D-n*A+o*x),ee=+(n*$-o*Rt+s*at),ie=-(i*$-o*ut+s*ht),mt=+(i*Rt-n*ut+s*ft),bt=-(i*at-n*ht+o*ft),Mt=-(n*yt-o*Kt+s*Wt),At=+(i*yt-o*jt+s*Gt),Ht=-(i*Kt-n*jt+s*Yt),pe=+(i*Wt-n*Gt+o*Yt);return r.FromValuesToRef(W*F,Zt*F,ee*F,Mt*F,q*F,Jt*F,ie*F,At*F,Q*F,$t*F,mt*F,Ht*F,st*F,te*F,bt*F,pe*F,t),this},r.prototype.addAtIndex=function(t,e){return this._m[t]+=e,this._markAsUpdated(),this},r.prototype.multiplyAtIndex=function(t,e){return this._m[t]*=e,this._markAsUpdated(),this},r.prototype.setTranslationFromFloats=function(t,e,i){return this._m[12]=t,this._m[13]=e,this._m[14]=i,this._markAsUpdated(),this},r.prototype.addTranslationFromFloats=function(t,e,i){return this._m[12]+=t,this._m[13]+=e,this._m[14]+=i,this._markAsUpdated(),this},r.prototype.setTranslation=function(t){return this.setTranslationFromFloats(t._x,t._y,t._z)},r.prototype.getTranslation=function(){return new g(this._m[12],this._m[13],this._m[14])},r.prototype.getTranslationToRef=function(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],this},r.prototype.removeRotationAndScaling=function(){var t=this.m;return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1),this},r.prototype.multiply=function(t){var e=new r;return this.multiplyToRef(t,e),e},r.prototype.copyFrom=function(t){t.copyToArray(this._m);var e=t;return this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},r.prototype.copyToArray=function(t,e){e===void 0&&(e=0);var i=this._m;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],this},r.prototype.multiplyToRef=function(t,e){return this._isIdentity?(e.copyFrom(t),this):t._isIdentity?(e.copyFrom(this),this):(this.multiplyToArray(t,e._m,0),e._markAsUpdated(),this)},r.prototype.multiplyToArray=function(t,e,i){var n=this._m,o=t.m,s=n[0],a=n[1],u=n[2],h=n[3],f=n[4],l=n[5],c=n[6],p=n[7],d=n[8],v=n[9],y=n[10],b=n[11],m=n[12],M=n[13],R=n[14],D=n[15],I=o[0],A=o[1],x=o[2],W=o[3],q=o[4],Q=o[5],st=o[6],Y=o[7],F=o[8],$=o[9],Rt=o[10],at=o[11],ut=o[12],ht=o[13],ft=o[14],yt=o[15];return e[i]=s*I+a*q+u*F+h*ut,e[i+1]=s*A+a*Q+u*$+h*ht,e[i+2]=s*x+a*st+u*Rt+h*ft,e[i+3]=s*W+a*Y+u*at+h*yt,e[i+4]=f*I+l*q+c*F+p*ut,e[i+5]=f*A+l*Q+c*$+p*ht,e[i+6]=f*x+l*st+c*Rt+p*ft,e[i+7]=f*W+l*Y+c*at+p*yt,e[i+8]=d*I+v*q+y*F+b*ut,e[i+9]=d*A+v*Q+y*$+b*ht,e[i+10]=d*x+v*st+y*Rt+b*ft,e[i+11]=d*W+v*Y+y*at+b*yt,e[i+12]=m*I+M*q+R*F+D*ut,e[i+13]=m*A+M*Q+R*$+D*ht,e[i+14]=m*x+M*st+R*Rt+D*ft,e[i+15]=m*W+M*Y+R*at+D*yt,this},r.prototype.equals=function(t){var e=t;if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var i=this.m,n=e.m;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},r.prototype.clone=function(){var t=new r;return t.copyFrom(this),t},r.prototype.getClassName=function(){return"Matrix"},r.prototype.getHashCode=function(){for(var t=this._m[0]|0,e=1;e<16;e++)t=t*397^(this._m[e]|0);return t},r.prototype.decompose=function(t,e,i){if(this._isIdentity)return i&&i.setAll(0),t&&t.setAll(1),e&&e.copyFromFloats(0,0,0,1),!0;var n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),t=t||B.Vector3[0],t.x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),t.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),t.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(t.y*=-1),t._x===0||t._y===0||t._z===0)return e&&e.copyFromFloats(0,0,0,1),!1;if(e){var o=1/t._x,s=1/t._y,a=1/t._z;r.FromValuesToRef(n[0]*o,n[1]*o,n[2]*o,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*a,n[9]*a,n[10]*a,0,0,0,0,1,B.Matrix[0]),N.FromRotationMatrixToRef(B.Matrix[0],e)}return!0},r.prototype.getRow=function(t){if(t<0||t>3)return null;var e=t*4;return new Ct(this._m[e+0],this._m[e+1],this._m[e+2],this._m[e+3])},r.prototype.setRow=function(t,e){return this.setRowFromFloats(t,e.x,e.y,e.z,e.w)},r.prototype.transpose=function(){return r.Transpose(this)},r.prototype.transposeToRef=function(t){return r.TransposeToRef(this,t),this},r.prototype.setRowFromFloats=function(t,e,i,n,o){if(t<0||t>3)return this;var s=t*4;return this._m[s+0]=e,this._m[s+1]=i,this._m[s+2]=n,this._m[s+3]=o,this._markAsUpdated(),this},r.prototype.scale=function(t){var e=new r;return this.scaleToRef(t,e),e},r.prototype.scaleToRef=function(t,e){for(var i=0;i<16;i++)e._m[i]=this._m[i]*t;return e._markAsUpdated(),this},r.prototype.scaleAndAddToRef=function(t,e){for(var i=0;i<16;i++)e._m[i]+=this._m[i]*t;return e._markAsUpdated(),this},r.prototype.toNormalMatrix=function(t){var e=B.Matrix[0];this.invertToRef(e),e.transposeToRef(t);var i=t._m;r.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},r.prototype.getRotationMatrix=function(){var t=new r;return this.getRotationMatrixToRef(t),t},r.prototype.getRotationMatrixToRef=function(t){var e=B.Vector3[0];if(!this.decompose(e))return r.IdentityToRef(t),this;var i=this._m,n=1/e._x,o=1/e._y,s=1/e._z;return r.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*o,i[5]*o,i[6]*o,0,i[8]*s,i[9]*s,i[10]*s,0,0,0,0,1,t),this},r.prototype.toggleModelMatrixHandInPlace=function(){var t=this._m;t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this._markAsUpdated()},r.prototype.toggleProjectionMatrixHandInPlace=function(){var t=this._m;t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this._markAsUpdated()},r.FromArray=function(t,e){e===void 0&&(e=0);var i=new r;return r.FromArrayToRef(t,e,i),i},r.FromArrayToRef=function(t,e,i){for(var n=0;n<16;n++)i._m[n]=t[n+e];i._markAsUpdated()},r.FromFloat32ArrayToRefScaled=function(t,e,i,n){for(var o=0;o<16;o++)n._m[o]=t[o+e]*i;n._markAsUpdated()},Object.defineProperty(r,"IdentityReadOnly",{get:function(){return r._identityReadOnly},enumerable:!1,configurable:!0}),r.FromValuesToRef=function(t,e,i,n,o,s,a,u,h,f,l,c,p,d,v,y,b){var m=b._m;m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=o,m[5]=s,m[6]=a,m[7]=u,m[8]=h,m[9]=f,m[10]=l,m[11]=c,m[12]=p,m[13]=d,m[14]=v,m[15]=y,b._markAsUpdated()},r.FromValues=function(t,e,i,n,o,s,a,u,h,f,l,c,p,d,v,y){var b=new r,m=b._m;return m[0]=t,m[1]=e,m[2]=i,m[3]=n,m[4]=o,m[5]=s,m[6]=a,m[7]=u,m[8]=h,m[9]=f,m[10]=l,m[11]=c,m[12]=p,m[13]=d,m[14]=v,m[15]=y,b._markAsUpdated(),b},r.Compose=function(t,e,i){var n=new r;return r.ComposeToRef(t,e,i,n),n},r.ComposeToRef=function(t,e,i,n){var o=n._m,s=e._x,a=e._y,u=e._z,h=e._w,f=s+s,l=a+a,c=u+u,p=s*f,d=s*l,v=s*c,y=a*l,b=a*c,m=u*c,M=h*f,R=h*l,D=h*c,I=t._x,A=t._y,x=t._z;o[0]=(1-(y+m))*I,o[1]=(d+D)*I,o[2]=(v-R)*I,o[3]=0,o[4]=(d-D)*A,o[5]=(1-(p+m))*A,o[6]=(b+M)*A,o[7]=0,o[8]=(v+R)*x,o[9]=(b-M)*x,o[10]=(1-(p+y))*x,o[11]=0,o[12]=i._x,o[13]=i._y,o[14]=i._z,o[15]=1,n._markAsUpdated()},r.Identity=function(){var t=r.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},r.IdentityToRef=function(t){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},r.Zero=function(){var t=r.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},r.RotationX=function(t){var e=new r;return r.RotationXToRef(t,e),e},r.Invert=function(t){var e=new r;return t.invertToRef(e),e},r.RotationXToRef=function(t,e){var i=Math.sin(t),n=Math.cos(t);r.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&i===0)},r.RotationY=function(t){var e=new r;return r.RotationYToRef(t,e),e},r.RotationYToRef=function(t,e){var i=Math.sin(t),n=Math.cos(t);r.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&i===0)},r.RotationZ=function(t){var e=new r;return r.RotationZToRef(t,e),e},r.RotationZToRef=function(t,e){var i=Math.sin(t),n=Math.cos(t);r.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&i===0)},r.RotationAxis=function(t,e){var i=new r;return r.RotationAxisToRef(t,e,i),i},r.RotationAxisToRef=function(t,e,i){var n=Math.sin(-e),o=Math.cos(-e),s=1-o;t.normalize();var a=i._m;a[0]=t._x*t._x*s+o,a[1]=t._x*t._y*s-t._z*n,a[2]=t._x*t._z*s+t._y*n,a[3]=0,a[4]=t._y*t._x*s+t._z*n,a[5]=t._y*t._y*s+o,a[6]=t._y*t._z*s-t._x*n,a[7]=0,a[8]=t._z*t._x*s-t._y*n,a[9]=t._z*t._y*s+t._x*n,a[10]=t._z*t._z*s+o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i._markAsUpdated()},r.RotationAlignToRef=function(t,e,i){var n=g.Cross(e,t),o=g.Dot(e,t),s=1/(1+o),a=i._m;a[0]=n._x*n._x*s+o,a[1]=n._y*n._x*s-n._z,a[2]=n._z*n._x*s+n._y,a[3]=0,a[4]=n._x*n._y*s+n._z,a[5]=n._y*n._y*s+o,a[6]=n._z*n._y*s-n._x,a[7]=0,a[8]=n._x*n._z*s-n._y,a[9]=n._y*n._z*s+n._x,a[10]=n._z*n._z*s+o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,i._markAsUpdated()},r.RotationYawPitchRoll=function(t,e,i){var n=new r;return r.RotationYawPitchRollToRef(t,e,i,n),n},r.RotationYawPitchRollToRef=function(t,e,i,n){N.RotationYawPitchRollToRef(t,e,i,B.Quaternion[0]),B.Quaternion[0].toRotationMatrix(n)},r.Scaling=function(t,e,i){var n=new r;return r.ScalingToRef(t,e,i,n),n},r.ScalingToRef=function(t,e,i,n){r.FromValuesToRef(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(t===1&&e===1&&i===1)},r.Translation=function(t,e,i){var n=new r;return r.TranslationToRef(t,e,i,n),n},r.TranslationToRef=function(t,e,i,n){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,e,i,1,n),n._updateIdentityStatus(t===0&&e===0&&i===0)},r.Lerp=function(t,e,i){var n=new r;return r.LerpToRef(t,e,i,n),n},r.LerpToRef=function(t,e,i,n){for(var o=n._m,s=t.m,a=e.m,u=0;u<16;u++)o[u]=s[u]*(1-i)+a[u]*i;n._markAsUpdated()},r.DecomposeLerp=function(t,e,i){var n=new r;return r.DecomposeLerpToRef(t,e,i,n),n},r.DecomposeLerpToRef=function(t,e,i,n){var o=B.Vector3[0],s=B.Quaternion[0],a=B.Vector3[1];t.decompose(o,s,a);var u=B.Vector3[2],h=B.Quaternion[1],f=B.Vector3[3];e.decompose(u,h,f);var l=B.Vector3[4];g.LerpToRef(o,u,i,l);var c=B.Quaternion[2];N.SlerpToRef(s,h,i,c);var p=B.Vector3[5];g.LerpToRef(a,f,i,p),r.ComposeToRef(l,c,p,n)},r.LookAtLH=function(t,e,i){var n=new r;return r.LookAtLHToRef(t,e,i,n),n},r.LookAtLHToRef=function(t,e,i,n){var o=B.Vector3[0],s=B.Vector3[1],a=B.Vector3[2];e.subtractToRef(t,a),a.normalize(),g.CrossToRef(i,a,o);var u=o.lengthSquared();u===0?o.x=1:o.normalizeFromLength(Math.sqrt(u)),g.CrossToRef(a,o,s),s.normalize();var h=-g.Dot(o,t),f=-g.Dot(s,t),l=-g.Dot(a,t);r.FromValuesToRef(o._x,s._x,a._x,0,o._y,s._y,a._y,0,o._z,s._z,a._z,0,h,f,l,1,n)},r.LookAtRH=function(t,e,i){var n=new r;return r.LookAtRHToRef(t,e,i,n),n},r.LookAtRHToRef=function(t,e,i,n){var o=B.Vector3[0],s=B.Vector3[1],a=B.Vector3[2];t.subtractToRef(e,a),a.normalize(),g.CrossToRef(i,a,o);var u=o.lengthSquared();u===0?o.x=1:o.normalizeFromLength(Math.sqrt(u)),g.CrossToRef(a,o,s),s.normalize();var h=-g.Dot(o,t),f=-g.Dot(s,t),l=-g.Dot(a,t);r.FromValuesToRef(o._x,s._x,a._x,0,o._y,s._y,a._y,0,o._z,s._z,a._z,0,h,f,l,1,n)},r.OrthoLH=function(t,e,i,n){var o=new r;return r.OrthoLHToRef(t,e,i,n,o),o},r.OrthoLHToRef=function(t,e,i,n,o){var s=i,a=n,u=2/t,h=2/e,f=2/(a-s),l=-(a+s)/(a-s);r.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,f,0,0,0,l,1,o),o._updateIdentityStatus(u===1&&h===1&&f===1&&l===0)},r.OrthoOffCenterLH=function(t,e,i,n,o,s){var a=new r;return r.OrthoOffCenterLHToRef(t,e,i,n,o,s,a),a},r.OrthoOffCenterLHToRef=function(t,e,i,n,o,s,a){var u=o,h=s,f=2/(e-t),l=2/(n-i),c=2/(h-u),p=-(h+u)/(h-u),d=(t+e)/(t-e),v=(n+i)/(i-n);r.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,0,d,v,p,1,a),a._markAsUpdated()},r.OrthoOffCenterRH=function(t,e,i,n,o,s){var a=new r;return r.OrthoOffCenterRHToRef(t,e,i,n,o,s,a),a},r.OrthoOffCenterRHToRef=function(t,e,i,n,o,s,a){r.OrthoOffCenterLHToRef(t,e,i,n,o,s,a),a._m[10]*=-1},r.PerspectiveLH=function(t,e,i,n){var o=new r,s=i,a=n,u=2*s/t,h=2*s/e,f=(a+s)/(a-s),l=-2*a*s/(a-s);return r.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,f,1,0,0,l,0,o),o._updateIdentityStatus(!1),o},r.PerspectiveFovLH=function(t,e,i,n){var o=new r;return r.PerspectiveFovLHToRef(t,e,i,n,o),o},r.PerspectiveFovLHToRef=function(t,e,i,n,o,s){s===void 0&&(s=!0);var a=i,u=n,h=1/Math.tan(t*.5),f=s?h/e:h,l=s?h:h*e,c=(u+a)/(u-a),p=-2*u*a/(u-a);r.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,1,0,0,p,0,o),o._updateIdentityStatus(!1)},r.PerspectiveFovReverseLHToRef=function(t,e,i,n,o,s){s===void 0&&(s=!0);var a=1/Math.tan(t*.5),u=s?a/e:a,h=s?a:a*e;r.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-i,1,0,0,1,0,o),o._updateIdentityStatus(!1)},r.PerspectiveFovRH=function(t,e,i,n){var o=new r;return r.PerspectiveFovRHToRef(t,e,i,n,o),o},r.PerspectiveFovRHToRef=function(t,e,i,n,o,s){s===void 0&&(s=!0);var a=i,u=n,h=1/Math.tan(t*.5),f=s?h/e:h,l=s?h:h*e,c=-(u+a)/(u-a),p=-2*u*a/(u-a);r.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,-1,0,0,p,0,o),o._updateIdentityStatus(!1)},r.PerspectiveFovReverseRHToRef=function(t,e,i,n,o,s){s===void 0&&(s=!0);var a=1/Math.tan(t*.5),u=s?a/e:a,h=s?a:a*e;r.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-i,-1,0,0,-1,0,o),o._updateIdentityStatus(!1)},r.PerspectiveFovWebVRToRef=function(t,e,i,n,o){o===void 0&&(o=!1);var s=o?-1:1,a=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),h=Math.tan(t.leftDegrees*Math.PI/180),f=Math.tan(t.rightDegrees*Math.PI/180),l=2/(h+f),c=2/(a+u),p=n._m;p[0]=l,p[1]=p[2]=p[3]=p[4]=0,p[5]=c,p[6]=p[7]=0,p[8]=(h-f)*l*.5,p[9]=-((a-u)*c*.5),p[10]=-i/(e-i),p[11]=1*s,p[12]=p[13]=p[15]=0,p[14]=-(2*i*e)/(i-e),n._markAsUpdated()},r.GetFinalMatrix=function(t,e,i,n,o,s){var a=t.width,u=t.height,h=t.x,f=t.y,l=r.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,s-o,0,h+a/2,u/2+f,o,1),c=B.Matrix[0];return e.multiplyToRef(i,c),c.multiplyToRef(n,c),c.multiply(l)},r.GetAsMatrix2x2=function(t){var e=t.m,i=[e[0],e[1],e[4],e[5]];return Bt.MatrixUse64Bits?i:new Float32Array(i)},r.GetAsMatrix3x3=function(t){var e=t.m,i=[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]];return Bt.MatrixUse64Bits?i:new Float32Array(i)},r.Transpose=function(t){var e=new r;return r.TransposeToRef(t,e),e},r.TransposeToRef=function(t,e){var i=e._m,n=t.m;i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15],e._updateIdentityStatus(t._isIdentity,t._isIdentityDirty)},r.Reflection=function(t){var e=new r;return r.ReflectionToRef(t,e),e},r.ReflectionToRef=function(t,e){t.normalize();var i=t.normal.x,n=t.normal.y,o=t.normal.z,s=-2*i,a=-2*n,u=-2*o;r.FromValuesToRef(s*i+1,a*i,u*i,0,s*n,a*n+1,u*n,0,s*o,a*o,u*o+1,0,s*t.d,a*t.d,u*t.d,1,e)},r.FromXYZAxesToRef=function(t,e,i,n){r.FromValuesToRef(t._x,t._y,t._z,0,e._x,e._y,e._z,0,i._x,i._y,i._z,0,0,0,0,1,n)},r.FromQuaternionToRef=function(t,e){var i=t._x*t._x,n=t._y*t._y,o=t._z*t._z,s=t._x*t._y,a=t._z*t._w,u=t._z*t._x,h=t._y*t._w,f=t._y*t._z,l=t._x*t._w;e._m[0]=1-2*(n+o),e._m[1]=2*(s+a),e._m[2]=2*(u-h),e._m[3]=0,e._m[4]=2*(s-a),e._m[5]=1-2*(o+i),e._m[6]=2*(f+l),e._m[7]=0,e._m[8]=2*(u+h),e._m[9]=2*(f-l),e._m[10]=1-2*(n+i),e._m[11]=0,e._m[12]=0,e._m[13]=0,e._m[14]=0,e._m[15]=1,e._markAsUpdated()},r._updateFlagSeed=0,r._identityReadOnly=r.Identity(),r}(),B=function(){function r(){}return r.Vector3=et.BuildArray(6,g.Zero),r.Matrix=et.BuildArray(2,O.Identity),r.Quaternion=et.BuildArray(3,N.Zero),r}(),C=function(){function r(){}return r.Vector2=et.BuildArray(3,G.Zero),r.Vector3=et.BuildArray(13,g.Zero),r.Vector4=et.BuildArray(3,Ct.Zero),r.Quaternion=et.BuildArray(2,N.Zero),r.Matrix=et.BuildArray(8,O.Identity),r}();nt.RegisteredTypes["BABYLON.Vector2"]=G;nt.RegisteredTypes["BABYLON.Vector3"]=g;nt.RegisteredTypes["BABYLON.Vector4"]=Ct;nt.RegisteredTypes["BABYLON.Matrix"]=O;var pt=function(){function r(t,e,i){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),this.r=t,this.g=e,this.b=i}return r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},r.prototype.getClassName=function(){return"Color3"},r.prototype.getHashCode=function(){var t=this.r*255|0;return t=t*397^(this.g*255|0),t=t*397^(this.b*255|0),t},r.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,this},r.prototype.fromArray=function(t,e){return e===void 0&&(e=0),r.FromArrayToRef(t,e,this),this},r.prototype.toColor4=function(t){return t===void 0&&(t=1),new J(this.r,this.g,this.b,t)},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},r.prototype.multiply=function(t){return new r(this.r*t.r,this.g*t.g,this.b*t.b)},r.prototype.multiplyToRef=function(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,this},r.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},r.prototype.equalsFloats=function(t,e,i){return this.r===t&&this.g===e&&this.b===i},r.prototype.scale=function(t){return new r(this.r*t,this.g*t,this.b*t)},r.prototype.scaleToRef=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,this},r.prototype.scaleAndAddToRef=function(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,this},r.prototype.clampToRef=function(t,e,i){return t===void 0&&(t=0),e===void 0&&(e=1),i.r=L.Clamp(this.r,t,e),i.g=L.Clamp(this.g,t,e),i.b=L.Clamp(this.b,t,e),this},r.prototype.add=function(t){return new r(this.r+t.r,this.g+t.g,this.b+t.b)},r.prototype.addToRef=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,this},r.prototype.subtract=function(t){return new r(this.r-t.r,this.g-t.g,this.b-t.b)},r.prototype.subtractToRef=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,this},r.prototype.clone=function(){return new r(this.r,this.g,this.b)},r.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},r.prototype.copyFromFloats=function(t,e,i){return this.r=t,this.g=e,this.b=i,this},r.prototype.set=function(t,e,i){return this.copyFromFloats(t,e,i)},r.prototype.toHexString=function(){var t=this.r*255|0,e=this.g*255|0,i=this.b*255|0;return"#"+L.ToHex(t)+L.ToHex(e)+L.ToHex(i)},r.prototype.toLinearSpace=function(){var t=new r;return this.toLinearSpaceToRef(t),t},r.prototype.toHSV=function(){var t=new r;return this.toHSVToRef(t),t},r.prototype.toHSVToRef=function(t){var e=this.r,i=this.g,n=this.b,o=Math.max(e,i,n),s=Math.min(e,i,n),a=0,u=0,h=o,f=o-s;o!==0&&(u=f/o),o!=s&&(o==e?(a=(i-n)/f,i<n&&(a+=6)):o==i?a=(n-e)/f+2:o==n&&(a=(e-i)/f+4),a*=60),t.r=a,t.g=u,t.b=h},r.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,Ut),t.g=Math.pow(this.g,Ut),t.b=Math.pow(this.b,Ut),this},r.prototype.toGammaSpace=function(){var t=new r;return this.toGammaSpaceToRef(t),t},r.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,Lt),t.g=Math.pow(this.g,Lt),t.b=Math.pow(this.b,Lt),this},r.HSVtoRGBToRef=function(t,e,i,n){var o=i*e,s=t/60,a=o*(1-Math.abs(s%2-1)),u=0,h=0,f=0;s>=0&&s<=1?(u=o,h=a):s>=1&&s<=2?(u=a,h=o):s>=2&&s<=3?(h=o,f=a):s>=3&&s<=4?(h=a,f=o):s>=4&&s<=5?(u=a,f=o):s>=5&&s<=6&&(u=o,f=a);var l=i-o;n.set(u+l,h+l,f+l)},r.FromHexString=function(t){if(t.substring(0,1)!=="#"||t.length!==7)return new r(0,0,0);var e=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return r.FromInts(e,i,n)},r.FromArray=function(t,e){return e===void 0&&(e=0),new r(t[e],t[e+1],t[e+2])},r.FromArrayToRef=function(t,e,i){e===void 0&&(e=0),i.r=t[e],i.g=t[e+1],i.b=t[e+2]},r.FromInts=function(t,e,i){return new r(t/255,e/255,i/255)},r.Lerp=function(t,e,i){var n=new r(0,0,0);return r.LerpToRef(t,e,i,n),n},r.LerpToRef=function(t,e,i,n){n.r=t.r+(e.r-t.r)*i,n.g=t.g+(e.g-t.g)*i,n.b=t.b+(e.b-t.b)*i},r.Red=function(){return new r(1,0,0)},r.Green=function(){return new r(0,1,0)},r.Blue=function(){return new r(0,0,1)},r.Black=function(){return new r(0,0,0)},Object.defineProperty(r,"BlackReadOnly",{get:function(){return r._BlackReadOnly},enumerable:!1,configurable:!0}),r.White=function(){return new r(1,1,1)},r.Purple=function(){return new r(.5,0,.5)},r.Magenta=function(){return new r(1,0,1)},r.Yellow=function(){return new r(1,1,0)},r.Gray=function(){return new r(.5,.5,.5)},r.Teal=function(){return new r(0,1,1)},r.Random=function(){return new r(Math.random(),Math.random(),Math.random())},r._BlackReadOnly=r.Black(),r}(),J=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),this.r=t,this.g=e,this.b=i,this.a=n}return r.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},r.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},r.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,this},r.prototype.fromArray=function(t,e){return e===void 0&&(e=0),r.FromArrayToRef(t,e,this),this},r.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},r.prototype.add=function(t){return new r(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},r.prototype.subtract=function(t){return new r(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},r.prototype.subtractToRef=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,this},r.prototype.scale=function(t){return new r(this.r*t,this.g*t,this.b*t,this.a*t)},r.prototype.scaleToRef=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this},r.prototype.scaleAndAddToRef=function(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,e.a+=this.a*t,this},r.prototype.clampToRef=function(t,e,i){return t===void 0&&(t=0),e===void 0&&(e=1),i.r=L.Clamp(this.r,t,e),i.g=L.Clamp(this.g,t,e),i.b=L.Clamp(this.b,t,e),i.a=L.Clamp(this.a,t,e),this},r.prototype.multiply=function(t){return new r(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},r.prototype.multiplyToRef=function(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,e.a=this.a*t.a,e},r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},r.prototype.getClassName=function(){return"Color4"},r.prototype.getHashCode=function(){var t=this.r*255|0;return t=t*397^(this.g*255|0),t=t*397^(this.b*255|0),t=t*397^(this.a*255|0),t},r.prototype.clone=function(){return new r(this.r,this.g,this.b,this.a)},r.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},r.prototype.copyFromFloats=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this},r.prototype.set=function(t,e,i,n){return this.copyFromFloats(t,e,i,n)},r.prototype.toHexString=function(t){t===void 0&&(t=!1);var e=this.r*255|0,i=this.g*255|0,n=this.b*255|0;if(t)return"#"+L.ToHex(e)+L.ToHex(i)+L.ToHex(n);var o=this.a*255|0;return"#"+L.ToHex(e)+L.ToHex(i)+L.ToHex(n)+L.ToHex(o)},r.prototype.toLinearSpace=function(){var t=new r;return this.toLinearSpaceToRef(t),t},r.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,Ut),t.g=Math.pow(this.g,Ut),t.b=Math.pow(this.b,Ut),t.a=this.a,this},r.prototype.toGammaSpace=function(){var t=new r;return this.toGammaSpaceToRef(t),t},r.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,Lt),t.g=Math.pow(this.g,Lt),t.b=Math.pow(this.b,Lt),t.a=this.a,this},r.FromHexString=function(t){if(t.substring(0,1)!=="#"||t.length!==9)return new r(0,0,0,0);var e=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),o=parseInt(t.substring(7,9),16);return r.FromInts(e,i,n,o)},r.Lerp=function(t,e,i){var n=new r(0,0,0,0);return r.LerpToRef(t,e,i,n),n},r.LerpToRef=function(t,e,i,n){n.r=t.r+(e.r-t.r)*i,n.g=t.g+(e.g-t.g)*i,n.b=t.b+(e.b-t.b)*i,n.a=t.a+(e.a-t.a)*i},r.FromColor3=function(t,e){return e===void 0&&(e=1),new r(t.r,t.g,t.b,e)},r.FromArray=function(t,e){return e===void 0&&(e=0),new r(t[e],t[e+1],t[e+2],t[e+3])},r.FromArrayToRef=function(t,e,i){e===void 0&&(e=0),i.r=t[e],i.g=t[e+1],i.b=t[e+2],i.a=t[e+3]},r.FromInts=function(t,e,i,n){return new r(t/255,e/255,i/255,n/255)},r.CheckColors4=function(t,e){if(t.length===e*3){for(var i=[],n=0;n<t.length;n+=3){var o=n/3*4;i[o]=t[n],i[o+1]=t[n+1],i[o+2]=t[n+2],i[o+3]=1}return i}return t},r}(),oe=function(){function r(){}return r.Color3=et.BuildArray(3,pt.Black),r.Color4=et.BuildArray(3,function(){return new J(0,0,0,0)}),r}();nt.RegisteredTypes["BABYLON.Color3"]=pt;nt.RegisteredTypes["BABYLON.Color4"]=J;var ae={},se={},Se=function(r,t,e){var i=r();k&&k.AddTagsTo(i,t.tags);var n=ve(i);for(var o in n){var s=n[o],a=t[o],u=s.type;if(a!=null&&o!=="uniqueId")switch(u){case 0:case 6:case 11:i[o]=a;break;case 1:i[o]=e||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[o]=e?a:a.clone();break}}return i};function mi(r){var t=r.getClassName();return ae[t]||(ae[t]={}),ae[t]}function ve(r){var t=r.getClassName();if(se[t])return se[t];se[t]={};for(var e=se[t],i=r,n=t;n;){var o=ae[n];for(var s in o)e[s]=o[s];var a=void 0,u=!1;do{if(a=Object.getPrototypeOf(i),!a.getClassName){u=!0;break}if(a.getClassName()!==n)break;i=a}while(a);if(u)break;n=a.getClassName(),i=a}return e}function Et(r,t){return function(e,i){var n=mi(e);n[i]||(n[i]={type:r,sourceName:t})}}function bi(r,t){return t===void 0&&(t=null),function(e,i){var n=t||"_"+i;Object.defineProperty(e,i,{get:function(){return this[n]},set:function(o){this[n]!==o&&(this[n]=o,e[r].apply(this))},enumerable:!0,configurable:!0})}}function Mi(r,t){return t===void 0&&(t=null),bi(r,t)}function T(r){return Et(0,r)}function Ai(r){return Et(1,r)}function xe(r){return Et(2,r)}function sr(r){return Et(3,r)}function wt(r){return Et(5,r)}function Pi(r){return Et(6,r)}function Ti(r){return Et(7,r)}function Ri(r){return Et(8,r)}function Ii(r){return Et(10,r)}var j=function(){function r(){}return r.AppendSerializedAnimations=function(t,e){if(t.animations){e.animations=[];for(var i=0;i<t.animations.length;i++){var n=t.animations[i];e.animations.push(n.serialize())}}},r.Serialize=function(t,e){e||(e={}),k&&(e.tags=k.GetTags(t));var i=ve(t);for(var n in i){var o=i[n],s=o.sourceName||n,a=o.type,u=t[n];if(u!=null&&n!=="uniqueId")switch(a){case 0:e[s]=u;break;case 1:e[s]=u.serialize();break;case 2:e[s]=u.asArray();break;case 3:e[s]=u.serialize();break;case 4:e[s]=u.asArray();break;case 5:e[s]=u.asArray();break;case 6:e[s]=u.id;break;case 7:e[s]=u.serialize();break;case 8:e[s]=u.asArray();break;case 9:e[s]=u.serialize();break;case 10:e[s]=u.asArray();break;case 11:e[s]=u.id;case 12:e[s]=u.asArray();break}}return e},r.Parse=function(t,e,i,n){n===void 0&&(n=null);var o=t();n||(n=""),k&&k.AddTagsTo(o,e.tags);var s=ve(o);for(var a in s){var u=s[a],h=e[u.sourceName||a],f=u.type;if(h!=null&&a!=="uniqueId"){var l=o;switch(f){case 0:l[a]=h;break;case 1:i&&(l[a]=r._TextureParser(h,i,n));break;case 2:l[a]=pt.FromArray(h);break;case 3:l[a]=r._FresnelParametersParser(h);break;case 4:l[a]=G.FromArray(h);break;case 5:l[a]=g.FromArray(h);break;case 6:i&&(l[a]=i.getLastMeshByID(h));break;case 7:l[a]=r._ColorCurvesParser(h);break;case 8:l[a]=J.FromArray(h);break;case 9:l[a]=r._ImageProcessingConfigurationParser(h);break;case 10:l[a]=N.FromArray(h);break;case 11:i&&(l[a]=i.getCameraByID(h));case 12:l[a]=O.FromArray(h);break}}}return o},r.Clone=function(t,e){return Se(t,e,!1)},r.Instanciate=function(t,e){return Se(t,e,!0)},r._ImageProcessingConfigurationParser=function(t){throw S.WarnImport("ImageProcessingConfiguration")},r._FresnelParametersParser=function(t){throw S.WarnImport("FresnelParameters")},r._ColorCurvesParser=function(t){throw S.WarnImport("ColorCurves")},r._TextureParser=function(t,e,i){throw S.WarnImport("Texture")},r}(),vt=function(){function r(t,e){e===void 0&&(e=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=O.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new E,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=e||gt.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return r.AddNodeConstructor=function(t,e){this._NodeConstructors[t]=e},r.Construct=function(t,e,i,n){var o=this._NodeConstructors[t];return o?o(e,i,n):null},Object.defineProperty(r.prototype,"doNotSerialize",{get:function(){return this._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1},set:function(t){this._doNotSerialize=t},enumerable:!1,configurable:!0}),r.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(r.prototype,"parent",{get:function(){return this._parentNode},set:function(t){if(this._parentNode!==t){var e=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var i=this._parentNode._children.indexOf(this);i!==-1&&this._parentNode._children.splice(i,1),!t&&!this._isDisposed&&this._addToSceneRootNodes()}this._parentNode=t,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),e||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),r.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},r.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var t=this._scene.rootNodes,e=t.length-1;t[this._sceneRootNodesIndex]=t[e],t[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(r.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"Node"},Object.defineProperty(r.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),r.prototype.getScene=function(){return this._scene},r.prototype.getEngine=function(){return this._scene.getEngine()},r.prototype.addBehavior=function(t,e){var i=this;e===void 0&&(e=!1);var n=this._behaviors.indexOf(t);return n!==-1?this:(t.init(),this._scene.isLoading&&!e?this._scene.onDataLoadedObservable.addOnce(function(){t.attach(i)}):t.attach(this),this._behaviors.push(t),this)},r.prototype.removeBehavior=function(t){var e=this._behaviors.indexOf(t);return e===-1?this:(this._behaviors[e].detach(),this._behaviors.splice(e,1),this)},Object.defineProperty(r.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),r.prototype.getBehaviorByName=function(t){for(var e=0,i=this._behaviors;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},r.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},r.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(r.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),r.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},r.prototype.updateCache=function(t){!t&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},r.prototype._getActionManagerForTrigger=function(t,e){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null},r.prototype._updateCache=function(t){},r.prototype._isSynchronized=function(){return!0},r.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},r.prototype.isSynchronizedWithParent=function(){return this._parentNode?this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0},r.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()},r.prototype.isReady=function(t){return this._isReady},r.prototype.isEnabled=function(t){return t===void 0&&(t=!0),t===!1?this._isEnabled:this._isEnabled?this._isParentEnabled:!1},r.prototype._syncParentEnabledState=function(){this._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(function(t){t._syncParentEnabledState()})},r.prototype.setEnabled=function(t){this._isEnabled=t,this._syncParentEnabledState()},r.prototype.isDescendantOf=function(t){return this.parent?this.parent===t?!0:this.parent.isDescendantOf(t):!1},r.prototype._getDescendants=function(t,e,i){if(e===void 0&&(e=!1),!!this._children)for(var n=0;n<this._children.length;n++){var o=this._children[n];(!i||i(o))&&t.push(o),e||o._getDescendants(t,!1,i)}},r.prototype.getDescendants=function(t,e){var i=new Array;return this._getDescendants(i,t,e),i},r.prototype.getChildMeshes=function(t,e){var i=[];return this._getDescendants(i,t,function(n){return(!e||e(n))&&n.cullingStrategy!==void 0}),i},r.prototype.getChildren=function(t,e){return e===void 0&&(e=!0),this.getDescendants(e,t)},r.prototype._setReady=function(t){if(t!==this._isReady){if(!t){this._isReady=!1;return}this.onReady&&this.onReady(this),this._isReady=!0}},r.prototype.getAnimationByName=function(t){for(var e=0;e<this.animations.length;e++){var i=this.animations[e];if(i.name===t)return i}return null},r.prototype.createAnimationRange=function(t,e,i){if(!this._ranges[t]){this._ranges[t]=r._AnimationRangeFactory(t,e,i);for(var n=0,o=this.animations.length;n<o;n++)this.animations[n]&&this.animations[n].createRange(t,e,i)}},r.prototype.deleteAnimationRange=function(t,e){e===void 0&&(e=!0);for(var i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(t,e);this._ranges[t]=null},r.prototype.getAnimationRange=function(t){return this._ranges[t]||null},r.prototype.getAnimationRanges=function(){var t=[],e;for(e in this._ranges)t.push(this._ranges[e]);return t},r.prototype.beginAnimation=function(t,e,i,n){var o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,i,n):null},r.prototype.serializeAnimationRanges=function(){var t=[];for(var e in this._ranges){var i=this._ranges[e];if(!!i){var n={};n.name=e,n.from=i.from,n.to=i.to,t.push(n)}}return t},r.prototype.computeWorldMatrix=function(t){return this._worldMatrix||(this._worldMatrix=O.Identity()),this._worldMatrix},r.prototype.dispose=function(t,e){if(e===void 0&&(e=!1),this._isDisposed=!0,!t)for(var i=this.getDescendants(!0),n=0,o=i;n<o.length;n++){var s=o[n];s.dispose(t,e)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var a=0,u=this._behaviors;a<u.length;a++){var h=u[a];h.detach()}this._behaviors=[]},r.ParseAnimationRanges=function(t,e,i){if(e.ranges)for(var n=0;n<e.ranges.length;n++){var o=e.ranges[n];t.createAnimationRange(o.name,o.from,o.to)}},r.prototype.getHierarchyBoundingVectors=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var i,n,o=this;if(o.getBoundingInfo&&o.subMeshes){var s=o.getBoundingInfo();i=s.boundingBox.minimumWorld.clone(),n=s.boundingBox.maximumWorld.clone()}else i=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new g(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t)for(var a=this.getDescendants(!1),u=0,h=a;u<h.length;u++){var f=h[u],l=f;if(l.computeWorldMatrix(!0),!(e&&!e(l))&&!(!l.getBoundingInfo||l.getTotalVertices()===0)){var c=l.getBoundingInfo(),p=c.boundingBox,d=p.minimumWorld,v=p.maximumWorld;g.CheckExtends(d,i,n),g.CheckExtends(v,i,n)}}return{min:i,max:n}},r._AnimationRangeFactory=function(t,e,i){throw S.WarnImport("AnimationRange")},r._NodeConstructors={},P([T()],r.prototype,"name",void 0),P([T()],r.prototype,"id",void 0),P([T()],r.prototype,"uniqueId",void 0),P([T()],r.prototype,"state",void 0),P([T()],r.prototype,"metadata",void 0),r}(),Ot;(function(r){r[r.LOCAL=0]="LOCAL",r[r.WORLD=1]="WORLD",r[r.BONE=2]="BONE"})(Ot||(Ot={}));var ye=function(){function r(){}return r.X=new g(1,0,0),r.Y=new g(0,1,0),r.Z=new g(0,0,1),r}(),we;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(we||(we={}));var dt=function(r){U(t,r);function t(e,i,n){i===void 0&&(i=null),n===void 0&&(n=!0);var o=r.call(this,e,i)||this;return o._forward=new g(0,0,1),o._forwardInverted=new g(0,0,-1),o._up=new g(0,1,0),o._right=new g(1,0,0),o._rightInverted=new g(-1,0,0),o._position=g.Zero(),o._rotation=g.Zero(),o._rotationQuaternion=null,o._scaling=g.One(),o._isDirty=!1,o._transformToBoneReferal=null,o._isAbsoluteSynced=!1,o._billboardMode=t.BILLBOARDMODE_NONE,o._preserveParentRotationForBillboard=!1,o.scalingDeterminant=1,o._infiniteDistance=!1,o.ignoreNonUniformScaling=!1,o.reIntegrateRotationIntoRotationQuaternion=!1,o._poseMatrix=null,o._localMatrix=O.Zero(),o._usePivotMatrix=!1,o._absolutePosition=g.Zero(),o._absoluteScaling=g.Zero(),o._absoluteRotationQuaternion=N.Identity(),o._pivotMatrix=O.Identity(),o._postMultiplyPivotMatrix=!1,o._isWorldMatrixFrozen=!1,o._indexInSceneTransformNodesArray=-1,o.onAfterWorldMatrixUpdateObservable=new E,o._nonUniformScaling=!1,n&&o.getScene().addTransformNode(o),o}return Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return g.Normalize(g.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return g.Normalize(g.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return g.Normalize(g.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=O.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;return!(this.billboardMode!==e.billboardMode||this.billboardMode!==t.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this.infiniteDistance||this.position._isDirty||this.scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},t.prototype._initCache=function(){r.prototype._initCache.call(this);var e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1},t.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,i){return i===void 0&&(i=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=O.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.instantiateHierarchy=function(e,i,n){e===void 0&&(e=null);var o=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);o&&n&&n(this,o);for(var s=0,a=this.getChildTransformNodes(!0);s<a.length;s++){var u=a[s];u.instantiateHierarchy(o,i,n)}return o},t.prototype.freezeWorldMatrix=function(e){return e===void 0&&(e=null),e?this._worldMatrix=e:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var i,n,o;if(e.x===void 0){if(arguments.length<3)return this;i=arguments[0],n=arguments[1],o=arguments[2]}else i=e.x,n=e.y,o=e.z;if(this.parent){var s=C.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),g.TransformCoordinatesFromFloatsToRef(i,n,o,s,this.position)}else this.position.x=i,this.position.y=n,this.position.z=o;return this._absolutePosition.copyFrom(e),this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=g.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=C.Matrix[0];return this._localMatrix.invertToRef(e),g.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=g.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,i,n,o,s){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=Ot.LOCAL);var a=t._lookAtVectorCache,u=s===Ot.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(u,a),this.setDirection(a,i,n,o),s===Ot.WORLD&&this.parent)if(this.rotationQuaternion){var h=C.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var f=C.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var l=C.Quaternion[0];N.FromEulerVectorToRef(this.rotation,l);var h=C.Matrix[0];l.toRotationMatrix(h);var f=C.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var i=g.Zero();return this.getDirectionToRef(e,i),i},t.prototype.getDirectionToRef=function(e,i){return g.TransformNormalToRef(e,this.getWorldMatrix(),i),this},t.prototype.setDirection=function(e,i,n,o){i===void 0&&(i=0),n===void 0&&(n=0),o===void 0&&(o=0);var s=-Math.atan2(e.z,e.x)+Math.PI/2,a=Math.sqrt(e.x*e.x+e.z*e.z),u=-Math.atan2(e.y,a);return this.rotationQuaternion?N.RotationYawPitchRollToRef(s+i,u+n,o,this.rotationQuaternion):(this.rotation.x=u+n,this.rotation.y=s+i,this.rotation.z=o),this},t.prototype.setPivotPoint=function(e,i){i===void 0&&(i=Ot.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(i==Ot.WORLD){var o=C.Matrix[0];n.invertToRef(o),e=g.TransformCoordinates(e,o)}return this.setPivotMatrix(O.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=g.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=g.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return this.getPivotPointToRef(e),g.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.setParent=function(e){if(!e&&!this.parent)return this;var i=C.Quaternion[0],n=C.Vector3[0],o=C.Vector3[1];if(!e)this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(o,i,n);else{var s=C.Matrix[0],a=C.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(a),this.getWorldMatrix().multiplyToRef(a,s),s.decompose(o,i,n)}return this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(o),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling===e?!1:(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,i){return this._transformToBoneReferal=i,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(e,i,n){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));var o;if(!n||n===Ot.LOCAL)o=N.RotationAxisToRef(e,i,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(o,this.rotationQuaternion);else{if(this.parent){var s=C.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),e=g.TransformNormal(e,s)}o=N.RotationAxisToRef(e,i,t._rotationAxisCache),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},t.prototype.rotateAround=function(e,i,n){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=N.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var o=C.Vector3[0],s=C.Vector3[1],a=C.Vector3[2],u=C.Quaternion[0],h=C.Matrix[0],f=C.Matrix[1],l=C.Matrix[2],c=C.Matrix[3];return e.subtractToRef(this.position,o),O.TranslationToRef(o.x,o.y,o.z,h),O.TranslationToRef(-o.x,-o.y,-o.z,f),O.RotationAxisToRef(i,n,l),f.multiplyToRef(l,c),c.multiplyToRef(h,c),c.decompose(s,u,a),this.position.addInPlace(a),u.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,i,n){var o=e.scale(i);if(!n||n===Ot.LOCAL){var s=this.getPositionExpressedInLocalSpace().add(o);this.setPositionWithLocalVector(s)}else this.setAbsolutePosition(this.getAbsolutePosition().add(o));return this},t.prototype.addRotation=function(e,i,n){var o;this.rotationQuaternion?o=this.rotationQuaternion:(o=C.Quaternion[1],N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,o));var s=C.Quaternion[0];return N.RotationYawPitchRollToRef(i,e,n,s),o.multiplyInPlace(s),this.rotationQuaternion||o.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var i=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=i,this._worldMatrix;var n=this.getScene().activeCamera,o=(this._billboardMode&t.BILLBOARDMODE_USE_POSITION)!==0,s=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;s&&n&&o&&(this.lookAt(n.position),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,this._currentRenderId=i,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var u=this._getEffectiveParent(),h=t._TmpScaling,f=this._position;if(this._infiniteDistance&&!this.parent&&n){var l=n.getWorldMatrix(),c=new g(l.m[12],l.m[13],l.m[14]);f=t._TmpTranslation,f.copyFromFloats(this._position.x+c.x,this._position.y+c.y,this._position.z+c.z)}h.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var p;if(this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){var d=this.rotation.lengthSquared();d&&(this._rotationQuaternion.multiplyInPlace(N.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else p=t._TmpRotation,N.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){var v=C.Matrix[1];O.ScalingToRef(h.x,h.y,h.z,v);var y=C.Matrix[0];p.toRotationMatrix(y),this._pivotMatrix.multiplyToRef(v,C.Matrix[4]),C.Matrix[4].multiplyToRef(y,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(f.x,f.y,f.z)}else O.ComposeToRef(h,p,f,this._localMatrix);if(u&&u.getWorldMatrix){if(e&&u.computeWorldMatrix(),s){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),C.Matrix[7]):C.Matrix[7].copyFrom(u.getWorldMatrix());var b=C.Vector3[5],m=C.Vector3[6];C.Matrix[7].decompose(m,void 0,b),O.ScalingToRef(m.x,m.y,m.z,C.Matrix[7]),C.Matrix[7].setTranslation(b),this._localMatrix.multiplyToRef(C.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),C.Matrix[6]),C.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s&&n&&this.billboardMode&&!o){var M=C.Vector3[0];if(this._worldMatrix.getTranslationToRef(M),C.Matrix[1].copyFrom(n.getViewMatrix()),C.Matrix[1].setTranslationFromFloats(0,0,0),C.Matrix[1].invertToRef(C.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){C.Matrix[0].decompose(void 0,C.Quaternion[0],void 0);var R=C.Vector3[1];C.Quaternion[0].toEulerAnglesToRef(R),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(R.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(R.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(R.z=0),O.RotationYawPitchRollToRef(R.y,R.x,R.z,C.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(C.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(C.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=O.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype.resetLocalMatrix=function(e){if(e===void 0&&(e=!0),this.computeWorldMatrix(),e)for(var i=this.getChildren(),n=0;n<i.length;++n){var o=i[n];if(o){o.computeWorldMatrix();var s=C.Matrix[0];o._localMatrix.multiplyToRef(this._localMatrix,s);var a=C.Quaternion[0];s.decompose(o.scaling,a,o.position),o.rotationQuaternion?o.rotationQuaternion=a:a.toEulerAnglesToRef(o.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=N.Identity()),this._worldMatrix=O.Identity()},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return e===void 0&&(e=null),e||(e=this.getScene().activeCamera),g.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return e===void 0&&(e=null),e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()},t.prototype.clone=function(e,i,n){var o=this,s=j.Clone(function(){return new t(e,o.getScene())},this);if(s.name=e,s.id=e,i&&(s.parent=i),!n)for(var a=this.getDescendants(!0),u=0;u<a.length;u++){var h=a[u];h.clone&&h.clone(e+"."+h.name,s)}return s},t.prototype.serialize=function(e){var i=j.Serialize(this,e);return i.type=this.getClassName(),this.parent&&(i.parentId=this.parent.id),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),this.parent&&(i.parentId=this.parent.id),i},t.Parse=function(e,i,n){var o=j.Parse(function(){return new t(e.name,i)},e,i,n);return e.localMatrix?o.setPreTransformMatrix(O.FromArray(e.localMatrix)):e.pivotMatrix&&o.setPivotMatrix(O.FromArray(e.pivotMatrix)),o.setEnabled(e.isEnabled),e.parentId&&(o._waitingParentId=e.parentId),o},t.prototype.getChildTransformNodes=function(e,i){var n=[];return this._getDescendants(n,e,function(o){return(!i||i(o))&&o instanceof t}),n},t.prototype.dispose=function(e,i){if(i===void 0&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),e)for(var n=this.getChildTransformNodes(!0),o=0,s=n;o<s.length;o++){var a=s[o];a.parent=null,a.computeWorldMatrix(!0)}r.prototype.dispose.call(this,e,i)},t.prototype.normalizeToUnitCube=function(e,i,n){e===void 0&&(e=!0),i===void 0&&(i=!1);var o=null,s=null;i&&(this.rotationQuaternion?(s=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(o=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var a=this.getHierarchyBoundingVectors(e,n),u=a.max.subtract(a.min),h=Math.max(u.x,u.y,u.z);if(h===0)return this;var f=1/h;return this.scaling.scaleInPlace(f),i&&(this.rotationQuaternion&&s?this.rotationQuaternion.copyFrom(s):this.rotation&&o&&this.rotation.copyFrom(o)),this},t.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t._TmpRotation=N.Zero(),t._TmpScaling=g.Zero(),t._TmpTranslation=g.Zero(),t._lookAtVectorCache=new g(0,0,0),t._rotationAxisCache=new N,P([wt("position")],t.prototype,"_position",void 0),P([wt("rotation")],t.prototype,"_rotation",void 0),P([Ii("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),P([wt("scaling")],t.prototype,"_scaling",void 0),P([T("billboardMode")],t.prototype,"_billboardMode",void 0),P([T()],t.prototype,"scalingDeterminant",void 0),P([T("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),P([T()],t.prototype,"ignoreNonUniformScaling",void 0),P([T()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(vt),me=function(){function r(t,e,i,n,o,s,a,u){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1),a===void 0&&(a=!1),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=i,this._instanced=s,this._divisor=u||1,this._data=e,this.byteStride=a?n:n*Float32Array.BYTES_PER_ELEMENT,o||this.create()}return r.prototype.createVertexBuffer=function(t,e,i,n,o,s,a){s===void 0&&(s=!1);var u=s?e:e*Float32Array.BYTES_PER_ELEMENT,h=n?s?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new _(this._engine,this,t,this._updatable,!0,h,o===void 0?this._instanced:o,u,i,void 0,void 0,!0,this._divisor||a)},r.prototype.isUpdatable=function(){return this._updatable},r.prototype.getData=function(){return this._data},r.prototype.getBuffer=function(){return this._buffer},r.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},r.prototype.create=function(t){t===void 0&&(t=null),!(!t&&this._buffer)&&(t=t||this._data,!!t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t)))},r.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},r.prototype.update=function(t){this.create(t)},r.prototype.updateDirectly=function(t,e,i,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,n?e:e*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},r.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},r.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},r}(),_=function(){function r(t,e,i,n,o,s,a,u,h,f,l,c,p,d){if(l===void 0&&(l=!1),c===void 0&&(c=!1),p===void 0&&(p=1),d===void 0&&(d=!1),e instanceof me?(this._buffer=e,this._ownsBuffer=d,d&&this._buffer._increaseReferences()):(this._buffer=new me(t,e,n,s,o,a,c),this._ownsBuffer=!0),this._kind=i,f==null){var v=this.getData();this.type=r.FLOAT,v instanceof Int8Array?this.type=r.BYTE:v instanceof Uint8Array?this.type=r.UNSIGNED_BYTE:v instanceof Int16Array?this.type=r.SHORT:v instanceof Uint16Array?this.type=r.UNSIGNED_SHORT:v instanceof Int32Array?this.type=r.INT:v instanceof Uint32Array&&(this.type=r.UNSIGNED_INT)}else this.type=f;var y=r.GetTypeByteLength(this.type);c?(this._size=h||(s?s/y:r.DeduceStride(i)),this.byteStride=s||this._buffer.byteStride||this._size*y,this.byteOffset=u||0):(this._size=h||s||r.DeduceStride(i),this.byteStride=s?s*y:this._buffer.byteStride||this._size*y,this.byteOffset=(u||0)*y),this.normalized=l,this._instanced=a!==void 0?a:!1,this._instanceDivisor=a?p:0}return Object.defineProperty(r.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,t==0?this._instanced=!1:this._instanced=!0},enumerable:!1,configurable:!0}),r.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},r.prototype.getKind=function(){return this._kind},r.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},r.prototype.getData=function(){return this._buffer.getData()},r.prototype.getBuffer=function(){return this._buffer.getBuffer()},r.prototype.getStrideSize=function(){return this.byteStride/r.GetTypeByteLength(this.type)},r.prototype.getOffset=function(){return this.byteOffset/r.GetTypeByteLength(this.type)},r.prototype.getSize=function(){return this._size},r.prototype.getIsInstanced=function(){return this._instanced},r.prototype.getInstanceDivisor=function(){return this._instanceDivisor},r.prototype.create=function(t){this._buffer.create(t)},r.prototype.update=function(t){this._buffer.update(t)},r.prototype.updateDirectly=function(t,e,i){i===void 0&&(i=!1),this._buffer.updateDirectly(t,e,void 0,i)},r.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},r.prototype.forEach=function(t,e){r.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,e)},r.DeduceStride=function(t){switch(t){case r.UVKind:case r.UV2Kind:case r.UV3Kind:case r.UV4Kind:case r.UV5Kind:case r.UV6Kind:return 2;case r.NormalKind:case r.PositionKind:return 3;case r.ColorKind:case r.MatricesIndicesKind:case r.MatricesIndicesExtraKind:case r.MatricesWeightsKind:case r.MatricesWeightsExtraKind:case r.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},r.GetTypeByteLength=function(t){switch(t){case r.BYTE:case r.UNSIGNED_BYTE:return 1;case r.SHORT:case r.UNSIGNED_SHORT:return 2;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},r.ForEach=function(t,e,i,n,o,s,a,u){if(t instanceof Array)for(var h=e/4,f=i/4,l=0;l<s;l+=n){for(var c=0;c<n;c++)u(t[h+c],l+c);h+=f}else for(var p=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),d=r.GetTypeByteLength(o),l=0;l<s;l+=n){for(var v=e,c=0;c<n;c++){var y=r._GetFloatValue(p,o,v,a);u(y,l+c),v+=d}e+=i}},r._GetFloatValue=function(t,e,i,n){switch(e){case r.BYTE:{var o=t.getInt8(i);return n&&(o=Math.max(o/127,-1)),o}case r.UNSIGNED_BYTE:{var o=t.getUint8(i);return n&&(o=o/255),o}case r.SHORT:{var o=t.getInt16(i,!0);return n&&(o=Math.max(o/32767,-1)),o}case r.UNSIGNED_SHORT:{var o=t.getUint16(i,!0);return n&&(o=o/65535),o}case r.INT:return t.getInt32(i,!0);case r.UNSIGNED_INT:return t.getUint32(i,!0);case r.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type "+e)}},r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="normal",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra",r}(),tt=function(){function r(){}return r.prototype.set=function(t,e){switch(t.length||z.Warn("Setting vertex data kind '"+e+"' with an empty array"),e){case _.PositionKind:this.positions=t;break;case _.NormalKind:this.normals=t;break;case _.TangentKind:this.tangents=t;break;case _.UVKind:this.uvs=t;break;case _.UV2Kind:this.uvs2=t;break;case _.UV3Kind:this.uvs3=t;break;case _.UV4Kind:this.uvs4=t;break;case _.UV5Kind:this.uvs5=t;break;case _.UV6Kind:this.uvs6=t;break;case _.ColorKind:this.colors=t;break;case _.MatricesIndicesKind:this.matricesIndices=t;break;case _.MatricesWeightsKind:this.matricesWeights=t;break;case _.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case _.MatricesWeightsExtraKind:this.matricesWeightsExtra=t;break}},r.prototype.applyToMesh=function(t,e){return this._applyTo(t,e),this},r.prototype.applyToGeometry=function(t,e){return this._applyTo(t,e),this},r.prototype.updateMesh=function(t){return this._update(t),this},r.prototype.updateGeometry=function(t){return this._update(t),this},r.prototype._applyTo=function(t,e){return e===void 0&&(e=!1),this.positions&&t.setVerticesData(_.PositionKind,this.positions,e),this.normals&&t.setVerticesData(_.NormalKind,this.normals,e),this.tangents&&t.setVerticesData(_.TangentKind,this.tangents,e),this.uvs&&t.setVerticesData(_.UVKind,this.uvs,e),this.uvs2&&t.setVerticesData(_.UV2Kind,this.uvs2,e),this.uvs3&&t.setVerticesData(_.UV3Kind,this.uvs3,e),this.uvs4&&t.setVerticesData(_.UV4Kind,this.uvs4,e),this.uvs5&&t.setVerticesData(_.UV5Kind,this.uvs5,e),this.uvs6&&t.setVerticesData(_.UV6Kind,this.uvs6,e),this.colors&&t.setVerticesData(_.ColorKind,this.colors,e),this.matricesIndices&&t.setVerticesData(_.MatricesIndicesKind,this.matricesIndices,e),this.matricesWeights&&t.setVerticesData(_.MatricesWeightsKind,this.matricesWeights,e),this.matricesIndicesExtra&&t.setVerticesData(_.MatricesIndicesExtraKind,this.matricesIndicesExtra,e),this.matricesWeightsExtra&&t.setVerticesData(_.MatricesWeightsExtraKind,this.matricesWeightsExtra,e),this.indices?t.setIndices(this.indices,null,e):t.setIndices([],null),this},r.prototype._update=function(t,e,i){return this.positions&&t.updateVerticesData(_.PositionKind,this.positions,e,i),this.normals&&t.updateVerticesData(_.NormalKind,this.normals,e,i),this.tangents&&t.updateVerticesData(_.TangentKind,this.tangents,e,i),this.uvs&&t.updateVerticesData(_.UVKind,this.uvs,e,i),this.uvs2&&t.updateVerticesData(_.UV2Kind,this.uvs2,e,i),this.uvs3&&t.updateVerticesData(_.UV3Kind,this.uvs3,e,i),this.uvs4&&t.updateVerticesData(_.UV4Kind,this.uvs4,e,i),this.uvs5&&t.updateVerticesData(_.UV5Kind,this.uvs5,e,i),this.uvs6&&t.updateVerticesData(_.UV6Kind,this.uvs6,e,i),this.colors&&t.updateVerticesData(_.ColorKind,this.colors,e,i),this.matricesIndices&&t.updateVerticesData(_.MatricesIndicesKind,this.matricesIndices,e,i),this.matricesWeights&&t.updateVerticesData(_.MatricesWeightsKind,this.matricesWeights,e,i),this.matricesIndicesExtra&&t.updateVerticesData(_.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,i),this.matricesWeightsExtra&&t.updateVerticesData(_.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,i),this.indices&&t.setIndices(this.indices,null),this},r.prototype.transform=function(t){var e=t.determinant()<0,i=g.Zero(),n;if(this.positions){var o=g.Zero();for(n=0;n<this.positions.length;n+=3)g.FromArrayToRef(this.positions,n,o),g.TransformCoordinatesToRef(o,t,i),this.positions[n]=i.x,this.positions[n+1]=i.y,this.positions[n+2]=i.z}if(this.normals){var s=g.Zero();for(n=0;n<this.normals.length;n+=3)g.FromArrayToRef(this.normals,n,s),g.TransformNormalToRef(s,t,i),this.normals[n]=i.x,this.normals[n+1]=i.y,this.normals[n+2]=i.z}if(this.tangents){var a=Ct.Zero(),u=Ct.Zero();for(n=0;n<this.tangents.length;n+=4)Ct.FromArrayToRef(this.tangents,n,a),Ct.TransformNormalToRef(a,t,u),this.tangents[n]=u.x,this.tangents[n+1]=u.y,this.tangents[n+2]=u.z,this.tangents[n+3]=u.w}if(e&&this.indices)for(n=0;n<this.indices.length;n+=3){var h=this.indices[n+1];this.indices[n+1]=this.indices[n+2],this.indices[n+2]=h}return this},r.prototype.merge=function(t,e){if(e===void 0&&(e=!1),this._validate(),t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(t.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0,n=this.indices.BYTES_PER_ELEMENT!==void 0;if(n){var o=this.indices.length+t.indices.length,s=e||this.indices instanceof Uint32Array?new Uint32Array(o):new Uint16Array(o);s.set(this.indices);for(var a=this.indices.length,u=0;u<t.indices.length;u++)s[a+u]=t.indices[u]+i;this.indices=s}else for(var u=0;u<t.indices.length;u++)this.indices.push(t.indices[u]+i)}return this.positions=this._mergeElement(this.positions,t.positions),this.normals=this._mergeElement(this.normals,t.normals),this.tangents=this._mergeElement(this.tangents,t.tangents),this.uvs=this._mergeElement(this.uvs,t.uvs),this.uvs2=this._mergeElement(this.uvs2,t.uvs2),this.uvs3=this._mergeElement(this.uvs3,t.uvs3),this.uvs4=this._mergeElement(this.uvs4,t.uvs4),this.uvs5=this._mergeElement(this.uvs5,t.uvs5),this.uvs6=this._mergeElement(this.uvs6,t.uvs6),this.colors=this._mergeElement(this.colors,t.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,t.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,t.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,t.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,t.matricesWeightsExtra),this},r.prototype._mergeElement=function(t,e){if(!t)return e;if(!e)return t;var i=e.length+t.length,n=t instanceof Float32Array,o=e instanceof Float32Array;if(n){var s=new Float32Array(i);return s.set(t),s.set(e,t.length),s}else if(o){for(var a=t.slice(0),u=0,i=e.length;u<i;u++)a.push(e[u]);return a}else return t.concat(e)},r.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var t=function(n,o){var s=_.DeduceStride(n);if(o.length%s!==0)throw new Error("The "+n+"s array count must be a multiple of "+s);return o.length/s},e=t(_.PositionKind,this.positions),i=function(n,o){var s=t(n,o);if(s!==e)throw new Error("The "+n+"s element count ("+s+") does not match the positions count ("+e+")")};this.normals&&i(_.NormalKind,this.normals),this.tangents&&i(_.TangentKind,this.tangents),this.uvs&&i(_.UVKind,this.uvs),this.uvs2&&i(_.UV2Kind,this.uvs2),this.uvs3&&i(_.UV3Kind,this.uvs3),this.uvs4&&i(_.UV4Kind,this.uvs4),this.uvs5&&i(_.UV5Kind,this.uvs5),this.uvs6&&i(_.UV6Kind,this.uvs6),this.colors&&i(_.ColorKind,this.colors),this.matricesIndices&&i(_.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(_.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(_.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(_.MatricesWeightsExtraKind,this.matricesWeightsExtra)},r.prototype.serialize=function(){var t=this.serialize();return this.positions&&(t.positions=this.positions),this.normals&&(t.normals=this.normals),this.tangents&&(t.tangents=this.tangents),this.uvs&&(t.uvs=this.uvs),this.uvs2&&(t.uvs2=this.uvs2),this.uvs3&&(t.uvs3=this.uvs3),this.uvs4&&(t.uvs4=this.uvs4),this.uvs5&&(t.uvs5=this.uvs5),this.uvs6&&(t.uvs6=this.uvs6),this.colors&&(t.colors=this.colors),this.matricesIndices&&(t.matricesIndices=this.matricesIndices,t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(t.matricesIndicesExtra=this.matricesIndicesExtra,t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=this.matricesWeightsExtra),t.indices=this.indices,t},r.ExtractFromMesh=function(t,e,i){return r._ExtractFrom(t,e,i)},r.ExtractFromGeometry=function(t,e,i){return r._ExtractFrom(t,e,i)},r._ExtractFrom=function(t,e,i){var n=new r;return t.isVerticesDataPresent(_.PositionKind)&&(n.positions=t.getVerticesData(_.PositionKind,e,i)),t.isVerticesDataPresent(_.NormalKind)&&(n.normals=t.getVerticesData(_.NormalKind,e,i)),t.isVerticesDataPresent(_.TangentKind)&&(n.tangents=t.getVerticesData(_.TangentKind,e,i)),t.isVerticesDataPresent(_.UVKind)&&(n.uvs=t.getVerticesData(_.UVKind,e,i)),t.isVerticesDataPresent(_.UV2Kind)&&(n.uvs2=t.getVerticesData(_.UV2Kind,e,i)),t.isVerticesDataPresent(_.UV3Kind)&&(n.uvs3=t.getVerticesData(_.UV3Kind,e,i)),t.isVerticesDataPresent(_.UV4Kind)&&(n.uvs4=t.getVerticesData(_.UV4Kind,e,i)),t.isVerticesDataPresent(_.UV5Kind)&&(n.uvs5=t.getVerticesData(_.UV5Kind,e,i)),t.isVerticesDataPresent(_.UV6Kind)&&(n.uvs6=t.getVerticesData(_.UV6Kind,e,i)),t.isVerticesDataPresent(_.ColorKind)&&(n.colors=t.getVerticesData(_.ColorKind,e,i)),t.isVerticesDataPresent(_.MatricesIndicesKind)&&(n.matricesIndices=t.getVerticesData(_.MatricesIndicesKind,e,i)),t.isVerticesDataPresent(_.MatricesWeightsKind)&&(n.matricesWeights=t.getVerticesData(_.MatricesWeightsKind,e,i)),t.isVerticesDataPresent(_.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=t.getVerticesData(_.MatricesIndicesExtraKind,e,i)),t.isVerticesDataPresent(_.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=t.getVerticesData(_.MatricesWeightsExtraKind,e,i)),n.indices=t.getIndices(e,i),n},r.CreateRibbon=function(t){throw S.WarnImport("ribbonBuilder")},r.CreateBox=function(t){throw S.WarnImport("boxBuilder")},r.CreateTiledBox=function(t){throw S.WarnImport("tiledBoxBuilder")},r.CreateTiledPlane=function(t){throw S.WarnImport("tiledPlaneBuilder")},r.CreateSphere=function(t){throw S.WarnImport("sphereBuilder")},r.CreateCylinder=function(t){throw S.WarnImport("cylinderBuilder")},r.CreateTorus=function(t){throw S.WarnImport("torusBuilder")},r.CreateLineSystem=function(t){throw S.WarnImport("linesBuilder")},r.CreateDashedLines=function(t){throw S.WarnImport("linesBuilder")},r.CreateGround=function(t){throw S.WarnImport("groundBuilder")},r.CreateTiledGround=function(t){throw S.WarnImport("groundBuilder")},r.CreateGroundFromHeightMap=function(t){throw S.WarnImport("groundBuilder")},r.CreatePlane=function(t){throw S.WarnImport("planeBuilder")},r.CreateDisc=function(t){throw S.WarnImport("discBuilder")},r.CreatePolygon=function(t,e,i,n,o,s,a){throw S.WarnImport("polygonBuilder")},r.CreateIcoSphere=function(t){throw S.WarnImport("icoSphereBuilder")},r.CreatePolyhedron=function(t){throw S.WarnImport("polyhedronBuilder")},r.CreateCapsule=function(t){throw t===void 0&&(t={orientation:g.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),S.WarnImport("capsuleBuilder")},r.CreateTorusKnot=function(t){throw S.WarnImport("torusKnotBuilder")},r.ComputeNormals=function(t,e,i,n){var o=0,s=0,a=0,u=0,h=0,f=0,l=0,c=0,p=0,d=0,v=0,y=0,b=0,m=0,M=0,R=0,D=0,I=0,A=0,x=0,W=!1,q=!1,Q=!1,st=!1,Y=1,F=0,$=null;if(n&&(W=!!n.facetNormals,q=!!n.facetPositions,Q=!!n.facetPartitioning,Y=n.useRightHandedSystem===!0?-1:1,F=n.ratio||0,st=!!n.depthSort,$=n.distanceTo,st)){$===void 0&&($=g.Zero());var Rt=n.depthSortedFacets}var at=0,ut=0,ht=0,ft=0;if(Q&&n&&n.bbSize){var yt=0,Kt=0,Wt=0,jt=0,Gt=0,Yt=0,Zt=0,Jt=0,$t=0,te=0,ee=0,ie=0,mt=0,bt=0,Mt=0,At=0,Ht=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;Ht=Ht>n.bbSize.z?Ht:n.bbSize.z,at=n.subDiv.X*F/n.bbSize.x,ut=n.subDiv.Y*F/n.bbSize.y,ht=n.subDiv.Z*F/n.bbSize.z,ft=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(o=0;o<t.length;o++)i[o]=0;var pe=e.length/3|0;for(o=0;o<pe;o++){if(y=e[o*3]*3,b=y+1,m=y+2,M=e[o*3+1]*3,R=M+1,D=M+2,I=e[o*3+2]*3,A=I+1,x=I+2,s=t[y]-t[M],a=t[b]-t[R],u=t[m]-t[D],h=t[I]-t[M],f=t[A]-t[R],l=t[x]-t[D],c=Y*(a*l-u*f),p=Y*(u*h-s*l),d=Y*(s*f-a*h),v=Math.sqrt(c*c+p*p+d*d),v=v===0?1:v,c/=v,p/=v,d/=v,W&&n&&(n.facetNormals[o].x=c,n.facetNormals[o].y=p,n.facetNormals[o].z=d),q&&n&&(n.facetPositions[o].x=(t[y]+t[M]+t[I])/3,n.facetPositions[o].y=(t[b]+t[R]+t[A])/3,n.facetPositions[o].z=(t[m]+t[D]+t[x])/3),Q&&n&&(yt=Math.floor((n.facetPositions[o].x-n.bInfo.minimum.x*F)*at),Kt=Math.floor((n.facetPositions[o].y-n.bInfo.minimum.y*F)*ut),Wt=Math.floor((n.facetPositions[o].z-n.bInfo.minimum.z*F)*ht),jt=Math.floor((t[y]-n.bInfo.minimum.x*F)*at),Gt=Math.floor((t[b]-n.bInfo.minimum.y*F)*ut),Yt=Math.floor((t[m]-n.bInfo.minimum.z*F)*ht),Zt=Math.floor((t[M]-n.bInfo.minimum.x*F)*at),Jt=Math.floor((t[R]-n.bInfo.minimum.y*F)*ut),$t=Math.floor((t[D]-n.bInfo.minimum.z*F)*ht),te=Math.floor((t[I]-n.bInfo.minimum.x*F)*at),ee=Math.floor((t[A]-n.bInfo.minimum.y*F)*ut),ie=Math.floor((t[x]-n.bInfo.minimum.z*F)*ht),bt=jt+n.subDiv.max*Gt+ft*Yt,Mt=Zt+n.subDiv.max*Jt+ft*$t,At=te+n.subDiv.max*ee+ft*ie,mt=yt+n.subDiv.max*Kt+ft*Wt,n.facetPartitioning[mt]=n.facetPartitioning[mt]?n.facetPartitioning[mt]:new Array,n.facetPartitioning[bt]=n.facetPartitioning[bt]?n.facetPartitioning[bt]:new Array,n.facetPartitioning[Mt]=n.facetPartitioning[Mt]?n.facetPartitioning[Mt]:new Array,n.facetPartitioning[At]=n.facetPartitioning[At]?n.facetPartitioning[At]:new Array,n.facetPartitioning[bt].push(o),Mt!=bt&&n.facetPartitioning[Mt].push(o),At==Mt||At==bt||n.facetPartitioning[At].push(o),mt==bt||mt==Mt||mt==At||n.facetPartitioning[mt].push(o)),st&&n&&n.facetPositions){var Oe=Rt[o];Oe.ind=o*3,Oe.sqDistance=g.DistanceSquared(n.facetPositions[o],$)}i[y]+=c,i[b]+=p,i[m]+=d,i[M]+=c,i[R]+=p,i[D]+=d,i[I]+=c,i[A]+=p,i[x]+=d}for(o=0;o<i.length/3;o++)c=i[o*3],p=i[o*3+1],d=i[o*3+2],v=Math.sqrt(c*c+p*p+d*d),v=v===0?1:v,c/=v,p/=v,d/=v,i[o*3]=c,i[o*3+1]=p,i[o*3+2]=d},r._ComputeSides=function(t,e,i,n,o,s,a){var u=i.length,h=n.length,f,l;switch(t=t||r.DEFAULTSIDE,t){case r.FRONTSIDE:break;case r.BACKSIDE:var c;for(f=0;f<u;f+=3)c=i[f],i[f]=i[f+2],i[f+2]=c;for(l=0;l<h;l++)n[l]=-n[l];break;case r.DOUBLESIDE:for(var p=e.length,d=p/3,v=0;v<p;v++)e[p+v]=e[v];for(f=0;f<u;f+=3)i[f+u]=i[f+2]+d,i[f+1+u]=i[f+1]+d,i[f+2+u]=i[f]+d;for(l=0;l<h;l++)n[h+l]=-n[l];var y=o.length,b=0;for(b=0;b<y;b++)o[b+y]=o[b];for(s=s||new Ct(0,0,1,1),a=a||new Ct(0,0,1,1),b=0,f=0;f<y/2;f++)o[b]=s.x+(s.z-s.x)*o[b],o[b+1]=s.y+(s.w-s.y)*o[b+1],o[b+y]=a.x+(a.z-a.x)*o[b+y],o[b+y+1]=a.y+(a.w-a.y)*o[b+y+1],b+=2;break}},r.ImportVertexData=function(t,e){var i=new r,n=t.positions;n&&i.set(n,_.PositionKind);var o=t.normals;o&&i.set(o,_.NormalKind);var s=t.tangents;s&&i.set(s,_.TangentKind);var a=t.uvs;a&&i.set(a,_.UVKind);var u=t.uv2s;u&&i.set(u,_.UV2Kind);var h=t.uv3s;h&&i.set(h,_.UV3Kind);var f=t.uv4s;f&&i.set(f,_.UV4Kind);var l=t.uv5s;l&&i.set(l,_.UV5Kind);var c=t.uv6s;c&&i.set(c,_.UV6Kind);var p=t.colors;p&&i.set(J.CheckColors4(p,n.length/3),_.ColorKind);var d=t.matricesIndices;d&&i.set(d,_.MatricesIndicesKind);var v=t.matricesWeights;v&&i.set(v,_.MatricesWeightsKind);var y=t.indices;y&&(i.indices=y),e.setAllVerticesData(i,t.updatable)},r.FRONTSIDE=0,r.BACKSIDE=1,r.DOUBLESIDE=2,r.DEFAULTSIDE=0,r}(),be=function(){function r(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return r.prototype.getNormal=function(t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(_.NormalKind))return null;var i=this.pickedMesh.getIndices();if(!i)return null;var n;if(e){var o=this.pickedMesh.getVerticesData(_.NormalKind),s=g.FromArray(o,i[this.faceId*3]*3),a=g.FromArray(o,i[this.faceId*3+1]*3),u=g.FromArray(o,i[this.faceId*3+2]*3);s=s.scale(this.bu),a=a.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new g(s.x+a.x+u.x,s.y+a.y+u.y,s.z+a.z+u.z)}else{var h=this.pickedMesh.getVerticesData(_.PositionKind),f=g.FromArray(h,i[this.faceId*3]*3),l=g.FromArray(h,i[this.faceId*3+1]*3),c=g.FromArray(h,i[this.faceId*3+2]*3),p=f.subtract(l),d=c.subtract(l);n=g.Cross(p,d)}if(t){var v=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(C.Matrix[0].copyFrom(v),v=C.Matrix[0],v.setTranslationFromFloats(0,0,0),v.invert(),v.transposeToRef(C.Matrix[1]),v=C.Matrix[1]),n=g.TransformNormal(n,v)}return n.normalize(),n},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(_.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var e=this.pickedMesh.getVerticesData(_.UVKind);if(!e)return null;var i=G.FromArray(e,t[this.faceId*3]*2),n=G.FromArray(e,t[this.faceId*3+1]*2),o=G.FromArray(e,t[this.faceId*3+2]*2);return i=i.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new G(i.x+n.x+o.x,i.y+n.y+o.y)},r}(),Fe=function(){function r(t,e,i){this.vectors=et.BuildArray(8,g.Zero),this.center=g.Zero(),this.centerWorld=g.Zero(),this.extendSize=g.Zero(),this.extendSizeWorld=g.Zero(),this.directions=et.BuildArray(3,g.Zero),this.vectorsWorld=et.BuildArray(8,g.Zero),this.minimumWorld=g.Zero(),this.maximumWorld=g.Zero(),this.minimum=g.Zero(),this.maximum=g.Zero(),this.reConstruct(t,e,i)}return r.prototype.reConstruct=function(t,e,i){var n=t.x,o=t.y,s=t.z,a=e.x,u=e.y,h=e.z,f=this.vectors;this.minimum.copyFromFloats(n,o,s),this.maximum.copyFromFloats(a,u,h),f[0].copyFromFloats(n,o,s),f[1].copyFromFloats(a,u,h),f[2].copyFromFloats(a,o,s),f[3].copyFromFloats(n,u,s),f[4].copyFromFloats(n,o,h),f[5].copyFromFloats(a,u,s),f[6].copyFromFloats(n,u,h),f[7].copyFromFloats(a,o,h),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||O.IdentityReadOnly,this._update(this._worldMatrix)},r.prototype.scale=function(t){var e=r.TmpVector3,i=this.maximum.subtractToRef(this.minimum,e[0]),n=i.length();i.normalizeFromLength(n);var o=n*t,s=i.scaleInPlace(o*.5),a=this.center.subtractToRef(s,e[1]),u=this.center.addToRef(s,e[2]);return this.reConstruct(a,u,this._worldMatrix),this},r.prototype.getWorldMatrix=function(){return this._worldMatrix},r.prototype._update=function(t){var e=this.minimumWorld,i=this.maximumWorld,n=this.directions,o=this.vectorsWorld,s=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),i.copyFrom(this.maximum);for(var a=0;a<8;++a)o[a].copyFrom(s[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var a=0;a<8;++a){var u=o[a];g.TransformCoordinatesToRef(s[a],t,u),e.minimizeInPlace(u),i.maximizeInPlace(u)}i.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(e,this.centerWorld).scaleInPlace(.5)}g.FromArrayToRef(t.m,0,n[0]),g.FromArrayToRef(t.m,4,n[1]),g.FromArrayToRef(t.m,8,n[2]),this._worldMatrix=t},r.prototype.isInFrustum=function(t){return r.IsInFrustum(this.vectorsWorld,t)},r.prototype.isCompletelyInFrustum=function(t){return r.IsCompletelyInFrustum(this.vectorsWorld,t)},r.prototype.intersectsPoint=function(t){var e=this.minimumWorld,i=this.maximumWorld,n=e.x,o=e.y,s=e.z,a=i.x,u=i.y,h=i.z,f=t.x,l=t.y,c=t.z,p=-X;return!(a-f<p||p>f-n||u-l<p||p>l-o||h-c<p||p>c-s)},r.prototype.intersectsSphere=function(t){return r.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)},r.prototype.intersectsMinMax=function(t,e){var i=this.minimumWorld,n=this.maximumWorld,o=i.x,s=i.y,a=i.z,u=n.x,h=n.y,f=n.z,l=t.x,c=t.y,p=t.z,d=e.x,v=e.y,y=e.z;return!(u<l||o>d||h<c||s>v||f<p||a>y)},r.Intersects=function(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)},r.IntersectsSphere=function(t,e,i,n){var o=r.TmpVector3[0];g.ClampToRef(i,t,e,o);var s=g.DistanceSquared(i,o);return s<=n*n},r.IsCompletelyInFrustum=function(t,e){for(var i=0;i<6;++i)for(var n=e[i],o=0;o<8;++o)if(n.dotCoordinate(t[o])<0)return!1;return!0},r.IsInFrustum=function(t,e){for(var i=0;i<6;++i){for(var n=!0,o=e[i],s=0;s<8;++s)if(o.dotCoordinate(t[s])>=0){n=!1;break}if(n)return!1}return!0},r.TmpVector3=et.BuildArray(3,g.Zero),r}(),Be=function(){function r(t,e,i){this.center=g.Zero(),this.centerWorld=g.Zero(),this.minimum=g.Zero(),this.maximum=g.Zero(),this.reConstruct(t,e,i)}return r.prototype.reConstruct=function(t,e,i){this.minimum.copyFrom(t),this.maximum.copyFrom(e);var n=g.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=n*.5,this._update(i||O.IdentityReadOnly)},r.prototype.scale=function(t){var e=this.radius*t,i=r.TmpVector3,n=i[0].setAll(e),o=this.center.subtractToRef(n,i[1]),s=this.center.addToRef(n,i[2]);return this.reConstruct(o,s,this._worldMatrix),this},r.prototype.getWorldMatrix=function(){return this._worldMatrix},r.prototype._update=function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{g.TransformCoordinatesToRef(this.center,t,this.centerWorld);var e=r.TmpVector3[0];g.TransformNormalFromFloatsToRef(1,1,1,t,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}},r.prototype.isInFrustum=function(t){for(var e=this.centerWorld,i=this.radiusWorld,n=0;n<6;n++)if(t[n].dotCoordinate(e)<=-i)return!1;return!0},r.prototype.isCenterInFrustum=function(t){for(var e=this.centerWorld,i=0;i<6;i++)if(t[i].dotCoordinate(e)<0)return!1;return!0},r.prototype.intersectsPoint=function(t){var e=g.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)},r.Intersects=function(t,e){var i=g.DistanceSquared(t.centerWorld,e.centerWorld),n=t.radiusWorld+e.radiusWorld;return!(n*n<i)},r.TmpVector3=et.BuildArray(3,g.Zero),r}(),_e={min:0,max:0},ge={min:0,max:0},Ne=function(r,t,e){var i=g.Dot(t.centerWorld,r),n=Math.abs(g.Dot(t.directions[0],r))*t.extendSize.x,o=Math.abs(g.Dot(t.directions[1],r))*t.extendSize.y,s=Math.abs(g.Dot(t.directions[2],r))*t.extendSize.z,a=n+o+s;e.min=i-a,e.max=i+a},it=function(r,t,e){return Ne(r,t,_e),Ne(r,e,ge),!(_e.min>ge.max||ge.min>_e.max)},Tt=function(){function r(t,e,i){this._isLocked=!1,this.boundingBox=new Fe(t,e,i),this.boundingSphere=new Be(t,e,i)}return r.prototype.reConstruct=function(t,e,i){this.boundingBox.reConstruct(t,e,i),this.boundingSphere.reConstruct(t,e,i)},Object.defineProperty(r.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isLocked",{get:function(){return this._isLocked},set:function(t){this._isLocked=t},enumerable:!1,configurable:!0}),r.prototype.update=function(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))},r.prototype.centerOn=function(t,e){var i=r.TmpVector3[0].copyFrom(t).subtractInPlace(e),n=r.TmpVector3[1].copyFrom(t).addInPlace(e);return this.boundingBox.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this},r.prototype.scale=function(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this},r.prototype.isInFrustum=function(t,e){e===void 0&&(e=0);var i=e===2||e===3;if(i&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;var n=e===1||e===3;return n?!0:this.boundingBox.isInFrustum(t)},Object.defineProperty(r.prototype,"diagonalLength",{get:function(){var t=this.boundingBox,e=t.maximumWorld.subtractToRef(t.minimumWorld,r.TmpVector3[0]);return e.length()},enumerable:!1,configurable:!0}),r.prototype.isCompletelyInFrustum=function(t){return this.boundingBox.isCompletelyInFrustum(t)},r.prototype._checkCollision=function(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},r.prototype.intersectsPoint=function(t){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(t)||!this.boundingBox.intersectsPoint(t))},r.prototype.intersects=function(t,e){if(!Be.Intersects(this.boundingSphere,t.boundingSphere)||!Fe.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;var i=this.boundingBox,n=t.boundingBox;return!(!it(i.directions[0],i,n)||!it(i.directions[1],i,n)||!it(i.directions[2],i,n)||!it(n.directions[0],i,n)||!it(n.directions[1],i,n)||!it(n.directions[2],i,n)||!it(g.Cross(i.directions[0],n.directions[0]),i,n)||!it(g.Cross(i.directions[0],n.directions[1]),i,n)||!it(g.Cross(i.directions[0],n.directions[2]),i,n)||!it(g.Cross(i.directions[1],n.directions[0]),i,n)||!it(g.Cross(i.directions[1],n.directions[1]),i,n)||!it(g.Cross(i.directions[1],n.directions[2]),i,n)||!it(g.Cross(i.directions[2],n.directions[0]),i,n)||!it(g.Cross(i.directions[2],n.directions[1]),i,n)||!it(g.Cross(i.directions[2],n.directions[2]),i,n))},r.TmpVector3=et.BuildArray(2,g.Zero),r}(),Oi=function(){function r(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new g(0,0,0),this._diffPositionForCollisions=new g(0,0,0),this._collisionResponse=!0}return r}();function Di(r,t,e,i,n){n===void 0&&(n=null);for(var o=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new g(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=e;a<e+i;a++){var u=t[a]*3,h=r[u],f=r[u+1],l=r[u+2];o.minimizeInPlaceFromFloats(h,f,l),s.maximizeInPlaceFromFloats(h,f,l)}return n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:o,maximum:s}}function Xe(r,t,e,i,n){i===void 0&&(i=null);var o=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new g(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);n||(n=3);for(var a=t,u=t*n;a<t+e;a++,u+=n){var h=r[u],f=r[u+1],l=r[u+2];o.minimizeInPlaceFromFloats(h,f,l),s.maximizeInPlaceFromFloats(h,f,l)}return i&&(o.x-=o.x*i.x+i.y,o.y-=o.y*i.x+i.y,o.z-=o.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:o,maximum:s}}var Ci=function(){function r(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=g.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return r}(),Ei=function(){function r(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new Ci,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1}return r}(),le=function(r){U(t,r);function t(e,i){i===void 0&&(i=null);var n=r.call(this,e,i,!1)||this;return n._internalAbstractMeshDataInfo=new Ei,n.cullingStrategy=t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,n.onCollideObservable=new E,n.onCollisionPositionChangeObservable=new E,n.onMaterialChangedObservable=new E,n.definedFacingForward=!0,n._occlusionQuery=null,n._renderingGroup=null,n.alphaIndex=Number.MAX_VALUE,n.isVisible=!0,n.isPickable=!0,n.showSubMeshesBoundingBox=!1,n.isBlocker=!1,n.enablePointerMoveEvents=!1,n._renderingGroupId=0,n._material=null,n.outlineColor=pt.Red(),n.outlineWidth=.02,n.overlayColor=pt.Red(),n.overlayAlpha=.5,n.useOctreeForRenderingSelection=!0,n.useOctreeForPicking=!0,n.useOctreeForCollisions=!0,n.alwaysSelectAsActiveMesh=!1,n.doNotSyncBoundingInfo=!1,n.actionManager=null,n._meshCollisionData=new Oi,n.ellipsoid=new g(.5,1,.5),n.ellipsoidOffset=new g(0,0,0),n.edgesWidth=1,n.edgesColor=new J(1,0,0,1),n._edgesRenderer=null,n._masterMesh=null,n._boundingInfo=null,n._renderId=0,n._intersectionsInProgress=new Array,n._unIndexed=!1,n._lightSources=new Array,n._waitingData={lods:null,actions:null,freezeWorldMatrix:null},n._bonesTransformMatrices=null,n._transformMatrixTexture=null,n.onRebuildObservable=new E,n._onCollisionPositionChange=function(o,s,a){a===void 0&&(a=null),s.subtractToRef(n._meshCollisionData._oldPositionForCollisions,n._meshCollisionData._diffPositionForCollisions),n._meshCollisionData._diffPositionForCollisions.length()>oi.CollisionsEpsilon&&n.position.addInPlace(n._meshCollisionData._diffPositionForCollisions),a&&n.onCollideObservable.notifyObservers(a),n.onCollisionPositionChangeObservable.notifyObservers(n.position)},n.getScene().addMesh(n),n._resyncLightSources(),n}return Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return dt.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return dt.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return dt.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return dt.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return dt.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_USE_POSITION",{get:function(){return dt.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return r.prototype._updateNonUniformScalingState.call(this,e)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(t.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(e){this._renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),!!this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(e){this._meshCollisionData._collisionResponse=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(e){this._meshCollisionData._surroundingMeshes=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var i=this._internalAbstractMeshDataInfo._skeleton;i&&i.needInitialSkinMatrix&&i._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(e){var i="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(i+=", skeleton: "+n.name),e&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),i},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==dt.BILLBOARDMODE_NONE?this._masterMesh:r.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(e,i){if(i===void 0&&(i=!0),this.actionManager&&(i||this.actionManager.isRecursive))if(e){if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},t.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),!!this.subMeshes)for(var e=0,i=this.subMeshes;e<i.length;e++){var n=i[e];n._rebuild()}},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,i=this.getScene().lights;e<i.length;e++){var n=i[e];!n.isEnabled()||n.canAffectMesh(this)&&this._lightSources.push(n)}this._markSubMeshesAsLightDirty()},t.prototype._resyncLightSource=function(e){var i=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e),o=!1;if(n===-1){if(!i)return;this._lightSources.push(e)}else{if(i)return;o=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(o)},t.prototype._unBindEffect=function(){for(var e=0,i=this.subMeshes;e<i.length;e++){var n=i[e];n.setEffect(null)}},t.prototype._removeLightSource=function(e,i){var n=this._lightSources.indexOf(e);n!==-1&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(i))},t.prototype._markSubMeshesAsDirty=function(e){if(!!this.subMeshes)for(var i=0,n=this.subMeshes;i<n.length;i++){var o=n[i];o._materialDefines&&e(o._materialDefines)}},t.prototype._markSubMeshesAsLightDirty=function(e){e===void 0&&(e=!1),this._markSubMeshesAsDirty(function(i){return i.markAsLightDirty(e)})},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},t.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsMiscDirty()})},Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getLOD=function(e){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(e){return null},t.prototype.setVerticesData=function(e,i,n,o){return this},t.prototype.updateVerticesData=function(e,i,n,o){return this},t.prototype.setIndices=function(e,i){return this},t.prototype.isVerticesDataPresent=function(e){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},t.prototype.normalizeToUnitCube=function(e,i,n){return e===void 0&&(e=!0),i===void 0&&(i=!1),r.prototype.normalizeToUnitCube.call(this,e,i,n)},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(_.MatricesIndicesKind)&&this.isVerticesDataPresent(_.MatricesWeightsKind)},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(e){},t.prototype._activate=function(e,i){return this._renderId=e,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===dt.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():r.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():r.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.movePOV=function(e,i,n){return this.position.addInPlace(this.calcMovePOV(e,i,n)),this},t.prototype.calcMovePOV=function(e,i,n){var o=new O,s=this.rotationQuaternion?this.rotationQuaternion:N.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);s.toRotationMatrix(o);var a=g.Zero(),u=this.definedFacingForward?-1:1;return g.TransformCoordinatesFromFloatsToRef(e*u,i,n*u,o,a),a},t.prototype.rotatePOV=function(e,i,n){return this.rotation.addInPlace(this.calcRotatePOV(e,i,n)),this},t.prototype.calcRotatePOV=function(e,i,n){var o=this.definedFacingForward?1:-1;return new g(e*o,i,n*o)},t.prototype.refreshBoundingInfo=function(e){return e===void 0&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(e),null),this)},t.prototype._refreshBoundingInfo=function(e,i){if(e){var n=Xe(e,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new Tt(n.minimum,n.maximum)}if(this.subMeshes)for(var o=0;o<this.subMeshes.length;o++)this.subMeshes[o].refreshBoundingInfo(e);this._updateBoundingInfo()},t.prototype._getPositionData=function(e){var i=this.getVerticesData(_.PositionKind);if(i&&e&&this.skeleton){i=K.Slice(i),this._generatePointsArray();var n=this.getVerticesData(_.MatricesIndicesKind),o=this.getVerticesData(_.MatricesWeightsKind);if(o&&n){var s=this.numBoneInfluencers>4,a=s?this.getVerticesData(_.MatricesIndicesExtraKind):null,u=s?this.getVerticesData(_.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var h=this.skeleton.getTransformMatrices(this),f=C.Vector3[0],l=C.Matrix[0],c=C.Matrix[1],p=0,d=0;d<i.length;d+=3,p+=4){l.reset();var v,y;for(v=0;v<4;v++)y=o[p+v],y>0&&(O.FromFloat32ArrayToRefScaled(h,Math.floor(n[p+v]*16),y,c),l.addToSelf(c));if(s)for(v=0;v<4;v++)y=u[p+v],y>0&&(O.FromFloat32ArrayToRefScaled(h,Math.floor(a[p+v]*16),y,c),l.addToSelf(c));g.TransformCoordinatesFromFloatsToRef(i[d],i[d+1],i[d+2],l,f),f.toArray(i,d),this._positions&&this._positions[d/3].copyFrom(f)}}}return i},t.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new Tt(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var i=this.subMeshes.length,n=0;n<i;n++){var o=this.subMeshes[n];(i>1||!o.IsGlobal)&&o.updateBoundingInfo(e)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(t.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),t.prototype.isInFrustum=function(e){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(e)},t.prototype.intersectsMesh=function(e,i,n){if(i===void 0&&(i=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,i))return!0;if(n)for(var o=0,s=this.getChildMeshes();o<s.length;o++){var a=s[o];if(a.intersectsMesh(e,i,!0))return!0}return!1},t.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),t.prototype.moveWithCollisions=function(e){var i=this.getAbsolutePosition();i.addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var n=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=n.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,n.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(e,i,n){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var o=e.verticesStart,s=e.verticesStart+e.verticesCount,a=o;a<s;a++)e._lastColliderWorldVertices.push(g.TransformCoordinates(this._positions[a],i))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this),this},t.prototype._processCollisionsForSubMeshes=function(e,i){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),o=n.length,s=0;s<o;s++){var a=n.data[s];o>1&&!a._checkCollision(e)||this._collideForSubMesh(a,i,e)}return this},t.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var i=C.Matrix[0],n=C.Matrix[1];return O.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,n),this._processCollisionsForSubMeshes(e,n),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(e,i,n,o,s,a){var u;o===void 0&&(o=!1),a===void 0&&(a=!1);var h=new be,f=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,l=this._boundingInfo;if(!this.subMeshes||!l||!a&&(!e.intersectsSphere(l.boundingSphere,f)||!e.intersectsBox(l.boundingBox,f)))return h;if(o)return h.hit=!a,h.pickedMesh=a?null:this,h.distance=a?0:g.Distance(e.origin,l.boundingSphere.center),h.subMeshId=0,h;if(!this._generatePointsArray())return h;for(var c=null,p=this._scene.getIntersectingSubMeshCandidates(this,e),d=p.length,v=!1,y=0;y<d;y++){var b=p.data[y],m=b.getMaterial();if(!!m&&((u=this.getIndices())===null||u===void 0?void 0:u.length)&&(m.fillMode==7||m.fillMode==0||m.fillMode==1||m.fillMode==2)){v=!0;break}}if(!v)return h.hit=!0,h.pickedMesh=this,h.distance=g.Distance(e.origin,l.boundingSphere.center),h.subMeshId=-1,h;for(var y=0;y<d;y++){var b=p.data[y];if(!(d>1&&!b.canIntersects(e))){var M=b.intersects(e,this._positions,this.getIndices(),i,n);if(M&&(i||!c||M.distance<c.distance)&&(c=M,c.subMeshId=y,i))break}}if(c){var R=s!=null?s:this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix(),D=C.Vector3[0],I=C.Vector3[1];g.TransformCoordinatesToRef(e.origin,R,D),e.direction.scaleToRef(c.distance,I);var A=g.TransformNormal(I,R),x=A.addInPlace(D);return h.hit=!0,h.distance=g.Distance(D,x),h.pickedPoint=x,h.pickedMesh=this,h.bu=c.bu||0,h.bv=c.bv||0,h.subMeshFaceId=c.faceId,h.faceId=c.faceId+p.data[c.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),h.subMeshId=c.subMeshId,h}return h},t.prototype.clone=function(e,i,n){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(e,i){var n=this;i===void 0&&(i=!1);var o;for(this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),o=0;o<this._intersectionsInProgress.length;o++){var s=this._intersectionsInProgress[o],a=s._intersectionsInProgress.indexOf(this);s._intersectionsInProgress.splice(a,1)}this._intersectionsInProgress=[];var u=this.getScene().lights;u.forEach(function(f){var l=f.includedOnlyMeshes.indexOf(n);l!==-1&&f.includedOnlyMeshes.splice(l,1),l=f.excludedMeshes.indexOf(n),l!==-1&&f.excludedMeshes.splice(l,1);var c=f.getShadowGenerator();if(c){var p=c.getShadowMap();p&&p.renderList&&(l=p.renderList.indexOf(n),l!==-1&&p.renderList.splice(l,1))}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();var h=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,h.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),h.wipeCaches(),this.getScene().removeMesh(this),i&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(o=0;o<this.getScene().particleSystems.length;o++)this.getScene().particleSystems[o].emitter===this&&(this.getScene().particleSystems[o].dispose(),o--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),r.prototype.dispose.call(this,e,i)},t.prototype.addChild=function(e){return e.setParent(this),this},t.prototype.removeChild=function(e){return e.setParent(null),this},t.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var i=0;i<e.facetNb;i++)e.facetNormals[i]=g.Zero(),e.facetPositions[i]=g.Zero();return e.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var i=this.getVerticesData(_.PositionKind),n=this.getIndices(),o=this.getVerticesData(_.NormalKind),s=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var a=!1,u=0;u<n.length;u++)if(n[u]>65535){a=!0;break}a?e.depthSortedIndices=new Uint32Array(n):e.depthSortedIndices=new Uint16Array(n)}if(e.facetDepthSortFunction=function(v,y){return y.sqDistance-v.sqDistance},!e.facetDepthSortFrom){var h=this.getScene().activeCamera;e.facetDepthSortFrom=h?h.position:g.Zero()}e.depthSortedFacets=[];for(var f=0;f<e.facetNb;f++){var l={ind:f*3,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=O.Identity(),e.facetDepthSortOrigin=g.Zero()}e.bbSize.x=s.maximum.x-s.minimum.x>X?s.maximum.x-s.minimum.x:X,e.bbSize.y=s.maximum.y-s.minimum.y>X?s.maximum.y-s.minimum.y:X,e.bbSize.z=s.maximum.z-s.minimum.z>X?s.maximum.z-s.minimum.z:X;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=s,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),g.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,tt.ComputeNormals(i,n,o,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);for(var p=e.depthSortedIndices.length/3|0,f=0;f<p;f++){var d=e.depthSortedFacets[f].ind;e.depthSortedIndices[f*3]=n[d],e.depthSortedIndices[f*3+1]=n[d+1],e.depthSortedIndices[f*3+2]=n[d+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},t.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},t.prototype.getFacetPosition=function(e){var i=g.Zero();return this.getFacetPositionToRef(e,i),i},t.prototype.getFacetPositionToRef=function(e,i){var n=this.getFacetLocalPositions()[e],o=this.getWorldMatrix();return g.TransformCoordinatesToRef(n,o,i),this},t.prototype.getFacetNormal=function(e){var i=g.Zero();return this.getFacetNormalToRef(e,i),i},t.prototype.getFacetNormalToRef=function(e,i){var n=this.getFacetLocalNormals()[e];return g.TransformNormalToRef(n,this.getWorldMatrix(),i),this},t.prototype.getFacetsAtLocalCoordinates=function(e,i,n){var o=this.getBoundingInfo(),s=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((e-o.minimum.x*s.partitioningBBoxRatio)*s.subDiv.X*s.partitioningBBoxRatio/s.bbSize.x),u=Math.floor((i-o.minimum.y*s.partitioningBBoxRatio)*s.subDiv.Y*s.partitioningBBoxRatio/s.bbSize.y),h=Math.floor((n-o.minimum.z*s.partitioningBBoxRatio)*s.subDiv.Z*s.partitioningBBoxRatio/s.bbSize.z);return a<0||a>s.subDiv.max||u<0||u>s.subDiv.max||h<0||h>s.subDiv.max?null:s.facetPartitioning[a+s.subDiv.max*u+s.subDiv.max*s.subDiv.max*h]},t.prototype.getClosestFacetAtCoordinates=function(e,i,n,o,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0);var u=this.getWorldMatrix(),h=C.Matrix[5];u.invertToRef(h);var f=C.Vector3[8];g.TransformCoordinatesFromFloatsToRef(e,i,n,h,f);var l=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,o,s,a);return o&&g.TransformCoordinatesFromFloatsToRef(o.x,o.y,o.z,u,o),l},t.prototype.getClosestFacetAtLocalCoordinates=function(e,i,n,o,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0);var u=null,h=0,f=0,l=0,c=0,p=0,d=0,v=0,y=0,b=this.getFacetLocalPositions(),m=this.getFacetLocalNormals(),M=this.getFacetsAtLocalCoordinates(e,i,n);if(!M)return null;for(var R=Number.MAX_VALUE,D=R,I,A,x,W=0;W<M.length;W++)I=M[W],A=m[I],x=b[I],c=(e-x.x)*A.x+(i-x.y)*A.y+(n-x.z)*A.z,(!s||s&&a&&c>=0||s&&!a&&c<=0)&&(c=A.x*x.x+A.y*x.y+A.z*x.z,p=-(A.x*e+A.y*i+A.z*n-c)/(A.x*A.x+A.y*A.y+A.z*A.z),d=e+A.x*p,v=i+A.y*p,y=n+A.z*p,h=d-e,f=v-i,l=y-n,D=h*h+f*f+l*l,D<R&&(R=D,u=I,o&&(o.x=d,o.y=v,o.z=y)));return u},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(e,i,n){return this},t.prototype.createNormals=function(e){var i=this.getVerticesData(_.PositionKind),n=this.getIndices(),o;return this.isVerticesDataPresent(_.NormalKind)?o=this.getVerticesData(_.NormalKind):o=[],tt.ComputeNormals(i,n,o,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(_.NormalKind,o,e),this},t.prototype.alignWithNormal=function(e,i){i||(i=ye.Y);var n=C.Vector3[0],o=C.Vector3[1];return g.CrossToRef(i,e,o),g.CrossToRef(e,o,n),this.rotationQuaternion?N.RotationQuaternionFromAxisToRef(n,e,o,this.rotationQuaternion):g.RotationFromAxisToRef(n,e,o,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw S.WarnImport("EdgesRenderer")},t.prototype.enableEdgesRendering=function(e,i,n){throw S.WarnImport("EdgesRenderer")},t.prototype.getConnectedParticleSystems=function(){var e=this;return this._scene.particleSystems.filter(function(i){return i.emitter===e})},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=0,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,t}(dt);nt.RegisteredTypes["BABYLON.AbstractMesh"]=le;var Si=function(){function r(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}return r.prototype.toGlobal=function(t,e){return new r(this.x*t,this.y*e,this.width*t,this.height*e)},r.prototype.toGlobalToRef=function(t,e,i){return i.x=this.x*t,i.y=this.y*e,i.width=this.width*t,i.height=this.height*e,this},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r}(),qe=function(){function r(t,e,i,n){this.normal=new g(t,e,i),this.d=n}return r.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},r.prototype.clone=function(){return new r(this.normal.x,this.normal.y,this.normal.z,this.d)},r.prototype.getClassName=function(){return"Plane"},r.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=t*397^(this.d|0),t},r.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),e=0;return t!==0&&(e=1/t),this.normal.x*=e,this.normal.y*=e,this.normal.z*=e,this.d*=e,this},r.prototype.transform=function(t){var e=r._TmpMatrix;t.invertToRef(e);var i=e.m,n=this.normal.x,o=this.normal.y,s=this.normal.z,a=this.d,u=n*i[0]+o*i[1]+s*i[2]+a*i[3],h=n*i[4]+o*i[5]+s*i[6]+a*i[7],f=n*i[8]+o*i[9]+s*i[10]+a*i[11],l=n*i[12]+o*i[13]+s*i[14]+a*i[15];return new r(u,h,f,l)},r.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},r.prototype.copyFromPoints=function(t,e,i){var n=e.x-t.x,o=e.y-t.y,s=e.z-t.z,a=i.x-t.x,u=i.y-t.y,h=i.z-t.z,f=o*h-s*u,l=s*a-n*h,c=n*u-o*a,p=Math.sqrt(f*f+l*l+c*c),d;return p!==0?d=1/p:d=0,this.normal.x=f*d,this.normal.y=l*d,this.normal.z=c*d,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},r.prototype.isFrontFacingTo=function(t,e){var i=g.Dot(this.normal,t);return i<=e},r.prototype.signedDistanceTo=function(t){return g.Dot(t,this.normal)+this.d},r.FromArray=function(t){return new r(t[0],t[1],t[2],t[3])},r.FromPoints=function(t,e,i){var n=new r(0,0,0,0);return n.copyFromPoints(t,e,i),n},r.FromPositionAndNormal=function(t,e){var i=new r(0,0,0,0);return e.normalize(),i.normal=e,i.d=-(e.x*t.x+e.y*t.y+e.z*t.z),i},r.SignedDistanceToPlaneFromPositionAndNormal=function(t,e,i){var n=-(e.x*t.x+e.y*t.y+e.z*t.z);return g.Dot(i,e)+n},r._TmpMatrix=O.Identity(),r}(),ce=function(){function r(){}return r.GetPlanes=function(t){for(var e=[],i=0;i<6;i++)e.push(new qe(0,0,0,0));return r.GetPlanesToRef(t,e),e},r.GetNearPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]+i[2],e.normal.y=i[7]+i[6],e.normal.z=i[11]+i[10],e.d=i[15]+i[14],e.normalize()},r.GetFarPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]-i[2],e.normal.y=i[7]-i[6],e.normal.z=i[11]-i[10],e.d=i[15]-i[14],e.normalize()},r.GetLeftPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]+i[0],e.normal.y=i[7]+i[4],e.normal.z=i[11]+i[8],e.d=i[15]+i[12],e.normalize()},r.GetRightPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]-i[0],e.normal.y=i[7]-i[4],e.normal.z=i[11]-i[8],e.d=i[15]-i[12],e.normalize()},r.GetTopPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]-i[1],e.normal.y=i[7]-i[5],e.normal.z=i[11]-i[9],e.d=i[15]-i[13],e.normalize()},r.GetBottomPlaneToRef=function(t,e){var i=t.m;e.normal.x=i[3]+i[1],e.normal.y=i[7]+i[5],e.normal.z=i[11]+i[9],e.d=i[15]+i[13],e.normalize()},r.GetPlanesToRef=function(t,e){r.GetNearPlaneToRef(t,e[0]),r.GetFarPlaneToRef(t,e[1]),r.GetLeftPlaneToRef(t,e[2]),r.GetRightPlaneToRef(t,e[3]),r.GetTopPlaneToRef(t,e[4]),r.GetBottomPlaneToRef(t,e[5])},r}(),V=function(r){U(t,r);function t(e,i,n,o){o===void 0&&(o=!0);var s=r.call(this,e,n)||this;return s._position=g.Zero(),s._upVector=g.Up(),s.orthoLeft=null,s.orthoRight=null,s.orthoBottom=null,s.orthoTop=null,s.fov=.8,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s.mode=t.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new Si(0,0,1,1),s.layerMask=268435455,s.fovMode=t.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=t.RIG_MODE_NONE,s.customRenderTargets=new Array,s.outputRenderTarget=null,s.onViewMatrixChangedObservable=new E,s.onProjectionMatrixChangedObservable=new E,s.onAfterCheckInputsObservable=new E,s.onRestoreStateObservable=new E,s.isRigCamera=!1,s._rigCameras=new Array,s._webvrViewMatrix=O.Identity(),s._skipRendering=!1,s._projectionMatrix=new O,s._postProcesses=new Array,s._activeMeshes=new _t(256),s._globalPosition=g.Zero(),s._computedViewMatrix=O.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=O.Zero(),s._refreshFrustumPlanes=!0,s._isCamera=!0,s._isLeftCamera=!1,s._isRightCamera=!1,s.getScene().addCamera(s),o&&!s.getScene().activeCamera&&(s.getScene().activeCamera=s),s.position=i,s}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upVector=e},enumerable:!1,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},t.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var i="Name: "+this.name;if(i+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(e);return i},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},t.prototype.isReady=function(e){if(e===void 0&&(e=!1),e)for(var i=0,n=this._postProcesses;i<n.length;i++){var o=n[i];if(o&&!o.isReady())return!1}return r.prototype.isReady.call(this,e)},t.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.position=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(e){e||r.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},t.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var i=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this):e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),e},t.prototype.attachControl=function(e,i){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(this._postProcesses[e]!==null)return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var i=0,n=this._rigCameras.length;i<n;i++){var o=this._rigCameras[i],s=o._rigPostProcess;if(s){var a=s.getEffectName()==="pass";a&&(o.isIntermediate=this._postProcesses.length===0),o._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()}else o._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,i){return i===void 0&&(i=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(z.Error("You're trying to reuse a post process not defined as reusable."),0):(i==null||i<0?this._postProcesses.push(e):this._postProcesses[i]===null?this._postProcesses[i]=e:this._postProcesses.splice(i,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var i=this._postProcesses.indexOf(e);i!==-1&&(this._postProcesses[i]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},t.prototype._getViewMatrix=function(){return O.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,e!==void 0&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){var i,n,o,s,a,u,h,f;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var l=this.getEngine(),c=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=l.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var p=l.useReverseDepthBuffer,d=void 0;c.useRightHandedSystem?d=p?O.PerspectiveFovReverseRHToRef:O.PerspectiveFovRHToRef:d=p?O.PerspectiveFovReverseLHToRef:O.PerspectiveFovLHToRef,d(this.fov,l.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED)}else{var v=l.getRenderWidth()/2,y=l.getRenderHeight()/2;c.useRightHandedSystem?O.OrthoOffCenterRHToRef((i=this.orthoLeft)!==null&&i!==void 0?i:-v,(n=this.orthoRight)!==null&&n!==void 0?n:v,(o=this.orthoBottom)!==null&&o!==void 0?o:-y,(s=this.orthoTop)!==null&&s!==void 0?s:y,this.minZ,this.maxZ,this._projectionMatrix):O.OrthoOffCenterLHToRef((a=this.orthoLeft)!==null&&a!==void 0?a:-v,(u=this.orthoRight)!==null&&u!==void 0?u:v,(h=this.orthoBottom)!==null&&h!==void 0?h:-y,(f=this.orthoTop)!==null&&f!==void 0?f:y,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=l.getRenderWidth(),this._cache.renderHeight=l.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){!this._refreshFrustumPlanes||(this.getTransformationMatrix(),this._frustumPlanes?ce.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ce.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,i){if(i===void 0&&(i=!1),this._updateFrustumPlanes(),i&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(o){o._updateFrustumPlanes(),n=n||e.isInFrustum(o._frustumPlanes)}),n}else return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,i,n){throw S.WarnImport("Ray")},t.prototype.getForwardRayToRef=function(e,i,n,o){throw S.WarnImport("Ray")},t.prototype.dispose=function(e,i){for(i===void 0&&(i=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var s=this._postProcesses.length;--s>=0;){var o=this._postProcesses[s];o&&o.dispose(this)}for(var s=this.customRenderTargets.length;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),r.prototype.dispose.call(this,e,i)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,i){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=K.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var o=this.createRigCamera(this.name+"_L",0);o&&(o._isLeftCamera=!0);var s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),o&&s&&(this._rigCameras.push(o),this._rigCameras.push(s))}switch(this.cameraRigMode){case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:t._setStereoscopicAnaglyphRigMode(this);break;case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.RIG_MODE_STEREOSCOPIC_INTERLACED:t._setStereoscopicRigMode(this);break;case t.RIG_MODE_VR:t._setVRRigMode(this,i);break;case t.RIG_MODE_WEBVR:t._setWebVRRigMode(this,i);break}this._cascadePostProcessesToRigCams(),this.update()}},t._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},t._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},t._setVRRigMode=function(e,i){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},t._setWebVRRigMode=function(e,i){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},t.prototype._getVRProjectionMatrix=function(){return O.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return O.Identity()},t.prototype._getWebVRViewMatrix=function(){return O.Identity()},t.prototype.setCameraRigParameter=function(e,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=i,e==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=K.ToRadians(i/.0637))},t.prototype.createRigCamera=function(e,i){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=j.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),j.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.prototype.clone=function(e){return j.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},t.prototype.getDirection=function(e){var i=g.Zero();return this.getDirectionToRef(e,i),i},Object.defineProperty(t.prototype,"absoluteRotation",{get:function(){var e=N.Zero();return this.getWorldMatrix().decompose(void 0,e),e},enumerable:!1,configurable:!0}),t.prototype.getDirectionToRef=function(e,i){g.TransformNormalToRef(e,this.getWorldMatrix(),i)},t.GetConstructorFromName=function(e,i,n,o,s){o===void 0&&(o=0),s===void 0&&(s=!0);var a=vt.Construct(e,i,n,{interaxial_distance:o,isStereoscopicSideBySide:s});return a||function(){return t._createDefaultParsedCamera(i,n)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,i){var n=e.type,o=t.GetConstructorFromName(n,e.name,i,e.interaxial_distance,e.isStereoscopicSideBySide),s=j.Parse(o,e,i);if(e.parentId&&(s._waitingParentId=e.parentId),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=g.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(g.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(g.FromArray(e.target)),e.cameraRigMode){var a=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,a)}if(e.animations){for(var u=0;u<e.animations.length;u++){var h=e.animations[u],f=nt.GetClass("BABYLON.Animation");f&&s.animations.push(f.Parse(h))}vt.ParseAnimationRanges(s,e,i)}return e.autoAnimate&&i.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),s},t._createDefaultParsedCamera=function(e,i){throw S.WarnImport("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,P([wt("position")],t.prototype,"_position",void 0),P([wt("upVector")],t.prototype,"_upVector",void 0),P([T()],t.prototype,"orthoLeft",void 0),P([T()],t.prototype,"orthoRight",void 0),P([T()],t.prototype,"orthoBottom",void 0),P([T()],t.prototype,"orthoTop",void 0),P([T()],t.prototype,"fov",void 0),P([T()],t.prototype,"minZ",void 0),P([T()],t.prototype,"maxZ",void 0),P([T()],t.prototype,"inertia",void 0),P([T()],t.prototype,"mode",void 0),P([T()],t.prototype,"layerMask",void 0),P([T()],t.prototype,"fovMode",void 0),P([T()],t.prototype,"cameraRigMode",void 0),P([T()],t.prototype,"interaxialDistance",void 0),P([T()],t.prototype,"isStereoscopicSideBySide",void 0),t}(vt),xi=function(){function r(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return r.AddParser=function(t,e){this._BabylonFileParsers[t]=e},r.GetParser=function(t){return this._BabylonFileParsers[t]?this._BabylonFileParsers[t]:null},r.AddIndividualParser=function(t,e){this._IndividualBabylonFileParsers[t]=e},r.GetIndividualParser=function(t){return this._IndividualBabylonFileParsers[t]?this._IndividualBabylonFileParsers[t]:null},r.Parse=function(t,e,i,n){for(var o in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(o)&&this._BabylonFileParsers[o](t,e,i,n)},Object.defineProperty(r.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture=t},enumerable:!1,configurable:!0}),r.prototype.getNodes=function(){var t=new Array;return t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes),this.skeletons.forEach(function(e){return t=t.concat(e.bones)}),t},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}(),wi=function(){function r(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),r.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},r.prototype.markAsUnprocessed=function(){this._isDirty=!0},r.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsLightDirty=function(t){t===void 0&&(t=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0},r.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},r.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},r.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},r.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},r.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},r.prototype.rebuild=function(){this._keys=[];for(var t=0,e=Object.keys(this);t<e.length;t++){var i=e[t];i[0]!=="_"&&this._keys.push(i)}},r.prototype.isEqual=function(t){if(this._keys.length!==t._keys.length)return!1;for(var e=0;e<this._keys.length;e++){var i=this._keys[e];if(this[i]!==t[i])return!1}return!0},r.prototype.cloneTo=function(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(var e=0;e<this._keys.length;e++){var i=this._keys[e];t[i]=this[i]}},r.prototype.reset=function(){for(var t=0;t<this._keys.length;t++){var e=this._keys[t],i=typeof this[e];switch(i){case"number":this[e]=0;break;case"string":this[e]="";break;default:this[e]=!1;break}}},r.prototype.toString=function(){for(var t="",e=0;e<this._keys.length;e++){var i=this._keys[e],n=this[i],o=typeof n;switch(o){case"number":case"string":t+="#define "+i+" "+n+`
`;break;default:n&&(t+="#define "+i+`
`);break}}return t},r}(),ue=function(){function r(){this._dirty=!0,this._tempColor=new J(0,0,0,0),this._globalCurve=new J(0,0,0,0),this._highlightsCurve=new J(0,0,0,0),this._midtonesCurve=new J(0,0,0,0),this._shadowsCurve=new J(0,0,0,0),this._positiveCurve=new J(0,0,0,0),this._negativeCurve=new J(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(r.prototype,"globalHue",{get:function(){return this._globalHue},set:function(t){this._globalHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(t){this._globalSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(t){this._globalExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(t){this._highlightsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(t){this._highlightsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(t){this._highlightsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(t){this._highlightsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(t){this._midtonesHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(t){this._midtonesDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(t){this._midtonesSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(t){this._midtonesExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(t){this._shadowsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(t){this._shadowsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(t){this._shadowsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(t){this._shadowsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ColorCurves"},r.Bind=function(t,e,i,n,o){i===void 0&&(i="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),o===void 0&&(o="vCameraColorCurveNegative"),t._dirty&&(t._dirty=!1,t.getColorGradingDataToRef(t._globalHue,t._globalDensity,t._globalSaturation,t._globalExposure,t._globalCurve),t.getColorGradingDataToRef(t._highlightsHue,t._highlightsDensity,t._highlightsSaturation,t._highlightsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._highlightsCurve),t.getColorGradingDataToRef(t._midtonesHue,t._midtonesDensity,t._midtonesSaturation,t._midtonesExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._midtonesCurve),t.getColorGradingDataToRef(t._shadowsHue,t._shadowsDensity,t._shadowsSaturation,t._shadowsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._shadowsCurve),t._highlightsCurve.subtractToRef(t._midtonesCurve,t._positiveCurve),t._midtonesCurve.subtractToRef(t._shadowsCurve,t._negativeCurve)),e&&(e.setFloat4(i,t._positiveCurve.r,t._positiveCurve.g,t._positiveCurve.b,t._positiveCurve.a),e.setFloat4(n,t._midtonesCurve.r,t._midtonesCurve.g,t._midtonesCurve.b,t._midtonesCurve.a),e.setFloat4(o,t._negativeCurve.r,t._negativeCurve.g,t._negativeCurve.b,t._negativeCurve.a))},r.PrepareUniforms=function(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},r.prototype.getColorGradingDataToRef=function(t,e,i,n,o){t!=null&&(t=r.clamp(t,0,360),e=r.clamp(e,-100,100),i=r.clamp(i,-100,100),n=r.clamp(n,-100,100),e=r.applyColorGradingSliderNonlinear(e),e*=.5,n=r.applyColorGradingSliderNonlinear(n),e<0&&(e*=-1,t=(t+180)%360),r.fromHSBToRef(t,e,50+.25*n,o),o.scaleToRef(2,o),o.a=1+.01*i)},r.applyColorGradingSliderNonlinear=function(t){t/=100;var e=Math.abs(t);return e=Math.pow(e,2),t<0&&(e*=-1),e*=100,e},r.fromHSBToRef=function(t,e,i,n){var o=r.clamp(t,0,360),s=r.clamp(e/100,0,1),a=r.clamp(i/100,0,1);if(s===0)n.r=a,n.g=a,n.b=a;else{o/=60;var u=Math.floor(o),h=o-u,f=a*(1-s),l=a*(1-s*h),c=a*(1-s*(1-h));switch(u){case 0:n.r=a,n.g=c,n.b=f;break;case 1:n.r=l,n.g=a,n.b=f;break;case 2:n.r=f,n.g=a,n.b=c;break;case 3:n.r=f,n.g=l,n.b=a;break;case 4:n.r=c,n.g=f,n.b=a;break;default:n.r=a,n.g=f,n.b=l;break}}n.a=1},r.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},r.prototype.clone=function(){return j.Clone(function(){return new r},this)},r.prototype.serialize=function(){return j.Serialize(this)},r.Parse=function(t){return j.Parse(function(){return new r},t,null,null)},P([T()],r.prototype,"_globalHue",void 0),P([T()],r.prototype,"_globalDensity",void 0),P([T()],r.prototype,"_globalSaturation",void 0),P([T()],r.prototype,"_globalExposure",void 0),P([T()],r.prototype,"_highlightsHue",void 0),P([T()],r.prototype,"_highlightsDensity",void 0),P([T()],r.prototype,"_highlightsSaturation",void 0),P([T()],r.prototype,"_highlightsExposure",void 0),P([T()],r.prototype,"_midtonesHue",void 0),P([T()],r.prototype,"_midtonesDensity",void 0),P([T()],r.prototype,"_midtonesSaturation",void 0),P([T()],r.prototype,"_midtonesExposure",void 0),r}();j._ColorCurvesParser=ue.Parse;(function(r){U(t,r);function t(){var e=r.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}return t})(wi);var Me=function(){function r(){this.colorCurves=new ue,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=r.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new J(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=r.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new E}return Object.defineProperty(r.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(t){this._colorCurvesEnabled!==t&&(this._colorCurvesEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(t){this._colorGradingTexture!==t&&(this._colorGradingTexture=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(t){this._colorGradingEnabled!==t&&(this._colorGradingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(t){this._colorGradingWithGreenDepth!==t&&(this._colorGradingWithGreenDepth=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(t){this._colorGradingBGR!==t&&(this._colorGradingBGR=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"exposure",{get:function(){return this._exposure},set:function(t){this._exposure!==t&&(this._exposure=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(t){this._toneMappingEnabled!==t&&(this._toneMappingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(t){this._toneMappingType!==t&&(this._toneMappingType=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"contrast",{get:function(){return this._contrast},set:function(t){this._contrast!==t&&(this._contrast=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(t){this._vignetteBlendMode!==t&&(this._vignetteBlendMode=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(t){this._vignetteEnabled!==t&&(this._vignetteEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(t){this._applyByPostProcess!==t&&(this._applyByPostProcess=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),r.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},r.prototype.getClassName=function(){return"ImageProcessingConfiguration"},r.PrepareUniforms=function(t,e){e.EXPOSURE&&t.push("exposureLinear"),e.CONTRAST&&t.push("contrast"),e.COLORGRADING&&t.push("colorTransformSettings"),e.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),e.COLORCURVES&&ue.PrepareUniforms(t)},r.PrepareSamplers=function(t,e){e.COLORGRADING&&t.push("txColorTransform")},r.prototype.prepareDefines=function(t,e){if(e===void 0&&(e=!1),e!==this.applyByPostProcess||!this._isEnabled){t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===r._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case r.TONEMAPPING_ACES:t.TONEMAPPING_ACES=!0;break;default:t.TONEMAPPING_ACES=!1;break}t.CONTRAST=this.contrast!==1,t.EXPOSURE=this.exposure!==1,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},r.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},r.prototype.bind=function(t,e){if(this._colorCurvesEnabled&&this.colorCurves&&ue.Bind(this.colorCurves,t),this._vignetteEnabled){var i=1/t.getEngine().getRenderWidth(),n=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",i,n);var o=e!=null?e:n/i,s=Math.tan(this.vignetteCameraFov*.5),a=s*o,u=Math.sqrt(a*s);a=K.Mix(a,u,this.vignetteStretch),s=K.Mix(s,u,this.vignetteStretch),t.setFloat4("vignetteSettings1",a,s,-a*this.vignetteCentreX,-s*this.vignetteCentreY);var h=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},r.prototype.clone=function(){return j.Clone(function(){return new r},this)},r.prototype.serialize=function(){return j.Serialize(this)},r.Parse=function(t){return j.Parse(function(){return new r},t,null,null)},Object.defineProperty(r,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(r,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),r.TONEMAPPING_STANDARD=0,r.TONEMAPPING_ACES=1,r._VIGNETTEMODE_MULTIPLY=0,r._VIGNETTEMODE_OPAQUE=1,P([Ti()],r.prototype,"colorCurves",void 0),P([T()],r.prototype,"_colorCurvesEnabled",void 0),P([Ai("colorGradingTexture")],r.prototype,"_colorGradingTexture",void 0),P([T()],r.prototype,"_colorGradingEnabled",void 0),P([T()],r.prototype,"_colorGradingWithGreenDepth",void 0),P([T()],r.prototype,"_colorGradingBGR",void 0),P([T()],r.prototype,"_exposure",void 0),P([T()],r.prototype,"_toneMappingEnabled",void 0),P([T()],r.prototype,"_toneMappingType",void 0),P([T()],r.prototype,"_contrast",void 0),P([T()],r.prototype,"vignetteStretch",void 0),P([T()],r.prototype,"vignetteCentreX",void 0),P([T()],r.prototype,"vignetteCentreY",void 0),P([T()],r.prototype,"vignetteWeight",void 0),P([Ri()],r.prototype,"vignetteColor",void 0),P([T()],r.prototype,"vignetteCameraFov",void 0),P([T()],r.prototype,"_vignetteBlendMode",void 0),P([T()],r.prototype,"_vignetteEnabled",void 0),P([T()],r.prototype,"_applyByPostProcess",void 0),P([T()],r.prototype,"_isEnabled",void 0),r}();j._ImageProcessingConfigurationParser=Me.Parse;Ft.prototype.createUniformBuffer=function(r){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var e=new Ge(t);return this.bindUniformBuffer(e),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),e.references=1,e};Ft.prototype.createDynamicUniformBuffer=function(r){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var e=new Ge(t);return this.bindUniformBuffer(e),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),e.references=1,e};Ft.prototype.updateUniformBuffer=function(r,t,e,i){this.bindUniformBuffer(r),e===void 0&&(e=0),i===void 0?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(e,e+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(e,e+i)),this.bindUniformBuffer(null)};Ft.prototype.bindUniformBuffer=function(r){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,r?r.underlyingResource:null)};Ft.prototype.bindUniformBufferBase=function(r,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,r?r.underlyingResource:null)};Ft.prototype.bindUniformBlock=function(r,t,e){var i=r.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,e)};var Ie=function(){function r(t,e,i){this._alreadyBound=!1,this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers,this._dynamic=i,this._data=e||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(r.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),r.prototype.isDynamic=function(){return this._dynamic!==void 0},r.prototype.getData=function(){return this._bufferData},r.prototype.getBuffer=function(){return this._buffer},r.prototype._fillAlignment=function(t){var e;if(t<=2?e=t:e=4,this._uniformLocationPointer%e!==0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=e-this._uniformLocationPointer%e;for(var n=this._uniformLocationPointer-i,o=0;o<n;o++)this._data.push(0)}},r.prototype.addUniform=function(t,e){if(!this._noUBO&&this._uniformLocations[t]===void 0){var i;if(e instanceof Array)i=e,e=i.length;else{e=e,i=[];for(var n=0;n<e;n++)i.push(0)}this._fillAlignment(e),this._uniformSizes[t]=e,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=e;for(var n=0;n<e;n++)this._data.push(i[n]);this._needSync=!0}},r.prototype.addMatrix=function(t,e){this.addUniform(t,Array.prototype.slice.call(e.toArray()))},r.prototype.addFloat2=function(t,e,i){var n=[e,i];this.addUniform(t,n)},r.prototype.addFloat3=function(t,e,i,n){var o=[e,i,n];this.addUniform(t,o)},r.prototype.addColor3=function(t,e){var i=new Array;e.toArray(i),this.addUniform(t,i)},r.prototype.addColor4=function(t,e,i){var n=new Array;e.toArray(n),n.push(i),this.addUniform(t,n)},r.prototype.addVector3=function(t,e){var i=new Array;e.toArray(i),this.addUniform(t,i)},r.prototype.addMatrix3x3=function(t){this.addUniform(t,12)},r.prototype.addMatrix2x2=function(t){this.addUniform(t,8)},r.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},r.prototype._rebuild=function(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},r.prototype.update=function(){if(!this._buffer){this.create();return}!this._dynamic&&!this._needSync||(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1)},r.prototype.updateUniform=function(t,e,i){var n=this._uniformLocations[t];if(n===void 0){if(this._buffer){z.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(t,i),n=this._uniformLocations[t]}if(this._buffer||this.create(),this._dynamic)for(var s=0;s<i;s++)this._bufferData[n+s]=e[s];else{for(var o=!1,s=0;s<i;s++)(i===16||this._bufferData[n+s]!==e[s])&&(o=!0,this._bufferData[n+s]=e[s]);this._needSync=this._needSync||o}},r.prototype._cacheMatrix=function(t,e){var i=this._valueCache[t],n=e.updateFlag;return i!==void 0&&i===n?!1:(this._valueCache[t]=n,!0)},r.prototype._updateMatrix3x3ForUniform=function(t,e){for(var i=0;i<3;i++)r._tempBuffer[i*4]=e[i*3],r._tempBuffer[i*4+1]=e[i*3+1],r._tempBuffer[i*4+2]=e[i*3+2],r._tempBuffer[i*4+3]=0;this.updateUniform(t,r._tempBuffer,12)},r.prototype._updateMatrix3x3ForEffect=function(t,e){this._currentEffect.setMatrix3x3(t,e)},r.prototype._updateMatrix2x2ForEffect=function(t,e){this._currentEffect.setMatrix2x2(t,e)},r.prototype._updateMatrix2x2ForUniform=function(t,e){for(var i=0;i<2;i++)r._tempBuffer[i*4]=e[i*2],r._tempBuffer[i*4+1]=e[i*2+1],r._tempBuffer[i*4+2]=0,r._tempBuffer[i*4+3]=0;this.updateUniform(t,r._tempBuffer,8)},r.prototype._updateFloatForEffect=function(t,e){this._currentEffect.setFloat(t,e)},r.prototype._updateFloatForUniform=function(t,e){r._tempBuffer[0]=e,this.updateUniform(t,r._tempBuffer,1)},r.prototype._updateFloat2ForEffect=function(t,e,i,n){n===void 0&&(n=""),this._currentEffect.setFloat2(t+n,e,i)},r.prototype._updateFloat2ForUniform=function(t,e,i){r._tempBuffer[0]=e,r._tempBuffer[1]=i,this.updateUniform(t,r._tempBuffer,2)},r.prototype._updateFloat3ForEffect=function(t,e,i,n,o){o===void 0&&(o=""),this._currentEffect.setFloat3(t+o,e,i,n)},r.prototype._updateFloat3ForUniform=function(t,e,i,n){r._tempBuffer[0]=e,r._tempBuffer[1]=i,r._tempBuffer[2]=n,this.updateUniform(t,r._tempBuffer,3)},r.prototype._updateFloat4ForEffect=function(t,e,i,n,o,s){s===void 0&&(s=""),this._currentEffect.setFloat4(t+s,e,i,n,o)},r.prototype._updateFloat4ForUniform=function(t,e,i,n,o){r._tempBuffer[0]=e,r._tempBuffer[1]=i,r._tempBuffer[2]=n,r._tempBuffer[3]=o,this.updateUniform(t,r._tempBuffer,4)},r.prototype._updateMatrixForEffect=function(t,e){this._currentEffect.setMatrix(t,e)},r.prototype._updateMatrixForUniform=function(t,e){this._cacheMatrix(t,e)&&this.updateUniform(t,e.toArray(),16)},r.prototype._updateVector3ForEffect=function(t,e){this._currentEffect.setVector3(t,e)},r.prototype._updateVector3ForUniform=function(t,e){e.toArray(r._tempBuffer),this.updateUniform(t,r._tempBuffer,3)},r.prototype._updateVector4ForEffect=function(t,e){this._currentEffect.setVector4(t,e)},r.prototype._updateVector4ForUniform=function(t,e){e.toArray(r._tempBuffer),this.updateUniform(t,r._tempBuffer,4)},r.prototype._updateColor3ForEffect=function(t,e,i){i===void 0&&(i=""),this._currentEffect.setColor3(t+i,e)},r.prototype._updateColor3ForUniform=function(t,e){e.toArray(r._tempBuffer),this.updateUniform(t,r._tempBuffer,3)},r.prototype._updateColor4ForEffect=function(t,e,i,n){n===void 0&&(n=""),this._currentEffect.setColor4(t+n,e,i)},r.prototype._updateColor4ForUniform=function(t,e,i){e.toArray(r._tempBuffer),r._tempBuffer[3]=i,this.updateUniform(t,r._tempBuffer,4)},r.prototype.setTexture=function(t,e){this._currentEffect.setTexture(t,e)},r.prototype.updateUniformDirectly=function(t,e){this.updateUniform(t,e,e.length),this.update()},r.prototype.bindToEffect=function(t,e){this._currentEffect=t,!(this._noUBO||!this._buffer)&&(this._alreadyBound=!0,t.bindUniformBuffer(this._buffer,e))},r.prototype.dispose=function(){if(!this._noUBO){var t=this._engine._uniformBuffers,e=t.indexOf(this);e!==-1&&(t[e]=t[t.length-1],t.pop()),!!this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},r._MAX_UNIFORM_SIZE=256,r._tempBuffer=new Float32Array(r._MAX_UNIFORM_SIZE),r}(),Fi=function(r){U(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.diffuse=new pt(1,1,1),n.specular=new pt(1,1,1),n.falloffType=t.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=t.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new Ie(n.getScene().getEngine()),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),t.prototype.transferTexturesToEffect=function(e,i){return this},t.prototype._bindLight=function(e,i,n,o,s){s===void 0&&(s=!1);var a=e.toString(),u=!1;if(!(s&&this._uniformBuffer._alreadyBound)){if(this._uniformBuffer.bindToEffect(n,"Light"+a),this._renderId!==i.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=i.getRenderId();var h=this.getScaledIntensity();this.transferToEffect(n,a),this.diffuse.scaleToRef(h,oe.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",oe.Color3[0],this.range,a),o&&(this.specular.scaleToRef(h,oe.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",oe.Color3[1],this.radius,a)),u=!0}if(this.transferTexturesToEffect(n,a),i.shadowsEnabled&&this.shadowEnabled){var f=this.getShadowGenerator();f&&(f.bindShadowLight(a,n),u=!0)}u&&this._uniformBuffer.update()}},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var i="Name: "+this.name;if(i+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(e);return i},t.prototype._syncParentEnabledState=function(){r.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(e){r.prototype.setEnabled.call(this,e),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return g.Zero()},t.prototype.canAffectMesh=function(e){return e?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(e)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1||this.includeOnlyWithLayerMask!==0&&(this.includeOnlyWithLayerMask&e.layerMask)===0||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&e.layerMask):!0},t.CompareLightsPriority=function(e,i){return e.shadowEnabled!==i.shadowEnabled?(i.shadowEnabled?1:0)-(e.shadowEnabled?1:0):i.renderPriority-e.renderPriority},t.prototype.dispose=function(e,i){i===void 0&&(i=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var n=0,o=this.getScene().meshes;n<o.length;n++){var s=o[n];s._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),r.prototype.dispose.call(this,e,i)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e,i){i===void 0&&(i=null);var n=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!n)return null;var o=j.Clone(n,this);return i&&(o.parent=i),o.setEnabled(this.isEnabled()),o},t.prototype.serialize=function(){var e=j.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(i){e.excludedMeshesIds.push(i.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(i){e.includedOnlyMeshesIds.push(i.id)})),j.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,i,n){var o=vt.Construct("Light_Type_"+e,i,n);return o||null},t.Parse=function(e,i){var n=t.GetConstructorFromName(e.type,e.name,i);if(!n)return null;var o=j.Parse(n,e,i);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(o._waitingParentId=e.parentId),e.falloffType!==void 0&&(o.falloffType=e.falloffType),e.lightmapMode!==void 0&&(o.lightmapMode=e.lightmapMode),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s],u=nt.GetClass("BABYLON.Animation");u&&o.animations.push(u.Parse(a))}vt.ParseAnimationRanges(o,e,i)}return e.autoAnimate&&i.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},t.prototype._hookArrayForExcluded=function(e){var i=this,n=e.push;e.push=function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];for(var l=n.apply(e,h),c=0,p=h;c<p.length;c++){var d=p[c];d._resyncLightSource(i)}return l};var o=e.splice;e.splice=function(h,f){for(var l=o.apply(e,[h,f]),c=0,p=l;c<p.length;c++){var d=p[c];d._resyncLightSource(i)}return l};for(var s=0,a=e;s<a.length;s++){var u=a[s];u._resyncLightSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var i=this,n=e.push;e.push=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var u=n.apply(e,s);return i._resyncMeshes(),u};var o=e.splice;e.splice=function(s,a){var u=o.apply(e,[s,a]);return i._resyncMeshes(),u},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,i=this.getScene().meshes;e<i.length;e++){var n=i[e];n._resyncLightSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,i=this.getScene().meshes;e<i.length;e++){var n=i[e];n.lightSources.indexOf(this)!==-1&&n._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,i=this.getTypeID(),n=this.intensityMode;switch(n===t.INTENSITYMODE_AUTOMATIC&&(i===t.LIGHTTYPEID_DIRECTIONALLIGHT?n=t.INTENSITYMODE_ILLUMINANCE:n=t.INTENSITYMODE_LUMINOUSINTENSITY),i){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(n){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius;break}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var o=this.radius;o=Math.max(o,.001);var s=2*Math.PI*(1-Math.cos(o));e=s;break}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1;break}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();this._renderPriority!=0&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,P([xe()],t.prototype,"diffuse",void 0),P([xe()],t.prototype,"specular",void 0),P([T()],t.prototype,"falloffType",void 0),P([T()],t.prototype,"intensity",void 0),P([T()],t.prototype,"range",null),P([T()],t.prototype,"intensityMode",null),P([T()],t.prototype,"radius",null),P([T()],t.prototype,"_renderPriority",void 0),P([Mi("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),P([T("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),P([T("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),P([T("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),P([T("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(vt),rt=function(){function r(t,e,i,n,o,s){this.source=t,this.pointerX=e,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=o,this.additionalData=s}return r.CreateNew=function(t,e,i){var n=t.getScene();return new r(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,e,i)},r.CreateNewFromSprite=function(t,e,i,n){return new r(t,e.pointerX,e.pointerY,e.meshUnderPointer,i,n)},r.CreateNewFromScene=function(t,e){return new r(null,t.pointerX,t.pointerY,t.meshUnderPointer,e)},r.CreateNewFromPrimitive=function(t,e,i,n){return new r(t,e.x,e.y,null,i,n)},r}(),Le=function(){function r(t,e,i){this.bu=t,this.bv=e,this.distance=i,this.faceId=0,this.subMeshId=0}return r}(),xt=function(){function r(t,e,i,n,o,s,a,u,h){u===void 0&&(u=!0),h===void 0&&(h=!0),this.materialIndex=t,this.verticesStart=e,this.verticesCount=i,this.indexStart=n,this.indexCount=o,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=a||s,h&&s.subMeshes.push(this),this._trianglePlanes=[],this._id=s.subMeshes.length-1,u&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return Object.defineProperty(r.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(t){this._materialDefines=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"effect",{get:function(){var t;return(t=this._effectOverride)!==null&&t!==void 0?t:this._materialEffect},enumerable:!1,configurable:!0}),r.prototype.setEffect=function(t,e){if(e===void 0&&(e=null),this._materialEffect===t){t||(this._materialDefines=null);return}this._materialDefines=e,this._materialEffect=t},r.AddToMesh=function(t,e,i,n,o,s,a,u){return u===void 0&&(u=!0),new r(t,e,i,n,o,s,a,u)},Object.defineProperty(r.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),r.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},r.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},r.prototype.getMesh=function(){return this._mesh},r.prototype.getRenderingMesh=function(){return this._renderingMesh},r.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},r.prototype.getEffectiveMesh=function(){var t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh},r.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(t==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(t)){var e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this._materialDefines=null),e}return t},r.prototype._IsMultiMaterial=function(t){return t.getSubMaterial!==void 0},r.prototype.refreshBoundingInfo=function(t){if(t===void 0&&(t=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(t||(t=this._renderingMesh.getVerticesData(_.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var e=this._renderingMesh.getIndices(),i;if(this.indexStart===0&&this.indexCount===e.length){var n=this._renderingMesh.getBoundingInfo();i={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else i=Di(t,e,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Tt(i.minimum,i.maximum),this},r.prototype._checkCollision=function(t){var e=this.getBoundingInfo();return e._checkCollision(t)},r.prototype.updateBoundingInfo=function(t){var e=this.getBoundingInfo();return e||(this.refreshBoundingInfo(),e=this.getBoundingInfo()),e&&e.update(t),this},r.prototype.isInFrustum=function(t){var e=this.getBoundingInfo();return e?e.isInFrustum(t,this._mesh.cullingStrategy):!1},r.prototype.isCompletelyInFrustum=function(t){var e=this.getBoundingInfo();return e?e.isCompletelyInFrustum(t):!1},r.prototype.render=function(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},r.prototype._getLinesIndexBuffer=function(t,e){if(!this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)i.push(t[n],t[n+1],t[n+1],t[n+2],t[n+2],t[n]);this._linesIndexBuffer=e.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},r.prototype.canIntersects=function(t){var e=this.getBoundingInfo();return e?t.intersectsBox(e.boundingBox):!1},r.prototype.intersects=function(t,e,i,n,o){var s=this.getMaterial();if(!s)return null;var a=3,u=!1;switch(s.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:a=1,u=!0;break}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?i.length?this._intersectLines(t,e,i,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(t,e,i,this._mesh.intersectionThreshold,n):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,e,i,n,o):this._intersectTriangles(t,e,i,a,u,n,o)},r.prototype._intersectLines=function(t,e,i,n,o){for(var s=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){var u=e[i[a]],h=e[i[a+1]],f=t.intersectionSegment(u,h,n);if(!(f<0)&&(o||!s||f<s.distance)&&(s=new Le(null,null,f),s.faceId=a/2,o))break}return s},r.prototype._intersectUnIndexedLines=function(t,e,i,n,o){for(var s=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){var u=e[a],h=e[a+1],f=t.intersectionSegment(u,h,n);if(!(f<0)&&(o||!s||f<s.distance)&&(s=new Le(null,null,f),s.faceId=a/2,o))break}return s},r.prototype._intersectTriangles=function(t,e,i,n,o,s,a){for(var u=null,h=-1,f=this.indexStart;f<this.indexStart+this.indexCount;f+=n){h++;var l=i[f],c=i[f+1],p=i[f+2];if(o&&p===4294967295){f+=2;continue}var d=e[l],v=e[c],y=e[p];if(!(a&&!a(d,v,y,t))){var b=t.intersectsTriangle(d,v,y);if(b){if(b.distance<0)continue;if((s||!u||b.distance<u.distance)&&(u=b,u.faceId=h,s))break}}}return u},r.prototype._intersectUnIndexedTriangles=function(t,e,i,n,o){for(var s=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){var u=e[a],h=e[a+1],f=e[a+2];if(!(o&&!o(u,h,f,t))){var l=t.intersectsTriangle(u,h,f);if(l){if(l.distance<0)continue;if((n||!s||l.distance<s.distance)&&(s=l,s.faceId=a/3,n))break}}}return s},r.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},r.prototype.clone=function(t,e){var i=new r(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,e,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new Tt(n.minimum,n.maximum)}return i},r.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1)},r.prototype.getClassName=function(){return"SubMesh"},r.CreateFromIndices=function(t,e,i,n,o){for(var s=Number.MAX_VALUE,a=-Number.MAX_VALUE,u=o||n,h=u.getIndices(),f=e;f<e+i;f++){var l=h[f];l<s&&(s=l),l>a&&(a=l)}return new r(t,s,a-s+1,e,i,n,o)},r}(),lt=function(){function r(t,e,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new E,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var n=1;for(this._scene=e||gt.LastCreatedScene,this.id=t||K.RandomId();this._scene.getMaterialByID(this.id);)this.id=t+" "+n++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=r.ClockWiseSideOrientation:this.sideOrientation=r.CounterClockWiseSideOrientation,this._uniformBuffer=new Ie(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(r.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alpha=t,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new E),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBind",{set:function(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new E),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new E),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wireframe",{get:function(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?r.WireFrameFillMode:r.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?r.PointFillMode:r.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),r.prototype.toString=function(t){var e="Name: "+this.name;return e},r.prototype.getClassName=function(){return"Material"},Object.defineProperty(r.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),r.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},r.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},r.prototype.isReady=function(t,e){return!0},r.prototype.isReadyForSubMesh=function(t,e,i){return!1},r.prototype.getEffect=function(){return this._effect},r.prototype.getScene=function(){return this._scene},Object.defineProperty(r.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===r.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===r.MATERIAL_OPAQUE||this._transparencyMode===r.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),r.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1},r.prototype.needAlphaBlendingForMesh=function(t){return this._disableAlphaBlending&&t.visibility>=1?!1:this.needAlphaBlending()||t.visibility<1||t.hasVertexAlpha},r.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},r.prototype._shouldTurnAlphaTestOn=function(t){return!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.markDirty=function(){for(var t=this.getScene().meshes,e=0,i=t;e<i.length;e++){var n=i[e];if(!!n.subMeshes)for(var o=0,s=n.subMeshes;o<s.length;o++){var a=s[o];a.getMaterial()===this&&(!a.effect||(a.effect._wasPreviouslyReady=!1))}}},r.prototype._preBind=function(t,e){e===void 0&&(e=null);var i=this._scene.getEngine(),n=e==null?this.sideOrientation:e,o=n===r.ClockWiseSideOrientation;return i.enableEffect(t||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,o),o},r.prototype.bind=function(t,e){},r.prototype.bindForSubMesh=function(t,e,i){},r.prototype.bindOnlyWorldMatrix=function(t){},r.prototype.bindSceneUniformBuffer=function(t,e){e.bindToEffect(t,"Scene")},r.prototype.bindView=function(t){this._useUBO?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("view",this.getScene().getViewMatrix())},r.prototype.bindViewProjection=function(t){this._useUBO?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("viewProjection",this.getScene().getTransformMatrix())},r.prototype._afterBind=function(t){if(this._scene._cachedMaterial=this,t?this._scene._cachedVisibility=t.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){var e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){var e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(this.depthFunction!==0){var e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}},r.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0){var t=this._scene.getEngine();t.setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){var t=this._scene.getEngine();t.setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){var t=this._scene.getEngine();t.setColorWrite(this._cachedColorWriteState)}},r.prototype.getActiveTextures=function(){return[]},r.prototype.hasTexture=function(t){return!1},r.prototype.clone=function(t){return null},r.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var e=new Array;for(var i in this.meshMap){var n=this.meshMap[i];n&&e.push(n)}return e}else{var o=this._scene.meshes;return o.filter(function(s){return s.material===t})}},r.prototype.forceCompilation=function(t,e,i,n){var o=this,s=Ye({clipPlane:!1,useInstances:!1},i),a=this.getScene(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var h=function(){if(!(!o._scene||!o._scene.getEngine())){var f=a.clipPlane;if(s.clipPlane&&(a.clipPlane=new qe(0,0,0,1)),o._storeEffectOnSubMeshes){var l=!0,c=null;if(t.subMeshes){var p=new xt(0,0,0,0,0,t,void 0,!1,!1);p._materialDefines&&(p._materialDefines._renderId=-1),o.isReadyForSubMesh(t,p,s.useInstances)||(p.effect&&p.effect.getCompilationError()&&p.effect.allFallbacksProcessed()?c=p.effect.getCompilationError():(l=!1,setTimeout(h,16)))}l&&(o.allowShaderHotSwapping=u,c&&n&&n(c),e&&e(o))}else o.isReady()?(o.allowShaderHotSwapping=u,e&&e(o)):setTimeout(h,16);s.clipPlane&&(a.clipPlane=f)}};h()},r.prototype.forceCompilationAsync=function(t,e){var i=this;return new Promise(function(n,o){i.forceCompilation(t,function(){n()},e,function(s){o(s)})})},r.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(r._DirtyCallbackArray.length=0,t&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),t&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),t&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),t&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),t&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),t&r.PrePassDirtyFlag&&r._DirtyCallbackArray.push(r._PrePassDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},r.prototype._markAllSubMeshesAsDirty=function(t){if(!this.getScene().blockMaterialDirtyMechanism)for(var e=this.getScene().meshes,i=0,n=e;i<n.length;i++){var o=n[i];if(!!o.subMeshes)for(var s=0,a=o.subMeshes;s<a.length;s++){var u=a[s];u.getMaterial()===this&&(!u._materialDefines||t(u._materialDefines))}}},r.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}},r.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(r._AllDirtyCallBack)},r.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)},r.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)},r.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)},r.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)},r.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)},r.prototype.setPrePassRenderer=function(t){return!1},r.prototype.dispose=function(t,e,i){var n=this.getScene();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),i!==!0)if(this.meshMap)for(var o in this.meshMap){var s=this.meshMap[o];s&&(s.material=null,this.releaseVertexArrayObject(s,t))}else for(var a=n.meshes,u=0,h=a;u<h.length;u++){var s=h[u];s.material===this&&!s.sourceMesh&&(s.material=null,this.releaseVertexArrayObject(s,t))}this._uniformBuffer.dispose(),t&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},r.prototype.releaseVertexArrayObject=function(t,e){if(t.geometry){var i=t.geometry;if(this._storeEffectOnSubMeshes)for(var n=0,o=t.subMeshes;n<o.length;n++){var s=o[n];i._releaseVertexArrayObject(s._materialEffect),e&&s._materialEffect&&s._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},r.prototype.serialize=function(){return j.Serialize(this)},r.Parse=function(t,e,i){if(!t.customType)t.customType="BABYLON.StandardMaterial";else if(t.customType==="BABYLON.PBRMaterial"&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return z.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;var n=K.Instantiate(t.customType);return n.Parse(t,e,i)},r.TriangleFillMode=0,r.WireFrameFillMode=1,r.PointFillMode=2,r.PointListDrawMode=3,r.LineListDrawMode=4,r.LineLoopDrawMode=5,r.LineStripDrawMode=6,r.TriangleStripDrawMode=7,r.TriangleFanDrawMode=8,r.ClockWiseSideOrientation=0,r.CounterClockWiseSideOrientation=1,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.PrePassDirtyFlag=32,r.AllDirtyFlag=63,r.MATERIAL_OPAQUE=0,r.MATERIAL_ALPHATEST=1,r.MATERIAL_ALPHABLEND=2,r.MATERIAL_ALPHATESTANDBLEND=3,r.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,r.MATERIAL_NORMALBLENDMETHOD_RNM=1,r._AllDirtyCallBack=function(t){return t.markAllAsDirty()},r._ImageProcessingDirtyCallBack=function(t){return t.markAsImageProcessingDirty()},r._TextureDirtyCallBack=function(t){return t.markAsTexturesDirty()},r._FresnelDirtyCallBack=function(t){return t.markAsFresnelDirty()},r._MiscDirtyCallBack=function(t){return t.markAsMiscDirty()},r._PrePassDirtyCallBack=function(t){return t.markAsPrePassDirty()},r._LightsDirtyCallBack=function(t){return t.markAsLightDirty()},r._AttributeDirtyCallBack=function(t){return t.markAsAttributesDirty()},r._FresnelAndMiscDirtyCallBack=function(t){r._FresnelDirtyCallBack(t),r._MiscDirtyCallBack(t)},r._TextureAndMiscDirtyCallBack=function(t){r._TextureDirtyCallBack(t),r._MiscDirtyCallBack(t)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=function(t){for(var e=0,i=r._DirtyCallbackArray;e<i.length;e++){var n=i[e];n(t)}},P([T()],r.prototype,"id",void 0),P([T()],r.prototype,"uniqueId",void 0),P([T()],r.prototype,"name",void 0),P([T()],r.prototype,"checkReadyOnEveryCall",void 0),P([T()],r.prototype,"checkReadyOnlyOnce",void 0),P([T()],r.prototype,"state",void 0),P([T("alpha")],r.prototype,"_alpha",void 0),P([T("backFaceCulling")],r.prototype,"_backFaceCulling",void 0),P([T()],r.prototype,"sideOrientation",void 0),P([T("alphaMode")],r.prototype,"_alphaMode",void 0),P([T()],r.prototype,"_needDepthPrePass",void 0),P([T()],r.prototype,"disableDepthWrite",void 0),P([T()],r.prototype,"disableColorWrite",void 0),P([T()],r.prototype,"forceDepthWrite",void 0),P([T()],r.prototype,"depthFunction",void 0),P([T()],r.prototype,"separateCullingPass",void 0),P([T("fogEnabled")],r.prototype,"_fogEnabled",void 0),P([T()],r.prototype,"pointSize",void 0),P([T()],r.prototype,"zOffset",void 0),P([T()],r.prototype,"pointsCloud",null),P([T()],r.prototype,"fillMode",null),P([T()],r.prototype,"transparencyMode",null),r}(),Ue=function(){function r(t){this._vertexBuffers={},this._scene=t}return r.prototype._prepareBuffers=function(){if(!this._vertexBuffers[_.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[_.PositionKind]=new _(this._scene.getEngine(),t,_.PositionKind,!1,!1,2),this._buildIndexBuffer()}},r.prototype._buildIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)},r.prototype._rebuild=function(){var t=this._vertexBuffers[_.PositionKind];!t||(t._rebuild(),this._buildIndexBuffer())},r.prototype._prepareFrame=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null);var i=this._scene.activeCamera;return!i||(e=e||i._postProcesses.filter(function(n){return n!=null}),!e||e.length===0||!this._scene.postProcessesEnabled)?!1:(e[0].activate(i,t,e!=null),!0)},r.prototype.directRender=function(t,e,i,n,o,s){e===void 0&&(e=null),i===void 0&&(i=!1),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=!1);for(var a=this._scene.getEngine(),u=0;u<t.length;u++){u<t.length-1?t[u+1].activate(this._scene.activeCamera,e):e?a.bindFramebuffer(e,n,void 0,void 0,i,o):s||a.restoreDefaultFramebuffer();var h=t[u],f=h.apply();f&&(h.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,f),a.drawElementsType(lt.TriangleFillMode,0,6),h.onAfterRenderObservable.notifyObservers(f))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},r.prototype._finalizeFrame=function(t,e,i,n,o){o===void 0&&(o=!1);var s=this._scene.activeCamera;if(!!s&&(n=n||s._postProcesses.filter(function(c){return c!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var a=this._scene.getEngine(),u=0,h=n.length;u<h;u++){var f=n[u];if(u<h-1?f._outputTexture=n[u+1].activate(s,e):e?(a.bindFramebuffer(e,i,void 0,void 0,o),f._outputTexture=e):(a.restoreDefaultFramebuffer(),f._outputTexture=null),t)break;var l=f.apply();l&&(f.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,l),a.drawElementsType(lt.TriangleFillMode,0,6),f.onAfterRenderObservable.notifyObservers(l))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},r.prototype.dispose=function(){var t=this._vertexBuffers[_.PositionKind];t&&(t.dispose(),this._vertexBuffers[_.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},r}(),Bi=function(){function r(t,e,i,n,o){i===void 0&&(i=null),n===void 0&&(n=null),o===void 0&&(o=null),this.index=t,this._opaqueSubMeshes=new _t(256),this._transparentSubMeshes=new _t(256),this._alphaTestSubMeshes=new _t(256),this._depthOnlySubMeshes=new _t(256),this._particleSystems=new _t(256),this._spriteManagers=new _t(256),this._edgesRenderers=new Nt(16),this._scene=e,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=o}return Object.defineProperty(r.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t,t?this._renderOpaque=this.renderOpaqueSorted:this._renderOpaque=r.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t,t?this._renderAlphaTest=this.renderAlphaTestSorted:this._renderAlphaTest=r.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transparentSortCompareFn",{set:function(t){t?this._transparentSortCompareFn=t:this._transparentSortCompareFn=r.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),r.prototype.render=function(t,e,i,n){if(t){t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var o=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var s=o.getStencilBuffer();if(o.setStencilBuffer(!1),e&&this._renderSprites(),i&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(o.setStencilBuffer(s),this._renderTransparent(this._transparentSubMeshes),o.setAlphaMode(0)),o.setStencilBuffer(!1),this._edgesRenderers.length){for(var a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();o.setAlphaMode(0)}o.setStencilBuffer(s)},r.prototype.renderOpaqueSorted=function(t){return r.renderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderAlphaTestSorted=function(t){return r.renderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderTransparentSorted=function(t){return r.renderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},r.renderSorted=function(t,e,i,n){for(var o=0,s,a=i?i.globalPosition:r._zeroVector;o<t.length;o++)s=t.data[o],s._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=g.Distance(s.getBoundingInfo().boundingSphere.centerWorld,a);var u=t.data.slice(0,t.length);for(e&&u.sort(e),o=0;o<u.length;o++){if(s=u[o],n){var h=s.getMaterial();if(h&&h.needDepthPrePass){var f=h.getScene().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),s.render(!1),f.setColorWrite(!0)}}s.render(n)}},r.renderUnsorted=function(t){for(var e=0;e<t.length;e++){var i=t.data[e];i.render(!1)}},r.defaultTransparentSortCompare=function(t,e){return t._alphaIndex>e._alphaIndex?1:t._alphaIndex<e._alphaIndex?-1:r.backToFrontSortCompare(t,e)},r.backToFrontSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?1:t._distanceToCamera>e._distanceToCamera?-1:0},r.frontToBackSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?-1:t._distanceToCamera>e._distanceToCamera?1:0},r.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},r.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},r.prototype.dispatch=function(t,e,i){e===void 0&&(e=t.getMesh()),i===void 0&&(i=t.getMaterial()),i!=null&&(i.needAlphaBlendingForMesh(e)?this._transparentSubMeshes.push(t):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),e._renderingGroup=this,e._edgesRenderer&&e._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(e._edgesRenderer))},r.prototype.dispatchSprites=function(t){this._spriteManagers.push(t)},r.prototype.dispatchParticles=function(t){this._particleSystems.push(t)},r.prototype._renderParticles=function(t){if(this._particleSystems.length!==0){var e=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var n=this._particleSystems.data[i];if((e&&e.layerMask&n.layerMask)!==0){var o=n.emitter;(!o.position||!t||t.indexOf(o)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},r.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var e=0;e<this._spriteManagers.length;e++){var i=this._spriteManagers.data[e];(t&&t.layerMask&i.layerMask)!==0&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},r._zeroVector=g.Zero(),r}(),Ni=function(){function r(){}return r}(),Li=function(){function r(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Ni,this._scene=t;for(var e=r.MIN_RENDERINGGROUPS;e<r.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={autoClear:!0,depth:!0,stencil:!0}}return r.prototype._clearDepthStencilBuffer=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,t,e),this._depthStencilBufferAlreadyCleaned=!0)},r.prototype.render=function(t,e,i,n){var o=this._renderingGroupInfo;if(o.scene=this._scene,o.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var s=0;s<this._scene.spriteManagers.length;s++){var a=this._scene.spriteManagers[s];this.dispatchSprites(a)}for(var s=r.MIN_RENDERINGGROUPS;s<r.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===r.MIN_RENDERINGGROUPS;var u=this._renderingGroups[s];if(!!u){var h=Math.pow(2,s);if(o.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,h),r.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(var l=0,c=this._scene._beforeRenderingGroupDrawStage;l<c.length;l++){var p=c[l];p.action(s)}u.render(t,n,i,e);for(var d=0,v=this._scene._afterRenderingGroupDrawStage;d<v.length;d++){var p=v[d];p.action(s)}this._scene.onAfterRenderingGroupObservable.notifyObservers(o,h)}}},r.prototype.reset=function(){for(var t=r.MIN_RENDERINGGROUPS;t<r.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.prepare()}},r.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},r.prototype.freeRenderingGroups=function(){for(var t=r.MIN_RENDERINGGROUPS;t<r.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.dispose()}},r.prototype._prepareRenderingGroup=function(t){this._renderingGroups[t]===void 0&&(this._renderingGroups[t]=new Bi(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))},r.prototype.dispatchSprites=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchSprites(t)},r.prototype.dispatchParticles=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchParticles(t)},r.prototype.dispatch=function(t,e,i){e===void 0&&(e=t.getMesh());var n=e.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(t,e,i)},r.prototype.setRenderingOrder=function(t,e,i,n){if(e===void 0&&(e=null),i===void 0&&(i=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[t]=e,this._customAlphaTestSortCompareFn[t]=i,this._customTransparentSortCompareFn[t]=n,this._renderingGroups[t]){var o=this._renderingGroups[t];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],o.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}},r.prototype.setRenderingAutoClearDepthStencil=function(t,e,i,n){i===void 0&&(i=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[t]={autoClear:e,depth:i,stencil:n}},r.prototype.getAutoClearDepthStencilSetup=function(t){return this._autoClearDepthStencil[t]},r.MAX_RENDERINGGROUPS=4,r.MIN_RENDERINGGROUPS=0,r.AUTOCLEAR=!0,r}(),ke=function(){function r(){}return r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,r.STEP_BEFORECAMERADRAW_LAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=2,r.STEP_BEFORERENDERTARGETDRAW_LAYER=0,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,r.STEP_AFTERCAMERADRAW_LAYER=3,r.STEP_AFTERCAMERADRAW_PREPASS=4,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_BEFORECLEARSTAGE_PREPASS=0,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0,r}(),Z=function(r){U(t,r);function t(e){return r.apply(this,e)||this}return t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,i,n){for(var o=0,s=Number.MAX_VALUE;o<this.length;o++){var a=this[o];if(s=a.index,e<s)break}this.splice(o,0,{index:e,component:i,action:n.bind(i)})},t.prototype.clear=function(){this.length=0},t}(Array),w=function(){function r(){}return r.POINTERDOWN=1,r.POINTERUP=2,r.POINTERMOVE=4,r.POINTERWHEEL=8,r.POINTERPICK=16,r.POINTERTAP=32,r.POINTERDOUBLETAP=64,r}(),Qe=function(){function r(t,e){this.type=t,this.event=e}return r}(),Ui=function(r){U(t,r);function t(e,i,n,o){var s=r.call(this,e,i)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new G(n,o),s}return t}(Qe),Xt=function(r){U(t,r);function t(e,i,n){var o=r.call(this,e,i)||this;return o.pickInfo=n,o}return t}(Qe),qt=function(){function r(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(r,"HasTriggers",{get:function(){for(var t in r.Triggers)if(r.Triggers.hasOwnProperty(t))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r,"HasPickTriggers",{get:function(){for(var t in r.Triggers)if(r.Triggers.hasOwnProperty(t)){var e=parseInt(t);if(e>=1&&e<=7)return!0}return!1},enumerable:!1,configurable:!0}),r.HasSpecificTrigger=function(t){for(var e in r.Triggers)if(r.Triggers.hasOwnProperty(e)){var i=parseInt(e);if(i===t)return!0}return!1},r.Triggers={},r}(),Ae=function(){function r(){}return r.KEYDOWN=1,r.KEYUP=2,r}(),Pe=function(){function r(t,e){this.type=t,this.event=e}return r}(),Ve=function(r){U(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.type=e,n.event=i,n.skipOnPointerObservable=!1,n}return t}(Pe),ze=function(){function r(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(r.prototype,"singleClick",{get:function(){return this._singleClick},set:function(t){this._singleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(t){this._doubleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(t){this._hasSwiped=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ignore",{get:function(){return this._ignore},set:function(t){this._ignore=t},enumerable:!1,configurable:!0}),r}(),It=function(){function r(t){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new G(0,0),this._previousStartingPointerPosition=new G(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=t}return Object.defineProperty(r.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),r.prototype.getMeshUnderPointerByPointerId=function(t){return this._meshUnderPointerId[t]},Object.defineProperty(r.prototype,"unTranslatedPointer",{get:function(){return new G(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerX",{get:function(){return this._pointerX},set:function(t){this._pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerY",{get:function(){return this._pointerY},set:function(t){this._pointerY=t},enumerable:!1,configurable:!0}),r.prototype._updatePointerPosition=function(t){var e=this._scene.getEngine().getInputElementClientRect();!e||(this._pointerX=t.clientX-e.left,this._pointerY=t.clientY-e.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},r.prototype._processPointerMove=function(t,e){var i=this._scene,n=i.getEngine(),o=n.getInputElement();if(!!o){o.tabIndex=n.canvasTabIndex,i.doNotHandleCursors||(o.style.cursor=i.defaultCursor);var s=!!(t&&t.hit&&t.pickedMesh);s?(i.setPointerOverMesh(t.pickedMesh,e.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(i.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?o.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:o.style.cursor=i.hoverCursor))):i.setPointerOverMesh(null,e.pointerId);for(var a=0,u=i._pointerMoveStage;a<u.length;a++){var h=u[a];t=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,s,o)}if(t){var f=e.type===this._wheelEventName?w.POINTERWHEEL:w.POINTERMOVE;if(i.onPointerMove&&i.onPointerMove(e,t,f),i.onPointerObservable.hasObservers()){var l=new Xt(f,e,t);this._setRayOnPointerInfo(l),i.onPointerObservable.notifyObservers(l,f)}}}},r.prototype._setRayOnPointerInfo=function(t){var e=this._scene;t.pickInfo&&!t.pickInfo._pickingUnavailable&&(t.pickInfo.ray||(t.pickInfo.ray=e.createPickingRay(t.event.offsetX,t.event.offsetY,O.Identity(),e.activeCamera)))},r.prototype._checkPrePointerObservable=function(t,e,i){var n=this._scene,o=new Ui(i,e,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(o.ray=t.ray),n.onPrePointerObservable.notifyObservers(o,i),!!o.skipOnPointerObservable},r.prototype.simulatePointerMove=function(t,e){var i=new PointerEvent("pointermove",e);this._checkPrePointerObservable(t,i,w.POINTERMOVE)||this._processPointerMove(t,i)},r.prototype.simulatePointerDown=function(t,e){var i=new PointerEvent("pointerdown",e);this._checkPrePointerObservable(t,i,w.POINTERDOWN)||this._processPointerDown(t,i)},r.prototype._processPointerDown=function(t,e){var i=this,n=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,rt.CreateNew(t.pickedMesh,e)),e.button){case 0:o.processTrigger(2,rt.CreateNew(t.pickedMesh,e));break;case 1:o.processTrigger(4,rt.CreateNew(t.pickedMesh,e));break;case 2:o.processTrigger(3,rt.CreateNew(t.pickedMesh,e));break}o.hasSpecificTrigger(8)&&window.setTimeout(function(){var l=n.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(8)&&c==i._pickedDownMesh},!1,n.cameraToUseForPointers);l&&l.hit&&l.pickedMesh&&o&&i._totalPointersPressed!==0&&Date.now()-i._startingPointerTime>r.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,o.processTrigger(8,rt.CreateNew(l.pickedMesh,e)))},r.LongPressDelay)}}else for(var s=0,a=n._pointerDownStage;s<a.length;s++){var u=a[s];t=u.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(t){var h=w.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(e,t,h),n.onPointerObservable.hasObservers()){var f=new Xt(h,e,t);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,h)}}},r.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>r.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>r.DragMovementThreshold},r.prototype.simulatePointerUp=function(t,e,i){var n=new PointerEvent("pointerup",e),o=new ze;i?o.doubleClick=!0:o.singleClick=!0,!this._checkPrePointerObservable(t,n,w.POINTERUP)&&this._processPointerUp(t,n,o)},r.prototype._processPointerUp=function(t,e,i){var n=this._scene;if(t&&t&&t.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(e,t),i.singleClick&&!i.ignore&&n.onPointerObservable.hasObservers())){var o=w.POINTERPICK,s=new Xt(o,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,o)}var a=t.pickedMesh._getActionManagerForTrigger();if(a&&!i.ignore){a.processTrigger(7,rt.CreateNew(t.pickedMesh,e)),!i.hasSwiped&&i.singleClick&&a.processTrigger(1,rt.CreateNew(t.pickedMesh,e));var u=t.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&u&&u.processTrigger(6,rt.CreateNew(t.pickedMesh,e))}}else if(!i.ignore)for(var h=0,f=n._pointerUpStage;h<f.length;h++){var l=f[h];t=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,rt.CreateNew(this._pickedDownMesh,e))}var p=0;if(n.onPointerObservable.hasObservers()){if(!i.ignore&&!i.hasSwiped&&(i.singleClick&&n.onPointerObservable.hasSpecificMask(w.POINTERTAP)?p=w.POINTERTAP:i.doubleClick&&n.onPointerObservable.hasSpecificMask(w.POINTERDOUBLETAP)&&(p=w.POINTERDOUBLETAP),p)){var s=new Xt(p,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}if(!i.ignore){p=w.POINTERUP;var s=new Xt(p,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}}n.onPointerUp&&!i.ignore&&n.onPointerUp(e,t,p)},r.prototype.isPointerCaptured=function(t){return t===void 0&&(t=0),this._pointerCaptures[t]},r.prototype.attachControl=function(t,e,i,n){var o=this;t===void 0&&(t=!0),e===void 0&&(e=!0),i===void 0&&(i=!0),n===void 0&&(n=null);var s=this._scene;if(n||(n=s.getEngine().getInputElement()),!!n){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=n;var a=s.getEngine();this._initActionManager=function(l,c){if(!o._meshPickProceed){var p=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);o._currentPickResult=p,p&&(l=p.hit&&p.pickedMesh?p.pickedMesh._getActionManagerForTrigger():null),o._meshPickProceed=!0}return l},this._delayedSimpleClick=function(l,c,p){(Date.now()-o._previousStartingPointerTime>r.DoubleClickDelay&&!o._doubleClickOccured||l!==o._previousButtonPressed)&&(o._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,p(c,o._currentPickResult))},this._initClickEvent=function(l,c,p,d){var v=new ze;o._currentPickResult=null;var y=null,b=l.hasSpecificMask(w.POINTERPICK)||c.hasSpecificMask(w.POINTERPICK)||l.hasSpecificMask(w.POINTERTAP)||c.hasSpecificMask(w.POINTERTAP)||l.hasSpecificMask(w.POINTERDOUBLETAP)||c.hasSpecificMask(w.POINTERDOUBLETAP);!b&&qt&&(y=o._initActionManager(y,v),y&&(b=y.hasPickTriggers));var m=!1;if(b){var M=p.button;if(v.hasSwiped=o._isPointerSwiping(),!v.hasSwiped){var R=!r.ExclusiveDoubleClickMode;R||(R=!l.hasSpecificMask(w.POINTERDOUBLETAP)&&!c.hasSpecificMask(w.POINTERDOUBLETAP),R&&!qt.HasSpecificTrigger(6)&&(y=o._initActionManager(y,v),y&&(R=!y.hasSpecificTrigger(6)))),R?(Date.now()-o._previousStartingPointerTime>r.DoubleClickDelay||M!==o._previousButtonPressed)&&(v.singleClick=!0,d(v,o._currentPickResult),m=!0):(o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,o._delayedSimpleClickTimeout=window.setTimeout(o._delayedSimpleClick.bind(o,M,v,d),r.DoubleClickDelay));var D=l.hasSpecificMask(w.POINTERDOUBLETAP)||c.hasSpecificMask(w.POINTERDOUBLETAP);!D&&qt.HasSpecificTrigger(6)&&(y=o._initActionManager(y,v),y&&(D=y.hasSpecificTrigger(6))),D&&(M===o._previousButtonPressed&&Date.now()-o._previousStartingPointerTime<r.DoubleClickDelay&&!o._doubleClickOccured?(!v.hasSwiped&&!o._isPointerSwiping()?(o._previousStartingPointerTime=0,o._doubleClickOccured=!0,v.doubleClick=!0,v.ignore=!1,r.ExclusiveDoubleClickMode&&o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,d(v,o._currentPickResult)):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=M,r.ExclusiveDoubleClickMode?(o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,d(v,o._previousPickResult)):d(v,o._currentPickResult)),m=!0):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=M))}}m||d(v,o._currentPickResult)},this._onPointerMove=function(l){if(l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),!o._checkPrePointerObservable(null,l,l.type===o._wheelEventName?w.POINTERWHEEL:w.POINTERMOVE)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){s.pointerMovePredicate||(s.pointerMovePredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(p.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||p._getActionManagerForTrigger()!=null)&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)});var c=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerMovePredicate,!1,s.cameraToUseForPointers);o._processPointerMove(c,l)}},this._onPointerDown=function(l){if(o._totalPointersPressed++,o._pickedDownMesh=null,o._meshPickProceed=!1,l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),s.preventDefaultOnPointerDown&&n&&(l.preventDefault(),n.focus()),o._startingPointerPosition.x=o._pointerX,o._startingPointerPosition.y=o._pointerY,o._startingPointerTime=Date.now(),!o._checkPrePointerObservable(null,l,w.POINTERDOWN)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){o._pointerCaptures[l.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)}),o._pickedDownMesh=null;var c=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);o._processPointerDown(c,l)}},this._onPointerUp=function(l){o._totalPointersPressed!==0&&(o._totalPointersPressed--,o._pickedUpMesh=null,o._meshPickProceed=!1,l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),s.preventDefaultOnPointerUp&&n&&(l.preventDefault(),n.focus()),o._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,l,function(c,p){s.onPrePointerObservable.hasObservers()&&!c.ignore&&(!c.hasSwiped&&(c.singleClick&&s.onPrePointerObservable.hasSpecificMask(w.POINTERTAP)&&o._checkPrePointerObservable(null,l,w.POINTERTAP)||c.doubleClick&&s.onPrePointerObservable.hasSpecificMask(w.POINTERDOUBLETAP)&&o._checkPrePointerObservable(null,l,w.POINTERDOUBLETAP))||o._checkPrePointerObservable(null,l,w.POINTERUP))||!o._pointerCaptures[l.pointerId]||(o._pointerCaptures[l.pointerId]=!1,!(!s.cameraToUseForPointers&&!s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=function(d){return d.isPickable&&d.isVisible&&d.isReady()&&d.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&d.layerMask)!==0)}),!o._meshPickProceed&&(qt&&qt.HasTriggers||s.onPointerObservable.hasObservers())&&o._initActionManager(null,c),p||(p=o._currentPickResult),o._processPointerUp(p,l,c),o._previousPickResult=o._currentPickResult))}))},this._onKeyDown=function(l){var c=Ae.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){var p=new Ve(c,l);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new Pe(c,l);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(14,rt.CreateNewFromScene(s,l))},this._onKeyUp=function(l){var c=Ae.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){var p=new Ve(c,l);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new Pe(c,l);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(15,rt.CreateNewFromScene(s,l))};var u=function(){!n||o._keyboardIsAttached||(n.addEventListener("keydown",o._onKeyDown,!1),n.addEventListener("keyup",o._onKeyUp,!1),o._keyboardIsAttached=!0)};this._onCanvasFocusObserver=a.onCanvasFocusObservable.add(function(){return document.activeElement===n&&u(),u}()),this._onCanvasBlurObserver=a.onCanvasBlurObservable.add(function(){!n||(n.removeEventListener("keydown",o._onKeyDown),n.removeEventListener("keyup",o._onKeyUp),o._keyboardIsAttached=!1)}),u();var h=K.GetPointerPrefix(a);if(i&&(n.addEventListener(h+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",n.addEventListener(this._wheelEventName,this._onPointerMove,!1)),e&&n.addEventListener(h+"down",this._onPointerDown,!1),t){var f=s.getEngine().getHostWindow();f&&f.addEventListener(h+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},r.prototype.detachControl=function(){var t=this._scene.getEngine(),e=K.GetPointerPrefix(t);!this._alreadyAttachedTo||!this._alreadyAttached||(this._alreadyAttachedTo.removeEventListener(e+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},r.prototype.setPointerOverMesh=function(t,e){if(e===void 0&&(e=0),e<0&&(e=0),this._meshUnderPointerId[e]!==t){var i=this._meshUnderPointerId[e],n;i&&(n=i._getActionManagerForTrigger(10),n&&n.processTrigger(10,rt.CreateNew(i,void 0,{pointerId:e}))),this._meshUnderPointerId[e]=t,this._pointerOverMesh=t,i=this._meshUnderPointerId[e],i&&(n=i._getActionManagerForTrigger(9),n&&n.processTrigger(9,rt.CreateNew(i,void 0,{pointerId:e})))}},r.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},r.DragMovementThreshold=10,r.LongPressDelay=500,r.DoubleClickDelay=300,r.ExclusiveDoubleClickMode=!1,r}(),ki=function(){function r(){}return Object.defineProperty(r,"UniqueId",{get:function(){var t=this._UniqueIdCounter;return this._UniqueIdCounter++,t},enumerable:!1,configurable:!0}),r._UniqueIdCounter=0,r}(),Vi=function(r){U(t,r);function t(e,i){var n=r.call(this)||this;n._inputManager=new It(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new J(.2,.2,.3,1),n.ambientColor=new pt(0,0,0),n._environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new E,n._onDisposeObserver=null,n.onBeforeRenderObservable=new E,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new E,n.onAfterRenderCameraObservable=new E,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new E,n.onAfterAnimationsObservable=new E,n.onBeforeDrawPhaseObservable=new E,n.onAfterDrawPhaseObservable=new E,n.onReadyObservable=new E,n.onBeforeCameraRenderObservable=new E,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new E,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new E,n.onAfterActiveMeshesEvaluationObservable=new E,n.onBeforeParticlesRenderingObservable=new E,n.onAfterParticlesRenderingObservable=new E,n.onDataLoadedObservable=new E,n.onNewCameraAddedObservable=new E,n.onCameraRemovedObservable=new E,n.onNewLightAddedObservable=new E,n.onLightRemovedObservable=new E,n.onNewGeometryAddedObservable=new E,n.onGeometryRemovedObservable=new E,n.onNewTransformNodeAddedObservable=new E,n.onTransformNodeRemovedObservable=new E,n.onNewMeshAddedObservable=new E,n.onMeshRemovedObservable=new E,n.onNewSkeletonAddedObservable=new E,n.onSkeletonRemovedObservable=new E,n.onNewMaterialAddedObservable=new E,n.onNewMultiMaterialAddedObservable=new E,n.onMaterialRemovedObservable=new E,n.onMultiMaterialRemovedObservable=new E,n.onNewTextureAddedObservable=new E,n.onTextureRemovedObservable=new E,n.onBeforeRenderTargetsRenderObservable=new E,n.onAfterRenderTargetsRenderObservable=new E,n.onBeforeStepObservable=new E,n.onAfterStepObservable=new E,n.onActiveCameraChanged=new E,n.onBeforeRenderingGroupObservable=new E,n.onAfterRenderingGroupObservable=new E,n.onMeshImportedObservable=new E,n.onAnimationFileImportedObservable=new E,n._registeredForLateAnimationBindings=new Nt(256),n.onPrePointerObservable=new E,n.onPointerObservable=new E,n.onPreKeyboardObservable=new E,n.onKeyboardObservable=new E,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=t.FOGMODE_NONE,n.fogColor=new pt(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.prePass=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new g(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new Nt(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new re,n._activeIndices=new re,n._activeParticles=new re,n._activeBones=new re,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=-1,n._intermediateRendering=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new _t(256),n._processedMaterials=new _t(256),n._renderTargets=new Nt(256),n._activeParticleSystems=new _t(256),n._activeSkeletons=new Nt(32),n._softwareSkinnedMeshes=new Nt(32),n._activeAnimatables=new Array,n._transformMatrix=O.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=Z.Create(),n._beforeClearStage=Z.Create(),n._gatherRenderTargetsStage=Z.Create(),n._gatherActiveCameraRenderTargetsStage=Z.Create(),n._isReadyForMeshStage=Z.Create(),n._beforeEvaluateActiveMeshStage=Z.Create(),n._evaluateSubMeshStage=Z.Create(),n._preActiveMeshStage=Z.Create(),n._cameraDrawRenderTargetStage=Z.Create(),n._beforeCameraDrawStage=Z.Create(),n._beforeRenderTargetDrawStage=Z.Create(),n._beforeRenderingGroupDrawStage=Z.Create(),n._beforeRenderingMeshStage=Z.Create(),n._afterRenderingMeshStage=Z.Create(),n._afterRenderingGroupDrawStage=Z.Create(),n._afterCameraDrawStage=Z.Create(),n._afterRenderTargetDrawStage=Z.Create(),n._afterRenderStage=Z.Create(),n._pointerMoveStage=Z.Create(),n._pointerDownStage=Z.Create(),n._pointerUpStage=Z.Create(),n.geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1;var o=Ye({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},i);return n._engine=e||gt.LastCreatedEngine,o.virtual||(gt._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new Li(n),Ue&&(n.postProcessManager=new Ue(n)),Dt.IsWindowObjectExist()&&n.attachControl(),n._createUbo(),Me&&(n._imageProcessingConfiguration=new Me),n.setDefaultCandidateProviders(),o.useGeometryUniqueIdsMap&&(n.geometriesByUniqueId={}),n.useMaterialMeshMap=o.useMaterialMeshMap,n.useClonedMeshMap=o.useClonedMeshMap,(!i||!i.virtual)&&n._engine.onNewSceneAddedObservable.notifyObservers(n),n}return t.DefaultMaterialFactory=function(e){throw S.WarnImport("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw S.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(e){this._environmentIntensity!==e&&(this._environmentIntensity=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return It.DragMovementThreshold},set:function(e){It.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return It.LongPressDelay},set:function(e){It.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return It.DoubleClickDelay},set:function(e){It.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return It.ExclusiveDoubleClickMode},set:function(e){It.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,i=this._transientComponents;e<i.length;e++){var n=i[e];n.register()}this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var i=e;i.addFromContainer&&i.serialize&&this._serializableComponents.push(i)},t.prototype._getComponent=function(e){for(var i=0,n=this._components;i<n.length;i++){var o=n[i];if(o.name===e)return o}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,i,n){return n===void 0&&(n=1),this._cachedEffect!==i||this._cachedMaterial!==e||this._cachedVisibility!==n},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this._sceneUbo=new Ie(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},t.prototype.simulatePointerMove=function(e,i){return this._inputManager.simulatePointerMove(e,i),this},t.prototype.simulatePointerDown=function(e,i){return this._inputManager.simulatePointerDown(e,i),this},t.prototype.simulatePointerUp=function(e,i,n){return this._inputManager.simulatePointerUp(e,i,n),this},t.prototype.isPointerCaptured=function(e){return e===void 0&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,i,n){e===void 0&&(e=!0),i===void 0&&(i=!0),n===void 0&&(n=!0),this._inputManager.attachControl(e,i,n)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(){if(this._isDisposed)return!1;var e,i=this.getEngine();if(!i.areAllEffectsReady()||this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var n=this.meshes[e];if(!!n.isEnabled()&&!(!n.subMeshes||n.subMeshes.length===0)){if(!n.isReady(!0))return!1;for(var o=n.hasThinInstances||n.getClassName()==="InstancedMesh"||n.getClassName()==="InstancedLinesMesh"||i.getCaps().instancedArrays&&n.instances.length>0,s=0,a=this._isReadyForMeshStage;s<a.length;s++){var u=a[s];if(!u.action(n,o))return!1}}}for(e=0;e<this.geometries.length;e++){var h=this.geometries[e];if(h.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var f=0,l=this.activeCameras;f<l.length;f++){var c=l[f];if(!c.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var p=0,d=this.particleSystems;p<d.length;p++){var v=d[p];if(!v.isReady())return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var i=this,n=function(){e(),setTimeout(function(){i.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},t.prototype.executeOnceBeforeRender=function(e,i){var n=this;i!==void 0?setTimeout(function(){n._executeOnceBeforeRender(e)},i):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var i=this.isLoading,n=this._pendingData.indexOf(e);n!==-1&&this._pendingData.splice(n,1),i&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e){var i=this;this.onReadyObservable.add(e),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){i._checkIsReady()},150))},t.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(i){e.executeWhenReady(function(){i()})})},t.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady()){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=kt.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,i,n,o){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===i.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=e,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?ce.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ce.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,o):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.getUniqueId=function(){return ki.UniqueId},t.prototype.addMesh=function(e,i){var n=this;i===void 0&&(i=!1),!this._blockEntityCollection&&(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),i&&e.getChildMeshes().forEach(function(o){n.addMesh(o)}))},t.prototype.removeMesh=function(e,i){var n=this;i===void 0&&(i=!1);var o=this.meshes.indexOf(e);return o!==-1&&(this.meshes[o]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(e),i&&e.getChildMeshes().forEach(function(s){n.removeMesh(s)}),o},t.prototype.addTransformNode=function(e){this._blockEntityCollection||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var i=e._indexInSceneTransformNodesArray;if(i!==-1){if(i!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[i]=n,n._indexInSceneTransformNodesArray=i}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),i},t.prototype.removeSkeleton=function(e){var i=this.skeletons.indexOf(e);return i!==-1&&(this.skeletons.splice(i,1),this.onSkeletonRemovedObservable.notifyObservers(e)),i},t.prototype.removeMorphTargetManager=function(e){var i=this.morphTargetManagers.indexOf(e);return i!==-1&&this.morphTargetManagers.splice(i,1),i},t.prototype.removeLight=function(e){var i=this.lights.indexOf(e);if(i!==-1){for(var n=0,o=this.meshes;n<o.length;n++){var s=o[n];s._removeLightSource(e,!1)}this.lights.splice(i,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),i},t.prototype.removeCamera=function(e){var i=this.cameras.indexOf(e);if(i!==-1&&(this.cameras.splice(i,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var n=this.activeCameras.indexOf(e);n!==-1&&this.activeCameras.splice(n,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),i},t.prototype.removeParticleSystem=function(e){var i=this.particleSystems.indexOf(e);return i!==-1&&this.particleSystems.splice(i,1),i},t.prototype.removeAnimation=function(e){var i=this.animations.indexOf(e);return i!==-1&&this.animations.splice(i,1),i},t.prototype.stopAnimation=function(e,i,n){},t.prototype.removeAnimationGroup=function(e){var i=this.animationGroups.indexOf(e);return i!==-1&&this.animationGroups.splice(i,1),i},t.prototype.removeMultiMaterial=function(e){var i=this.multiMaterials.indexOf(e);return i!==-1&&this.multiMaterials.splice(i,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),i},t.prototype.removeMaterial=function(e){var i=e._indexInSceneMaterialArray;if(i!==-1&&i<this.materials.length){if(i!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[i]=n,n._indexInSceneMaterialArray=i}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),i},t.prototype.removeActionManager=function(e){var i=this.actionManagers.indexOf(e);return i!==-1&&this.actionManagers.splice(i,1),i},t.prototype.removeTexture=function(e){var i=this.textures.indexOf(e);return i!==-1&&this.textures.splice(i,1),this.onTextureRemovedObservable.notifyObservers(e),i},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var i=0,n=this.meshes;i<n.length;i++){var o=n[i];o.lightSources.indexOf(e)===-1&&(o.lightSources.push(e),o._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(Fi.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,i){i===void 0&&(i=!0);var n=this._engine.getInputElement();!n||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,i&&e.attachControl())},t.prototype.setActiveCameraByID=function(e){var i=this.getCameraByID(e);return i?(this.activeCamera=i,i):null},t.prototype.setActiveCameraByName=function(e){var i=this.getCameraByName(e);return i?(this.activeCamera=i,i):null},t.prototype.getAnimationGroupByName=function(e){for(var i=0;i<this.animationGroups.length;i++)if(this.animationGroups[i].name===e)return this.animationGroups[i];return null},t.prototype.getMaterialByUniqueID=function(e){for(var i=0;i<this.materials.length;i++)if(this.materials[i].uniqueId===e)return this.materials[i];return null},t.prototype.getMaterialByID=function(e){for(var i=0;i<this.materials.length;i++)if(this.materials[i].id===e)return this.materials[i];return null},t.prototype.getLastMaterialByID=function(e){for(var i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===e)return this.materials[i];return null},t.prototype.getMaterialByName=function(e){for(var i=0;i<this.materials.length;i++)if(this.materials[i].name===e)return this.materials[i];return null},t.prototype.getTextureByUniqueID=function(e){for(var i=0;i<this.textures.length;i++)if(this.textures[i].uniqueId===e)return this.textures[i];return null},t.prototype.getCameraByID=function(e){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].id===e)return this.cameras[i];return null},t.prototype.getCameraByUniqueID=function(e){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].uniqueId===e)return this.cameras[i];return null},t.prototype.getCameraByName=function(e){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].name===e)return this.cameras[i];return null},t.prototype.getBoneByID=function(e){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],o=0;o<n.bones.length;o++)if(n.bones[o].id===e)return n.bones[o];return null},t.prototype.getBoneByName=function(e){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],o=0;o<n.bones.length;o++)if(n.bones[o].name===e)return n.bones[o];return null},t.prototype.getLightByName=function(e){for(var i=0;i<this.lights.length;i++)if(this.lights[i].name===e)return this.lights[i];return null},t.prototype.getLightByID=function(e){for(var i=0;i<this.lights.length;i++)if(this.lights[i].id===e)return this.lights[i];return null},t.prototype.getLightByUniqueID=function(e){for(var i=0;i<this.lights.length;i++)if(this.lights[i].uniqueId===e)return this.lights[i];return null},t.prototype.getParticleSystemByID=function(e){for(var i=0;i<this.particleSystems.length;i++)if(this.particleSystems[i].id===e)return this.particleSystems[i];return null},t.prototype.getGeometryByID=function(e){for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].id===e)return this.geometries[i];return null},t.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var i=this.geometriesByUniqueId[e];if(i!==void 0)return this.geometries[i]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===e)return this.geometries[n];return null},t.prototype.pushGeometry=function(e,i){return!i&&this._getGeometryByUniqueID(e.uniqueId)?!1:(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var i;if(this.geometriesByUniqueId){if(i=this.geometriesByUniqueId[e.uniqueId],i===void 0)return!1}else if(i=this.geometries.indexOf(e),i<0)return!1;if(i!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];n&&(this.geometries[i]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=i,this.geometriesByUniqueId[e.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshByID=function(e){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].id===e)return this.meshes[i];return null},t.prototype.getMeshesByID=function(e){return this.meshes.filter(function(i){return i.id===e})},t.prototype.getTransformNodeByID=function(e){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].id===e)return this.transformNodes[i];return null},t.prototype.getTransformNodeByUniqueID=function(e){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].uniqueId===e)return this.transformNodes[i];return null},t.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(i){return i.id===e})},t.prototype.getMeshByUniqueID=function(e){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].uniqueId===e)return this.meshes[i];return null},t.prototype.getLastMeshByID=function(e){for(var i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===e)return this.meshes[i];return null},t.prototype.getLastEntryByID=function(e){var i;for(i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===e)return this.meshes[i];for(i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===e)return this.transformNodes[i];for(i=this.cameras.length-1;i>=0;i--)if(this.cameras[i].id===e)return this.cameras[i];for(i=this.lights.length-1;i>=0;i--)if(this.lights[i].id===e)return this.lights[i];return null},t.prototype.getNodeByID=function(e){var i=this.getMeshByID(e);if(i)return i;var n=this.getTransformNodeByID(e);if(n)return n;var o=this.getLightByID(e);if(o)return o;var s=this.getCameraByID(e);if(s)return s;var a=this.getBoneByID(e);return a||null},t.prototype.getNodeByName=function(e){var i=this.getMeshByName(e);if(i)return i;var n=this.getTransformNodeByName(e);if(n)return n;var o=this.getLightByName(e);if(o)return o;var s=this.getCameraByName(e);if(s)return s;var a=this.getBoneByName(e);return a||null},t.prototype.getMeshByName=function(e){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].name===e)return this.meshes[i];return null},t.prototype.getTransformNodeByName=function(e){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].name===e)return this.transformNodes[i];return null},t.prototype.getLastSkeletonByID=function(e){for(var i=this.skeletons.length-1;i>=0;i--)if(this.skeletons[i].id===e)return this.skeletons[i];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].uniqueId===e)return this.skeletons[i];return null},t.prototype.getSkeletonById=function(e){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].id===e)return this.skeletons[i];return null},t.prototype.getSkeletonByName=function(e){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].name===e)return this.skeletons[i];return null},t.prototype.getMorphTargetManagerById=function(e){for(var i=0;i<this.morphTargetManagers.length;i++)if(this.morphTargetManagers[i].uniqueId===e)return this.morphTargetManagers[i];return null},t.prototype.getMorphTargetById=function(e){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],o=0;o<n.numTargets;++o){var s=n.getTarget(o);if(s.id===e)return s}return null},t.prototype.getMorphTargetByName=function(e){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],o=0;o<n.numTargets;++o){var s=n.getTarget(o);if(s.name===e)return s}return null},t.prototype.getPostProcessByName=function(e){for(var i=0;i<this.postProcesses.length;++i){var n=this.postProcesses[i];if(n.name===e)return n}return null},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=K.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,i){return this._externalData||(this._externalData=new Ee),this._externalData.add(e,i)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,i){return this._externalData||(this._externalData=new Ee),this._externalData.getOrAddWithFactory(e,i)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,i,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||i.alwaysSelectAsActiveMesh||i.subMeshes.length===1||e.isInFrustum(this._frustumPlanes)){for(var o=0,s=this._evaluateSubMeshStage;o<s.length;o++){var a=s[o];a.action(i,e)}var u=e.getMaterial();u!=null&&(u.hasRenderTargetTextures&&u.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(u)===-1&&(this._processedMaterials.push(u),this._renderTargets.concatWithNoDuplicate(u.getRenderTargetTextures())),this._renderingManager.dispatch(e,i,u))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var i=this.activeCameras[e];i&&i._activeMeshes&&i._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var i=this.textures[e];i&&i.renderList&&i.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,i,n){var o=this;return e===void 0&&(e=!1),this.executeWhenReady(function(){if(!o.activeCamera){n&&n("No active camera found");return}o._frustumPlanes||o.setTransformMatrix(o.activeCamera.getViewMatrix(),o.activeCamera.getProjectionMatrix()),o._evaluateActiveMeshes(),o._activeMeshesFrozen=!0,o._skipEvaluateActiveMeshesCompletely=e;for(var s=0;s<o._activeMeshes.length;s++)o._activeMeshes.data[s]._freeze();i&&i()}),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var i=this.meshes[e];i._internalAbstractMeshDataInfo&&(i._internalAbstractMeshDataInfo._isActive=!1)}for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var e=this._activeMeshes.length,i=0;i<e;i++){var n=this._activeMeshes.data[i];n.computeWorldMatrix()}if(this._activeParticleSystems)for(var o=this._activeParticleSystems.length,i=0;i<o;i++)this._activeParticleSystems.data[i].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var s=0,a=this._beforeEvaluateActiveMeshStage;s<a.length;s++){var u=a[s];u.action()}for(var h=this.getActiveMeshCandidates(),f=h.length,i=0;i<f;i++){var n=h.data[i];if(n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!n.isBlocked&&(this._totalVertices.addCount(n.getTotalVertices(),!1),!(!n.isReady()||!n.isEnabled()||n.scaling.lengthSquared()===0))){n.computeWorldMatrix(),n.actionManager&&n.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(n);var l=this.customLODSelector?this.customLODSelector(n,this.activeCamera):n.getLOD(this.activeCamera);if(n._internalAbstractMeshDataInfo._currentLOD=l,n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,l!=null&&(l!==n&&l.billboardMode!==dt.BILLBOARDMODE_NONE&&l.computeWorldMatrix(),n._preActivate(),n.isVisible&&n.visibility>0&&(n.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||n.alwaysSelectAsActiveMesh||n.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(n),this.activeCamera._activeMeshes.push(n),l!==n&&l._activate(this._renderId,!1);for(var c=0,p=this._preActiveMeshStage;c<p.length;c++){var u=p[c];u.action(n)}n._activate(this._renderId,!1)&&(n.isAnInstance?n._internalAbstractMeshDataInfo._actAsRegularMesh&&(l=n):l._internalAbstractMeshDataInfo._onlyForInstances=!1,l._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(n,l)),n._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var d=0;d<this.particleSystems.length;d++){var v=this.particleSystems[d];if(!(!v.isStarted()||!v.emitter)){var y=v.emitter;(!y.position||y.isEnabled())&&(this._activeParticleSystems.push(v),v.animate(),this._renderingManager.dispatchParticles(v))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,i){if(this._skeletonsEnabled&&i.skeleton!==null&&i.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(i.skeleton)&&i.skeleton.prepare(),i.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(i)),i!=null&&i.subMeshes!==void 0&&i.subMeshes!==null&&i.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(i),o=n.length,s=0;s<o;s++){var a=n.data[s];this._evaluateSubMesh(a,i,e)}},t.prototype.updateTransformMatrix=function(e){!this.activeCamera||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget){var e=this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1;if(e)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var i=this.activeCamera.outputRenderTarget.getInternalTexture();i?this.getEngine().bindFramebuffer(i):z.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},t.prototype._renderForCamera=function(e,i){if(!(e&&e._skipRendering)){var n=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++;var o=this.getEngine().getCaps().multiview&&e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1;o?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var s=0;s<this._softwareSkinnedMeshes.length;s++){var a=this._softwareSkinnedMeshes.data[s];a.applySkeleton(a.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(i.customRenderTargets);for(var u=0,h=this._gatherActiveCameraRenderTargetsStage;u<h.length;u++){var f=h[u];f.action(this._renderTargets)}var l=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){K.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var c=0;c<this._renderTargets.length;c++){var p=this._renderTargets.data[c];if(p._shouldRender()){this._renderId++;var d=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(d,this.dumpNextRenderTargets),l=!0}}K.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var v=0,y=this._cameraDrawRenderTargetStage;v<y.length;v++){var f=y[v];l=f.action(this.activeCamera)||l}this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(l=!0)}l&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var b=0,m=this._beforeCameraDrawStage;b<m.length;b++){var f=m[b];f.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var M=0,R=this._afterCameraDrawStage;M<R.length;M++){var f=R[M];f.action(this.activeCamera)}if(this.postProcessManager&&!e._multiviewTexture){var D=e.outputRenderTarget?e.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,D)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e){if(e.cameraRigMode===V.RIG_MODE_NONE||e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview){this._renderForCamera(e),this.onAfterRenderCameraObservable.notifyObservers(e);return}if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var i=0;i<e._rigCameras.length;i++)this._renderForCamera(e._rigCameras[i],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var i=this._meshesForIntersections.data[e];if(!!i.actionManager)for(var n=0;i.actionManager&&n<i.actionManager.actions.length;n++){var o=i.actionManager.actions[n];if(o.trigger===12||o.trigger===13){var s=o.getTriggerParameter(),a=s instanceof le?s:s.mesh,u=a.intersectsMesh(i,s.usePreciseIntersection),h=i._intersectionsInProgress.indexOf(a);u&&h===-1?o.trigger===12?(o._executeCurrent(rt.CreateNew(i,void 0,a)),i._intersectionsInProgress.push(a)):o.trigger===13&&i._intersectionsInProgress.push(a):!u&&h>-1&&(o.trigger===13&&o._executeCurrent(rt.CreateNew(i,void 0,a)),(!i.actionManager.hasSpecificTrigger(13,function(f){var l=f instanceof le?f:f.mesh;return a===l})||o.trigger===13)&&i._intersectionsInProgress.splice(h,1))}}}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,i=this._engine.getTimeStep(),n=1e3/i/1e3,o=0,s=this._engine.getLockstepMaxSteps(),a=Math.floor(e/i);for(a=Math.min(a,s);e>0&&o<a;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,o++,e-=i;this._timeAccumulator=e<0?0:e}else{var e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=e*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}},t.prototype.render=function(e,i){if(e===void 0&&(e=!0),i===void 0&&(i=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),i||this.animate();for(var n=0,o=this._beforeCameraUpdateStage;n<o.length;n++){var s=o[n];s.action()}if(e){if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++){var u=this.activeCameras[a];if(u.update(),u.cameraRigMode!==V.RIG_MODE_NONE)for(var h=0;h<u._rigCameras.length;h++)u._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==V.RIG_MODE_NONE))for(var h=0;h<this.activeCamera._rigCameras.length;h++)this.activeCamera._rigCameras[h].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var f=this.getEngine(),l=this.activeCamera;if(this.renderTargetsEnabled){K.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var p=this.customRenderTargets[c];if(p._shouldRender()){if(this._renderId++,this.activeCamera=p.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");f.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),p.render(l!==this.activeCamera,this.dumpNextRenderTargets)}}K.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=l,this._activeCamera&&this._activeCamera.cameraRigMode!==V.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,v=this._beforeClearStage;d<v.length;d++){var s=v[d];s.action()}(this.autoClearDepthAndStencil||this.autoClear)&&!this.prePass&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var y=0,b=this._gatherRenderTargetsStage;y<b.length;y++){var s=b[y];s.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++)a>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[a]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var m=0,M=this._afterRenderStage;m<M.length;m++){var s=M[m];s.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var h=0;h<this._toBeDisposed.length;h++){var R=this._toBeDisposed[h];R&&R.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,gt._LastCreatedScene===this&&(gt._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,i=this._components;e<i.length;e++){var n=i[e];n.dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var o=0,s=this._activeRequests;o<s.length;o++){var a=s[o];a.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var u=this._engine.getInputElement();if(u){var h;for(h=0;h<this.cameras.length;h++)this.cameras[h].detachControl()}for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),h=this._engine.scenes.indexOf(this),h>-1&&this._engine.scenes.splice(h,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var i=this.meshes[e],n=i.geometry;if(n){n._indices=[];for(var o in n._vertexBuffers)!n._vertexBuffers.hasOwnProperty(o)||(n._vertexBuffers[o]._buffer._data=null)}}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,i=this.textures;e<i.length;e++){var n=i[e],o=n._buffer;o&&(n._buffer=null)}},t.prototype.getWorldExtends=function(e){var i=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new g(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(o){if(o.computeWorldMatrix(!0),!(!o.subMeshes||o.subMeshes.length===0||o.infiniteDistance)){var s=o.getBoundingInfo(),a=s.boundingBox.minimumWorld,u=s.boundingBox.maximumWorld;g.CheckExtends(a,i,n),g.CheckExtends(u,i,n)}}),{min:i,max:n}},t.prototype.createPickingRay=function(e,i,n,o,s){throw S.WarnImport("Ray")},t.prototype.createPickingRayToRef=function(e,i,n,o,s,a){throw S.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,i,n){throw S.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,i,n,o){throw S.WarnImport("Ray")},t.prototype.pick=function(e,i,n,o,s,a){var u=new be;return u._pickingUnavailable=!0,u},t.prototype.pickWithBoundingInfo=function(e,i,n,o,s){var a=new be;return a._pickingUnavailable=!0,a},t.prototype.pickWithRay=function(e,i,n,o){throw S.WarnImport("Ray")},t.prototype.multiPick=function(e,i,n,o,s){throw S.WarnImport("Ray")},t.prototype.multiPickWithRay=function(e,i,n){throw S.WarnImport("Ray")},t.prototype.setPointerOverMesh=function(e,i){this._inputManager.setPointerOverMesh(e,i)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,i=this.geometries;e<i.length;e++){var n=i[e];n._rebuild()}for(var o=0,s=this.meshes;o<s.length;o++){var a=s[o];a._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var u=0,h=this._components;u<h.length;u++){var f=h[u];f.rebuild()}for(var l=0,c=this.particleSystems;l<c.length;l++){var p=c[l];p.rebuild()}},t.prototype._rebuildTextures=function(){for(var e=0,i=this.textures;e<i.length;e++){var n=i[e];n._rebuild()}this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,i,n){if(i===void 0)return e;var o=[];n=n||function(u){};for(var s in e){var a=e[s];k&&k.MatchesQuery(a,i)&&(o.push(a),n(a))}return o},t.prototype.getMeshesByTags=function(e,i){return this._getByTags(this.meshes,e,i)},t.prototype.getCamerasByTags=function(e,i){return this._getByTags(this.cameras,e,i)},t.prototype.getLightsByTags=function(e,i){return this._getByTags(this.lights,e,i)},t.prototype.getMaterialByTags=function(e,i){return this._getByTags(this.materials,e,i).concat(this._getByTags(this.multiMaterials,e,i))},t.prototype.getTransformNodesByTags=function(e,i){return this._getByTags(this.transformNodes,e,i)},t.prototype.setRenderingOrder=function(e,i,n,o){i===void 0&&(i=null),n===void 0&&(n=null),o===void 0&&(o=null),this._renderingManager.setRenderingOrder(e,i,n,o)},t.prototype.setRenderingAutoClearDepthStencil=function(e,i,n,o){n===void 0&&(n=!0),o===void 0&&(o=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,i,n,o)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,i){if(!this._blockMaterialDirtyMechanism)for(var n=0,o=this.materials;n<o.length;n++){var s=o[n];i&&!i(s)||s.markAsDirty(e)}},t.prototype._loadFile=function(e,i,n,o,s,a){var u=this,h=H.LoadFile(e,i,n,o?this.offlineProvider:void 0,s,a);return this._activeRequests.push(h),h.onCompleteObservable.add(function(f){u._activeRequests.splice(u._activeRequests.indexOf(f),1)}),h},t.prototype._loadFileAsync=function(e,i,n,o){var s=this;return new Promise(function(a,u){s._loadFile(e,function(h){a(h)},i,n,o,function(h,f){u(f)})})},t.prototype._requestFile=function(e,i,n,o,s,a,u){var h=this,f=H.RequestFile(e,i,n,o?this.offlineProvider:void 0,s,a,u);return this._activeRequests.push(f),f.onCompleteObservable.add(function(l){h._activeRequests.splice(h._activeRequests.indexOf(l),1)}),f},t.prototype._requestFileAsync=function(e,i,n,o,s){var a=this;return new Promise(function(u,h){a._requestFile(e,function(f){u(f)},i,n,o,function(f){h(f)},s)})},t.prototype._readFile=function(e,i,n,o,s){var a=this,u=H.ReadFile(e,i,n,o,s);return this._activeRequests.push(u),u.onCompleteObservable.add(function(h){a._activeRequests.splice(a._activeRequests.indexOf(h),1)}),u},t.prototype._readFileAsync=function(e,i,n){var o=this;return new Promise(function(s,a){o._readFile(e,function(u){s(u)},i,n,function(u){a(u)})})},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(xi),Ke;(function(r){r[r.CW=0]="CW",r[r.CCW=1]="CCW"})(Ke||(Ke={}));var zi=function(){function r(){}return r.Interpolate=function(t,e,i,n,o){for(var s=1-3*n+3*e,a=3*n-6*e,u=3*e,h=t,f=0;f<5;f++){var l=h*h,c=l*h,p=s*c+a*l+u*h,d=1/(3*s*l+2*a*h+u);h-=(p-t)*d,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*o+Math.pow(h,3)},r}(),We=function(){function r(t,e){this.width=t,this.height=e}return r.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},r.prototype.getClassName=function(){return"Size"},r.prototype.getHashCode=function(){var t=this.width|0;return t=t*397^(this.height|0),t},r.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},r.prototype.copyFromFloats=function(t,e){return this.width=t,this.height=e,this},r.prototype.set=function(t,e){return this.copyFromFloats(t,e)},r.prototype.multiplyByFloats=function(t,e){return new r(this.width*t,this.height*e)},r.prototype.clone=function(){return new r(this.width,this.height)},r.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(r.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),r.Zero=function(){return new r(0,0)},r.prototype.add=function(t){var e=new r(this.width+t.width,this.height+t.height);return e},r.prototype.subtract=function(t){var e=new r(this.width-t.width,this.height-t.height);return e},r.Lerp=function(t,e,i){var n=t.width+(e.width-t.width)*i,o=t.height+(e.height-t.height)*i;return new r(n,o)},r}(),Ze=function(){function r(){}return Object.defineProperty(r,"ForceFullSceneLoadingForIncremental",{get:function(){return r._ForceFullSceneLoadingForIncremental},set:function(t){r._ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ShowLoadingScreen",{get:function(){return r._ShowLoadingScreen},set:function(t){r._ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"loggingLevel",{get:function(){return r._loggingLevel},set:function(t){r._loggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(r,"CleanBoneMatrixWeights",{get:function(){return r._CleanBoneMatrixWeights},set:function(t){r._CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),r._ForceFullSceneLoadingForIncremental=!1,r._ShowLoadingScreen=!0,r._CleanBoneMatrixWeights=!1,r._loggingLevel=0,r}(),St=function(){function r(t,e,i,n,o){n===void 0&&(n=!1),o===void 0&&(o=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=t,this.uniqueId=e.getUniqueId(),this._engine=e.getEngine(),this._meshes=[],this._scene=e,this._vertexBuffers={},this._indices=[],this._updatable=n,i?this.setAllVerticesData(i,n):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return Object.defineProperty(r.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(t){this._boundingBias?this._boundingBias.copyFrom(t):this._boundingBias=t.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),r.CreateGeometryForMesh=function(t){var e=new r(r.RandomId(),t.getScene());return e.applyToMesh(t),e},Object.defineProperty(r.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),r.prototype.getScene=function(){return this._scene},r.prototype.getEngine=function(){return this._engine},r.prototype.isReady=function(){return this.delayLoadState===1||this.delayLoadState===0},Object.defineProperty(r.prototype,"doNotSerialize",{get:function(){for(var t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),r.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var t in this._vertexBuffers){var e=this._vertexBuffers[t];e._rebuild()}},r.prototype.setAllVerticesData=function(t,e){t.applyToGeometry(this,e),this.notifyUpdate()},r.prototype.setVerticesData=function(t,e,i,n){i===void 0&&(i=!1),i&&Array.isArray(e)&&(e=new Float32Array(e));var o=new _(this._engine,e,t,i,this._meshes.length===0,n);this.setVerticesBuffer(o)},r.prototype.removeVerticesData=function(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t])},r.prototype.setVerticesBuffer=function(t,e){e===void 0&&(e=null);var i=t.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=t,i===_.PositionKind){var n=t.getData();e!=null?this._totalVertices=e:n!=null&&(this._totalVertices=n.length/(t.byteStride/4)),this._updateExtend(n),this._resetPointsArrayCache();for(var o=this._meshes,s=o.length,a=0;a<s;a++){var u=o[a];u._boundingInfo=new Tt(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(i),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},r.prototype.updateVerticesDataDirectly=function(t,e,i,n){n===void 0&&(n=!1);var o=this.getVertexBuffer(t);!o||(o.updateDirectly(e,i,n),this.notifyUpdate(t))},r.prototype.updateVerticesData=function(t,e,i){i===void 0&&(i=!1);var n=this.getVertexBuffer(t);!n||(n.update(e),t===_.PositionKind&&this._updateBoundingInfo(i,e),this.notifyUpdate(t))},r.prototype._updateBoundingInfo=function(t,e){if(t&&this._updateExtend(e),this._resetPointsArrayCache(),t)for(var i=this._meshes,n=0,o=i;n<o.length;n++){var s=o[n];s._boundingInfo?s._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):s._boundingInfo=new Tt(this._extend.minimum,this._extend.maximum);for(var a=s.subMeshes,u=0,h=a;u<h.length;u++){var f=h[u];f.refreshBoundingInfo()}}},r.prototype._bind=function(t,e){if(!!t){e===void 0&&(e=this._indexBuffer);var i=this.getVertexBuffers();if(!!i){if(e!=this._indexBuffer||!this._vertexArrayObjects){this._engine.bindBuffers(i,e,t);return}this._vertexArrayObjects[t.key]||(this._vertexArrayObjects[t.key]=this._engine.recordVertexArrayObject(i,e,t)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[t.key],e)}}},r.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},r.prototype.getVerticesData=function(t,e,i){var n=this.getVertexBuffer(t);if(!n)return null;var o=n.getData();if(!o)return null;var s=n.getSize()*_.GetTypeByteLength(n.type),a=this._totalVertices*n.getSize();if(n.type!==_.FLOAT||n.byteStride!==s){var u=[];return n.forEach(a,function(p){return u.push(p)}),u}if(!(o instanceof Array||o instanceof Float32Array)||n.byteOffset!==0||o.length!==a)if(o instanceof Array){var h=n.byteOffset/4;return K.Slice(o,h,h+a)}else{if(o instanceof ArrayBuffer)return new Float32Array(o,n.byteOffset,a);var h=o.byteOffset+n.byteOffset;if(i||e&&this._meshes.length!==1){var f=new Float32Array(a),l=new Float32Array(o.buffer,h,a);return f.set(l),f}var c=h%4;return c&&(h=Math.max(0,h-c)),new Float32Array(o.buffer,h,a)}return i||e&&this._meshes.length!==1?K.Slice(o):o},r.prototype.isVertexBufferUpdatable=function(t){var e=this._vertexBuffers[t];return e?e.isUpdatable():!1},r.prototype.getVertexBuffer=function(t){return this.isReady()?this._vertexBuffers[t]:null},r.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},r.prototype.isVerticesDataPresent=function(t){return this._vertexBuffers?this._vertexBuffers[t]!==void 0:this._delayInfo?this._delayInfo.indexOf(t)!==-1:!1},r.prototype.getVerticesDataKinds=function(){var t=[],e;if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},r.prototype.updateIndices=function(t,e,i){if(i===void 0&&(i=!1),!!this._indexBuffer)if(!this._indexBufferIsUpdatable)this.setIndices(t,null,!0);else{var n=t.length!==this._indices.length;if(i||(this._indices=t.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,e),n)for(var o=0,s=this._meshes;o<s.length;o++){var a=s[o];a._createGlobalSubMesh(!0)}}},r.prototype.setIndices=function(t,e,i){e===void 0&&(e=null),i===void 0&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=t,this._indexBufferIsUpdatable=i,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),e!=null&&(this._totalVertices=e);for(var n=0,o=this._meshes;n<o.length;n++){var s=o[n];s._createGlobalSubMesh(!0)}this.notifyUpdate()},r.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},r.prototype.getIndices=function(t,e){if(!this.isReady())return null;var i=this._indices;if(!e&&(!t||this._meshes.length===1))return i;for(var n=i.length,o=[],s=0;s<n;s++)o.push(i[s]);return o},r.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},r.prototype._releaseVertexArrayObject=function(t){t===void 0&&(t=null),!(!t||!this._vertexArrayObjects)&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])},r.prototype.releaseForMesh=function(t,e){var i=this._meshes,n=i.indexOf(t);n!==-1&&(i.splice(n,1),t._geometry=null,i.length===0&&e&&this.dispose())},r.prototype.applyToMesh=function(t){if(t._geometry!==this){var e=t._geometry;e&&e.releaseForMesh(t);var i=this._meshes;t._geometry=this,this._scene.pushGeometry(this),i.push(t),this.isReady()?this._applyToMesh(t):t._boundingInfo=this._boundingInfo}},r.prototype._updateExtend=function(t){t===void 0&&(t=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(t||(t=this.getVerticesData(_.PositionKind)),this._extend=Xe(t,0,this._totalVertices,this.boundingBias,3))},r.prototype._applyToMesh=function(t){var e=this._meshes.length;for(var i in this._vertexBuffers){e===1&&this._vertexBuffers[i].create();var n=this._vertexBuffers[i].getBuffer();n&&(n.references=e),i===_.PositionKind&&(this._extend||this._updateExtend(),t._boundingInfo=new Tt(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(!1),t._updateBoundingInfo())}e===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=e),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()},r.prototype.notifyUpdate=function(t){this.onGeometryUpdated&&this.onGeometryUpdated(this,t);for(var e=0,i=this._meshes;e<i.length;e++){var n=i[e];n._markSubMeshesAsAttributesDirty()}},r.prototype.load=function(t,e){if(this.delayLoadState!==2){if(this.isReady()){e&&e();return}this.delayLoadState=2,this._queueLoad(t,e)}},r.prototype._queueLoad=function(t,e){var i=this;!this.delayLoadingFile||(t._addPendingData(this),t._loadFile(this.delayLoadingFile,function(n){if(!!i._delayLoadingFunction){i._delayLoadingFunction(JSON.parse(n),i),i.delayLoadState=1,i._delayInfo=[],t._removePendingData(i);for(var o=i._meshes,s=o.length,a=0;a<s;a++)i._applyToMesh(o[a]);e&&e()}},void 0,!0))},r.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(t!=null&&t.length>0){for(var e=0;e<t.length;e+=3){var i=t[e+0];t[e+0]=t[e+2],t[e+2]=i}this.setIndices(t)}var n=this.getVerticesData(_.PositionKind,!1);if(n!=null&&n.length>0){for(var e=0;e<n.length;e+=3)n[e+2]=-n[e+2];this.setVerticesData(_.PositionKind,n,!1)}var o=this.getVerticesData(_.NormalKind,!1);if(o!=null&&o.length>0){for(var e=0;e<o.length;e+=3)o[e+2]=-o[e+2];this.setVerticesData(_.NormalKind,o,!1)}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){if(this._positions)return!0;var t=this.getVerticesData(_.PositionKind);if(!t||t.length===0)return!1;for(var e=this._positionsCache.length*3,i=this._positionsCache.length;e<t.length;e+=3,++i)this._positionsCache[i]=g.FromArray(t,e);for(var e=0,i=0;e<t.length;e+=3,++i)this._positionsCache[i].set(t[0+e],t[1+e],t[2+e]);return this._positionsCache.length=t.length/3,this._positions=this._positionsCache,!0},r.prototype.isDisposed=function(){return this._isDisposed},r.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var t in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t]);this._vertexArrayObjects={}}},r.prototype.dispose=function(){var t=this._meshes,e=t.length,i;for(i=0;i<e;i++)this.releaseForMesh(t[i]);this._meshes=[],this._disposeVertexArrayObjects();for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},r.prototype.copy=function(t){var e=new tt;e.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)e.indices.push(i[n]);var o=!1,s=!1,a;for(a in this._vertexBuffers){var u=this.getVerticesData(a);if(u&&(u instanceof Float32Array?e.set(new Float32Array(u),a):e.set(u.slice(0),a),!s)){var h=this.getVertexBuffer(a);h&&(o=h.isUpdatable(),s=!o)}}var f=new r(t,this._scene,e,o);f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction;for(a in this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(a);return f._boundingInfo=new Tt(this._extend.minimum,this._extend.maximum),f},r.prototype.serialize=function(){var t={};return t.id=this.id,t.updatable=this._updatable,k&&k.HasTags(this)&&(t.tags=k.GetTags(this)),t},r.prototype.toNumberArray=function(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)},r.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(_.PositionKind)&&(t.positions=this.toNumberArray(this.getVerticesData(_.PositionKind)),this.isVertexBufferUpdatable(_.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(_.NormalKind)&&(t.normals=this.toNumberArray(this.getVerticesData(_.NormalKind)),this.isVertexBufferUpdatable(_.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(_.TangentKind)&&(t.tangets=this.toNumberArray(this.getVerticesData(_.TangentKind)),this.isVertexBufferUpdatable(_.TangentKind)&&(t.tangets._updatable=!0)),this.isVerticesDataPresent(_.UVKind)&&(t.uvs=this.toNumberArray(this.getVerticesData(_.UVKind)),this.isVertexBufferUpdatable(_.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(_.UV2Kind)&&(t.uv2s=this.toNumberArray(this.getVerticesData(_.UV2Kind)),this.isVertexBufferUpdatable(_.UV2Kind)&&(t.uv2s._updatable=!0)),this.isVerticesDataPresent(_.UV3Kind)&&(t.uv3s=this.toNumberArray(this.getVerticesData(_.UV3Kind)),this.isVertexBufferUpdatable(_.UV3Kind)&&(t.uv3s._updatable=!0)),this.isVerticesDataPresent(_.UV4Kind)&&(t.uv4s=this.toNumberArray(this.getVerticesData(_.UV4Kind)),this.isVertexBufferUpdatable(_.UV4Kind)&&(t.uv4s._updatable=!0)),this.isVerticesDataPresent(_.UV5Kind)&&(t.uv5s=this.toNumberArray(this.getVerticesData(_.UV5Kind)),this.isVertexBufferUpdatable(_.UV5Kind)&&(t.uv5s._updatable=!0)),this.isVerticesDataPresent(_.UV6Kind)&&(t.uv6s=this.toNumberArray(this.getVerticesData(_.UV6Kind)),this.isVertexBufferUpdatable(_.UV6Kind)&&(t.uv6s._updatable=!0)),this.isVerticesDataPresent(_.ColorKind)&&(t.colors=this.toNumberArray(this.getVerticesData(_.ColorKind)),this.isVertexBufferUpdatable(_.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(_.MatricesIndicesKind)&&(t.matricesIndices=this.toNumberArray(this.getVerticesData(_.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(_.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(_.MatricesWeightsKind)&&(t.matricesWeights=this.toNumberArray(this.getVerticesData(_.MatricesWeightsKind)),this.isVertexBufferUpdatable(_.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this.toNumberArray(this.getIndices()),t},r.ExtractFromMesh=function(t,e){var i=t._geometry;return i?i.copy(e):null},r.RandomId=function(){return K.RandomId()},r._ImportGeometry=function(t,e){var i=e.getScene(),n=t.geometryId;if(n){var o=i.getGeometryByID(n);o&&o.applyToMesh(e)}else if(t instanceof ArrayBuffer){var s=e._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){var a=new Float32Array(t,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);e.setVerticesData(_.PositionKind,a,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){var u=new Float32Array(t,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);e.setVerticesData(_.NormalKind,u,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){var h=new Float32Array(t,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);e.setVerticesData(_.TangentKind,h,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){var f=new Float32Array(t,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);e.setVerticesData(_.UVKind,f,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){var l=new Float32Array(t,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);e.setVerticesData(_.UV2Kind,l,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){var c=new Float32Array(t,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);e.setVerticesData(_.UV3Kind,c,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){var p=new Float32Array(t,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);e.setVerticesData(_.UV4Kind,p,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){var d=new Float32Array(t,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);e.setVerticesData(_.UV5Kind,d,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){var v=new Float32Array(t,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);e.setVerticesData(_.UV6Kind,v,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){var y=new Float32Array(t,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);e.setVerticesData(_.ColorKind,y,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){for(var b=new Int32Array(t,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),m=[],M=0;M<b.length;M++){var R=b[M];m.push(R&255),m.push((R&65280)>>8),m.push((R&16711680)>>16),m.push(R>>24&255)}e.setVerticesData(_.MatricesIndicesKind,m,!1)}if(s.matricesIndicesExtraAttrDesc&&s.matricesIndicesExtraAttrDesc.count>0){for(var b=new Int32Array(t,s.matricesIndicesExtraAttrDesc.offset,s.matricesIndicesExtraAttrDesc.count),m=[],M=0;M<b.length;M++){var R=b[M];m.push(R&255),m.push((R&65280)>>8),m.push((R&16711680)>>16),m.push(R>>24&255)}e.setVerticesData(_.MatricesIndicesExtraKind,m,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){var D=new Float32Array(t,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);e.setVerticesData(_.MatricesWeightsKind,D,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){var I=new Int32Array(t,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);e.setIndices(I,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){var A=new Int32Array(t,s.subMeshesAttrDesc.offset,s.subMeshesAttrDesc.count*5);e.subMeshes=[];for(var M=0;M<s.subMeshesAttrDesc.count;M++){var x=A[M*5+0],W=A[M*5+1],q=A[M*5+2],Q=A[M*5+3],st=A[M*5+4];xt.AddToMesh(x,W,q,Q,st,e)}}}else if(t.positions&&t.normals&&t.indices){if(e.setVerticesData(_.PositionKind,t.positions,t.positions._updatable),e.setVerticesData(_.NormalKind,t.normals,t.normals._updatable),t.tangents&&e.setVerticesData(_.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&e.setVerticesData(_.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&e.setVerticesData(_.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&e.setVerticesData(_.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&e.setVerticesData(_.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&e.setVerticesData(_.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&e.setVerticesData(_.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&e.setVerticesData(_.ColorKind,J.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(_.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(var m=[],M=0;M<t.matricesIndices.length;M++){var Y=t.matricesIndices[M];m.push(Y&255),m.push((Y&65280)>>8),m.push((Y&16711680)>>16),m.push(Y>>24&255)}e.setVerticesData(_.MatricesIndicesKind,m,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(_.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(var m=[],M=0;M<t.matricesIndicesExtra.length;M++){var Y=t.matricesIndicesExtra[M];m.push(Y&255),m.push((Y&65280)>>8),m.push((Y&16711680)>>16),m.push(Y>>24&255)}e.setVerticesData(_.MatricesIndicesExtraKind,m,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(r._CleanMatricesWeights(t,e),e.setVerticesData(_.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&e.setVerticesData(_.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),e.setIndices(t.indices,null)}if(t.subMeshes){e.subMeshes=[];for(var F=0;F<t.subMeshes.length;F++){var $=t.subMeshes[F];xt.AddToMesh($.materialIndex,$.verticesStart,$.verticesCount,$.indexStart,$.indexCount,e)}}e._shouldGenerateFlatShading&&(e.convertToFlatShadedMesh(),e._shouldGenerateFlatShading=!1),e.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(e)},r._CleanMatricesWeights=function(t,e){var i=.001;if(!!Ze.CleanBoneMatrixWeights){var n=0;if(t.skeletonId>-1){var o=e.getScene().getLastSkeletonByID(t.skeletonId);if(!o)return;n=o.bones.length}else return;for(var s=e.getVerticesData(_.MatricesIndicesKind),a=e.getVerticesData(_.MatricesIndicesExtraKind),u=t.matricesWeights,h=t.matricesWeightsExtra,f=t.numBoneInfluencer,l=u.length,c=0;c<l;c+=4){for(var p=0,d=-1,v=0;v<4;v++){var y=u[c+v];p+=y,y<i&&d<0&&(d=v)}if(h)for(var v=0;v<4;v++){var y=h[c+v];p+=y,y<i&&d<0&&(d=v+4)}if((d<0||d>f-1)&&(d=f-1),p>i){for(var b=1/p,v=0;v<4;v++)u[c+v]*=b;if(h)for(var v=0;v<4;v++)h[c+v]*=b}else d>=4?(h[c+d-4]=1-p,a[c+d-4]=n):(u[c+d]=1-p,s[c+d]=n)}e.setVerticesData(_.MatricesIndicesKind,s),t.matricesWeightsExtra&&e.setVerticesData(_.MatricesIndicesExtraKind,a)}},r.Parse=function(t,e,i){if(e.getGeometryByID(t.id))return null;var n=new r(t.id,e,void 0,t.updatable);return k&&k.AddTagsTo(n,t.tags),t.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+t.delayLoadingFile,n._boundingInfo=new Tt(g.FromArray(t.boundingBoxMinimum),g.FromArray(t.boundingBoxMaximum)),n._delayInfo=[],t.hasUVs&&n._delayInfo.push(_.UVKind),t.hasUVs2&&n._delayInfo.push(_.UV2Kind),t.hasUVs3&&n._delayInfo.push(_.UV3Kind),t.hasUVs4&&n._delayInfo.push(_.UV4Kind),t.hasUVs5&&n._delayInfo.push(_.UV5Kind),t.hasUVs6&&n._delayInfo.push(_.UV6Kind),t.hasColors&&n._delayInfo.push(_.ColorKind),t.hasMatricesIndices&&n._delayInfo.push(_.MatricesIndicesKind),t.hasMatricesWeights&&n._delayInfo.push(_.MatricesWeightsKind),n._delayLoadingFunction=tt.ImportVertexData):tt.ImportVertexData(t,n),e.pushGeometry(n,!0),n},r}(),Te=function(r){U(t,r);function t(e,i){var n=r.call(this,e,i,!0)||this;return i.multiMaterials.push(n),n.subMaterials=new Array,n._storeEffectOnSubMeshes=!0,n}return Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!1,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(e){var i=this,n=e.push;e.push=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var u=n.apply(e,s);return i._markAllSubMeshesAsTexturesDirty(),u};var o=e.splice;e.splice=function(s,a){var u=o.apply(e,[s,a]);return i._markAllSubMeshesAsTexturesDirty(),u}},t.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.getActiveTextures=function(){var e;return(e=r.prototype.getActiveTextures.call(this)).concat.apply(e,this.subMaterials.map(function(i){return i?i.getActiveTextures():[]}))},t.prototype.hasTexture=function(e){var i;if(r.prototype.hasTexture.call(this,e))return!0;for(var n=0;n<this.subMaterials.length;n++)if((i=this.subMaterials[n])===null||i===void 0?void 0:i.hasTexture(e))return!0;return!1},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(e,i,n){for(var o=0;o<this.subMaterials.length;o++){var s=this.subMaterials[o];if(s){if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(e,i,n))return!1;continue}if(!s.isReady(e))return!1}}return!0},t.prototype.clone=function(e,i){for(var n=new t(e,this.getScene()),o=0;o<this.subMaterials.length;o++){var s=null,a=this.subMaterials[o];i&&a?s=a.clone(e+"-"+a.name):s=this.subMaterials[o],n.subMaterials.push(s)}return n},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,k&&(e.tags=k.GetTags(this)),e.materials=[];for(var i=0;i<this.subMaterials.length;i++){var n=this.subMaterials[i];n?e.materials.push(n.id):e.materials.push(null)}return e},t.prototype.dispose=function(e,i,n){var o=this.getScene();if(!!o){if(n)for(var a=0;a<this.subMaterials.length;a++){var s=this.subMaterials[a];s&&s.dispose(e,i)}var a=o.multiMaterials.indexOf(this);a>=0&&o.multiMaterials.splice(a,1),r.prototype.dispose.call(this,e,i)}},t.ParseMultiMaterial=function(e,i){var n=new t(e.name,i);n.id=e.id,k&&k.AddTagsTo(n,e.tags);for(var o=0;o<e.materials.length;o++){var s=e.materials[o];s?n.subMaterials.push(i.getLastMaterialByID(s)):n.subMaterials.push(null)}return n},t}(lt);nt.RegisteredTypes["BABYLON.MultiMaterial"]=Te;var Ki=function(){function r(t,e){this.distance=t,this.mesh=e}return r}(),Wi=function(){function r(){this.visibleInstances={},this.batchCache=new ji,this.instancesBufferSize=32*16*4}return r}(),ji=function(){function r(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array}return r}(),Gi=function(){function r(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=32*16,this.boundingVectors=[],this.worldMatrices=null}return r}(),Yi=function(){function r(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null}return r}(),he=function(r){U(t,r);function t(e,i,n,o,s,a){i===void 0&&(i=null),n===void 0&&(n=null),o===void 0&&(o=null),a===void 0&&(a=!0);var u=r.call(this,e,i)||this;if(u._internalMeshDataInfo=new Yi,u.delayLoadState=0,u.instances=new Array,u._creationDataStorage=null,u._geometry=null,u._instanceDataStorage=new Wi,u._thinInstanceDataStorage=new Gi,u._effectiveMaterial=null,u._shouldGenerateFlatShading=!1,u._originalBuilderSideOrientation=t.DEFAULTSIDE,u.overrideMaterialSideOrientation=null,i=u.getScene(),o){if(o._geometry&&o._geometry.applyToMesh(u),He.DeepCopy(o,u,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),u._internalMeshDataInfo._source=o,i.useClonedMeshMap&&(o._internalMeshDataInfo.meshMap||(o._internalMeshDataInfo.meshMap={}),o._internalMeshDataInfo.meshMap[u.uniqueId]=u),u._originalBuilderSideOrientation=o._originalBuilderSideOrientation,u._creationDataStorage=o._creationDataStorage,o._ranges){var h=o._ranges;for(var e in h)!h.hasOwnProperty(e)||!h[e]||u.createAnimationRange(e,h[e].from,h[e].to)}o.metadata&&o.metadata.clone?u.metadata=o.metadata.clone():u.metadata=o.metadata,k&&k.HasTags(o)&&k.AddTagsTo(u,k.GetTags(o,!0)),u.setEnabled(o.isEnabled()),u.parent=o.parent,u.setPivotMatrix(o.getPivotMatrix()),u.id=e+"."+o.id,u.material=o.material;var f;if(!s)for(var l=o.getDescendants(!0),c=0;c<l.length;c++){var p=l[c];p.clone&&p.clone(e+"."+p.name,u)}if(o.morphTargetManager&&(u.morphTargetManager=o.morphTargetManager),i.getPhysicsEngine){var d=i.getPhysicsEngine();if(a&&d){var v=d.getImpostorForPhysicsObject(o);v&&(u.physicsImpostor=v.clone(u))}}for(f=0;f<i.particleSystems.length;f++){var y=i.particleSystems[f];y.emitter===o&&y.clone(y.name,u)}u.refreshBoundingInfo(),u.computeWorldMatrix(!0)}return n!==null&&(u.parent=n),u._instanceDataStorage.hardwareInstancedRendering=u.getEngine().getCaps().instancedArrays,u}return t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(_.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(_.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new E),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new E),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new E),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new E),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){var e;return((e=this._thinInstanceDataStorage.instancesCount)!==null&&e!==void 0?e:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(e){this._internalMeshDataInfo._morphTargetManager!==e&&(this._internalMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!1,configurable:!0}),t.prototype.instantiateHierarchy=function(e,i,n){e===void 0&&(e=null);var o=this.getTotalVertices()>0&&(!i||!i.doNotInstantiate)?this.createInstance("instance of "+(this.name||this.id)):this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);o&&(o.parent=e||this.parent,o.position=this.position.clone(),o.scaling=this.scaling.clone(),this.rotationQuaternion?o.rotationQuaternion=this.rotationQuaternion.clone():o.rotation=this.rotation.clone(),n&&n(this,o));for(var s=0,a=this.getChildTransformNodes(!0);s<a.length;s++){var u=a[s];u.instantiateHierarchy(o,i,n)}return o},t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(e){var i=r.prototype.toString.call(this,e);if(i+=", n vertices: "+this.getTotalVertices(),i+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(e);if(e)if(this._geometry){var o=this.getIndices(),s=this.getVerticesData(_.PositionKind);s&&o&&(i+=", flat shading: "+(s.length/3===o.length?"YES":"NO"))}else i+=", flat shading: UNKNOWN";return i},t.prototype._unBindEffect=function(){r.prototype._unBindEffect.call(this);for(var e=0,i=this.instances;e<i.length;e++){var n=i[e];n._unBindEffect()}},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(e,i){return e.distance<i.distance?1:e.distance>i.distance?-1:0})},t.prototype.addLODLevel=function(e,i){if(i&&i._masterMesh)return z.Warn("You cannot use a mesh as LOD level twice"),this;var n=new Ki(e,i);return this._internalMeshDataInfo._LODLevels.push(n),i&&(i._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var i=this._internalMeshDataInfo,n=0;n<i._LODLevels.length;n++){var o=i._LODLevels[n];if(o.distance===e)return o.mesh}return null},t.prototype.removeLODLevel=function(e){for(var i=this._internalMeshDataInfo,n=0;n<i._LODLevels.length;n++)i._LODLevels[n].mesh===e&&(i._LODLevels.splice(n,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,i){var n=this._internalMeshDataInfo;if(!n._LODLevels||n._LODLevels.length===0)return this;var o;if(i)o=i;else{var s=this.getBoundingInfo();o=s.boundingSphere}var a=o.centerWorld.subtract(e.globalPosition).length();if(n._LODLevels[n._LODLevels.length-1].distance>a)return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this;for(var u=0;u<n._LODLevels.length;u++){var h=n._LODLevels[u];if(h.distance<a){if(h.mesh){if(h.mesh.delayLoadState===4)return h.mesh._checkDelayState(),this;if(h.mesh.delayLoadState===2)return this;h.mesh._preActivate(),h.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,h.mesh),h.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(a,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,i,n){return this._geometry?this._geometry.getVerticesData(e,i,n):null},t.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1},t.prototype.isVertexBufferUpdatable=function(e){return this._geometry?this._geometry.isVertexBufferUpdatable(e):this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach(function(i){e.push(i)}),e}return this._geometry.getVerticesDataKinds()},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,i){return this._geometry?this._geometry.getIndices(e,i):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),t.prototype.isReady=function(e,i){var n,o,s,a,u,h;if(e===void 0&&(e=!1),i===void 0&&(i=!1),this.delayLoadState===2||!r.prototype.isReady.call(this,e))return!1;if(!this.subMeshes||this.subMeshes.length===0||!e)return!0;var f=this.getEngine(),l=this.getScene(),c=i||f.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var p=this.material||l.defaultMaterial;if(p){if(p._storeEffectOnSubMeshes)for(var d=0,v=this.subMeshes;d<v.length;d++){var y=v[d],b=y.getMaterial();if(b){if(b._storeEffectOnSubMeshes){if(!b.isReadyForSubMesh(this,y,c))return!1}else if(!b.isReady(this,c))return!1}}else if(!p.isReady(this,c))return!1}for(var m=0,M=this.lightSources;m<M.length;m++){var R=M[m],D=R.getShadowGenerator();if(D&&(!((n=D.getShadowMap())===null||n===void 0?void 0:n.renderList)||((o=D.getShadowMap())===null||o===void 0?void 0:o.renderList)&&((a=(s=D.getShadowMap())===null||s===void 0?void 0:s.renderList)===null||a===void 0?void 0:a.indexOf(this))!==-1))for(var I=0,A=this.subMeshes;I<A.length;I++){var y=A[I];if(!D.isReady(y,c,(h=(u=y.getMaterial())===null||u===void 0?void 0:u.needAlphaBlendingForMesh(this))!==null&&h!==void 0?h:!1))return!1}}for(var x=0,W=this._internalMeshDataInfo._LODLevels;x<W.length;x++){var q=W[x];if(q.mesh&&!q.mesh.isReady(c))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,i=this.getScene().getRenderId();return e._preActivateId===i?this:(e._preActivateId=i,this._instanceDataStorage.visibleInstances=null,this)},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,i){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:i,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[i]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=i,this._instanceDataStorage.visibleInstances[i]=new Array),this._instanceDataStorage.visibleInstances[i].push(e),this},t.prototype._afterComputeWorldMatrix=function(){r.prototype._afterComputeWorldMatrix.call(this),!!this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},t.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},t.prototype.refreshBoundingInfo=function(e){if(e===void 0&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var i=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e),i),this},t.prototype._createGlobalSubMesh=function(e){var i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var n=this.getIndices();if(!n)return null;var o=n.length,s=!1;if(e)s=!0;else for(var a=0,u=this.subMeshes;a<u.length;a++){var h=u[a];if(h.indexStart+h.indexCount>o){s=!0;break}if(h.verticesStart+h.verticesCount>i){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new xt(0,0,i,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var i=this.getTotalIndices(),n=i/e|0,o=0;n%3!==0;)n++;this.releaseSubMeshes();for(var s=0;s<e&&!(o>=i);s++)xt.CreateFromIndices(0,o,s===e-1?i-o:n,this),o+=n;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,i,n,o){if(n===void 0&&(n=!1),this._geometry)this._geometry.setVerticesData(e,i,n,o);else{var s=new tt;s.set(i,e);var a=this.getScene();new St(St.RandomId(),a,s,n,this)}return this},t.prototype.removeVerticesData=function(e){!this._geometry||this._geometry.removeVerticesData(e)},t.prototype.markVerticesDataAsUpdatable=function(e,i){i===void 0&&(i=!0);var n=this.getVertexBuffer(e);!n||n.isUpdatable()===i||this.setVerticesData(e,this.getVerticesData(e),i)},t.prototype.setVerticesBuffer=function(e){return this._geometry||(this._geometry=St.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e),this},t.prototype.updateVerticesData=function(e,i,n,o){return this._geometry?(o?(this.makeGeometryUnique(),this.updateVerticesData(e,i,n,!1)):this._geometry.updateVerticesData(e,i,n),this):this},t.prototype.updateMeshPositions=function(e,i){i===void 0&&(i=!0);var n=this.getVerticesData(_.PositionKind);if(!n)return this;if(e(n),this.updateVerticesData(_.PositionKind,n,!1,!1),i){var o=this.getIndices(),s=this.getVerticesData(_.NormalKind);if(!s)return this;tt.ComputeNormals(n,o,s),this.updateVerticesData(_.NormalKind,s,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var e=this._geometry,i=this._geometry.copy(St.RandomId());return e.releaseForMesh(this,!0),i.applyToMesh(this),this},t.prototype.setIndices=function(e,i,n){if(i===void 0&&(i=null),n===void 0&&(n=!1),this._geometry)this._geometry.setIndices(e,i,n);else{var o=new tt;o.indices=e;var s=this.getScene();new St(St.RandomId(),s,o,n,this)}return this},t.prototype.updateIndices=function(e,i,n){return n===void 0&&(n=!1),this._geometry?(this._geometry.updateIndices(e,i,n),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,i,n){if(!this._geometry)return this;var o=this.getScene().getEngine(),s;if(this._unIndexed)s=null;else switch(n){case lt.PointFillMode:s=null;break;case lt.WireFrameFillMode:s=e._getLinesIndexBuffer(this.getIndices(),o);break;default:case lt.TriangleFillMode:s=this._geometry.getIndexBuffer();break}return this._geometry._bind(i,s),this},t.prototype._draw=function(e,i,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var o=this.getScene(),s=o.getEngine();return this._unIndexed||i==lt.PointFillMode?s.drawArraysType(i,e.verticesStart,e.verticesCount,n):i==lt.WireFrameFillMode?s.drawElementsType(i,0,e._linesIndexCount,n):s.drawElementsType(i,e.indexStart,e.indexCount,n),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e,i){if(i===void 0&&(i=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var n=this.getScene(),o=n._isInIntermediateRendering(),s=o?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,a=this._instanceDataStorage.batchCache;if(a.mustReturn=!1,a.renderSelf[e]=i||!s&&this.isEnabled()&&this.isVisible,a.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!i){var u=this._instanceDataStorage.visibleInstances,h=n.getRenderId(),f=o?u.intermediateDefaultRenderId:u.defaultRenderId;a.visibleInstances[e]=u[h],!a.visibleInstances[e]&&f&&(a.visibleInstances[e]=u[f])}return a.hardwareInstancedRendering[e]=!i&&this._instanceDataStorage.hardwareInstancedRendering&&a.visibleInstances[e]!==null&&a.visibleInstances[e]!==void 0,this._instanceDataStorage.previousBatch=a,a},t.prototype._renderWithInstances=function(e,i,n,o,s){var a=n.visibleInstances[e._id];if(!a)return this;for(var u=this._instanceDataStorage,h=u.instancesBufferSize,f=u.instancesBuffer,l=a.length+1,c=l*16*4;u.instancesBufferSize<c;)u.instancesBufferSize*=2;(!u.instancesData||h!=u.instancesBufferSize)&&(u.instancesData=new Float32Array(u.instancesBufferSize/4));var p=0,d=0,v=n.renderSelf[e._id],y=!f||h!==u.instancesBufferSize;if(!this._instanceDataStorage.manualUpdate&&(!u.isFrozen||y)){var b=this._effectiveMesh.getWorldMatrix();if(v&&(b.copyToArray(u.instancesData,p),p+=16,d++),a)for(var m=0;m<a.length;m++){var M=a[m];M.getWorldMatrix().copyToArray(u.instancesData,p),p+=16,d++}}else d=(v?1:0)+a.length;return y?(f&&f.dispose(),f=new me(s,u.instancesData,!0,16,!1,!0),u.instancesBuffer=f,this.setVerticesBuffer(f.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(f.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(f.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(f.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||f.updateDirectly(u.instancesData,0,d),this._processInstancedBuffers(a,v),this.getScene()._activeIndices.addCount(e.indexCount*d,!1),this._bind(e,o,i),this._draw(e,i,d),s.unbindInstanceAttributes(),this},t.prototype._renderWithThinInstances=function(e,i,n,o){var s,a,u=(a=(s=this._thinInstanceDataStorage)===null||s===void 0?void 0:s.instancesCount)!==null&&a!==void 0?a:0;this.getScene()._activeIndices.addCount(e.indexCount*u,!1),this._bind(e,n,i),this._draw(e,i,u),o.unbindInstanceAttributes()},t.prototype._processInstancedBuffers=function(e,i){},t.prototype._processRendering=function(e,i,n,o,s,a,u,h){var f=this.getScene(),l=f.getEngine();if(a&&i.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(i,o,n,l),this;if(a)this._renderWithInstances(i,o,s,n,l);else{var c=0;s.renderSelf[i._id]&&(u&&u(!1,e._effectiveMesh.getWorldMatrix(),h),c++,this._draw(i,o,this._instanceDataStorage.overridenInstanceCount));var p=s.visibleInstances[i._id];if(p){var d=p.length;c+=d;for(var v=0;v<d;v++){var y=p[v],b=y.getWorldMatrix();u&&u(!0,b,h),this._draw(i,o)}}f._activeIndices.addCount(i.indexCount*c,!1)}return this},t.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),r.prototype._rebuild.call(this)},t.prototype._freeze=function(){if(!!this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},t.prototype.render=function(e,i,n){var o=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var s=this._getInstancesRenderList(e._id,!!n);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var a=o.getEngine(),u=s.hardwareInstancedRendering[e._id]||e.getRenderingMesh().hasThinInstances,h=this._instanceDataStorage,f=e.getMaterial();if(!f)return this;if(!h.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==f){if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,e,u))return this}else if(!f.isReady(this,u))return this;this._effectiveMaterial=f}i&&a.setAlphaMode(this._effectiveMaterial.alphaMode);var l;this._effectiveMaterial._storeEffectOnSubMeshes?l=e.effect:l=this._effectiveMaterial.getEffect();for(var c=0,p=o._beforeRenderingMeshStage;c<p.length;c++){var d=p[c];d.action(this,e,s,l)}if(!l)return this;var v=n||this._effectiveMesh,y;if(!h.isFrozen&&(this._effectiveMaterial.backFaceCulling||this.overrideMaterialSideOrientation!==null)){var b=v._getWorldMatrixDeterminant();y=this.overrideMaterialSideOrientation,y==null&&(y=this._effectiveMaterial.sideOrientation),b<0&&(y=y===lt.ClockWiseSideOrientation?lt.CounterClockWiseSideOrientation:lt.ClockWiseSideOrientation),h.sideOrientation=y}else y=h.sideOrientation;var m=this._effectiveMaterial._preBind(l,y);this._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);var M=o.forcePointsCloud?lt.PointFillMode:o.forceWireframe?lt.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),u||this._bind(e,l,M);var R=v.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(R,this,e):this._effectiveMaterial.bind(R,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(a.setState(!0,this._effectiveMaterial.zOffset,!1,!m),this._processRendering(this,e,l,M,s,u,this._onBeforeDraw,this._effectiveMaterial),a.setState(!0,this._effectiveMaterial.zOffset,!1,m)),this._processRendering(this,e,l,M,s,u,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var D=0,I=o._afterRenderingMeshStage;D<I.length;D++){var d=I[D];d.action(this,e,s,l)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},t.prototype._onBeforeDraw=function(e,i,n){e&&n&&n.bindOnlyWorldMatrix(i)},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(_.MatricesWeightsKind)&&(this.isVerticesDataPresent(_.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},t.prototype.normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(_.MatricesWeightsKind),i=e.length,n=0;n<i;n+=4){var o=e[n]+e[n+1]+e[n+2]+e[n+3];if(o===0)e[n]=1;else{var s=1/o;e[n]*=s,e[n+1]*=s,e[n+2]*=s,e[n+3]*=s}}this.setVerticesData(_.MatricesWeightsKind,e)},t.prototype.normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(_.MatricesWeightsExtraKind),i=this.getVerticesData(_.MatricesWeightsKind),n=i.length,o=0;o<n;o+=4){var s=i[o]+i[o+1]+i[o+2]+i[o+3];if(s+=e[o]+e[o+1]+e[o+2]+e[o+3],s===0)i[o]=1;else{var a=1/s;i[o]*=a,i[o+1]*=a,i[o+2]*=a,i[o+3]*=a,e[o]*=a,e[o+1]*=a,e[o+2]*=a,e[o+3]*=a}}this.setVerticesData(_.MatricesWeightsKind,i),this.setVerticesData(_.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(_.MatricesWeightsExtraKind),i=this.getVerticesData(_.MatricesWeightsKind);if(i===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var n=i.length,o=0,s=0,a=0,u=0,h=e===null?4:8,f=new Array,l=0;l<=h;l++)f[l]=0;for(var c=.001,l=0;l<n;l+=4){for(var p=i[l],d=p,v=d===0?0:1,y=1;y<h;y++){var b=y<4?i[l+y]:e[l+y-4];b>p&&o++,b!==0&&v++,d+=b,p=b}if(f[v]++,v>a&&(a=v),d===0)s++;else{var m=1/d,M=0;for(y=0;y<h;y++)y<4?M+=Math.abs(i[l+y]-i[l+y]*m):M+=Math.abs(e[l+y-4]-e[l+y-4]*m);M>c&&u++}}for(var R=this.skeleton.bones.length,D=this.getVerticesData(_.MatricesIndicesKind),I=this.getVerticesData(_.MatricesIndicesExtraKind),A=0,l=0;l<n;l+=4)for(var y=0;y<h;y++){var x=y<4?D[l+y]:I[l+y-4];(x>=R||x<0)&&A++}var W="Number of Weights = "+n/4+`
Maximum influences = `+a+`
Missing Weights = `+s+`
Not Sorted = `+o+`
Not Normalized = `+u+`
WeightCounts = [`+f+`]
Number of bones = `+R+`
Bad Bone Indices = `+A;return{skinned:!0,valid:s===0&&u===0&&A===0,report:W}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):this.delayLoadState===4&&(this.delayLoadState=2,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var i=this;e._addPendingData(this);var n=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return K.LoadFile(this.delayLoadingFile,function(o){o instanceof ArrayBuffer?i._delayLoadingFunction(o,i):i._delayLoadingFunction(JSON.parse(o),i),i.instances.forEach(function(s){s.refreshBoundingInfo(),s._syncSubMeshes()}),i.delayLoadState=1,e._removePendingData(i)},function(){},e.offlineProvider,n),this},t.prototype.isInFrustum=function(e){return this.delayLoadState===2||!r.prototype.isInFrustum.call(this,e)?!1:(this._checkDelayState(),!0)},t.prototype.setMaterialByID=function(e){var i=this.getScene().materials,n;for(n=i.length-1;n>-1;n--)if(i[n].id===e)return this.material=i[n],this;var o=this.getScene().multiMaterials;for(n=o.length-1;n>-1;n--)if(o[n].id===e)return this.material=o[n],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(_.PositionKind))return this;var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var n=this.getVerticesData(_.PositionKind),o=new Array,s;for(s=0;s<n.length;s+=3)g.TransformCoordinates(g.FromArray(n,s),e).toArray(o,s);if(this.setVerticesData(_.PositionKind,o,this.getVertexBuffer(_.PositionKind).isUpdatable()),this.isVerticesDataPresent(_.NormalKind)){for(n=this.getVerticesData(_.NormalKind),o=[],s=0;s<n.length;s+=3)g.TransformNormal(g.FromArray(n,s),e).normalize().toArray(o,s);this.setVerticesData(_.NormalKind,o,this.getVertexBuffer(_.NormalKind).isUpdatable())}return e.m[0]*e.m[5]*e.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this},t.prototype.bakeCurrentTransformIntoVertices=function(e){return e===void 0&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return this._geometry?this._geometry._generatePointsArray():!1},t.prototype.clone=function(e,i,n,o){return e===void 0&&(e=""),i===void 0&&(i=null),o===void 0&&(o=!0),new t(e,this.getScene(),i,this,n,o)},t.prototype.dispose=function(e,i){i===void 0&&(i=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var n=this._internalMeshDataInfo;if(n._onBeforeDrawObservable&&n._onBeforeDrawObservable.clear(),n._onBeforeBindObservable&&n._onBeforeBindObservable.clear(),n._onBeforeRenderObservable&&n._onBeforeRenderObservable.clear(),n._onAfterRenderObservable&&n._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(n.meshMap)for(var o in n.meshMap){var s=n.meshMap[o];s&&(s._internalMeshDataInfo._source=null,n.meshMap[o]=void 0)}n._source&&n._source._internalMeshDataInfo.meshMap&&(n._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var a=this.getScene().meshes,u=0,h=a;u<h.length;u++){var f=h[u],s=f;s._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}n._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),r.prototype.dispose.call(this,e,i)},t.prototype._disposeInstanceSpecificData=function(){},t.prototype._disposeThinInstanceSpecificData=function(){},t.prototype.applyDisplacementMap=function(e,i,n,o,s,a,u){var h=this;u===void 0&&(u=!1);var f=this.getScene(),l=function(c){var p=c.width,d=c.height,v=si.CreateCanvas(p,d),y=v.getContext("2d");y.drawImage(c,0,0);var b=y.getImageData(0,0,p,d).data;h.applyDisplacementMapFromBuffer(b,p,d,i,n,s,a,u),o&&o(h)};return K.LoadImage(e,l,function(){},f.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,i,n,o,s,a,u,h){if(h===void 0&&(h=!1),!this.isVerticesDataPresent(_.PositionKind)||!this.isVerticesDataPresent(_.NormalKind)||!this.isVerticesDataPresent(_.UVKind))return z.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var f=this.getVerticesData(_.PositionKind,!0,!0),l=this.getVerticesData(_.NormalKind),c=this.getVerticesData(_.UVKind),p=g.Zero(),d=g.Zero(),v=G.Zero();a=a||G.Zero(),u=u||new G(1,1);for(var y=0;y<f.length;y+=3){g.FromArrayToRef(f,y,p),g.FromArrayToRef(l,y,d),G.FromArrayToRef(c,y/3*2,v);var b=Math.abs(v.x*u.x+a.x%1)*(i-1)%i|0,m=Math.abs(v.y*u.y+a.y%1)*(n-1)%n|0,M=(b+m*i)*4,R=e[M]/255,D=e[M+1]/255,I=e[M+2]/255,A=R*.3+D*.59+I*.11;d.normalize(),d.scaleInPlace(o+(s-o)*A),p=p.add(d),p.toArray(f,y)}return tt.ComputeNormals(f,this.getIndices(),l),h?(this.setVerticesData(_.PositionKind,f),this.setVerticesData(_.NormalKind,l)):(this.updateVerticesData(_.PositionKind,f),this.updateVerticesData(_.NormalKind,l)),this},t.prototype.convertToFlatShadedMesh=function(){var e=this.getVerticesDataKinds(),i={},n={},o={},s=!1,a,u;for(a=0;a<e.length;a++){u=e[a];var h=this.getVertexBuffer(u);if(u===_.NormalKind){s=h.isUpdatable(),e.splice(a,1),a--;continue}i[u]=h,n[u]=i[u].getData(),o[u]=[]}var f=this.subMeshes.slice(0),l=this.getIndices(),c=this.getTotalIndices(),p;for(p=0;p<c;p++){var d=l[p];for(a=0;a<e.length;a++){u=e[a];for(var v=i[u].getStrideSize(),y=0;y<v;y++)o[u].push(n[u][d*v+y])}}var b=[],m=o[_.PositionKind];for(p=0;p<c;p+=3){l[p]=p,l[p+1]=p+1,l[p+2]=p+2;for(var M=g.FromArray(m,p*3),R=g.FromArray(m,(p+1)*3),D=g.FromArray(m,(p+2)*3),I=M.subtract(R),A=D.subtract(R),x=g.Normalize(g.Cross(I,A)),W=0;W<3;W++)b.push(x.x),b.push(x.y),b.push(x.z)}for(this.setIndices(l),this.setVerticesData(_.NormalKind,b,s),a=0;a<e.length;a++)u=e[a],this.setVerticesData(u,o[u],i[u].isUpdatable());this.releaseSubMeshes();for(var q=0;q<f.length;q++){var Q=f[q];xt.AddToMesh(Q.materialIndex,Q.indexStart,Q.indexCount,Q.indexStart,Q.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e=this.getVerticesDataKinds(),i={},n={},o={},s,a;for(s=0;s<e.length;s++){a=e[s];var u=this.getVertexBuffer(a);i[a]=u,n[a]=i[a].getData(),o[a]=[]}var h=this.subMeshes.slice(0),f=this.getIndices(),l=this.getTotalIndices(),c;for(c=0;c<l;c++){var p=f[c];for(s=0;s<e.length;s++){a=e[s];for(var d=i[a].getStrideSize(),v=0;v<d;v++)o[a].push(n[a][p*d+v])}}for(c=0;c<l;c+=3)f[c]=c,f[c+1]=c+1,f[c+2]=c+2;for(this.setIndices(f),s=0;s<e.length;s++)a=e[s],this.setVerticesData(a,o[a],i[a].isUpdatable());this.releaseSubMeshes();for(var y=0;y<h.length;y++){var b=h[y];xt.AddToMesh(b.materialIndex,b.indexStart,b.indexCount,b.indexStart,b.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){e===void 0&&(e=!1);var i=tt.ExtractFromMesh(this),n;if(e&&this.isVerticesDataPresent(_.NormalKind)&&i.normals)for(n=0;n<i.normals.length;n++)i.normals[n]*=-1;if(i.indices){var o;for(n=0;n<i.indices.length;n+=3)o=i.indices[n+1],i.indices[n+1]=i.indices[n+2],i.indices[n+2]=o}return i.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind)),this},t.prototype.increaseVertices=function(e){var i=tt.ExtractFromMesh(this),n=i.uvs,o=i.indices,s=i.positions,a=i.normals;if(!o||!s||!a||!n)z.Warn("VertexData contains null entries");else{for(var u=e+1,h=new Array,f=0;f<u+1;f++)h[f]=new Array;for(var l,c,p=new g(0,0,0),d=new g(0,0,0),v=new G(0,0),y=new Array,b=new Array,m=new Array,M,R=s.length,D=n.length,f=0;f<o.length;f+=3){b[0]=o[f],b[1]=o[f+1],b[2]=o[f+2];for(var I=0;I<3;I++)if(l=b[I],c=b[(I+1)%3],m[l]===void 0&&m[c]===void 0?(m[l]=new Array,m[c]=new Array):(m[l]===void 0&&(m[l]=new Array),m[c]===void 0&&(m[c]=new Array)),m[l][c]===void 0&&m[c][l]===void 0){m[l][c]=[],p.x=(s[3*c]-s[3*l])/u,p.y=(s[3*c+1]-s[3*l+1])/u,p.z=(s[3*c+2]-s[3*l+2])/u,d.x=(a[3*c]-a[3*l])/u,d.y=(a[3*c+1]-a[3*l+1])/u,d.z=(a[3*c+2]-a[3*l+2])/u,v.x=(n[2*c]-n[2*l])/u,v.y=(n[2*c+1]-n[2*l+1])/u,m[l][c].push(l);for(var A=1;A<u;A++)m[l][c].push(s.length/3),s[R]=s[3*l]+A*p.x,a[R++]=a[3*l]+A*d.x,s[R]=s[3*l+1]+A*p.y,a[R++]=a[3*l+1]+A*d.y,s[R]=s[3*l+2]+A*p.z,a[R++]=a[3*l+2]+A*d.z,n[D++]=n[2*l]+A*v.x,n[D++]=n[2*l+1]+A*v.y;m[l][c].push(c),m[c][l]=new Array,M=m[l][c].length;for(var x=0;x<M;x++)m[c][l][x]=m[l][c][M-1-x]}h[0][0]=o[f],h[1][0]=m[o[f]][o[f+1]][1],h[1][1]=m[o[f]][o[f+2]][1];for(var A=2;A<u;A++){h[A][0]=m[o[f]][o[f+1]][A],h[A][A]=m[o[f]][o[f+2]][A],p.x=(s[3*h[A][A]]-s[3*h[A][0]])/A,p.y=(s[3*h[A][A]+1]-s[3*h[A][0]+1])/A,p.z=(s[3*h[A][A]+2]-s[3*h[A][0]+2])/A,d.x=(a[3*h[A][A]]-a[3*h[A][0]])/A,d.y=(a[3*h[A][A]+1]-a[3*h[A][0]+1])/A,d.z=(a[3*h[A][A]+2]-a[3*h[A][0]+2])/A,v.x=(n[2*h[A][A]]-n[2*h[A][0]])/A,v.y=(n[2*h[A][A]+1]-n[2*h[A][0]+1])/A;for(var I=1;I<A;I++)h[A][I]=s.length/3,s[R]=s[3*h[A][0]]+I*p.x,a[R++]=a[3*h[A][0]]+I*d.x,s[R]=s[3*h[A][0]+1]+I*p.y,a[R++]=a[3*h[A][0]+1]+I*d.y,s[R]=s[3*h[A][0]+2]+I*p.z,a[R++]=a[3*h[A][0]+2]+I*d.z,n[D++]=n[2*h[A][0]]+I*v.x,n[D++]=n[2*h[A][0]+1]+I*v.y}h[u]=m[o[f+1]][o[f+2]],y.push(h[0][0],h[1][0],h[1][1]);for(var A=1;A<u;A++){for(var I=0;I<A;I++)y.push(h[A][I],h[A+1][I],h[A+1][I+1]),y.push(h[A][I],h[A+1][I+1],h[A][I+1]);y.push(h[A][I],h[A+1][I],h[A+1][I+1])}}i.indices=y,i.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind))}},t.prototype.forceSharedVertices=function(){var e=tt.ExtractFromMesh(this),i=e.uvs,n=e.indices,o=e.positions,s=e.colors;if(n===void 0||o===void 0||n===null||o===null)z.Warn("VertexData contains empty entries");else{for(var a=new Array,u=new Array,h=new Array,f=new Array,l=new Array,c=0,p={},d,v,y=0;y<n.length;y+=3){v=[n[y],n[y+1],n[y+2]],l=new Array;for(var b=0;b<3;b++){l[b]="";for(var m=0;m<3;m++)Math.abs(o[3*v[b]+m])<1e-8&&(o[3*v[b]+m]=0),l[b]+=o[3*v[b]+m]+"|"}if(!(l[0]==l[1]||l[0]==l[2]||l[1]==l[2]))for(var b=0;b<3;b++){if(d=p[l[b]],d===void 0){p[l[b]]=c,d=c++;for(var m=0;m<3;m++)a.push(o[3*v[b]+m]);if(s!=null)for(var m=0;m<4;m++)f.push(s[4*v[b]+m]);if(i!=null)for(var m=0;m<2;m++)h.push(i[2*v[b]+m])}u.push(d)}}var M=new Array;tt.ComputeNormals(a,u,M),e.positions=a,e.indices=u,e.normals=M,i!=null&&(e.uvs=h),s!=null&&(e.colors=f),e.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind))}},t._instancedMeshFactory=function(e,i){throw S.WarnImport("InstancedMesh")},t._PhysicsImpostorParser=function(e,i,n){throw S.WarnImport("PhysicsImpostor")},t.prototype.createInstance=function(e){var i=this.geometry;if(i&&i.meshes.length>1)for(var n=i.meshes.slice(0),o=0,s=n;o<s.length;o++){var a=s[o];a!==this&&a.makeGeometryUnique()}return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){this._geometry&&this._geometry.meshes.length!==1&&this.instances.length&&this.makeGeometryUnique();for(var e=0;e<this.instances.length;e++){var i=this.instances[e];i._syncSubMeshes()}return this},t.prototype.optimizeIndices=function(e){var i=this,n=this.getIndices(),o=this.getVerticesData(_.PositionKind);if(!o||!n)return this;for(var s=new Array,a=0;a<o.length;a=a+3)s.push(g.FromArray(o,a));var u=new Array;return vi.SyncAsyncForLoop(s.length,40,function(h){for(var f=s.length-1-h,l=s[f],c=0;c<f;++c){var p=s[c];if(l.equals(p)){u[f]=c;break}}},function(){for(var h=0;h<n.length;++h)n[h]=u[n[h]]||n[h];var f=i.subMeshes.slice(0);i.setIndices(n),i.subMeshes=f,e&&e(i)}),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),k&&k.HasTags(this)&&(e.tags=k.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(e.parentId=this.parent.id),e.isUnIndexed=this.isUnIndexed;var i=this._geometry;if(i){var n=i.id;e.geometryId=n,e.subMeshes=[];for(var o=0;o<this.subMeshes.length;o++){var s=this.subMeshes[o];e.subMeshes.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(e.materialId=this.material.id):this.material=null,this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(ke.NAME_PHYSICSENGINE)){var a=this.getPhysicsImpostor();a&&(e.physicsMass=a.getParam("mass"),e.physicsFriction=a.getParam("friction"),e.physicsRestitution=a.getParam("mass"),e.physicsImpostor=a.type)}this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var u=0;u<this.instances.length;u++){var h=this.instances[u];if(!h.doNotSerialize){var f={name:h.name,id:h.id,isEnabled:h.isEnabled(!1),isVisible:h.isVisible,isPickable:h.isPickable,checkCollisions:h.checkCollisions,position:h.position.asArray(),scaling:h.scaling.asArray()};if(h.parent&&(f.parentId=h.parent.id),h.rotationQuaternion?f.rotationQuaternion=h.rotationQuaternion.asArray():h.rotation&&(f.rotation=h.rotation.asArray()),this.getScene()._getComponent(ke.NAME_PHYSICSENGINE)){var a=h.getPhysicsImpostor();a&&(f.physicsMass=a.getParam("mass"),f.physicsFriction=a.getParam("friction"),f.physicsRestitution=a.getParam("mass"),f.physicsImpostor=a.type)}h.metadata&&(f.metadata=h.metadata),e.instances.push(f),j.AppendSerializedAnimations(h,f),f.ranges=h.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:K.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var l={data:{},sizes:{},strides:{}};for(var c in this._userThinInstanceBuffersStorage.data)l.data[c]=K.SliceToArray(this._userThinInstanceBuffersStorage.data[c]),l.sizes[c]=this._userThinInstanceBuffersStorage.sizes[c],l.strides[c]=this._userThinInstanceBuffersStorage.strides[c];e.thinInstances.userThinInstance=l}j.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(!!this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices()){z.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}for(var i=0;i<e.numInfluencers;i++){var n=e.getActiveTarget(i),o=n.getPositions();if(!o){z.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(_.PositionKind+i,o,!1,3);var s=n.getNormals();s&&this.geometry.setVerticesData(_.NormalKind+i,s,!1,3);var a=n.getTangents();a&&this.geometry.setVerticesData(_.TangentKind+i,a,!1,3);var u=n.getUVs();u&&this.geometry.setVerticesData(_.UVKind+"_"+i,u,!1,2)}}else for(var i=0;this.geometry.isVerticesDataPresent(_.PositionKind+i);)this.geometry.removeVerticesData(_.PositionKind+i),this.geometry.isVerticesDataPresent(_.NormalKind+i)&&this.geometry.removeVerticesData(_.NormalKind+i),this.geometry.isVerticesDataPresent(_.TangentKind+i)&&this.geometry.removeVerticesData(_.TangentKind+i),this.geometry.isVerticesDataPresent(_.UVKind+i)&&this.geometry.removeVerticesData(_.UVKind+"_"+i),i++}},t.Parse=function(e,i,n){var o;if(e.type&&e.type==="GroundMesh"?o=t._GroundMeshParser(e,i):o=new t(e.name,i),o.id=e.id,k&&k.AddTagsTo(o,e.tags),o.position=g.FromArray(e.position),e.metadata!==void 0&&(o.metadata=e.metadata),e.rotationQuaternion?o.rotationQuaternion=N.FromArray(e.rotationQuaternion):e.rotation&&(o.rotation=g.FromArray(e.rotation)),o.scaling=g.FromArray(e.scaling),e.localMatrix?o.setPreTransformMatrix(O.FromArray(e.localMatrix)):e.pivotMatrix&&o.setPivotMatrix(O.FromArray(e.pivotMatrix)),o.setEnabled(e.isEnabled),o.isVisible=e.isVisible,o.infiniteDistance=e.infiniteDistance,o.showBoundingBox=e.showBoundingBox,o.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,e.applyFog!==void 0&&(o.applyFog=e.applyFog),e.pickable!==void 0&&(o.isPickable=e.pickable),e.alphaIndex!==void 0&&(o.alphaIndex=e.alphaIndex),o.receiveShadows=e.receiveShadows,o.billboardMode=e.billboardMode,e.visibility!==void 0&&(o.visibility=e.visibility),o.checkCollisions=e.checkCollisions,o.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,e.isBlocker!==void 0&&(o.isBlocker=e.isBlocker),o._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(o._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),e.parentId&&(o._waitingParentId=e.parentId),e.actions!==void 0&&(o._waitingData.actions=e.actions),e.overlayAlpha!==void 0&&(o.overlayAlpha=e.overlayAlpha),e.overlayColor!==void 0&&(o.overlayColor=pt.FromArray(e.overlayColor)),e.renderOverlay!==void 0&&(o.renderOverlay=e.renderOverlay),o.isUnIndexed=!!e.isUnIndexed,o.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(o.delayLoadState=4,o.delayLoadingFile=n+e.delayLoadingFile,o._boundingInfo=new Tt(g.FromArray(e.boundingBoxMinimum),g.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(o._binaryInfo=e._binaryInfo),o._delayInfo=[],e.hasUVs&&o._delayInfo.push(_.UVKind),e.hasUVs2&&o._delayInfo.push(_.UV2Kind),e.hasUVs3&&o._delayInfo.push(_.UV3Kind),e.hasUVs4&&o._delayInfo.push(_.UV4Kind),e.hasUVs5&&o._delayInfo.push(_.UV5Kind),e.hasUVs6&&o._delayInfo.push(_.UV6Kind),e.hasColors&&o._delayInfo.push(_.ColorKind),e.hasMatricesIndices&&o._delayInfo.push(_.MatricesIndicesKind),e.hasMatricesWeights&&o._delayInfo.push(_.MatricesWeightsKind),o._delayLoadingFunction=St._ImportGeometry,Ze.ForceFullSceneLoadingForIncremental&&o._checkDelayState()):St._ImportGeometry(e,o),e.materialId?o.setMaterialByID(e.materialId):o.material=null,e.morphTargetManagerId>-1&&(o.morphTargetManager=i.getMorphTargetManagerById(e.morphTargetManagerId)),e.skeletonId!==void 0&&e.skeletonId!==null&&(o.skeleton=i.getLastSkeletonByID(e.skeletonId),e.numBoneInfluencers&&(o.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s],u=nt.GetClass("BABYLON.Animation");u&&o.animations.push(u.Parse(a))}vt.ParseAnimationRanges(o,e,i)}if(e.autoAnimate&&i.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?o.layerMask=Math.abs(parseInt(e.layerMask)):o.layerMask=268435455,e.physicsImpostor&&t._PhysicsImpostorParser(i,o,e),e.lodMeshIds&&(o._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var h=0;h<e.instances.length;h++){var f=e.instances[h],l=o.createInstance(f.name);if(f.id&&(l.id=f.id),k&&(f.tags?k.AddTagsTo(l,f.tags):k.AddTagsTo(l,e.tags)),l.position=g.FromArray(f.position),f.metadata!==void 0&&(l.metadata=f.metadata),f.parentId&&(l._waitingParentId=f.parentId),f.isEnabled!==void 0&&f.isEnabled!==null&&l.setEnabled(f.isEnabled),f.isVisible!==void 0&&f.isVisible!==null&&(l.isVisible=f.isVisible),f.isPickable!==void 0&&f.isPickable!==null&&(l.isPickable=f.isPickable),f.rotationQuaternion?l.rotationQuaternion=N.FromArray(f.rotationQuaternion):f.rotation&&(l.rotation=g.FromArray(f.rotation)),l.scaling=g.FromArray(f.scaling),f.checkCollisions!=null&&f.checkCollisions!=null&&(l.checkCollisions=f.checkCollisions),f.pickable!=null&&f.pickable!=null&&(l.isPickable=f.pickable),f.showBoundingBox!=null&&f.showBoundingBox!=null&&(l.showBoundingBox=f.showBoundingBox),f.showSubMeshesBoundingBox!=null&&f.showSubMeshesBoundingBox!=null&&(l.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),f.alphaIndex!=null&&f.showSubMeshesBoundingBox!=null&&(l.alphaIndex=f.alphaIndex),f.physicsImpostor&&t._PhysicsImpostorParser(i,l,f),f.animations){for(s=0;s<f.animations.length;s++){a=f.animations[s];var u=nt.GetClass("BABYLON.Animation");u&&l.animations.push(u.Parse(a))}vt.ParseAnimationRanges(l,f,i),f.autoAnimate&&i.beginAnimation(l,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}if(e.thinInstances){var c=e.thinInstances;if(c.matrixData?(o.thinInstanceSetBuffer("matrix",new Float32Array(c.matrixData),16,!1),o._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,o._thinInstanceDataStorage.instancesCount=c.instancesCount):o._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,e.thinInstances.userThinInstance){var p=e.thinInstances.userThinInstance;for(var d in p.data)o.thinInstanceSetBuffer(d,new Float32Array(p.data[d]),p.strides[d],!1),o._userThinInstanceBuffersStorage.sizes[d]=p.sizes[d]}}return o},t.CreateRibbon=function(e,i,n,o,s,a,u,h,f){throw S.WarnImport("MeshBuilder")},t.CreateDisc=function(e,i,n,o,s,a){throw S.WarnImport("MeshBuilder")},t.CreateBox=function(e,i,n,o,s){throw S.WarnImport("MeshBuilder")},t.CreateSphere=function(e,i,n,o,s,a){throw S.WarnImport("MeshBuilder")},t.CreateHemisphere=function(e,i,n,o){throw S.WarnImport("MeshBuilder")},t.CreateCylinder=function(e,i,n,o,s,a,u,h,f){throw S.WarnImport("MeshBuilder")},t.CreateTorus=function(e,i,n,o,s,a,u){throw S.WarnImport("MeshBuilder")},t.CreateTorusKnot=function(e,i,n,o,s,a,u,h,f,l){throw S.WarnImport("MeshBuilder")},t.CreateLines=function(e,i,n,o,s){throw S.WarnImport("MeshBuilder")},t.CreateDashedLines=function(e,i,n,o,s,a,u,h){throw S.WarnImport("MeshBuilder")},t.CreatePolygon=function(e,i,n,o,s,a,u){throw u===void 0&&(u=earcut),S.WarnImport("MeshBuilder")},t.ExtrudePolygon=function(e,i,n,o,s,a,u,h){throw h===void 0&&(h=earcut),S.WarnImport("MeshBuilder")},t.ExtrudeShape=function(e,i,n,o,s,a,u,h,f,l){throw S.WarnImport("MeshBuilder")},t.ExtrudeShapeCustom=function(e,i,n,o,s,a,u,h,f,l,c,p){throw S.WarnImport("MeshBuilder")},t.CreateLathe=function(e,i,n,o,s,a,u){throw S.WarnImport("MeshBuilder")},t.CreatePlane=function(e,i,n,o,s){throw S.WarnImport("MeshBuilder")},t.CreateGround=function(e,i,n,o,s,a){throw S.WarnImport("MeshBuilder")},t.CreateTiledGround=function(e,i,n,o,s,a,u,h,f){throw S.WarnImport("MeshBuilder")},t.CreateGroundFromHeightMap=function(e,i,n,o,s,a,u,h,f,l,c){throw S.WarnImport("MeshBuilder")},t.CreateTube=function(e,i,n,o,s,a,u,h,f,l){throw S.WarnImport("MeshBuilder")},t.CreatePolyhedron=function(e,i,n){throw S.WarnImport("MeshBuilder")},t.CreateIcoSphere=function(e,i,n){throw S.WarnImport("MeshBuilder")},t.CreateDecal=function(e,i,n,o,s,a){throw S.WarnImport("MeshBuilder")},t.CreateCapsule=function(e,i,n){throw S.WarnImport("MeshBuilder")},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var i=this.getVerticesData(_.PositionKind);if(!i)return e._sourcePositions;e._sourcePositions=new Float32Array(i),this.isVertexBufferUpdatable(_.PositionKind)||this.setVerticesData(_.PositionKind,i,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var i=this.getVerticesData(_.NormalKind);if(!i)return e._sourceNormals;e._sourceNormals=new Float32Array(i),this.isVertexBufferUpdatable(_.NormalKind)||this.setVerticesData(_.NormalKind,i,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(_.PositionKind))return this;if(!this.isVerticesDataPresent(_.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(_.MatricesWeightsKind))return this;var i=this.isVerticesDataPresent(_.NormalKind),n=this._internalMeshDataInfo;if(!n._sourcePositions){var o=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=o}i&&!n._sourceNormals&&this.setNormalsForCPUSkinning();var s=this.getVerticesData(_.PositionKind);if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s));var a=this.getVerticesData(_.NormalKind);if(i){if(!a)return this;a instanceof Float32Array||(a=new Float32Array(a))}var u=this.getVerticesData(_.MatricesIndicesKind),h=this.getVerticesData(_.MatricesWeightsKind);if(!h||!u)return this;for(var f=this.numBoneInfluencers>4,l=f?this.getVerticesData(_.MatricesIndicesExtraKind):null,c=f?this.getVerticesData(_.MatricesWeightsExtraKind):null,p=e.getTransformMatrices(this),d=g.Zero(),v=new O,y=new O,b=0,m,M=0;M<s.length;M+=3,b+=4){var R;for(m=0;m<4;m++)R=h[b+m],R>0&&(O.FromFloat32ArrayToRefScaled(p,Math.floor(u[b+m]*16),R,y),v.addToSelf(y));if(f)for(m=0;m<4;m++)R=c[b+m],R>0&&(O.FromFloat32ArrayToRefScaled(p,Math.floor(l[b+m]*16),R,y),v.addToSelf(y));g.TransformCoordinatesFromFloatsToRef(n._sourcePositions[M],n._sourcePositions[M+1],n._sourcePositions[M+2],v,d),d.toArray(s,M),i&&(g.TransformNormalFromFloatsToRef(n._sourceNormals[M],n._sourceNormals[M+1],n._sourceNormals[M+2],v,d),d.toArray(a,M)),v.reset()}return this.updateVerticesData(_.PositionKind,s),i&&this.updateVerticesData(_.NormalKind,a),this},t.MinMax=function(e){var i=null,n=null;return e.forEach(function(o){var s=o.getBoundingInfo(),a=s.boundingBox;!i||!n?(i=a.minimumWorld,n=a.maximumWorld):(i.minimizeInPlace(a.minimumWorld),n.maximizeInPlace(a.maximumWorld))}),!i||!n?{min:g.Zero(),max:g.Zero()}:{min:i,max:n}},t.Center=function(e){var i=e instanceof Array?t.MinMax(e):e;return g.Center(i.min,i.max)},t.MergeMeshes=function(e,i,n,o,s,a){i===void 0&&(i=!0);var u;if(!n){var h=0;for(u=0;u<e.length;u++)if(e[u]&&(h+=e[u].getTotalVertices(),h>=65536))return z.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(a){var f=null,l,c;s=!1}var p=new Array,d=new Array,v=null,y,b=new Array,m=null;for(u=0;u<e.length;u++)if(e[u]){var M=e[u];if(M.isAnInstance)return z.Warn("Cannot merge instance meshes."),null;var R=M.computeWorldMatrix(!0);if(y=tt.ExtractFromMesh(M,!0,!0),y.transform(R),v?v.merge(y,n):(v=y,m=M),s&&b.push(M.getTotalIndices()),a)if(M.material){var D=M.material;if(D instanceof Te){for(c=0;c<D.subMaterials.length;c++)p.indexOf(D.subMaterials[c])<0&&p.push(D.subMaterials[c]);for(l=0;l<M.subMeshes.length;l++)d.push(p.indexOf(D.subMaterials[M.subMeshes[l].materialIndex])),b.push(M.subMeshes[l].indexCount)}else for(p.indexOf(D)<0&&p.push(D),l=0;l<M.subMeshes.length;l++)d.push(p.indexOf(D)),b.push(M.subMeshes[l].indexCount)}else for(l=0;l<M.subMeshes.length;l++)d.push(0),b.push(M.subMeshes[l].indexCount)}if(m=m,o||(o=new t(m.name+"_merged",m.getScene())),v.applyToMesh(o),o.checkCollisions=m.checkCollisions,o.overrideMaterialSideOrientation=m.overrideMaterialSideOrientation,i)for(u=0;u<e.length;u++)e[u]&&e[u].dispose();if(s||a){o.releaseSubMeshes(),u=0;for(var I=0;u<b.length;)xt.CreateFromIndices(0,I,b[u],o),I+=b[u],u++}if(a){for(f=new Te(m.name+"_merged",m.getScene()),f.subMaterials=p,l=0;l<o.subMeshes.length;l++)o.subMeshes[l].materialIndex=d[l];o.material=f}else o.material=m.material;return o},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var i=e._indexInSourceMeshInstanceArray;if(i!=-1){if(i!==this.instances.length-1){var n=this.instances[this.instances.length-1];this.instances[i]=n,n._indexInSourceMeshInstanceArray=i}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.FRONTSIDE=tt.FRONTSIDE,t.BACKSIDE=tt.BACKSIDE,t.DOUBLESIDE=tt.DOUBLESIDE,t.DEFAULTSIDE=tt.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t._GroundMeshParser=function(e,i){throw S.WarnImport("GroundMesh")},t}(le);nt.RegisteredTypes["BABYLON.Mesh"]=he;var Hi=function(){function r(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(r.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(t){this._idleRotationSpeed=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(t){this._idleRotationWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(t){this._idleRotationSpinupTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(t){var e=this;this._attachedCamera=t;var i=this._attachedCamera.getScene();this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(n){if(n.type===w.POINTERDOWN){e._isPointerDown=!0;return}n.type===w.POINTERUP&&(e._isPointerDown=!1)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){var n=kt.Now,o=0;e._lastFrameTime!=null&&(o=n-e._lastFrameTime),e._lastFrameTime=n,e._applyUserInteraction();var s=n-e._lastInteractionTime-e._idleRotationWaitTime,a=Math.max(Math.min(s/e._idleRotationSpinupTime,1),0);e._cameraRotationSpeed=e._idleRotationSpeed*a,e._attachedCamera&&(e._attachedCamera.alpha-=e._cameraRotationSpeed*(o/1e3))})},r.prototype.detach=function(){if(!!this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},r.prototype._userIsZooming=function(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1},r.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var t=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(t=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?t:this._userIsZooming()},r.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=kt.Now)},r.prototype._userIsMoving=function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},r}(),ot=function(){function r(){this._easingMode=r.EASINGMODE_EASEIN}return r.prototype.setEasingMode=function(t){var e=Math.min(Math.max(t,0),2);this._easingMode=e},r.prototype.getEasingMode=function(){return this._easingMode},r.prototype.easeInCore=function(t){throw new Error("You must implement this method")},r.prototype.ease=function(t){switch(this._easingMode){case r.EASINGMODE_EASEIN:return this.easeInCore(t);case r.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?(1-this.easeInCore((1-t)*2))*.5+.5:this.easeInCore(t*2)*.5},r.EASINGMODE_EASEIN=0,r.EASINGMODE_EASEOUT=1,r.EASINGMODE_EASEINOUT=2,r}();(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t})(ot);var Xi=function(r){U(t,r);function t(e){e===void 0&&(e=1);var i=r.call(this)||this;return i.amplitude=e,i}return t.prototype.easeInCore=function(e){var i=Math.max(0,this.amplitude);return Math.pow(e,3)-e*i*Math.sin(3.141592653589793*e)},t}(ot);(function(r){U(t,r);function t(e,i){e===void 0&&(e=3),i===void 0&&(i=2);var n=r.call(this)||this;return n.bounces=e,n.bounciness=i,n}return t.prototype.easeInCore=function(e){var i=Math.max(0,this.bounces),n=this.bounciness;n<=1&&(n=1.001);var o=Math.pow(n,i),s=1-n,a=(1-o)/s+o*.5,u=e*a,h=Math.log(-u*(1-n)+1)/Math.log(n),f=Math.floor(h),l=f+1,c=(1-Math.pow(n,f))/(s*a),p=(1-Math.pow(n,l))/(s*a),d=(c+p)*.5,v=e-d,y=d-c;return-Math.pow(1/n,i-f)/(y*y)*(v-y)*(v+y)},t})(ot);(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return e*e*e},t})(ot);(function(r){U(t,r);function t(e,i){e===void 0&&(e=3),i===void 0&&(i=3);var n=r.call(this)||this;return n.oscillations=e,n.springiness=i,n}return t.prototype.easeInCore=function(e){var i,n=Math.max(0,this.oscillations),o=Math.max(0,this.springiness);return o==0?i=e:i=(Math.exp(o*e)-1)/(Math.exp(o)-1),i*Math.sin((6.283185307179586*n+1.5707963267948966)*e)},t})(ot);var qi=function(r){U(t,r);function t(e){e===void 0&&(e=2);var i=r.call(this)||this;return i.exponent=e,i}return t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(ot);(function(r){U(t,r);function t(e){e===void 0&&(e=2);var i=r.call(this)||this;return i.power=e,i}return t.prototype.easeInCore=function(e){var i=Math.max(0,this.power);return Math.pow(e,i)},t})(ot);(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return e*e},t})(ot);(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return e*e*e*e},t})(ot);(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return e*e*e*e*e},t})(ot);(function(r){U(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t})(ot);(function(r){U(t,r);function t(e,i,n,o){e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=1),o===void 0&&(o=1);var s=r.call(this)||this;return s.x1=e,s.y1=i,s.x2=n,s.y2=o,s}return t.prototype.easeInCore=function(e){return zi.Interpolate(e,this.x1,this.y1,this.x2,this.y2)},t})(ot);var Re;(function(r){r[r.STEP=1]="STEP"})(Re||(Re={}));var Je=function(){function r(t,e,i){this.name=t,this.from=e,this.to=i}return r.prototype.clone=function(){return new r(this.name,this.from,this.to)},r}(),ct=function(){function r(t,e,i,n,o,s){this.name=t,this.targetProperty=e,this.framePerSecond=i,this.dataType=n,this.loopMode=o,this.enableBlending=s,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=e.split("."),this.dataType=n,this.loopMode=o===void 0?r.ANIMATIONLOOPMODE_CYCLE:o}return r._PrepareAnimation=function(t,e,i,n,o,s,a,u){var h=void 0;if(!isNaN(parseFloat(o))&&isFinite(o)?h=r.ANIMATIONTYPE_FLOAT:o instanceof N?h=r.ANIMATIONTYPE_QUATERNION:o instanceof g?h=r.ANIMATIONTYPE_VECTOR3:o instanceof G?h=r.ANIMATIONTYPE_VECTOR2:o instanceof pt?h=r.ANIMATIONTYPE_COLOR3:o instanceof J?h=r.ANIMATIONTYPE_COLOR4:o instanceof We&&(h=r.ANIMATIONTYPE_SIZE),h==null)return null;var f=new r(t,e,i,h,a),l=[{frame:0,value:o},{frame:n,value:s}];return f.setKeys(l),u!==void 0&&f.setEasingFunction(u),f},r.CreateAnimation=function(t,e,i,n){var o=new r(t+"Animation",t,i,e,r.ANIMATIONLOOPMODE_CONSTANT);return o.setEasingFunction(n),o},r.CreateAndStartAnimation=function(t,e,i,n,o,s,a,u,h,f){var l=r._PrepareAnimation(t,i,n,o,s,a,u,h);return l?e.getScene().beginDirectAnimation(e,[l],0,o,l.loopMode===1,1,f):null},r.CreateAndStartHierarchyAnimation=function(t,e,i,n,o,s,a,u,h,f,l){var c=r._PrepareAnimation(t,n,o,s,a,u,h,f);if(!c)return null;var p=e.getScene();return p.beginDirectHierarchyAnimation(e,i,[c],0,s,c.loopMode===1,1,l)},r.CreateMergeAndStartAnimation=function(t,e,i,n,o,s,a,u,h,f){var l=r._PrepareAnimation(t,i,n,o,s,a,u,h);return l?(e.animations.push(l),e.getScene().beginAnimation(e,0,o,l.loopMode===1,1,f)):null},r.MakeAnimationAdditive=function(t,e,i,n,o){e===void 0&&(e=0),n===void 0&&(n=!1);var s=t;if(n&&(s=t.clone(),s.name=o||s.name),!s._keys.length)return s;e=e>=0?e:0;var a=0,u=s._keys[0],h=s._keys.length-1,f=s._keys[h],l={referenceValue:u.value,referencePosition:C.Vector3[0],referenceQuaternion:C.Quaternion[0],referenceScaling:C.Vector3[1],keyPosition:C.Vector3[2],keyQuaternion:C.Quaternion[1],keyScaling:C.Vector3[3]},c=!1,p=u.frame,d=f.frame;if(i){var v=s.getRange(i);v&&(p=v.from,d=v.to)}var y=u.frame===p,b=f.frame===d;if(s._keys.length===1){var m=s._getKeyValue(s._keys[0]);l.referenceValue=m.clone?m.clone():m,c=!0}else if(e<=u.frame){var m=s._getKeyValue(u.value);l.referenceValue=m.clone?m.clone():m,c=!0}else if(e>=f.frame){var m=s._getKeyValue(f.value);l.referenceValue=m.clone?m.clone():m,c=!0}for(var M=0;!c||!y||!b&&M<s._keys.length-1;){var R=s._keys[M],D=s._keys[M+1];if(!c&&e>=R.frame&&e<=D.frame){var m=void 0;if(e===R.frame)m=s._getKeyValue(R.value);else if(e===D.frame)m=s._getKeyValue(D.value);else{var I={key:M,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};m=s._interpolate(e,I)}l.referenceValue=m.clone?m.clone():m,c=!0}if(!y&&p>=R.frame&&p<=D.frame){if(p===R.frame)a=M;else if(p===D.frame)a=M+1;else{var I={key:M,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},m=s._interpolate(p,I),A={frame:p,value:m.clone?m.clone():m};s._keys.splice(M+1,0,A),a=M+1}y=!0}if(!b&&d>=R.frame&&d<=D.frame){if(d===R.frame)h=M;else if(d===D.frame)h=M+1;else{var I={key:M,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},m=s._interpolate(d,I),A={frame:d,value:m.clone?m.clone():m};s._keys.splice(M+1,0,A),h=M+1}b=!0}M++}s.dataType===r.ANIMATIONTYPE_QUATERNION?l.referenceValue.normalize().conjugateInPlace():s.dataType===r.ANIMATIONTYPE_MATRIX&&(l.referenceValue.decompose(l.referenceScaling,l.referenceQuaternion,l.referencePosition),l.referenceQuaternion.normalize().conjugateInPlace());for(var M=a;M<=h;M++){var A=s._keys[M];if(!(M&&s.dataType!==r.ANIMATIONTYPE_FLOAT&&A.value===u.value))switch(s.dataType){case r.ANIMATIONTYPE_MATRIX:A.value.decompose(l.keyScaling,l.keyQuaternion,l.keyPosition),l.keyPosition.subtractInPlace(l.referencePosition),l.keyScaling.divideInPlace(l.referenceScaling),l.referenceQuaternion.multiplyToRef(l.keyQuaternion,l.keyQuaternion),O.ComposeToRef(l.keyScaling,l.keyQuaternion,l.keyPosition,A.value);break;case r.ANIMATIONTYPE_QUATERNION:l.referenceValue.multiplyToRef(A.value,A.value);break;case r.ANIMATIONTYPE_VECTOR2:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:A.value.subtractToRef(l.referenceValue,A.value);break;case r.ANIMATIONTYPE_SIZE:A.value.width-=l.referenceValue.width,A.value.height-=l.referenceValue.height;break;default:A.value-=l.referenceValue}}return s},r.TransitionTo=function(t,e,i,n,o,s,a,u){if(u===void 0&&(u=null),a<=0)return i[t]=e,u&&u(),null;var h=o*(a/1e3);s.setKeys([{frame:0,value:i[t].clone?i[t].clone():i[t]},{frame:h,value:e}]),i.animations||(i.animations=[]),i.animations.push(s);var f=n.beginAnimation(i,0,h,!1);return f.onAnimationEnd=u,f},Object.defineProperty(r.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var t=0,e=this._runtimeAnimations;t<e.length;t++){var i=e[t];if(!i.isStopped)return!0}return!1},enumerable:!1,configurable:!0}),r.prototype.toString=function(t){var e="Name: "+this.name+", property: "+this.targetProperty;if(e+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],e+=", nKeys: "+(this._keys?this._keys.length:"none"),e+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),t){e+=", Ranges: {";var i=!0;for(var n in this._ranges)i&&(e+=", ",i=!1),e+=n;e+="}"}return e},r.prototype.addEvent=function(t){this._events.push(t),this._events.sort(function(e,i){return e.frame-i.frame})},r.prototype.removeEvents=function(t){for(var e=0;e<this._events.length;e++)this._events[e].frame===t&&(this._events.splice(e,1),e--)},r.prototype.getEvents=function(){return this._events},r.prototype.createRange=function(t,e,i){this._ranges[t]||(this._ranges[t]=new Je(t,e,i))},r.prototype.deleteRange=function(t,e){e===void 0&&(e=!0);var i=this._ranges[t];if(!!i){if(e)for(var n=i.from,o=i.to,s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=n&&this._keys[s].frame<=o&&this._keys.splice(s,1);this._ranges[t]=null}},r.prototype.getRange=function(t){return this._ranges[t]},r.prototype.getKeys=function(){return this._keys},r.prototype.getHighestFrame=function(){for(var t=0,e=0,i=this._keys.length;e<i;e++)t<this._keys[e].frame&&(t=this._keys[e].frame);return t},r.prototype.getEasingFunction=function(){return this._easingFunction},r.prototype.setEasingFunction=function(t){this._easingFunction=t},r.prototype.floatInterpolateFunction=function(t,e,i){return L.Lerp(t,e,i)},r.prototype.floatInterpolateFunctionWithTangents=function(t,e,i,n,o){return L.Hermite(t,e,i,n,o)},r.prototype.quaternionInterpolateFunction=function(t,e,i){return N.Slerp(t,e,i)},r.prototype.quaternionInterpolateFunctionWithTangents=function(t,e,i,n,o){return N.Hermite(t,e,i,n,o).normalize()},r.prototype.vector3InterpolateFunction=function(t,e,i){return g.Lerp(t,e,i)},r.prototype.vector3InterpolateFunctionWithTangents=function(t,e,i,n,o){return g.Hermite(t,e,i,n,o)},r.prototype.vector2InterpolateFunction=function(t,e,i){return G.Lerp(t,e,i)},r.prototype.vector2InterpolateFunctionWithTangents=function(t,e,i,n,o){return G.Hermite(t,e,i,n,o)},r.prototype.sizeInterpolateFunction=function(t,e,i){return We.Lerp(t,e,i)},r.prototype.color3InterpolateFunction=function(t,e,i){return pt.Lerp(t,e,i)},r.prototype.color4InterpolateFunction=function(t,e,i){return J.Lerp(t,e,i)},r.prototype._getKeyValue=function(t){return typeof t=="function"?t():t},r.prototype._interpolate=function(t,e){if(e.loopMode===r.ANIMATIONLOOPMODE_CONSTANT&&e.repeatCount>0)return e.highLimitValue.clone?e.highLimitValue.clone():e.highLimitValue;var i=this._keys;if(i.length===1)return this._getKeyValue(i[0].value);var n=e.key;if(i[n].frame>=t)for(;n-1>=0&&i[n].frame>=t;)n--;for(var o=n;o<i.length;o++){var s=i[o+1];if(s.frame>=t){e.key=o;var a=i[o],u=this._getKeyValue(a.value);if(a.interpolation===Re.STEP)return u;var h=this._getKeyValue(s.value),f=a.outTangent!==void 0&&s.inTangent!==void 0,l=s.frame-a.frame,c=(t-a.frame)/l,p=this.getEasingFunction();switch(p!=null&&(c=p.ease(c)),this.dataType){case r.ANIMATIONTYPE_FLOAT:var d=f?this.floatInterpolateFunctionWithTangents(u,a.outTangent*l,h,s.inTangent*l,c):this.floatInterpolateFunction(u,h,c);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return d;case r.ANIMATIONLOOPMODE_RELATIVE:return e.offsetValue*e.repeatCount+d}break;case r.ANIMATIONTYPE_QUATERNION:var v=f?this.quaternionInterpolateFunctionWithTangents(u,a.outTangent.scale(l),h,s.inTangent.scale(l),c):this.quaternionInterpolateFunction(u,h,c);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return v;case r.ANIMATIONLOOPMODE_RELATIVE:return v.addInPlace(e.offsetValue.scale(e.repeatCount))}return v;case r.ANIMATIONTYPE_VECTOR3:var y=f?this.vector3InterpolateFunctionWithTangents(u,a.outTangent.scale(l),h,s.inTangent.scale(l),c):this.vector3InterpolateFunction(u,h,c);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return y;case r.ANIMATIONLOOPMODE_RELATIVE:return y.add(e.offsetValue.scale(e.repeatCount))}case r.ANIMATIONTYPE_VECTOR2:var b=f?this.vector2InterpolateFunctionWithTangents(u,a.outTangent.scale(l),h,s.inTangent.scale(l),c):this.vector2InterpolateFunction(u,h,c);switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return b;case r.ANIMATIONLOOPMODE_RELATIVE:return b.add(e.offsetValue.scale(e.repeatCount))}case r.ANIMATIONTYPE_SIZE:switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(u,h,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(u,h,c).add(e.offsetValue.scale(e.repeatCount))}case r.ANIMATIONTYPE_COLOR3:switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(u,h,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(u,h,c).add(e.offsetValue.scale(e.repeatCount))}case r.ANIMATIONTYPE_COLOR4:switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(u,h,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(u,h,c).add(e.offsetValue.scale(e.repeatCount))}case r.ANIMATIONTYPE_MATRIX:switch(e.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:if(r.AllowMatricesInterpolation)return this.matrixInterpolateFunction(u,h,c,e.workValue);case r.ANIMATIONLOOPMODE_RELATIVE:return u}}break}}return this._getKeyValue(i[i.length-1].value)},r.prototype.matrixInterpolateFunction=function(t,e,i,n){return r.AllowMatrixDecomposeForInterpolation?n?(O.DecomposeLerpToRef(t,e,i,n),n):O.DecomposeLerp(t,e,i):n?(O.LerpToRef(t,e,i,n),n):O.Lerp(t,e,i)},r.prototype.clone=function(){var t=new r(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed,this._keys&&t.setKeys(this._keys),this._ranges){t._ranges={};for(var e in this._ranges){var i=this._ranges[e];!i||(t._ranges[e]=i.clone())}}return t},r.prototype.setKeys=function(t){this._keys=t.slice(0)},r.prototype.serialize=function(){var t={};t.name=this.name,t.property=this.targetProperty,t.framePerSecond=this.framePerSecond,t.dataType=this.dataType,t.loopBehavior=this.loopMode,t.enableBlending=this.enableBlending,t.blendingSpeed=this.blendingSpeed;var e=this.dataType;t.keys=[];for(var i=this.getKeys(),n=0;n<i.length;n++){var o=i[n],s={};switch(s.frame=o.frame,e){case r.ANIMATIONTYPE_FLOAT:s.values=[o.value],o.inTangent!==void 0&&s.values.push(o.inTangent),o.outTangent!==void 0&&(o.inTangent===void 0&&s.values.push(void 0),s.values.push(o.outTangent));break;case r.ANIMATIONTYPE_QUATERNION:case r.ANIMATIONTYPE_MATRIX:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:s.values=o.value.asArray(),o.inTangent!=null&&s.values.push(o.inTangent.asArray()),o.outTangent!=null&&(o.inTangent===void 0&&s.values.push(void 0),s.values.push(o.outTangent.asArray()));break}t.keys.push(s)}t.ranges=[];for(var a in this._ranges){var u=this._ranges[a];if(!!u){var h={};h.name=a,h.from=u.from,h.to=u.to,t.ranges.push(h)}}return t},r._UniversalLerp=function(t,e,i){var n=t.constructor;return n.Lerp?n.Lerp(t,e,i):n.Slerp?n.Slerp(t,e,i):t.toFixed?t*(1-i)+i*e:e},r.Parse=function(t){var e=new r(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),i=t.dataType,n=[],o,s;for(t.enableBlending&&(e.enableBlending=t.enableBlending),t.blendingSpeed&&(e.blendingSpeed=t.blendingSpeed),s=0;s<t.keys.length;s++){var a=t.keys[s],u,h;switch(i){case r.ANIMATIONTYPE_FLOAT:o=a.values[0],a.values.length>=1&&(u=a.values[1]),a.values.length>=2&&(h=a.values[2]);break;case r.ANIMATIONTYPE_QUATERNION:if(o=N.FromArray(a.values),a.values.length>=8){var f=N.FromArray(a.values.slice(4,8));f.equals(N.Zero())||(u=f)}if(a.values.length>=12){var l=N.FromArray(a.values.slice(8,12));l.equals(N.Zero())||(h=l)}break;case r.ANIMATIONTYPE_MATRIX:o=O.FromArray(a.values);break;case r.ANIMATIONTYPE_COLOR3:o=pt.FromArray(a.values);break;case r.ANIMATIONTYPE_COLOR4:o=J.FromArray(a.values);break;case r.ANIMATIONTYPE_VECTOR3:default:o=g.FromArray(a.values);break}var c={};c.frame=a.frame,c.value=o,u!=null&&(c.inTangent=u),h!=null&&(c.outTangent=h),n.push(c)}if(e.setKeys(n),t.ranges)for(s=0;s<t.ranges.length;s++)o=t.ranges[s],e.createRange(o.name,o.from,o.to);return e},r.AppendSerializedAnimations=function(t,e){j.AppendSerializedAnimations(t,e)},r.ParseFromFileAsync=function(t,e){var i=this;return new Promise(function(n,o){var s=new Vt;s.addEventListener("readystatechange",function(){if(s.readyState==4)if(s.status==200){var a=JSON.parse(s.responseText);if(a.length){for(var u=new Array,h=0,f=a;h<f.length;h++){var l=f[h];u.push(i.Parse(l))}n(u)}else{var u=i.Parse(a);t&&(u.name=t),n(u)}}else o("Unable to load the animation")}),s.open("GET",e),s.send()})},r.CreateFromSnippetAsync=function(t){var e=this;return new Promise(function(i,n){var o=new Vt;o.addEventListener("readystatechange",function(){if(o.readyState==4)if(o.status==200){var s=JSON.parse(JSON.parse(o.responseText).jsonPayload);if(s.animations){for(var a=JSON.parse(s.animations),u=new Array,h=0,f=a;h<f.length;h++){var l=f[h];u.push(e.Parse(l))}i(u)}else{var a=JSON.parse(s.animation),u=e.Parse(a);u.snippetId=t,i(u)}}else n("Unable to load the snippet "+t)}),o.open("GET",e.SnippetUrl+"/"+t.replace(/#/g,"/")),o.send()})},r.AllowMatricesInterpolation=!1,r.AllowMatrixDecomposeForInterpolation=!0,r.SnippetUrl="https://snippet.babylonjs.com",r.ANIMATIONTYPE_FLOAT=0,r.ANIMATIONTYPE_VECTOR3=1,r.ANIMATIONTYPE_QUATERNION=2,r.ANIMATIONTYPE_MATRIX=3,r.ANIMATIONTYPE_COLOR3=4,r.ANIMATIONTYPE_COLOR4=7,r.ANIMATIONTYPE_VECTOR2=5,r.ANIMATIONTYPE_SIZE=6,r.ANIMATIONLOOPMODE_RELATIVE=0,r.ANIMATIONLOOPMODE_CYCLE=1,r.ANIMATIONLOOPMODE_CONSTANT=2,r}();nt.RegisteredTypes["BABYLON.Animation"]=ct;vt._AnimationRangeFactory=function(r,t,e){return new Je(r,t,e)};var Qi=function(){function r(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(r.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(t){var e=this;if(this._autoTransitionRange!==t){this._autoTransitionRange=t;var i=this._attachedCamera;!i||(t?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(n){if(!!n){n.computeWorldMatrix(!0);var o=n.getBoundingInfo().diagonalLength;e.lowerRadiusTransitionRange=o*.05,e.upperRadiusTransitionRange=o*.05}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(t){var e=this;this._attachedCamera=t,this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){!e._attachedCamera||(e._isRadiusAtLimit(e._attachedCamera.lowerRadiusLimit)&&e._applyBoundRadiusAnimation(e.lowerRadiusTransitionRange),e._isRadiusAtLimit(e._attachedCamera.upperRadiusLimit)&&e._applyBoundRadiusAnimation(e.upperRadiusTransitionRange))})},r.prototype.detach=function(){!this._attachedCamera||(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},r.prototype._isRadiusAtLimit=function(t){return this._attachedCamera?this._attachedCamera.radius===t&&!this._radiusIsAnimating:!1},r.prototype._applyBoundRadiusAnimation=function(t){var e=this;if(!!this._attachedCamera){this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=ct.CreateAnimation("radius",ct.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=ct.TransitionTo("radius",this._attachedCamera.radius+t,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return e._clearAnimationLocks()});i&&this._animatables.push(i)}},r.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},r.EasingFunction=new Xi(.3),r.EasingMode=ot.EASINGMODE_EASEOUT,r}(),Zi=function(){function r(){this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(r.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(t){this._radiusScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"positionScale",{get:function(){return this._positionScale},set:function(t){this._positionScale=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(t){this._defaultElevation=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(t){this._elevationReturnTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(t){this._elevationReturnWaitTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(t){this._zoomStopsAnimation=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"framingTime",{get:function(){return this._framingTime},set:function(t){this._framingTime=t},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(t){var e=this;this._attachedCamera=t;var i=this._attachedCamera.getScene();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(n){if(n.type===w.POINTERDOWN){e._isPointerDown=!0;return}n.type===w.POINTERUP&&(e._isPointerDown=!1)}),this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add(function(n){n&&e.zoomOnMesh(n)}),this._onAfterCheckInputsObserver=t.onAfterCheckInputsObservable.add(function(){e._applyUserInteraction(),e._maintainCameraAboveGround()})},r.prototype.detach=function(){if(!!this._attachedCamera){var t=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&t.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},r.prototype.zoomOnMesh=function(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=null),t.computeWorldMatrix(!0);var n=t.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,e,i)},r.prototype.zoomOnMeshHierarchy=function(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=null),t.computeWorldMatrix(!0);var n=t.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,e,i)},r.prototype.zoomOnMeshesHierarchy=function(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=null);for(var n=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new g(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=0;s<t.length;s++){var a=t[s].getHierarchyBoundingVectors(!0);g.CheckExtends(a.min,n,o),g.CheckExtends(a.max,n,o)}this.zoomOnBoundingInfo(n,o,e,i)},r.prototype.zoomOnBoundingInfo=function(t,e,i,n){var o=this;i===void 0&&(i=!1),n===void 0&&(n=null);var s;if(!!this._attachedCamera){var a=t.y,u=e.y,h=a+(u-a)*this._positionScale,f=e.subtract(t).scale(.5);if(i)s=new g(0,h,0);else{var l=t.add(f);s=new g(l.x,h,l.z)}this._vectorTransition||(this._vectorTransition=ct.CreateAnimation("target",ct.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;var c=ct.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);c&&this._animatables.push(c);var p=0;if(this._mode===r.FitFrustumSidesMode){var d=this._calculateLowerRadiusFromModelBoundingSphere(t,e);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=f.length()+this._attachedCamera.minZ),p=d}else this._mode===r.IgnoreBoundsSizeMode&&(p=this._calculateLowerRadiusFromModelBoundingSphere(t,e),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var v=e.subtract(t).length();this._attachedCamera.panningSensibility=5e3/v,this._attachedCamera.wheelPrecision=100/p}this._radiusTransition||(this._radiusTransition=ct.CreateAnimation("radius",ct.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),c=ct.TransitionTo("radius",p,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){o.stopAllAnimations(),n&&n(),o._attachedCamera&&o._attachedCamera.useInputToRestoreState&&o._attachedCamera.storeState()}),c&&this._animatables.push(c)}},r.prototype._calculateLowerRadiusFromModelBoundingSphere=function(t,e){var i=e.subtract(t),n=i.length(),o=this._getFrustumSlope(),s=n*.5,a=s*this._radiusScale,u=a*Math.sqrt(1+1/(o.x*o.x)),h=a*Math.sqrt(1+1/(o.y*o.y)),f=Math.max(u,h),l=this._attachedCamera;return l?(l.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(f=f<l.lowerRadiusLimit?l.lowerRadiusLimit:f),l.upperRadiusLimit&&(f=f>l.upperRadiusLimit?l.upperRadiusLimit:f),f):0},r.prototype._maintainCameraAboveGround=function(){var t=this;if(!(this._elevationReturnTime<0)){var e=kt.Now-this._lastInteractionTime,i=Math.PI*.5-this._defaultElevation,n=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&e>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=ct.CreateAnimation("beta",ct.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));var o=ct.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){t._clearAnimationLocks(),t.stopAllAnimations()});o&&this._animatables.push(o)}}},r.prototype._getFrustumSlope=function(){var t=this._attachedCamera;if(!t)return G.Zero();var e=t.getScene().getEngine(),i=e.getAspectRatio(t),n=Math.tan(t.fov/2),o=n*i;return new G(o,n)},r.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},r.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=kt.Now,this.stopAllAnimations(),this._clearAnimationLocks())},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(r.prototype,"isUserIsMoving",{get:function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},enumerable:!1,configurable:!0}),r.EasingFunction=new qi,r.EasingMode=ot.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1,r}(),Ji=function(r){U(t,r);function t(e,i,n,o){o===void 0&&(o=!0);var s=r.call(this,e,i,n,o)||this;return s._tmpUpVector=g.Zero(),s._tmpTargetVector=g.Zero(),s.cameraDirection=new g(0,0,0),s.cameraRotation=new G(0,0),s.ignoreParentScaling=!1,s.updateUpVectorFromRotation=!1,s._tmpQuaternion=new N,s.rotation=new g(0,0,0),s.speed=2,s.noRotationConstraint=!1,s.invertRotation=!1,s.inverseRotationSpeed=.2,s.lockedTarget=null,s._currentTarget=g.Zero(),s._initialFocalDistance=1,s._viewMatrix=O.Zero(),s._camMatrix=O.Zero(),s._cameraTransformMatrix=O.Zero(),s._cameraRotationMatrix=O.Zero(),s._referencePoint=new g(0,0,1),s._transformedReferencePoint=g.Zero(),s._defaultUp=g.Up(),s._cachedRotationZ=0,s._cachedQuaternionRotationZ=0,s}return t.prototype.getFrontPosition=function(e){this.getWorldMatrix();var i=this.getTarget().subtract(this.position);return i.normalize(),i.scaleInPlace(e),this.globalPosition.add(i)},t.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},t.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),r.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return r.prototype._restoreStateValues.call(this)?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1},t.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.lockedTarget=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new N(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},t.prototype._updateCache=function(e){e||r.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},t.prototype._isSynchronizedViewMatrix=function(){if(!r.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},t.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*Math.sqrt(e.getDeltaTime()/(e.getFps()*100))},t.prototype.setTarget=function(e){this.upVector.normalize(),this._initialFocalDistance=e.subtract(this.position).length(),this.position.z===e.z&&(this.position.z+=X),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),O.LookAtLHToRef(this.position,e,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=e.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(t.prototype,"target",{get:function(){return this.getTarget()},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),t.prototype.getTarget=function(){return this._currentTarget},t.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},t.prototype._updatePosition=function(){if(this.parent){this.parent.getWorldMatrix().invertToRef(C.Matrix[0]),g.TransformNormalToRef(this.cameraDirection,C.Matrix[0],C.Vector3[0]),this.position.addInPlace(C.Vector3[0]);return}this.position.addInPlace(this.cameraDirection)},t.prototype._checkInputs=function(){var e=this.invertRotation?-this.inverseRotationSpeed:1,i=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),n){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*e,this.rotation.y+=this.cameraRotation.y*e,!this.noRotationConstraint){var o=1.570796;this.rotation.x>o&&(this.rotation.x=o),this.rotation.x<-o&&(this.rotation.x=-o)}if(this.rotationQuaternion){var s=this.rotation.lengthSquared();s&&N.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*X&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*X&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*X&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*X&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*X&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),r.prototype._checkInputs.call(this)},t.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):O.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},t.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return g.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},t.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),g.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?ye.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(N.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),ye.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},t.prototype._computeViewMatrix=function(e,i,n){if(this.ignoreParentScaling){if(this.parent){var o=this.parent.getWorldMatrix();g.TransformCoordinatesToRef(e,o,this._globalPosition),g.TransformCoordinatesToRef(i,o,this._tmpTargetVector),g.TransformNormalToRef(n,o,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e),this._tmpTargetVector.copyFrom(i),this._tmpUpVector.copyFrom(n);this.getScene().useRightHandedSystem?O.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):O.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?O.LookAtRHToRef(e,i,n,this._viewMatrix):O.LookAtLHToRef(e,i,n,this._viewMatrix),this.parent){var o=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(o,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(e)},t.prototype.createRigCamera=function(e,i){if(this.cameraRigMode!==V.RIG_MODE_NONE){var n=new t(e,this.position.clone(),this.getScene());return n.isRigCamera=!0,n.rigParent=this,(this.cameraRigMode===V.RIG_MODE_VR||this.cameraRigMode===V.RIG_MODE_WEBVR)&&(this.rotationQuaternion||(this.rotationQuaternion=new N),n._cameraRigParams={},n.rotationQuaternion=new N),n}return null},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.RIG_MODE_STEREOSCOPIC_INTERLACED:var n=this.cameraRigMode===V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,e),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*o,i);break;case V.RIG_MODE_VR:e.rotationQuaternion?(e.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),e.position.copyFrom(this.position),i.position.copyFrom(this.position);break}r.prototype._updateRigCameras.call(this)},t.prototype._getRigCamPositionAndTarget=function(e,i){var n=this.getTarget();n.subtractToRef(this.position,t._TargetFocalPoint),t._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var o=t._TargetFocalPoint.addInPlace(this.position);O.TranslationToRef(-o.x,-o.y,-o.z,t._TargetTransformMatrix),t._TargetTransformMatrix.multiplyToRef(O.RotationAxis(i.upVector,e),t._RigCamTransformMatrix),O.TranslationToRef(o.x,o.y,o.z,t._TargetTransformMatrix),t._RigCamTransformMatrix.multiplyToRef(t._TargetTransformMatrix,t._RigCamTransformMatrix),g.TransformCoordinatesToRef(this.position,t._RigCamTransformMatrix,i.position),i.setTarget(o)},t.prototype.getClassName=function(){return"TargetCamera"},t._RigCamTransformMatrix=new O,t._TargetTransformMatrix=new O,t._TargetFocalPoint=new g,P([wt()],t.prototype,"rotation",void 0),P([T()],t.prototype,"speed",void 0),P([Pi("lockedTargetId")],t.prototype,"lockedTarget",void 0),t}(V),Qt={},$i=function(){function r(t){this.attachedToElement=!1,this.attached={},this.camera=t,this.checkInputs=function(){}}return r.prototype.add=function(t){var e=t.getSimpleName();if(this.attached[e]){z.Warn("camera input of type "+e+" already exists on camera");return}this.attached[e]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),this.attachedToElement&&t.attachControl()},r.prototype.remove=function(t){for(var e in this.attached){var i=this.attached[e];i===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},r.prototype.removeByType=function(t){for(var e in this.attached){var i=this.attached[e];i.getClassName()===t&&(i.detachControl(),i.camera=null,delete this.attached[e],this.rebuildInputCheck())}},r.prototype._addCheckInputs=function(t){var e=this.checkInputs;return function(){e(),t()}},r.prototype.attachInput=function(t){this.attachedToElement&&t.attachControl(this.noPreventDefault)},r.prototype.attachElement=function(t){if(t===void 0&&(t=!1),!this.attachedToElement){t=V.ForceAttachControlToAlwaysPreventDefault?!1:t,this.attachedToElement=!0,this.noPreventDefault=t;for(var e in this.attached)this.attached[e].attachControl(t)}},r.prototype.detachElement=function(t){t===void 0&&(t=!1);for(var e in this.attached)this.attached[e].detachControl(),t&&(this.attached[e].camera=null);this.attachedToElement=!1},r.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var t in this.attached){var e=this.attached[t];e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e)))}},r.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},r.prototype.serialize=function(t){var e={};for(var i in this.attached){var n=this.attached[i],o=j.Serialize(n);e[n.getClassName()]=o}t.inputsmgr=e},r.prototype.parse=function(t){var e=t.inputsmgr;if(e){this.clear();for(var i in e){var n=Qt[i];if(n){var o=e[i],s=j.Parse(function(){return new n},o,null);this.add(s)}}}else for(var i in this.attached){var n=Qt[this.attached[i].getClassName()];if(n){var s=j.Parse(function(){return new n},t,null);this.remove(this.attached[i]),this.add(s)}}},r}(),tr=function(){function r(){this.buttons=[0,1,2]}return r.prototype.attachControl=function(t){var e=this;t=K.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),n=i.getInputElement(),o=0,s=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(u,h){var f=u.event,l=f.pointerType==="touch";if(!i.isInVRExclusivePointerMode&&!(u.type!==w.POINTERMOVE&&e.buttons.indexOf(f.button)===-1)){var c=f.srcElement||f.target;if(e._altKey=f.altKey,e._ctrlKey=f.ctrlKey,e._metaKey=f.metaKey,e._shiftKey=f.shiftKey,e._buttonsPressed=f.buttons,i.isPointerLock){var p=f.movementX||f.mozMovementX||f.webkitMovementX||f.msMovementX||0,d=f.movementY||f.mozMovementY||f.webkitMovementY||f.msMovementY||0;e.onTouch(null,p,d),e.pointA=null,e.pointB=null}else if(u.type===w.POINTERDOWN&&c){try{c.setPointerCapture(f.pointerId)}catch{}e.pointA===null?e.pointA={x:f.clientX,y:f.clientY,pointerId:f.pointerId,type:f.pointerType}:e.pointB===null&&(e.pointB={x:f.clientX,y:f.clientY,pointerId:f.pointerId,type:f.pointerType}),e.onButtonDown(f),t||(f.preventDefault(),n&&n.focus())}else if(u.type===w.POINTERDOUBLETAP)e.onDoubleTap(f.pointerType);else if(u.type===w.POINTERUP&&c){try{c.releasePointerCapture(f.pointerId)}catch{}l||(e.pointB=null),i._badOS?e.pointA=e.pointB=null:e.pointB&&e.pointA&&e.pointA.pointerId==f.pointerId?(e.pointA=e.pointB,e.pointB=null):e.pointA&&e.pointB&&e.pointB.pointerId==f.pointerId?e.pointB=null:e.pointA=e.pointB=null,(o!==0||s)&&(e.onMultiTouch(e.pointA,e.pointB,o,0,s,null),o=0,s=null),e.onButtonUp(f),t||f.preventDefault()}else if(u.type===w.POINTERMOVE){if(t||f.preventDefault(),e.pointA&&e.pointB===null){var p=f.clientX-e.pointA.x,d=f.clientY-e.pointA.y;e.onTouch(e.pointA,p,d),e.pointA.x=f.clientX,e.pointA.y=f.clientY}else if(e.pointA&&e.pointB){var v=e.pointA.pointerId===f.pointerId?e.pointA:e.pointB;v.x=f.clientX,v.y=f.clientY;var y=e.pointA.x-e.pointB.x,b=e.pointA.y-e.pointB.y,m=y*y+b*b,M={x:(e.pointA.x+e.pointB.x)/2,y:(e.pointA.y+e.pointB.y)/2,pointerId:f.pointerId,type:u.type};e.onMultiTouch(e.pointA,e.pointB,o,m,s,M),s=M,o=m}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,w.POINTERDOWN|w.POINTERUP|w.POINTERMOVE),this._onLostFocus=function(){e.pointA=e.pointB=null,o=0,s=null,e.onLostFocus()},n&&n.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var a=this.camera.getScene().getEngine().getHostWindow();a&&K.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])},r.prototype.detachControl=function(t){if(this._onLostFocus){var e=this.camera.getScene().getEngine().getHostWindow();e&&K.UnregisterTopRootEvents(e,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var i=this.camera.getScene().getEngine().getInputElement();i&&i.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},r.prototype.getClassName=function(){return"BaseCameraPointersInput"},r.prototype.getSimpleName=function(){return"pointers"},r.prototype.onDoubleTap=function(t){},r.prototype.onTouch=function(t,e,i){},r.prototype.onMultiTouch=function(t,e,i,n,o,s){},r.prototype.onContextMenu=function(t){t.preventDefault()},r.prototype.onButtonDown=function(t){},r.prototype.onButtonUp=function(t){},r.prototype.onLostFocus=function(){},P([T()],r.prototype,"buttons",void 0),r}(),$e=function(r){U(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.buttons=[0,1,2],e.angularSensibilityX=1e3,e.angularSensibilityY=1e3,e.pinchPrecision=12,e.pinchDeltaPercentage=0,e.useNaturalPinchZoom=!1,e.panningSensibility=1e3,e.multiTouchPanning=!0,e.multiTouchPanAndZoom=!0,e.pinchInwards=!0,e._isPanClick=!1,e._twoFingerActivityCount=0,e._isPinching=!1,e}return t.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},t.prototype.onTouch=function(e,i,n){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},t.prototype.onDoubleTap=function(e){this.camera.useInputToRestoreState&&this.camera.restoreState()},t.prototype.onMultiTouch=function(e,i,n,o,s,a){if(!(n===0&&s===null)&&!(o===0&&a===null)){var u=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(n)/Math.sqrt(o):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(o-n)*.001*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-n)/(this.pinchPrecision*u*(this.angularSensibilityX+this.angularSensibilityY)/2),this.panningSensibility!==0&&s&&a){var h=a.x-s.x,f=a.y-s.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}else{this._twoFingerActivityCount++;var l=Math.sqrt(n),c=Math.sqrt(o);if(this._isPinching||this._twoFingerActivityCount<20&&Math.abs(c-l)>this.camera.pinchToPanMaxDistance)this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(o-n)*.001*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(o-n)/(this.pinchPrecision*u*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0;else if(this.panningSensibility!==0&&this.multiTouchPanning&&a&&s){var h=a.x-s.x,f=a.y-s.y;this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}}},t.prototype.onButtonDown=function(e){this._isPanClick=e.button===this.camera._panningMouseButton},t.prototype.onButtonUp=function(e){this._twoFingerActivityCount=0,this._isPinching=!1},t.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},P([T()],t.prototype,"buttons",void 0),P([T()],t.prototype,"angularSensibilityX",void 0),P([T()],t.prototype,"angularSensibilityY",void 0),P([T()],t.prototype,"pinchPrecision",void 0),P([T()],t.prototype,"pinchDeltaPercentage",void 0),P([T()],t.prototype,"useNaturalPinchZoom",void 0),P([T()],t.prototype,"panningSensibility",void 0),P([T()],t.prototype,"multiTouchPanning",void 0),P([T()],t.prototype,"multiTouchPanAndZoom",void 0),t}(tr);Qt.ArcRotateCameraPointersInput=$e;var ti=function(){function r(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return r.prototype.attachControl=function(t){var e=this;t=K.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){e._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(!n.metaKey){if(i.type===Ae.KEYDOWN){if(e._ctrlPressed=n.ctrlKey,e._altPressed=n.altKey,e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysReset.indexOf(n.keyCode)!==-1){var o=e._keys.indexOf(n.keyCode);o===-1&&e._keys.push(n.keyCode),n.preventDefault&&(t||n.preventDefault())}}else if(e.keysUp.indexOf(n.keyCode)!==-1||e.keysDown.indexOf(n.keyCode)!==-1||e.keysLeft.indexOf(n.keyCode)!==-1||e.keysRight.indexOf(n.keyCode)!==-1||e.keysReset.indexOf(n.keyCode)!==-1){var o=e._keys.indexOf(n.keyCode);o>=0&&e._keys.splice(o,1),n.preventDefault&&(t||n.preventDefault())}}}))},r.prototype.detachControl=function(t){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},r.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var t=this.camera,e=0;e<this._keys.length;e++){var i=this._keys[e];this.keysLeft.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX-=1/this.panningSensibility:t.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset+=1/this.zoomingSensibility:t.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningX+=1/this.panningSensibility:t.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?t.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?t.inertialRadiusOffset-=1/this.zoomingSensibility:t.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(i)!==-1&&t.useInputToRestoreState&&t.restoreState()}},r.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},r.prototype.getSimpleName=function(){return"keyboard"},P([T()],r.prototype,"keysUp",void 0),P([T()],r.prototype,"keysDown",void 0),P([T()],r.prototype,"keysLeft",void 0),P([T()],r.prototype,"keysRight",void 0),P([T()],r.prototype,"keysReset",void 0),P([T()],r.prototype,"panningSensibility",void 0),P([T()],r.prototype,"zoomingSensibility",void 0),P([T()],r.prototype,"useAltToZoom",void 0),P([T()],r.prototype,"angularSpeed",void 0),r}();Qt.ArcRotateCameraKeyboardMoveInput=ti;var ei=function(){function r(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return r.prototype.computeDeltaFromMouseWheelLegacyEvent=function(t,e){var i=0,n=t*.01*this.wheelDeltaPercentage*e;return t>0?i=n/(1+this.wheelDeltaPercentage):i=n*(1+this.wheelDeltaPercentage),i},r.prototype.attachControl=function(t){var e=this;t=K.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i,n){if(i.type===w.POINTERWHEEL){var o=i.event,s=0,a=o,u=0;if(a.wheelDelta?u=a.wheelDelta:u=-(o.deltaY||o.detail)*60,e.wheelDeltaPercentage){if(s=e.computeDeltaFromMouseWheelLegacyEvent(u,e.camera.radius),s>0){for(var h=e.camera.radius,f=e.camera.inertialRadiusOffset+s,l=0;l<20&&Math.abs(f)>.001;l++)h-=f,f*=e.camera.inertia;h=L.Clamp(h,0,Number.MAX_VALUE),s=e.computeDeltaFromMouseWheelLegacyEvent(u,h)}}else s=u/(e.wheelPrecision*40);s&&(e.camera.inertialRadiusOffset+=s),o.preventDefault&&(t||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,w.POINTERWHEEL)},r.prototype.detachControl=function(t){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},r.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},r.prototype.getSimpleName=function(){return"mousewheel"},P([T()],r.prototype,"wheelPrecision",void 0),P([T()],r.prototype,"wheelDeltaPercentage",void 0),r}();Qt.ArcRotateCameraMouseWheelInput=ei;var er=function(r){U(t,r);function t(e){return r.call(this,e)||this}return t.prototype.addMouseWheel=function(){return this.add(new ei),this},t.prototype.addPointers=function(){return this.add(new $e),this},t.prototype.addKeyboard=function(){return this.add(new ti),this},t}($i);vt.AddNodeConstructor("ArcRotateCamera",function(r,t){return function(){return new ii(r,0,0,1,g.Zero(),t)}});var ii=function(r){U(t,r);function t(e,i,n,o,s,a,u){u===void 0&&(u=!0);var h=r.call(this,e,g.Zero(),a,u)||this;return h.inertialAlphaOffset=0,h.inertialBetaOffset=0,h.inertialRadiusOffset=0,h.lowerAlphaLimit=null,h.upperAlphaLimit=null,h.lowerBetaLimit=.01,h.upperBetaLimit=Math.PI-.01,h.lowerRadiusLimit=null,h.upperRadiusLimit=null,h.inertialPanningX=0,h.inertialPanningY=0,h.pinchToPanMaxDistance=20,h.panningDistanceLimit=null,h.panningOriginTarget=g.Zero(),h.panningInertia=.9,h.zoomOnFactor=1,h.targetScreenOffset=G.Zero(),h.allowUpsideDown=!0,h.useInputToRestoreState=!0,h._viewMatrix=new O,h.panningAxis=new g(1,1,0),h.onMeshTargetChangedObservable=new E,h.checkCollisions=!1,h.collisionRadius=new g(.5,.5,.5),h._previousPosition=g.Zero(),h._collisionVelocity=g.Zero(),h._newPosition=g.Zero(),h._computationVector=g.Zero(),h._onCollisionPositionChange=function(f,l,c){c===void 0&&(c=null),c?(h.setPosition(l),h.onCollide&&h.onCollide(c)):h._previousPosition.copyFrom(h._position);var p=Math.cos(h.alpha),d=Math.sin(h.alpha),v=Math.cos(h.beta),y=Math.sin(h.beta);y===0&&(y=1e-4);var b=h._getTargetPosition();h._computationVector.copyFromFloats(h.radius*p*y,h.radius*v,h.radius*d*y),b.addToRef(h._computationVector,h._newPosition),h._position.copyFrom(h._newPosition);var m=h.upVector;h.allowUpsideDown&&h.beta<0&&(m=m.clone(),m=m.negate()),h._computeViewMatrix(h._position,b,m),h._viewMatrix.addAtIndex(12,h.targetScreenOffset.x),h._viewMatrix.addAtIndex(13,h.targetScreenOffset.y),h._collisionTriggered=!1},h._target=g.Zero(),s&&h.setTarget(s),h.alpha=i,h.beta=n,h.radius=o,h.getViewMatrix(),h.inputs=new er(h),h.inputs.addKeyboard().addMouseWheel().addPointers(),h}return Object.defineProperty(t.prototype,"target",{get:function(){return this._target},set:function(e){this.setTarget(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this.setPosition(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upToYMatrix||(this._YToUpMatrix=new O,this._upToYMatrix=new O,this._upVector=g.Zero()),e.normalize(),this._upVector.copyFrom(e),this.setMatUp()},enumerable:!1,configurable:!0}),t.prototype.setMatUp=function(){O.RotationAlignToRef(g.UpReadOnly,this._upVector,this._YToUpMatrix),O.RotationAlignToRef(this._upVector,g.UpReadOnly,this._upToYMatrix)},Object.defineProperty(t.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.pinchPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pinchDeltaPercentage",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchDeltaPercentage:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useNaturalPinchZoom",{get:function(){var e=this.inputs.attached.pointers;return e?e.useNaturalPinchZoom:!1},set:function(e){var i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:0},set:function(e){var i=this.inputs.attached.pointers;i&&(i.panningSensibility=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysUp=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysDown=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:[]},set:function(e){var i=this.inputs.attached.keyboard;i&&(i.keysRight=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:0},set:function(e){var i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wheelDeltaPercentage",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelDeltaPercentage:0},set:function(e){var i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(e){e!==this.useBouncingBehavior&&(e?(this._bouncingBehavior=new Qi,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(e){e!==this.useFramingBehavior&&(e?(this._framingBehavior=new Zi,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(e){e!==this.useAutoRotationBehavior&&(e?(this._autoRotationBehavior=new Hi,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),t.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache._target=new g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=G.Zero()},t.prototype._updateCache=function(e){e||r.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},t.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var e=this._targetHost.absolutePosition;this._targetBoundingCenter?e.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(e)}var i=this._getLockedTargetPosition();return i||this._target},t.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),r.prototype.storeState.call(this)},t.prototype._restoreStateValues=function(){return r.prototype._restoreStateValues.call(this)?(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1},t.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronizedViewMatrix.call(this)?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},t.prototype.attachControl=function(e,i,n,o){var s=this;n===void 0&&(n=!0),o===void 0&&(o=2),i=K.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=n,this._panningMouseButton=o,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(i),this._reset=function(){s.inertialAlphaOffset=0,s.inertialBetaOffset=0,s.inertialRadiusOffset=0,s.inertialPanningX=0,s.inertialPanningY=0}},t.prototype.detachControl=function(e){this.inputs.detachElement(),this._reset&&this._reset()},t.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var e=this.inertialAlphaOffset;this.beta<=0&&(e*=-1),this.getScene().useRightHandedSystem&&(e*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(e*=-1),this.alpha+=e,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<X&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<X&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*X&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){if(this._localDirection||(this._localDirection=g.Zero(),this._transformedDirection=g.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),g.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var i=g.DistanceSquared(this._transformedDirection,this.panningOriginTarget);i<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*X&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*X&&(this.inertialPanningY=0)}this._checkLimits(),r.prototype._checkInputs.call(this)}},t.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},t.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&g.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var e=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var i=Math.round((e-this.alpha)/(2*Math.PI));this.alpha+=i*2*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},t.prototype.setPosition=function(e){this._position.equals(e)||(this._position.copyFrom(e),this.rebuildAnglesAndRadius())},t.prototype.setTarget=function(e,i,n){if(i===void 0&&(i=!1),n===void 0&&(n=!1),e.getBoundingInfo)i?this._targetBoundingCenter=e.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,e.computeWorldMatrix(),this._targetHost=e,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var o=e,s=this._getTargetPosition();if(s&&!n&&s.equals(o))return;this._targetHost=null,this._target=o,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},t.prototype._getViewMatrix=function(){var e=Math.cos(this.alpha),i=Math.sin(this.alpha),n=Math.cos(this.beta),o=Math.sin(this.beta);o===0&&(o=1e-4),this.radius===0&&(this.radius=1e-4);var s=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*e*o,this.radius*n,this.radius*i*o),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&g.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),s.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var a=this.getScene().collisionCoordinator;this._collider||(this._collider=a.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,a.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var u=this.upVector;this.allowUpsideDown&&o<0&&(u=u.negate()),this._computeViewMatrix(this._position,s,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=s,this._viewMatrix},t.prototype.zoomOn=function(e,i){i===void 0&&(i=!1),e=e||this.getScene().meshes;var n=he.MinMax(e),o=g.Distance(n.min,n.max);this.radius=o*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:o},i)},t.prototype.focusOn=function(e,i){i===void 0&&(i=!1);var n,o;if(e.min===void 0){var s=e||this.getScene().meshes;n=he.MinMax(s),o=g.Distance(n.min,n.max)}else{var a=e;n=a,o=a.distance}this._target=he.Center(n),i||(this.maxZ=o*2)},t.prototype.createRigCamera=function(e,i){var n=0;switch(this.cameraRigMode){case V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(i===0?1:-1);break;case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(i===0?-1:1);break}var o=new t(e,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o},t.prototype._updateRigCameras=function(){var e=this._rigCameras[0],i=this._rigCameras[1];switch(e.beta=i.beta=this.beta,this.cameraRigMode){case V.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case V.RIG_MODE_STEREOSCOPIC_OVERUNDER:case V.RIG_MODE_STEREOSCOPIC_INTERLACED:case V.RIG_MODE_VR:e.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case V.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}r.prototype._updateRigCameras.call(this)},t.prototype.dispose=function(){this.inputs.clear(),r.prototype.dispose.call(this)},t.prototype.getClassName=function(){return"ArcRotateCamera"},P([T()],t.prototype,"alpha",void 0),P([T()],t.prototype,"beta",void 0),P([T()],t.prototype,"radius",void 0),P([wt("target")],t.prototype,"_target",void 0),P([T()],t.prototype,"inertialAlphaOffset",void 0),P([T()],t.prototype,"inertialBetaOffset",void 0),P([T()],t.prototype,"inertialRadiusOffset",void 0),P([T()],t.prototype,"lowerAlphaLimit",void 0),P([T()],t.prototype,"upperAlphaLimit",void 0),P([T()],t.prototype,"lowerBetaLimit",void 0),P([T()],t.prototype,"upperBetaLimit",void 0),P([T()],t.prototype,"lowerRadiusLimit",void 0),P([T()],t.prototype,"upperRadiusLimit",void 0),P([T()],t.prototype,"inertialPanningX",void 0),P([T()],t.prototype,"inertialPanningY",void 0),P([T()],t.prototype,"pinchToPanMaxDistance",void 0),P([T()],t.prototype,"panningDistanceLimit",void 0),P([wt()],t.prototype,"panningOriginTarget",void 0),P([T()],t.prototype,"panningInertia",void 0),P([T()],t.prototype,"zoomOnFactor",void 0),P([T()],t.prototype,"targetScreenOffset",void 0),P([T()],t.prototype,"allowUpsideDown",void 0),P([T()],t.prototype,"useInputToRestoreState",void 0),t}(Ji);const ir="FBUDLR",fe=Math.PI/2,ri=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,-1],[0,0,1]],rr=r=>{const t=new Vi(r),e=new ii("",.4,1.2,7,g.Zero(),t);return e.wheelPrecision=100,e.lowerRadiusLimit=6,e.upperRadiusLimit=8,e.attachControl(r.getRenderingCanvas(),!0),t.clearColor.set(.1,.1,.1,1),t.ambientColor.set(1,1,1),t},nr=(r,t,e)=>{const i=new Map(ri.map((n,o)=>{const s=n.findIndex(c=>c),a=fe*n[s],u="xyz"[s],h=`rotation.${u}`,f=c=>c.position.asArray().every((p,d)=>!n[d]||n[d]===p),l=new dt("",r);return l.position.set(...n),[ir[o],async(c,p=0)=>{if(!c)return;const d=a*c,v=t.filter(f);for(const y of v)y.setParent(l);p?await e(l,h,60,p,0,d,0):l.rotation[u]=d;for(const y of v)y.setParent(null),y.position.set(...y.position.asArray().map(b=>Math.round(b))),y.rotation.set(...y.rotation.asArray().map(b=>Math.round(b/fe)*fe));l.rotation.set(0,0,0)}]}));return(n,o,s)=>{var a;return(a=i.get(n))==null?void 0:a(o,s)}};var ar=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",HALF_PI:fe,POINTS:ri,createScene:rr,createRotator:nr});export{le as A,Tt as B,J as C,He as D,gi as G,fe as H,de as I,Fi as L,he as M,vt as N,qe as P,N as Q,Vi as S,_i as T,tt as V,nt as _,Ct as a,O as b,lt as c,pt as d,_ as e,We as f,j as g,Ai as h,g as i,C as j,Mi as k,wi as l,_t as m,Me as n,xe as o,sr as p,K as q,dt as r,T as s,G as t,ct as u,Ot as v,et as w,ri as x,ar as y};
//# sourceMappingURL=scene.166bd9f8.js.map
