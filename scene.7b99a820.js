import{_ as Ne}from"./index.792b56aa.js";import{S as Se,L as K,_ as Y,q as Tt,s as Le,O as T,D as mt,v as st,x as S,P as Ie,y as Et,z as m,E as Ue,W as xe,A as Fe,B as Ht}from"./vendor.db607760.js";var pe=function(i,t){return!i||i.getClassName&&i.getClassName()==="Mesh"?null:i.getClassName&&i.getClassName()==="SubMesh"?i.clone(t):i.clone?i.clone():null};function ze(i){var t=[];do Object.getOwnPropertyNames(i).forEach(function(e){t.indexOf(e)===-1&&t.push(e)});while(i=Object.getPrototypeOf(i));return t}var ke=function(){function i(){}return i.DeepCopy=function(t,e,r,n){for(var o=ze(t),s=0,a=o;s<a.length;s++){var u=a[s];if(!(u[0]==="_"&&(!n||n.indexOf(u)===-1))&&!Se.EndsWith(u,"Observable")&&!(r&&r.indexOf(u)!==-1)){var h=t[u],f=typeof h;if(f!=="function")try{if(f==="object")if(h instanceof Array){if(e[u]=[],h.length>0)if(typeof h[0]=="object")for(var l=0;l<h.length;l++){var c=pe(h[l],e);e[u].indexOf(c)===-1&&e[u].push(c)}else e[u]=h.slice(0)}else e[u]=pe(h,e);else e[u]=h}catch(p){K.Warn(p.message)}}}},i}();function Ke(){return typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var $t=function(){function i(){this._xhr=Ke()}return i.prototype._injectCustomRequestHeaders=function(){for(var t in i.CustomRequestHeaders){var e=i.CustomRequestHeaders[t];e&&this._xhr.setRequestHeader(t,e)}},Object.defineProperty(i.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(t){this._xhr.onprogress=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(t){this._xhr.responseType=t},enumerable:!1,configurable:!0}),i.prototype.addEventListener=function(t,e,r){this._xhr.addEventListener(t,e,r)},i.prototype.removeEventListener=function(t,e,r){this._xhr.removeEventListener(t,e,r)},i.prototype.abort=function(){this._xhr.abort()},i.prototype.send=function(t){i.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},i.prototype.open=function(t,e){for(var r=0,n=i.CustomRequestModifiers;r<n.length;r++){var o=n[r];o(this._xhr,e)}return e=e.replace("file:http:","http:"),e=e.replace("file:https:","https:"),this._xhr.open(t,e,!0)},i.prototype.setRequestHeader=function(t,e){this._xhr.setRequestHeader(t,e)},i.prototype.getResponseHeader=function(t){return this._xhr.getResponseHeader(t)},i.CustomRequestHeaders={},i.CustomRequestModifiers=new Array,i}(),Yt=function(){function i(){}return i.FilesToLoad={},i}(),We=function(){function i(){}return i.ExponentialBackoff=function(t,e){return t===void 0&&(t=3),e===void 0&&(e=500),function(r,n,o){return n.status!==0||o>=t||r.indexOf("file:")!==-1?-1:Math.pow(2,o)*e}},i}(),St=function(i){Y(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t._setPrototypeOf=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e},t}(Error),de=function(i){Y(t,i);function t(e,r){var n=i.call(this,e)||this;return n.name="LoadFileError",St._setPrototypeOf(n,t.prototype),r instanceof $t?n.request=r:n.file=r,n}return t}(St),Ge=function(i){Y(t,i);function t(e,r){var n=i.call(this,e)||this;return n.request=r,n.name="RequestFileError",St._setPrototypeOf(n,t.prototype),n}return t}(St),Ve=function(i){Y(t,i);function t(e,r){var n=i.call(this,e)||this;return n.file=r,n.name="ReadFileError",St._setPrototypeOf(n,t.prototype),n}return t}(St),U=function(){function i(){}return i._CleanUrl=function(t){return t=t.replace(/#/mg,"%23"),t},i.SetCorsBehavior=function(t,e){if(!(t&&t.indexOf("data:")===0)&&i.CorsBehavior)if(typeof i.CorsBehavior=="string"||this.CorsBehavior instanceof String)e.crossOrigin=i.CorsBehavior;else{var r=i.CorsBehavior(t);r&&(e.crossOrigin=r)}},i.LoadImage=function(t,e,r,n,o){o===void 0&&(o="");var s,a=!1;if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)?typeof Blob!="undefined"?(s=URL.createObjectURL(new Blob([t],{type:o})),a=!0):s="data:"+o+";base64,"+Se.EncodeArrayBufferToBase64(t):t instanceof Blob?(s=URL.createObjectURL(t),a=!0):(s=i._CleanUrl(t),s=i.PreprocessUrl(t)),typeof Image=="undefined")return i.LoadFile(s,function(g){createImageBitmap(new Blob([g],{type:o})).then(function(v){e(v),a&&URL.revokeObjectURL(s)}).catch(function(v){r&&r("Error while trying to load image: "+t,v)})},void 0,n||void 0,!0,function(g,v){r&&r("Error while trying to load image: "+t,v)}),null;var u=new Image;i.SetCorsBehavior(s,u);var h=function(){u.removeEventListener("load",h),u.removeEventListener("error",f),e(u),a&&u.src&&URL.revokeObjectURL(u.src)},f=function(g){if(u.removeEventListener("load",h),u.removeEventListener("error",f),r){var v=t.toString();r("Error while trying to load image: "+(v.length<32?v:v.slice(0,32)+"..."),g)}a&&u.src&&URL.revokeObjectURL(u.src)};u.addEventListener("load",h),u.addEventListener("error",f);var l=function(){u.src=s},c=function(){n&&n.loadImage(s,u)};if(s.substr(0,5)!=="data:"&&n&&n.enableTexturesOffline)n.open(c,l);else{if(s.indexOf("file:")!==-1){var p=decodeURIComponent(s.substring(5).toLowerCase());if(Yt.FilesToLoad[p]){try{var d;try{d=URL.createObjectURL(Yt.FilesToLoad[p])}catch{d=URL.createObjectURL(Yt.FilesToLoad[p])}u.src=d,a=!0}catch{u.src=""}return u}}l()}return u},i.ReadFile=function(t,e,r,n,o){var s=new FileReader,a={onCompleteObservable:new T,abort:function(){return s.abort()}};return s.onloadend=function(u){return a.onCompleteObservable.notifyObservers(a)},o&&(s.onerror=function(u){o(new Ve("Unable to read "+t.name,t))}),s.onload=function(u){e(u.target.result)},r&&(s.onprogress=r),n?s.readAsArrayBuffer(t):s.readAsText(t),a},i.LoadFile=function(t,e,r,n,o,s){if(t.indexOf("file:")!==-1){var a=decodeURIComponent(t.substring(5).toLowerCase());a.indexOf("./")===0&&(a=a.substring(2));var u=Yt.FilesToLoad[a];if(u)return i.ReadFile(u,e,r,o,s?function(h){return s(void 0,new de(h.message,h.file))}:void 0)}return i.RequestFile(t,function(h,f){e(h,f?f.responseURL:void 0)},r,n,o,s?function(h){s(h.request,new de(h.message,h.request))}:void 0)},i.RequestFile=function(t,e,r,n,o,s,a){t=i._CleanUrl(t),t=i.PreprocessUrl(t);var u=i.BaseUrl+t,h=!1,f={onCompleteObservable:new T,abort:function(){return h=!0}},l=function(){var d=new $t,g=null;f.abort=function(){h=!0,d.readyState!==(XMLHttpRequest.DONE||4)&&d.abort(),g!==null&&(clearTimeout(g),g=null)};var v=function(P){d.open("GET",u),a&&a(d),o&&(d.responseType="arraybuffer"),r&&d.addEventListener("progress",r);var b=function(){d.removeEventListener("loadend",b),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};d.addEventListener("loadend",b);var E=function(){if(!h&&d.readyState===(XMLHttpRequest.DONE||4)){if(d.removeEventListener("readystatechange",E),d.status>=200&&d.status<300||d.status===0&&(!mt.IsWindowObjectExist()||i.IsFileURL())){e(o?d.response:d.responseText,d);return}var A=i.DefaultRetryStrategy;if(A){var I=A(u,d,P);if(I!==-1){d.removeEventListener("loadend",b),d=new $t,g=setTimeout(function(){return v(P+1)},I);return}}var F=new Ge("Error status: "+d.status+" "+d.statusText+" - Unable to load "+u,d);s&&s(F)}};d.addEventListener("readystatechange",E),d.send()};v(0)};if(n&&n.enableSceneOffline){var c=function(d){d&&d.status>400?s&&s(d):l()},p=function(){n&&n.loadFile(i.BaseUrl+t,function(d){h||e(d),f.onCompleteObservable.notifyObservers(f)},r?function(d){h||r(d)}:void 0,c,o)};n.open(p,c)}else l();return f},i.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},i.DefaultRetryStrategy=We.ExponentialBackoff(),i.BaseUrl="",i.CorsBehavior="anonymous",i.PreprocessUrl=function(t){return t},i}();Tt._FileToolsLoadImage=U.LoadImage.bind(U);Tt._FileToolsLoadFile=U.LoadFile.bind(U);Le._FileToolsLoadFile=U.LoadFile.bind(U);var dt;(function(i){i[i.Pending=0]="Pending",i[i.Fulfilled=1]="Fulfilled",i[i.Rejected=2]="Rejected"})(dt||(dt={}));var je=function(){function i(){this.count=0,this.target=0,this.results=[]}return i}(),He=function(){function i(t){var e=this;if(this._state=dt.Pending,this._children=new Array,this._rejectWasConsumed=!1,!!t)try{t(function(r){e._resolve(r)},function(r){e._reject(r)})}catch(r){this._reject(r)}}return Object.defineProperty(i.prototype,"_result",{get:function(){return this._resultValue},set:function(t){this._resultValue=t,this._parent&&this._parent._result===void 0&&(this._parent._result=t)},enumerable:!1,configurable:!0}),i.prototype.catch=function(t){return this.then(void 0,t)},i.prototype.then=function(t,e){var r=this,n=new i;return n._onFulfilled=t,n._onRejected=e,this._children.push(n),n._parent=this,this._state!==dt.Pending&&setTimeout(function(){if(r._state===dt.Fulfilled||r._rejectWasConsumed){var o=n._resolve(r._result);if(o!=null)if(o._state!==void 0){var s=o;n._children.push(s),s._parent=n,n=s}else n._result=o}else n._reject(r._reason)}),n},i.prototype._moveChildren=function(t){var e,r=this;if((e=this._children).push.apply(e,t.splice(0,t.length)),this._children.forEach(function(h){h._parent=r}),this._state===dt.Fulfilled)for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._resolve(this._result)}else if(this._state===dt.Rejected)for(var a=0,u=this._children;a<u.length;a++){var s=u[a];s._reject(this._reason)}},i.prototype._resolve=function(t){try{this._state=dt.Fulfilled;var e=null;if(this._onFulfilled&&(e=this._onFulfilled(t)),e!=null)if(e._state!==void 0){var r=e;r._parent=this,r._moveChildren(this._children),t=r._result}else t=e;this._result=t;for(var n=0,o=this._children;n<o.length;n++){var s=o[n];s._resolve(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(a){this._reject(a,!0)}},i.prototype._reject=function(t,e){if(e===void 0&&(e=!1),this._state=dt.Rejected,this._reason=t,this._onRejected&&!e)try{this._onRejected(t),this._rejectWasConsumed=!0}catch(s){t=s}for(var r=0,n=this._children;r<n.length;r++){var o=n[r];this._rejectWasConsumed?o._resolve(null):o._reject(t)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},i.resolve=function(t){var e=new i;return e._resolve(t),e},i._RegisterForFulfillment=function(t,e,r){t.then(function(n){return e.results[r]=n,e.count++,e.count===e.target&&e.rootPromise._resolve(e.results),null},function(n){e.rootPromise._state!==dt.Rejected&&e.rootPromise._reject(n)})},i.all=function(t){var e=new i,r=new je;if(r.target=t.length,r.rootPromise=e,t.length)for(var n=0;n<t.length;n++)i._RegisterForFulfillment(t[n],r,n);else e._resolve([]);return e},i.race=function(t){var e=new i;if(t.length)for(var r=0,n=t;r<n.length;r++){var o=n[r];o.then(function(s){return e&&(e._resolve(s),e=null),null},function(s){e&&(e._reject(s),e=null)})}return e},i}(),Ye=function(){function i(){}return i.Apply=function(t){if(t===void 0&&(t=!1),t||typeof Promise=="undefined"){var e=window;e.Promise=He}},i}(),qe=function(){function i(){}return i.SetImmediate=function(t){mt.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(t):setTimeout(t,1)},i}(),_t=function(){function i(){}return i.GetClass=function(t){return this.RegisteredTypes&&this.RegisteredTypes[t]?this.RegisteredTypes[t]:null},i.RegisteredTypes={},i}(),ie=function(){function i(){}return i.Instantiate=function(t){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[t])return this.RegisteredExternalClasses[t];var e=_t.GetClass(t);if(e)return e;K.Warn(t+" not found, you may have missed an import.");for(var r=t.split("."),n=window||this,o=0,s=r.length;o<s;o++)n=n[r[o]];return typeof n!="function"?null:n},i.RegisteredExternalClasses={},i}(),Xe=function(){function i(){}return i.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,r=t==="x"?e:e&3|8;return r.toString(16)})},i}(),q=function(){function i(){}return Object.defineProperty(i,"BaseUrl",{get:function(){return U.BaseUrl},set:function(t){U.BaseUrl=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"DefaultRetryStrategy",{get:function(){return U.DefaultRetryStrategy},set:function(t){U.DefaultRetryStrategy=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"CorsBehavior",{get:function(){return U.CorsBehavior},set:function(t){U.CorsBehavior=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"UseFallbackTexture",{get:function(){return st.UseFallbackTexture},set:function(t){st.UseFallbackTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"RegisteredExternalClasses",{get:function(){return ie.RegisteredExternalClasses},set:function(t){ie.RegisteredExternalClasses=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"fallbackTexture",{get:function(){return st.FallbackTexture},set:function(t){st.FallbackTexture=t},enumerable:!1,configurable:!0}),i.FetchToRef=function(t,e,r,n,o,s){var a=Math.abs(t)*r%r|0,u=Math.abs(e)*n%n|0,h=(a+u*r)*4;s.r=o[h]/255,s.g=o[h+1]/255,s.b=o[h+2]/255,s.a=o[h+3]/255},i.Mix=function(t,e,r){return t*(1-r)+e*r},i.Instantiate=function(t){return ie.Instantiate(t)},i.Slice=function(t,e,r){return t.slice?t.slice(e,r):Array.prototype.slice.call(t,e,r)},i.SliceToArray=function(t,e,r){return Array.isArray(t)?t.slice(e,r):Array.prototype.slice.call(t,e,r)},i.SetImmediate=function(t){qe.SetImmediate(t)},i.IsExponentOfTwo=function(t){var e=1;do e*=2;while(e<t);return e===t},i.FloatRound=function(t){return Math.fround?Math.fround(t):i._tmpFloatArray[0]=t},i.GetFilename=function(t){var e=t.lastIndexOf("/");return e<0?t:t.substring(e+1)},i.GetFolderPath=function(t,e){e===void 0&&(e=!1);var r=t.lastIndexOf("/");return r<0?e?t:"":t.substring(0,r+1)},i.ToDegrees=function(t){return t*180/Math.PI},i.ToRadians=function(t){return t*Math.PI/180},i.MakeArray=function(t,e){return e!==!0&&(t===void 0||t==null)?null:Array.isArray(t)?t:[t]},i.GetPointerPrefix=function(t){var e="pointer";return mt.IsWindowObjectExist()&&!window.PointerEvent&&mt.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(e="mouse"),t._badDesktopOS&&!t._badOS&&!(document&&"ontouchend"in document)&&(e="mouse"),e},i.SetCorsBehavior=function(t,e){U.SetCorsBehavior(t,e)},i.CleanUrl=function(t){return t=t.replace(/#/gm,"%23"),t},Object.defineProperty(i,"PreprocessUrl",{get:function(){return U.PreprocessUrl},set:function(t){U.PreprocessUrl=t},enumerable:!1,configurable:!0}),i.LoadImage=function(t,e,r,n,o){return U.LoadImage(t,e,r,n,o)},i.LoadFile=function(t,e,r,n,o,s){return U.LoadFile(t,e,r,n,o,s)},i.LoadFileAsync=function(t,e){return e===void 0&&(e=!0),new Promise(function(r,n){U.LoadFile(t,function(o){r(o)},void 0,void 0,e,function(o,s){n(s)})})},i.LoadScript=function(t,e,r,n){if(!!mt.IsWindowObjectExist()){var o=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",t),n&&(s.id=n),s.onload=function(){e&&e()},s.onerror=function(a){r&&r("Unable to load script '"+t+"'",a)},o.appendChild(s)}},i.LoadScriptAsync=function(t,e){var r=this;return new Promise(function(n,o){r.LoadScript(t,function(){n()},function(s,a){o(a)})})},i.ReadFileAsDataURL=function(t,e,r){var n=new FileReader,o={onCompleteObservable:new T,abort:function(){return n.abort()}};return n.onloadend=function(s){o.onCompleteObservable.notifyObservers(o)},n.onload=function(s){e(s.target.result)},n.onprogress=r,n.readAsDataURL(t),o},i.ReadFile=function(t,e,r,n,o){return U.ReadFile(t,e,r,n,o)},i.FileAsURL=function(t){var e=new Blob([t]),r=window.URL||window.webkitURL,n=r.createObjectURL(e);return n},i.Format=function(t,e){return e===void 0&&(e=2),t.toFixed(e)},i.DeepCopy=function(t,e,r,n){ke.DeepCopy(t,e,r,n)},i.IsEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},i.RegisterTopRootEvents=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch{}}},i.UnregisterTopRootEvents=function(t,e){for(var r=0;r<e.length;r++){var n=e[r];t.removeEventListener(n.name,n.handler);try{t.parent&&t.parent.removeEventListener(n.name,n.handler)}catch{}}},i.DumpFramebuffer=function(t,e,r,n,o,s){o===void 0&&(o="image/png");for(var a=t*4,u=e/2,h=r.readPixels(0,0,t,e),f=0;f<u;f++)for(var l=0;l<a;l++){var c=l+f*a,p=e-f-1,d=l+p*a,g=h[c];h[c]=h[d],h[d]=g}i._ScreenshotCanvas||(i._ScreenshotCanvas=document.createElement("canvas")),i._ScreenshotCanvas.width=t,i._ScreenshotCanvas.height=e;var v=i._ScreenshotCanvas.getContext("2d");if(v){var P=v.createImageData(t,e),b=P.data;b.set(h),v.putImageData(P,0,0),i.EncodeScreenshotCanvasData(n,o,s)}},i.ToBlob=function(t,e,r){r===void 0&&(r="image/png"),t.toBlob||(t.toBlob=function(n,o,s){var a=this;setTimeout(function(){for(var u=atob(a.toDataURL(o,s).split(",")[1]),h=u.length,f=new Uint8Array(h),l=0;l<h;l++)f[l]=u.charCodeAt(l);n(new Blob([f]))})}),t.toBlob(function(n){e(n)},r)},i.EncodeScreenshotCanvasData=function(t,e,r){if(e===void 0&&(e="image/png"),t){var n=i._ScreenshotCanvas.toDataURL(e);t(n)}else this.ToBlob(i._ScreenshotCanvas,function(o){if("download"in document.createElement("a")){if(!r){var s=new Date,a=(s.getFullYear()+"-"+(s.getMonth()+1)).slice(2)+"-"+s.getDate()+"_"+s.getHours()+"-"+("0"+s.getMinutes()).slice(-2);r="screenshot_"+a+".png"}i.Download(o,r)}else{var u=URL.createObjectURL(o),h=window.open("");if(!h)return;var f=h.document.createElement("img");f.onload=function(){URL.revokeObjectURL(u)},f.src=u,h.document.body.appendChild(f)}},e)},i.Download=function(t,e){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(t,e);return}var r=window.URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=e,n.addEventListener("click",function(){n.parentElement&&n.parentElement.removeChild(n)}),n.click(),window.URL.revokeObjectURL(r)},i.BackCompatCameraNoPreventDefault=function(t){return typeof t[0]=="boolean"?t[0]:typeof t[1]=="boolean"?t[1]:!1},i.CreateScreenshot=function(t,e,r,n,o){throw S.WarnImport("ScreenshotTools")},i.CreateScreenshotAsync=function(t,e,r,n){throw S.WarnImport("ScreenshotTools")},i.CreateScreenshotUsingRenderTarget=function(t,e,r,n,o,s,a,u){throw S.WarnImport("ScreenshotTools")},i.CreateScreenshotUsingRenderTargetAsync=function(t,e,r,n,o,s,a){throw S.WarnImport("ScreenshotTools")},i.RandomId=function(){return Xe.RandomId()},i.IsBase64=function(t){return t.length<5?!1:t.substr(0,5)==="data:"},i.DecodeBase64=function(t){for(var e=atob(t.split(",")[1]),r=e.length,n=new Uint8Array(new ArrayBuffer(r)),o=0;o<r;o++)n[o]=e.charCodeAt(o);return n.buffer},i.GetAbsoluteUrl=function(t){var e=document.createElement("a");return e.href=t,e.href},Object.defineProperty(i,"errorsCount",{get:function(){return K.errorsCount},enumerable:!1,configurable:!0}),i.Log=function(t){K.Log(t)},i.Warn=function(t){K.Warn(t)},i.Error=function(t){K.Error(t)},Object.defineProperty(i,"LogCache",{get:function(){return K.LogCache},enumerable:!1,configurable:!0}),i.ClearLogCache=function(){K.ClearLogCache()},Object.defineProperty(i,"LogLevels",{set:function(t){K.LogLevels=t},enumerable:!1,configurable:!0}),Object.defineProperty(i,"PerformanceLogLevel",{set:function(t){if((t&i.PerformanceUserMarkLogLevel)===i.PerformanceUserMarkLogLevel){i.StartPerformanceCounter=i._StartUserMark,i.EndPerformanceCounter=i._EndUserMark;return}if((t&i.PerformanceConsoleLogLevel)===i.PerformanceConsoleLogLevel){i.StartPerformanceCounter=i._StartPerformanceConsole,i.EndPerformanceCounter=i._EndPerformanceConsole;return}i.StartPerformanceCounter=i._StartPerformanceCounterDisabled,i.EndPerformanceCounter=i._EndPerformanceCounterDisabled},enumerable:!1,configurable:!0}),i._StartPerformanceCounterDisabled=function(t,e){},i._EndPerformanceCounterDisabled=function(t,e){},i._StartUserMark=function(t,e){if(e===void 0&&(e=!0),!i._performance){if(!mt.IsWindowObjectExist())return;i._performance=window.performance}!e||!i._performance.mark||i._performance.mark(t+"-Begin")},i._EndUserMark=function(t,e){e===void 0&&(e=!0),!(!e||!i._performance.mark)&&(i._performance.mark(t+"-End"),i._performance.measure(t,t+"-Begin",t+"-End"))},i._StartPerformanceConsole=function(t,e){e===void 0&&(e=!0),!!e&&(i._StartUserMark(t,e),console.time&&console.time(t))},i._EndPerformanceConsole=function(t,e){e===void 0&&(e=!0),!!e&&(i._EndUserMark(t,e),console.timeEnd(t))},Object.defineProperty(i,"Now",{get:function(){return Ie.Now},enumerable:!1,configurable:!0}),i.GetClassName=function(t,e){e===void 0&&(e=!1);var r=null;if(!e&&t.getClassName)r=t.getClassName();else{if(t instanceof Object){var n=e?t:Object.getPrototypeOf(t);r=n.constructor.__bjsclassName__}r||(r=typeof t)}return r},i.First=function(t,e){for(var r=0,n=t;r<n.length;r++){var o=n[r];if(e(o))return o}return null},i.getFullClassName=function(t,e){e===void 0&&(e=!1);var r=null,n=null;if(!e&&t.getClassName)r=t.getClassName();else{if(t instanceof Object){var o=e?t:Object.getPrototypeOf(t);r=o.constructor.__bjsclassName__,n=o.constructor.__bjsmoduleName__}r||(r=typeof t)}return r?(n!=null?n+".":"")+r:null},i.DelayAsync=function(t){return new Promise(function(e){setTimeout(function(){e()},t)})},i.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},i.UseCustomRequestHeaders=!1,i.CustomRequestHeaders=$t.CustomRequestHeaders,i._tmpFloatArray=new Float32Array(1),i.GetDOMTextContent=mt.GetDOMTextContent,i.NoneLogLevel=K.NoneLogLevel,i.MessageLogLevel=K.MessageLogLevel,i.WarningLogLevel=K.WarningLogLevel,i.ErrorLogLevel=K.ErrorLogLevel,i.AllLogLevel=K.AllLogLevel,i.IsWindowObjectExist=mt.IsWindowObjectExist,i.PerformanceNoneLogLevel=0,i.PerformanceUserMarkLogLevel=1,i.PerformanceConsoleLogLevel=2,i.StartPerformanceCounter=i._StartPerformanceCounterDisabled,i.EndPerformanceCounter=i._EndPerformanceCounterDisabled,i}(),Ar=function(){function i(t,e,r,n){n===void 0&&(n=0),this.iterations=t,this.index=n-1,this._done=!1,this._fn=e,this._successCallback=r}return i.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},i.prototype.breakLoop=function(){this._done=!0,this._successCallback()},i.Run=function(t,e,r,n){n===void 0&&(n=0);var o=new i(t,e,r,n);return o.executeNext(),o},i.SyncAsyncForLoop=function(t,e,r,n,o,s){return s===void 0&&(s=0),i.Run(Math.ceil(t/e),function(a){o&&o()?a.breakLoop():setTimeout(function(){for(var u=0;u<e;++u){var h=a.index*e+u;if(h>=t)break;if(r(h),o&&o()){a.breakLoop();break}}a.executeNext()},s)},n)},i}();st.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";Ye.Apply();var nt=function(){function i(t){this.length=0,this.data=new Array(t),this._id=i._GlobalId++}return i.prototype.push=function(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)},i.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t(this.data[e])},i.prototype.sort=function(t){this.data.sort(t)},i.prototype.reset=function(){this.length=0},i.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},i.prototype.concat=function(t){if(t.length!==0){this.length+t.length>this.data.length&&(this.data.length=(this.length+t.length)*2);for(var e=0;e<t.length;e++)this.data[this.length++]=(t.data||t)[e]}},i.prototype.indexOf=function(t){var e=this.data.indexOf(t);return e>=this.length?-1:e},i.prototype.contains=function(t){return this.indexOf(t)!==-1},i._GlobalId=0,i}(),Dt=function(i){Y(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._duplicateId=0,e}return t.prototype.push=function(e){i.prototype.push.call(this,e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(e),!0)},t.prototype.reset=function(){i.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(var r=0;r<e.length;r++){var n=(e.data||e)[r];this.pushNoDuplicate(n)}}},t}(nt),_e=function(){function i(){this._count=0,this._data={}}return i.prototype.copyFrom=function(t){var e=this;this.clear(),t.forEach(function(r,n){return e.add(r,n)})},i.prototype.get=function(t){var e=this._data[t];if(e!==void 0)return e},i.prototype.getOrAddWithFactory=function(t,e){var r=this.get(t);return r!==void 0||(r=e(t),r&&this.add(t,r)),r},i.prototype.getOrAdd=function(t,e){var r=this.get(t);return r!==void 0?r:(this.add(t,e),e)},i.prototype.contains=function(t){return this._data[t]!==void 0},i.prototype.add=function(t,e){return this._data[t]!==void 0?!1:(this._data[t]=e,++this._count,!0)},i.prototype.set=function(t,e){return this._data[t]===void 0?!1:(this._data[t]=e,!0)},i.prototype.getAndRemove=function(t){var e=this.get(t);return e!==void 0?(delete this._data[t],--this._count,e):null},i.prototype.remove=function(t){return this.contains(t)?(delete this._data[t],--this._count,!0):!1},i.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(i.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),i.prototype.forEach=function(t){for(var e in this._data){var r=this._data[e];t(e,r)}},i.prototype.first=function(t){for(var e in this._data){var r=this._data[e],n=t(e,r);if(n)return n}return null},i}(),Ze=function(){function i(){}return i.Eval=function(t,e){return t.match(/\([^\(\)]*\)/g)?t=t.replace(/\([^\(\)]*\)/g,function(r){return r=r.slice(1,r.length-1),i._HandleParenthesisContent(r,e)}):t=i._HandleParenthesisContent(t,e),t==="true"?!0:t==="false"?!1:i.Eval(t,e)},i._HandleParenthesisContent=function(t,e){e=e||function(f){return f==="true"};var r,n=t.split("||");for(var o in n)if(n.hasOwnProperty(o)){var s=i._SimplifyNegation(n[o].trim()),a=s.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=i._SimplifyNegation(a[u].trim());if(h!=="true"&&h!=="false"?h[0]==="!"?r=!e(h.substring(1)):r=e(h):r=h==="true",!r){s="false";break}}if(r||s==="true"){r=!0;break}s!=="true"&&s!=="false"?s[0]==="!"?r=!e(s.substring(1)):r=e(s):r=s==="true"}return r?"true":"false"},i._SimplifyNegation=function(t){return t=t.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),t=t.trim(),t==="!true"?t="false":t==="!false"&&(t="true"),t},i}(),Rt=function(){function i(){}return i.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return i.HasTags(t)},t.addTags=function(e){return i.AddTagsTo(t,e)},t.removeTags=function(e){return i.RemoveTagsFrom(t,e)},t.matchesTagsQuery=function(e){return i.MatchesQuery(t,e)}},i.DisableFor=function(t){delete t._tags,delete t.hasTags,delete t.addTags,delete t.removeTags,delete t.matchesTagsQuery},i.HasTags=function(t){if(!t._tags)return!1;var e=t._tags;for(var r in e)if(e.hasOwnProperty(r))return!0;return!1},i.GetTags=function(t,e){if(e===void 0&&(e=!0),!t._tags)return null;if(e){var r=[];for(var n in t._tags)t._tags.hasOwnProperty(n)&&t._tags[n]===!0&&r.push(n);return r.join(" ")}else return t._tags},i.AddTagsTo=function(t,e){if(!!e&&typeof e=="string"){var r=e.split(" ");r.forEach(function(n,o,s){i._AddTagTo(t,n)})}},i._AddTagTo=function(t,e){e=e.trim(),!(e===""||e==="true"||e==="false")&&(e.match(/[\s]/)||e.match(/^([!]|([|]|[&]){2})/)||(i.EnableFor(t),t._tags[e]=!0))},i.RemoveTagsFrom=function(t,e){if(!!i.HasTags(t)){var r=e.split(" ");for(var n in r)i._RemoveTagFrom(t,r[n])}},i._RemoveTagFrom=function(t,e){delete t._tags[e]},i.MatchesQuery=function(t,e){return e===void 0?!0:e===""?i.HasTags(t):Ze.Eval(e,function(r){return i.HasTags(t)&&t._tags[r]})},i}(),w=function(){function i(){}return i.WithinEpsilon=function(t,e,r){r===void 0&&(r=1401298e-51);var n=t-e;return-r<=n&&n<=r},i.ToHex=function(t){var e=t.toString(16);return t<=15?("0"+e).toUpperCase():e.toUpperCase()},i.Sign=function(t){return t=+t,t===0||isNaN(t)?t:t>0?1:-1},i.Clamp=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),Math.min(r,Math.max(e,t))},i.Log2=function(t){return Math.log(t)*Math.LOG2E},i.Repeat=function(t,e){return t-Math.floor(t/e)*e},i.Normalize=function(t,e,r){return(t-e)/(r-e)},i.Denormalize=function(t,e,r){return t*(r-e)+e},i.DeltaAngle=function(t,e){var r=i.Repeat(e-t,360);return r>180&&(r-=360),r},i.PingPong=function(t,e){var r=i.Repeat(t,e*2);return e-Math.abs(r-e)},i.SmoothStep=function(t,e,r){var n=i.Clamp(r);return n=-2*n*n*n+3*n*n,e*n+t*(1-n)},i.MoveTowards=function(t,e,r){var n=0;return Math.abs(e-t)<=r?n=e:n=t+i.Sign(e-t)*r,n},i.MoveTowardsAngle=function(t,e,r){var n=i.DeltaAngle(t,e),o=0;return-r<n&&n<r?o=e:(e=t+n,o=i.MoveTowards(t,e,r)),o},i.Lerp=function(t,e,r){return t+(e-t)*r},i.LerpAngle=function(t,e,r){var n=i.Repeat(e-t,360);return n>180&&(n-=360),t+n*i.Clamp(r)},i.InverseLerp=function(t,e,r){var n=0;return t!=e?n=i.Clamp((r-t)/(e-t)):n=0,n},i.Hermite=function(t,e,r,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s;return t*u+r*h+e*f+n*l},i.RandomRange=function(t,e){return t===e?t:Math.random()*(e-t)+t},i.RangeToPercent=function(t,e,r){return(t-e)/(r-e)},i.PercentToRange=function(t,e,r){return(r-e)*t+e},i.NormalizeRadians=function(t){return t-=i.TwoPi*Math.floor((t+Math.PI)/i.TwoPi),t},i.TwoPi=Math.PI*2,i}(),Ct=1/2.2,Ot=2.2,ot=.001,G=function(){function i(){}return i.BuildArray=function(t,e){for(var r=[],n=0;n<t;++n)r.push(e());return r},i}(),at=function(){function i(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}return i.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},i.prototype.getClassName=function(){return"Vector2"},i.prototype.getHashCode=function(){var t=this.x|0;return t=t*397^(this.y|0),t},i.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,this},i.prototype.fromArray=function(t,e){return e===void 0&&(e=0),i.FromArrayToRef(t,e,this),this},i.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.copyFromFloats=function(t,e){return this.x=t,this.y=e,this},i.prototype.set=function(t,e){return this.copyFromFloats(t,e)},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.addToRef=function(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.addVector3=function(t){return new i(this.x+t.x,this.y+t.y)},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y)},i.prototype.subtractToRef=function(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y)},i.prototype.multiplyToRef=function(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,this},i.prototype.multiplyByFloats=function(t,e){return new i(this.x*t,this.y*e)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y)},i.prototype.divideToRef=function(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,this},i.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},i.prototype.negateToRef=function(t){return t.copyFromFloats(this.x*-1,this.y*-1)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},i.prototype.scale=function(t){var e=new i(0,0);return this.scaleToRef(t,e),e},i.prototype.scaleToRef=function(t,e){return e.x=this.x*t,e.y=this.y*t,this},i.prototype.scaleAndAddToRef=function(t,e){return e.x+=this.x*t,e.y+=this.y*t,this},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},i.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=ot),t&&w.WithinEpsilon(this.x,t.x,e)&&w.WithinEpsilon(this.y,t.y,e)},i.prototype.floor=function(){return new i(Math.floor(this.x),Math.floor(this.y))},i.prototype.fract=function(){return new i(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();return t===0?this:(this.x/=t,this.y/=t,this)},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.One=function(){return new i(1,1)},i.FromArray=function(t,e){return e===void 0&&(e=0),new i(t[e],t[e+1])},i.FromArrayToRef=function(t,e,r){r.x=t[e],r.y=t[e+1]},i.CatmullRom=function(t,e,r,n,o){var s=o*o,a=o*s,u=.5*(2*e.x+(-t.x+r.x)*o+(2*t.x-5*e.x+4*r.x-n.x)*s+(-t.x+3*e.x-3*r.x+n.x)*a),h=.5*(2*e.y+(-t.y+r.y)*o+(2*t.y-5*e.y+4*r.y-n.y)*s+(-t.y+3*e.y-3*r.y+n.y)*a);return new i(u,h)},i.Clamp=function(t,e,r){var n=t.x;n=n>r.x?r.x:n,n=n<e.x?e.x:n;var o=t.y;return o=o>r.y?r.y:o,o=o<e.y?e.y:o,new i(n,o)},i.Hermite=function(t,e,r,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t.x*u+r.x*h+e.x*f+n.x*l,p=t.y*u+r.y*h+e.y*f+n.y*l;return new i(c,p)},i.Lerp=function(t,e,r){var n=t.x+(e.x-t.x)*r,o=t.y+(e.y-t.y)*r;return new i(n,o)},i.Dot=function(t,e){return t.x*e.x+t.y*e.y},i.Normalize=function(t){var e=t.clone();return e.normalize(),e},i.Minimize=function(t,e){var r=t.x<e.x?t.x:e.x,n=t.y<e.y?t.y:e.y;return new i(r,n)},i.Maximize=function(t,e){var r=t.x>e.x?t.x:e.x,n=t.y>e.y?t.y:e.y;return new i(r,n)},i.Transform=function(t,e){var r=i.Zero();return i.TransformToRef(t,e,r),r},i.TransformToRef=function(t,e,r){var n=e.m,o=t.x*n[0]+t.y*n[4]+n[12],s=t.x*n[1]+t.y*n[5]+n[13];r.x=o,r.y=s},i.PointInTriangle=function(t,e,r,n){var o=.5*(-r.y*n.x+e.y*(-r.x+n.x)+e.x*(r.y-n.y)+r.x*n.y),s=o<0?-1:1,a=(e.y*n.x-e.x*n.y+(n.y-e.y)*t.x+(e.x-n.x)*t.y)*s,u=(e.x*r.y-e.y*r.x+(e.y-r.y)*t.x+(r.x-e.x)*t.y)*s;return a>0&&u>0&&a+u<2*o*s},i.Distance=function(t,e){return Math.sqrt(i.DistanceSquared(t,e))},i.DistanceSquared=function(t,e){var r=t.x-e.x,n=t.y-e.y;return r*r+n*n},i.Center=function(t,e){var r=t.add(e);return r.scaleInPlace(.5),r},i.DistanceOfPointFromSegment=function(t,e,r){var n=i.DistanceSquared(e,r);if(n===0)return i.Distance(t,e);var o=r.subtract(e),s=Math.max(0,Math.min(1,i.Dot(t.subtract(e),o)/n)),a=e.add(o.multiplyByFloats(s,s));return i.Distance(t,a)},i}(),_=function(){function i(t,e,r){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this._isDirty=!0,this._x=t,this._y=e,this._z=r}return Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this._isDirty=!0},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},i.prototype.getClassName=function(){return"Vector3"},i.prototype.getHashCode=function(){var t=this._x|0;return t=t*397^(this._y|0),t=t*397^(this._z|0),t},i.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},i.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,this},i.prototype.fromArray=function(t,e){return e===void 0&&(e=0),i.FromArrayToRef(t,e,this),this},i.prototype.toQuaternion=function(){return L.RotationYawPitchRoll(this._y,this._x,this._z)},i.prototype.addInPlace=function(t){return this.addInPlaceFromFloats(t._x,t._y,t._z)},i.prototype.addInPlaceFromFloats=function(t,e,r){return this.x+=t,this.y+=e,this.z+=r,this},i.prototype.add=function(t){return new i(this._x+t._x,this._y+t._y,this._z+t._z)},i.prototype.addToRef=function(t,e){return e.copyFromFloats(this._x+t._x,this._y+t._y,this._z+t._z)},i.prototype.subtractInPlace=function(t){return this.x-=t._x,this.y-=t._y,this.z-=t._z,this},i.prototype.subtract=function(t){return new i(this._x-t._x,this._y-t._y,this._z-t._z)},i.prototype.subtractToRef=function(t,e){return this.subtractFromFloatsToRef(t._x,t._y,t._z,e)},i.prototype.subtractFromFloats=function(t,e,r){return new i(this._x-t,this._y-e,this._z-r)},i.prototype.subtractFromFloatsToRef=function(t,e,r,n){return n.copyFromFloats(this._x-t,this._y-e,this._z-r)},i.prototype.negate=function(){return new i(-this._x,-this._y,-this._z)},i.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},i.prototype.negateToRef=function(t){return t.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.scale=function(t){return new i(this._x*t,this._y*t,this._z*t)},i.prototype.scaleToRef=function(t,e){return e.copyFromFloats(this._x*t,this._y*t,this._z*t)},i.prototype.scaleAndAddToRef=function(t,e){return e.addInPlaceFromFloats(this._x*t,this._y*t,this._z*t)},i.prototype.projectOnPlane=function(t,e){var r=i.Zero();return this.projectOnPlaneToRef(t,e,r),r},i.prototype.projectOnPlaneToRef=function(t,e,r){var n=t.normal,o=t.d,s=O.Vector3[0];this.subtractToRef(e,s),s.normalize();var a=i.Dot(s,n),u=-(i.Dot(e,n)+o)/a,h=s.scaleInPlace(u);e.addToRef(h,r)},i.prototype.equals=function(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z},i.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=ot),t&&w.WithinEpsilon(this._x,t._x,e)&&w.WithinEpsilon(this._y,t._y,e)&&w.WithinEpsilon(this._z,t._z,e)},i.prototype.equalsToFloats=function(t,e,r){return this._x===t&&this._y===e&&this._z===r},i.prototype.multiplyInPlace=function(t){return this.x*=t._x,this.y*=t._y,this.z*=t._z,this},i.prototype.multiply=function(t){return this.multiplyByFloats(t._x,t._y,t._z)},i.prototype.multiplyToRef=function(t,e){return e.copyFromFloats(this._x*t._x,this._y*t._y,this._z*t._z)},i.prototype.multiplyByFloats=function(t,e,r){return new i(this._x*t,this._y*e,this._z*r)},i.prototype.divide=function(t){return new i(this._x/t._x,this._y/t._y,this._z/t._z)},i.prototype.divideToRef=function(t,e){return e.copyFromFloats(this._x/t._x,this._y/t._y,this._z/t._z)},i.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},i.prototype.minimizeInPlace=function(t){return this.minimizeInPlaceFromFloats(t._x,t._y,t._z)},i.prototype.maximizeInPlace=function(t){return this.maximizeInPlaceFromFloats(t._x,t._y,t._z)},i.prototype.minimizeInPlaceFromFloats=function(t,e,r){return t<this._x&&(this.x=t),e<this._y&&(this.y=e),r<this._z&&(this.z=r),this},i.prototype.maximizeInPlaceFromFloats=function(t,e,r){return t>this._x&&(this.x=t),e>this._y&&(this.y=e),r>this._z&&(this.z=r),this},i.prototype.isNonUniformWithinEpsilon=function(t){var e=Math.abs(this._x),r=Math.abs(this._y);if(!w.WithinEpsilon(e,r,t))return!0;var n=Math.abs(this._z);return!w.WithinEpsilon(e,n,t)||!w.WithinEpsilon(r,n,t)},Object.defineProperty(i.prototype,"isNonUniform",{get:function(){var t=Math.abs(this._x),e=Math.abs(this._y);if(t!==e)return!0;var r=Math.abs(this._z);return t!==r},enumerable:!1,configurable:!0}),i.prototype.floor=function(){return new i(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},i.prototype.fract=function(){return new i(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},i.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},i.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},i.prototype.normalize=function(){return this.normalizeFromLength(this.length())},i.prototype.reorderInPlace=function(t){var e=this;return t=t.toLowerCase(),t==="xyz"?this:(O.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(r,n){e[r]=O.Vector3[0][t[n]]}),this)},i.prototype.rotateByQuaternionToRef=function(t,e){return t.toRotationMatrix(O.Matrix[0]),i.TransformCoordinatesToRef(this,O.Matrix[0],e),e},i.prototype.rotateByQuaternionAroundPointToRef=function(t,e,r){return this.subtractToRef(e,O.Vector3[0]),O.Vector3[0].rotateByQuaternionToRef(t,O.Vector3[0]),e.addToRef(O.Vector3[0],r),r},i.prototype.cross=function(t){return i.Cross(this,t)},i.prototype.normalizeFromLength=function(t){return t===0||t===1?this:this.scaleInPlace(1/t)},i.prototype.normalizeToNew=function(){var t=new i(0,0,0);return this.normalizeToRef(t),t},i.prototype.normalizeToRef=function(t){var e=this.length();return e===0||e===1?t.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/e,t)},i.prototype.clone=function(){return new i(this._x,this._y,this._z)},i.prototype.copyFrom=function(t){return this.copyFromFloats(t._x,t._y,t._z)},i.prototype.copyFromFloats=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},i.prototype.set=function(t,e,r){return this.copyFromFloats(t,e,r)},i.prototype.setAll=function(t){return this.x=this.y=this.z=t,this},i.GetClipFactor=function(t,e,r,n){var o=i.Dot(t,r)-n,s=i.Dot(e,r)-n,a=o/(o-s);return a},i.GetAngleBetweenVectors=function(t,e,r){var n=t.normalizeToRef(O.Vector3[1]),o=e.normalizeToRef(O.Vector3[2]),s=i.Dot(n,o),a=O.Vector3[3];return i.CrossToRef(n,o,a),i.Dot(a,r)>0?Math.acos(s):-Math.acos(s)},i.FromArray=function(t,e){return e===void 0&&(e=0),new i(t[e],t[e+1],t[e+2])},i.FromFloatArray=function(t,e){return i.FromArray(t,e)},i.FromArrayToRef=function(t,e,r){r.x=t[e],r.y=t[e+1],r.z=t[e+2]},i.FromFloatArrayToRef=function(t,e,r){return i.FromArrayToRef(t,e,r)},i.FromFloatsToRef=function(t,e,r,n){n.copyFromFloats(t,e,r)},i.Zero=function(){return new i(0,0,0)},i.One=function(){return new i(1,1,1)},i.Up=function(){return new i(0,1,0)},Object.defineProperty(i,"UpReadOnly",{get:function(){return i._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ZeroReadOnly",{get:function(){return i._ZeroReadOnly},enumerable:!1,configurable:!0}),i.Down=function(){return new i(0,-1,0)},i.Forward=function(t){return t===void 0&&(t=!1),new i(0,0,t?-1:1)},i.Backward=function(t){return t===void 0&&(t=!1),new i(0,0,t?1:-1)},i.Right=function(){return new i(1,0,0)},i.Left=function(){return new i(-1,0,0)},i.TransformCoordinates=function(t,e){var r=i.Zero();return i.TransformCoordinatesToRef(t,e,r),r},i.TransformCoordinatesToRef=function(t,e,r){i.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,e,r)},i.TransformCoordinatesFromFloatsToRef=function(t,e,r,n,o){var s=n.m,a=t*s[0]+e*s[4]+r*s[8]+s[12],u=t*s[1]+e*s[5]+r*s[9]+s[13],h=t*s[2]+e*s[6]+r*s[10]+s[14],f=1/(t*s[3]+e*s[7]+r*s[11]+s[15]);o.x=a*f,o.y=u*f,o.z=h*f},i.TransformNormal=function(t,e){var r=i.Zero();return i.TransformNormalToRef(t,e,r),r},i.TransformNormalToRef=function(t,e,r){this.TransformNormalFromFloatsToRef(t._x,t._y,t._z,e,r)},i.TransformNormalFromFloatsToRef=function(t,e,r,n,o){var s=n.m;o.x=t*s[0]+e*s[4]+r*s[8],o.y=t*s[1]+e*s[5]+r*s[9],o.z=t*s[2]+e*s[6]+r*s[10]},i.CatmullRom=function(t,e,r,n,o){var s=o*o,a=o*s,u=.5*(2*e._x+(-t._x+r._x)*o+(2*t._x-5*e._x+4*r._x-n._x)*s+(-t._x+3*e._x-3*r._x+n._x)*a),h=.5*(2*e._y+(-t._y+r._y)*o+(2*t._y-5*e._y+4*r._y-n._y)*s+(-t._y+3*e._y-3*r._y+n._y)*a),f=.5*(2*e._z+(-t._z+r._z)*o+(2*t._z-5*e._z+4*r._z-n._z)*s+(-t._z+3*e._z-3*r._z+n._z)*a);return new i(u,h,f)},i.Clamp=function(t,e,r){var n=new i;return i.ClampToRef(t,e,r,n),n},i.ClampToRef=function(t,e,r,n){var o=t._x;o=o>r._x?r._x:o,o=o<e._x?e._x:o;var s=t._y;s=s>r._y?r._y:s,s=s<e._y?e._y:s;var a=t._z;a=a>r._z?r._z:a,a=a<e._z?e._z:a,n.copyFromFloats(o,s,a)},i.CheckExtends=function(t,e,r){e.minimizeInPlace(t),r.maximizeInPlace(t)},i.Hermite=function(t,e,r,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t._x*u+r._x*h+e._x*f+n._x*l,p=t._y*u+r._y*h+e._y*f+n._y*l,d=t._z*u+r._z*h+e._z*f+n._z*l;return new i(c,p,d)},i.Lerp=function(t,e,r){var n=new i(0,0,0);return i.LerpToRef(t,e,r,n),n},i.LerpToRef=function(t,e,r,n){n.x=t._x+(e._x-t._x)*r,n.y=t._y+(e._y-t._y)*r,n.z=t._z+(e._z-t._z)*r},i.Dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z},i.Cross=function(t,e){var r=i.Zero();return i.CrossToRef(t,e,r),r},i.CrossToRef=function(t,e,r){var n=t._y*e._z-t._z*e._y,o=t._z*e._x-t._x*e._z,s=t._x*e._y-t._y*e._x;r.copyFromFloats(n,o,s)},i.Normalize=function(t){var e=i.Zero();return i.NormalizeToRef(t,e),e},i.NormalizeToRef=function(t,e){t.normalizeToRef(e)},i.Project=function(t,e,r,n){var o=new i;return i.ProjectToRef(t,e,r,n,o),o},i.ProjectToRef=function(t,e,r,n,o){var s=n.width,a=n.height,u=n.x,h=n.y,f=O.Matrix[1];D.FromValuesToRef(s/2,0,0,0,0,-a/2,0,0,0,0,.5,0,u+s/2,a/2+h,.5,1,f);var l=O.Matrix[0];return e.multiplyToRef(r,l),l.multiplyToRef(f,l),i.TransformCoordinatesToRef(t,l,o),o},i._UnprojectFromInvertedMatrixToRef=function(t,e,r){i.TransformCoordinatesToRef(t,e,r);var n=e.m,o=t._x*n[3]+t._y*n[7]+t._z*n[11]+n[15];w.WithinEpsilon(o,1)&&r.scaleInPlace(1/o)},i.UnprojectFromTransform=function(t,e,r,n,o){var s=O.Matrix[0];n.multiplyToRef(o,s),s.invert(),t.x=t._x/e*2-1,t.y=-(t._y/r*2-1);var a=new i;return i._UnprojectFromInvertedMatrixToRef(t,s,a),a},i.Unproject=function(t,e,r,n,o,s){var a=i.Zero();return i.UnprojectToRef(t,e,r,n,o,s,a),a},i.UnprojectToRef=function(t,e,r,n,o,s,a){i.UnprojectFloatsToRef(t._x,t._y,t._z,e,r,n,o,s,a)},i.UnprojectFloatsToRef=function(t,e,r,n,o,s,a,u,h){var f=O.Matrix[0];s.multiplyToRef(a,f),f.multiplyToRef(u,f),f.invert();var l=O.Vector3[0];l.x=t/n*2-1,l.y=-(e/o*2-1),l.z=2*r-1,i._UnprojectFromInvertedMatrixToRef(l,f,h)},i.Minimize=function(t,e){var r=t.clone();return r.minimizeInPlace(e),r},i.Maximize=function(t,e){var r=t.clone();return r.maximizeInPlace(e),r},i.Distance=function(t,e){return Math.sqrt(i.DistanceSquared(t,e))},i.DistanceSquared=function(t,e){var r=t._x-e._x,n=t._y-e._y,o=t._z-e._z;return r*r+n*n+o*o},i.Center=function(t,e){var r=t.add(e);return r.scaleInPlace(.5),r},i.RotationFromAxis=function(t,e,r){var n=i.Zero();return i.RotationFromAxisToRef(t,e,r,n),n},i.RotationFromAxisToRef=function(t,e,r,n){var o=O.Quaternion[0];L.RotationQuaternionFromAxisToRef(t,e,r,o),o.toEulerAnglesToRef(n)},i._UpReadOnly=i.Up(),i._ZeroReadOnly=i.Zero(),i}(),bt=function(){function i(t,e,r,n){this.x=t,this.y=e,this.z=r,this.w=n}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},i.prototype.getClassName=function(){return"Vector4"},i.prototype.getHashCode=function(){var t=this.x|0;return t=t*397^(this.y|0),t=t*397^(this.z|0),t=t*397^(this.w|0),t},i.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},i.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,this},i.prototype.fromArray=function(t,e){return e===void 0&&(e=0),i.FromArrayToRef(t,e,this),this},i.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},i.prototype.add=function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},i.prototype.addToRef=function(t,e){return e.x=this.x+t.x,e.y=this.y+t.y,e.z=this.z+t.z,e.w=this.w+t.w,this},i.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},i.prototype.subtract=function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},i.prototype.subtractToRef=function(t,e){return e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z,e.w=this.w-t.w,this},i.prototype.subtractFromFloats=function(t,e,r,n){return new i(this.x-t,this.y-e,this.z-r,this.w-n)},i.prototype.subtractFromFloatsToRef=function(t,e,r,n,o){return o.x=this.x-t,o.y=this.y-e,o.z=this.z-r,o.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},i.prototype.negateToRef=function(t){return t.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scale=function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},i.prototype.scaleToRef=function(t,e){return e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t,this},i.prototype.scaleAndAddToRef=function(t,e){return e.x+=this.x*t,e.y+=this.y*t,e.z+=this.z*t,e.w+=this.w*t,this},i.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},i.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=ot),t&&w.WithinEpsilon(this.x,t.x,e)&&w.WithinEpsilon(this.y,t.y,e)&&w.WithinEpsilon(this.z,t.z,e)&&w.WithinEpsilon(this.w,t.w,e)},i.prototype.equalsToFloats=function(t,e,r,n){return this.x===t&&this.y===e&&this.z===r&&this.w===n},i.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},i.prototype.multiply=function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},i.prototype.multiplyToRef=function(t,e){return e.x=this.x*t.x,e.y=this.y*t.y,e.z=this.z*t.z,e.w=this.w*t.w,this},i.prototype.multiplyByFloats=function(t,e,r,n){return new i(this.x*t,this.y*e,this.z*r,this.w*n)},i.prototype.divide=function(t){return new i(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},i.prototype.divideToRef=function(t,e){return e.x=this.x/t.x,e.y=this.y/t.y,e.z=this.z/t.z,e.w=this.w/t.w,this},i.prototype.divideInPlace=function(t){return this.divideToRef(t,this)},i.prototype.minimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},i.prototype.maximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},i.prototype.floor=function(){return new i(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},i.prototype.fract=function(){return new i(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var t=this.length();return t===0?this:this.scaleInPlace(1/t)},i.prototype.toVector3=function(){return new _(this.x,this.y,this.z)},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.copyFromFloats=function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},i.prototype.set=function(t,e,r,n){return this.copyFromFloats(t,e,r,n)},i.prototype.setAll=function(t){return this.x=this.y=this.z=this.w=t,this},i.FromArray=function(t,e){return e||(e=0),new i(t[e],t[e+1],t[e+2],t[e+3])},i.FromArrayToRef=function(t,e,r){r.x=t[e],r.y=t[e+1],r.z=t[e+2],r.w=t[e+3]},i.FromFloatArrayToRef=function(t,e,r){i.FromArrayToRef(t,e,r)},i.FromFloatsToRef=function(t,e,r,n,o){o.x=t,o.y=e,o.z=r,o.w=n},i.Zero=function(){return new i(0,0,0,0)},i.One=function(){return new i(1,1,1,1)},i.Normalize=function(t){var e=i.Zero();return i.NormalizeToRef(t,e),e},i.NormalizeToRef=function(t,e){e.copyFrom(t),e.normalize()},i.Minimize=function(t,e){var r=t.clone();return r.minimizeInPlace(e),r},i.Maximize=function(t,e){var r=t.clone();return r.maximizeInPlace(e),r},i.Distance=function(t,e){return Math.sqrt(i.DistanceSquared(t,e))},i.DistanceSquared=function(t,e){var r=t.x-e.x,n=t.y-e.y,o=t.z-e.z,s=t.w-e.w;return r*r+n*n+o*o+s*s},i.Center=function(t,e){var r=t.add(e);return r.scaleInPlace(.5),r},i.TransformNormal=function(t,e){var r=i.Zero();return i.TransformNormalToRef(t,e,r),r},i.TransformNormalToRef=function(t,e,r){var n=e.m,o=t.x*n[0]+t.y*n[4]+t.z*n[8],s=t.x*n[1]+t.y*n[5]+t.z*n[9],a=t.x*n[2]+t.y*n[6]+t.z*n[10];r.x=o,r.y=s,r.z=a,r.w=t.w},i.TransformNormalFromFloatsToRef=function(t,e,r,n,o,s){var a=o.m;s.x=t*a[0]+e*a[4]+r*a[8],s.y=t*a[1]+e*a[5]+r*a[9],s.z=t*a[2]+e*a[6]+r*a[10],s.w=n},i.FromVector3=function(t,e){return e===void 0&&(e=0),new i(t._x,t._y,t._z,e)},i}(),L=function(){function i(t,e,r,n){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=1),this._isDirty=!0,this._x=t,this._y=e,this._z=r,this._w=n}return Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t,this._isDirty=!0},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},i.prototype.getClassName=function(){return"Quaternion"},i.prototype.getHashCode=function(){var t=this._x|0;return t=t*397^(this._y|0),t=t*397^(this._z|0),t=t*397^(this._w|0),t},i.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},i.prototype.equals=function(t){return t&&this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w},i.prototype.equalsWithEpsilon=function(t,e){return e===void 0&&(e=ot),t&&w.WithinEpsilon(this._x,t._x,e)&&w.WithinEpsilon(this._y,t._y,e)&&w.WithinEpsilon(this._z,t._z,e)&&w.WithinEpsilon(this._w,t._w,e)},i.prototype.clone=function(){return new i(this._x,this._y,this._z,this._w)},i.prototype.copyFrom=function(t){return this.x=t._x,this.y=t._y,this.z=t._z,this.w=t._w,this},i.prototype.copyFromFloats=function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},i.prototype.set=function(t,e,r,n){return this.copyFromFloats(t,e,r,n)},i.prototype.add=function(t){return new i(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)},i.prototype.addInPlace=function(t){return this._x+=t._x,this._y+=t._y,this._z+=t._z,this._w+=t._w,this},i.prototype.subtract=function(t){return new i(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)},i.prototype.scale=function(t){return new i(this._x*t,this._y*t,this._z*t,this._w*t)},i.prototype.scaleToRef=function(t,e){return e.x=this._x*t,e.y=this._y*t,e.z=this._z*t,e.w=this._w*t,this},i.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.scaleAndAddToRef=function(t,e){return e.x+=this._x*t,e.y+=this._y*t,e.z+=this._z*t,e.w+=this._w*t,this},i.prototype.multiply=function(t){var e=new i(0,0,0,1);return this.multiplyToRef(t,e),e},i.prototype.multiplyToRef=function(t,e){var r=this._x*t._w+this._y*t._z-this._z*t._y+this._w*t._x,n=-this._x*t._z+this._y*t._w+this._z*t._x+this._w*t._y,o=this._x*t._y-this._y*t._x+this._z*t._w+this._w*t._z,s=-this._x*t._x-this._y*t._y-this._z*t._z+this._w*t._w;return e.copyFromFloats(r,n,o,s),this},i.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},i.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},i.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},i.prototype.conjugate=function(){var t=new i(-this._x,-this._y,-this._z,this._w);return t},i.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},i.prototype.normalize=function(){var t=this.length();if(t===0)return this;var e=1/t;return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},i.prototype.toEulerAngles=function(t){var e=_.Zero();return this.toEulerAnglesToRef(e),e},i.prototype.toEulerAnglesToRef=function(t){var e=this._z,r=this._x,n=this._y,o=this._w,s=o*o,a=e*e,u=r*r,h=n*n,f=n*e-r*o,l=.4999999;return f<-l?(t.y=2*Math.atan2(n,o),t.x=Math.PI/2,t.z=0):f>l?(t.y=2*Math.atan2(n,o),t.x=-Math.PI/2,t.z=0):(t.z=Math.atan2(2*(r*n+e*o),-a-u+h+s),t.x=Math.asin(-2*(e*n-r*o)),t.y=Math.atan2(2*(e*r+n*o),a-u-h+s)),this},i.prototype.toRotationMatrix=function(t){return D.FromQuaternionToRef(this,t),this},i.prototype.fromRotationMatrix=function(t){return i.FromRotationMatrixToRef(t,this),this},i.FromRotationMatrix=function(t){var e=new i;return i.FromRotationMatrixToRef(t,e),e},i.FromRotationMatrixToRef=function(t,e){var r=t.m,n=r[0],o=r[4],s=r[8],a=r[1],u=r[5],h=r[9],f=r[2],l=r[6],c=r[10],p=n+u+c,d;p>0?(d=.5/Math.sqrt(p+1),e.w=.25/d,e.x=(l-h)*d,e.y=(s-f)*d,e.z=(a-o)*d):n>u&&n>c?(d=2*Math.sqrt(1+n-u-c),e.w=(l-h)/d,e.x=.25*d,e.y=(o+a)/d,e.z=(s+f)/d):u>c?(d=2*Math.sqrt(1+u-n-c),e.w=(s-f)/d,e.x=(o+a)/d,e.y=.25*d,e.z=(h+l)/d):(d=2*Math.sqrt(1+c-n-u),e.w=(a-o)/d,e.x=(s+f)/d,e.y=(h+l)/d,e.z=.25*d)},i.Dot=function(t,e){return t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w},i.AreClose=function(t,e){var r=i.Dot(t,e);return r>=0},i.Zero=function(){return new i(0,0,0,0)},i.Inverse=function(t){return new i(-t._x,-t._y,-t._z,t._w)},i.InverseToRef=function(t,e){return e.set(-t._x,-t._y,-t._z,t._w),e},i.Identity=function(){return new i(0,0,0,1)},i.IsIdentity=function(t){return t&&t._x===0&&t._y===0&&t._z===0&&t._w===1},i.RotationAxis=function(t,e){return i.RotationAxisToRef(t,e,new i)},i.RotationAxisToRef=function(t,e,r){var n=Math.sin(e/2);return t.normalize(),r.w=Math.cos(e/2),r.x=t._x*n,r.y=t._y*n,r.z=t._z*n,r},i.FromArray=function(t,e){return e||(e=0),new i(t[e],t[e+1],t[e+2],t[e+3])},i.FromArrayToRef=function(t,e,r){r.x=t[e],r.y=t[e+1],r.z=t[e+2],r.w=t[e+3]},i.FromEulerAngles=function(t,e,r){var n=new i;return i.RotationYawPitchRollToRef(e,t,r,n),n},i.FromEulerAnglesToRef=function(t,e,r,n){return i.RotationYawPitchRollToRef(e,t,r,n),n},i.FromEulerVector=function(t){var e=new i;return i.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e},i.FromEulerVectorToRef=function(t,e){return i.RotationYawPitchRollToRef(t._y,t._x,t._z,e),e},i.RotationYawPitchRoll=function(t,e,r){var n=new i;return i.RotationYawPitchRollToRef(t,e,r,n),n},i.RotationYawPitchRollToRef=function(t,e,r,n){var o=r*.5,s=e*.5,a=t*.5,u=Math.sin(o),h=Math.cos(o),f=Math.sin(s),l=Math.cos(s),c=Math.sin(a),p=Math.cos(a);n.x=p*f*h+c*l*u,n.y=c*l*h-p*f*u,n.z=p*l*u-c*f*h,n.w=p*l*h+c*f*u},i.RotationAlphaBetaGamma=function(t,e,r){var n=new i;return i.RotationAlphaBetaGammaToRef(t,e,r,n),n},i.RotationAlphaBetaGammaToRef=function(t,e,r,n){var o=(r+t)*.5,s=(r-t)*.5,a=e*.5;n.x=Math.cos(s)*Math.sin(a),n.y=Math.sin(s)*Math.sin(a),n.z=Math.sin(o)*Math.cos(a),n.w=Math.cos(o)*Math.cos(a)},i.RotationQuaternionFromAxis=function(t,e,r){var n=new i(0,0,0,0);return i.RotationQuaternionFromAxisToRef(t,e,r,n),n},i.RotationQuaternionFromAxisToRef=function(t,e,r,n){var o=O.Matrix[0];D.FromXYZAxesToRef(t.normalize(),e.normalize(),r.normalize(),o),i.FromRotationMatrixToRef(o,n)},i.Slerp=function(t,e,r){var n=i.Identity();return i.SlerpToRef(t,e,r,n),n},i.SlerpToRef=function(t,e,r,n){var o,s,a=t._x*e._x+t._y*e._y+t._z*e._z+t._w*e._w,u=!1;if(a<0&&(u=!0,a=-a),a>.999999)s=1-r,o=u?-r:r;else{var h=Math.acos(a),f=1/Math.sin(h);s=Math.sin((1-r)*h)*f,o=u?-Math.sin(r*h)*f:Math.sin(r*h)*f}n.x=s*t._x+o*e._x,n.y=s*t._y+o*e._y,n.z=s*t._z+o*e._z,n.w=s*t._w+o*e._w},i.Hermite=function(t,e,r,n,o){var s=o*o,a=o*s,u=2*a-3*s+1,h=-2*a+3*s,f=a-2*s+o,l=a-s,c=t._x*u+r._x*h+e._x*f+n._x*l,p=t._y*u+r._y*h+e._y*f+n._y*l,d=t._z*u+r._z*h+e._z*f+n._z*l,g=t._w*u+r._w*h+e._w*f+n._w*l;return new i(c,p,d,g)},i}(),D=function(){function i(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,Et.MatrixTrackPrecisionChange&&Et.MatrixTrackedMatrices.push(this),this._m=new Et.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(i,"Use64Bits",{get:function(){return Et.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),i.prototype._markAsUpdated=function(){this.updateFlag=i._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},i.prototype._updateIdentityStatus=function(t,e,r,n){e===void 0&&(e=!1),r===void 0&&(r=!1),n===void 0&&(n=!0),this.updateFlag=i._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||r,this._isIdentityDirty=this._isIdentity?!1:e,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:n},i.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var t=this._m;this._isIdentity=t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1}return this._isIdentity},i.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},i.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var t=this._m,e=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],u=t[6],h=t[7],f=t[8],l=t[9],c=t[10],p=t[11],d=t[12],g=t[13],v=t[14],P=t[15],b=c*P-v*p,E=l*P-g*p,A=l*v-g*c,I=f*P-d*p,F=f*v-c*d,C=f*g-d*l,B=+(a*b-u*E+h*A),W=-(s*b-u*I+h*F),tt=+(s*E-a*I+h*C),X=-(s*A-a*F+u*C);return e*B+r*W+n*tt+o*X},i.prototype.toArray=function(){return this._m},i.prototype.asArray=function(){return this._m},i.prototype.invert=function(){return this.invertToRef(this),this},i.prototype.reset=function(){return i.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},i.prototype.add=function(t){var e=new i;return this.addToRef(t,e),e},i.prototype.addToRef=function(t,e){for(var r=this._m,n=e._m,o=t.m,s=0;s<16;s++)n[s]=r[s]+o[s];return e._markAsUpdated(),this},i.prototype.addToSelf=function(t){for(var e=this._m,r=t.m,n=0;n<16;n++)e[n]+=r[n];return this._markAsUpdated(),this},i.prototype.invertToRef=function(t){if(this._isIdentity===!0)return i.IdentityToRef(t),this;var e=this._m,r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],u=e[5],h=e[6],f=e[7],l=e[8],c=e[9],p=e[10],d=e[11],g=e[12],v=e[13],P=e[14],b=e[15],E=p*b-P*d,A=c*b-v*d,I=c*P-v*p,F=l*b-g*d,C=l*P-p*g,B=l*v-g*c,W=+(u*E-h*A+f*I),tt=-(a*E-h*F+f*C),X=+(a*A-u*F+f*B),it=-(a*I-u*C+h*B),et=r*W+n*tt+o*X+s*it;if(et===0)return t.copyFrom(this),this;var x=1/et,rt=h*b-P*f,gt=u*b-v*f,Z=u*P-v*h,Q=a*b-g*f,J=a*P-g*h,$=a*v-g*u,ut=h*d-p*f,It=u*d-c*f,xt=u*p-c*h,Ft=a*d-l*f,wt=a*p-l*h,Bt=a*c-l*u,kt=-(n*E-o*A+s*I),Kt=+(r*E-o*F+s*C),Wt=-(r*A-n*F+s*B),Gt=+(r*I-n*C+o*B),Vt=+(n*rt-o*gt+s*Z),jt=-(r*rt-o*Q+s*J),ht=+(r*gt-n*Q+s*$),ft=-(r*Z-n*J+o*$),lt=-(n*ut-o*It+s*xt),ct=+(r*ut-o*Ft+s*wt),Nt=-(r*It-n*Ft+s*Bt),re=+(r*xt-n*wt+o*Bt);return i.FromValuesToRef(W*x,kt*x,Vt*x,lt*x,tt*x,Kt*x,jt*x,ct*x,X*x,Wt*x,ht*x,Nt*x,it*x,Gt*x,ft*x,re*x,t),this},i.prototype.addAtIndex=function(t,e){return this._m[t]+=e,this._markAsUpdated(),this},i.prototype.multiplyAtIndex=function(t,e){return this._m[t]*=e,this._markAsUpdated(),this},i.prototype.setTranslationFromFloats=function(t,e,r){return this._m[12]=t,this._m[13]=e,this._m[14]=r,this._markAsUpdated(),this},i.prototype.addTranslationFromFloats=function(t,e,r){return this._m[12]+=t,this._m[13]+=e,this._m[14]+=r,this._markAsUpdated(),this},i.prototype.setTranslation=function(t){return this.setTranslationFromFloats(t._x,t._y,t._z)},i.prototype.getTranslation=function(){return new _(this._m[12],this._m[13],this._m[14])},i.prototype.getTranslationToRef=function(t){return t.x=this._m[12],t.y=this._m[13],t.z=this._m[14],this},i.prototype.removeRotationAndScaling=function(){var t=this.m;return i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(t[12]===0&&t[13]===0&&t[14]===0&&t[15]===1),this},i.prototype.multiply=function(t){var e=new i;return this.multiplyToRef(t,e),e},i.prototype.copyFrom=function(t){t.copyToArray(this._m);var e=t;return this._updateIdentityStatus(e._isIdentity,e._isIdentityDirty,e._isIdentity3x2,e._isIdentity3x2Dirty),this},i.prototype.copyToArray=function(t,e){e===void 0&&(e=0);var r=this._m;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],this},i.prototype.multiplyToRef=function(t,e){return this._isIdentity?(e.copyFrom(t),this):t._isIdentity?(e.copyFrom(this),this):(this.multiplyToArray(t,e._m,0),e._markAsUpdated(),this)},i.prototype.multiplyToArray=function(t,e,r){var n=this._m,o=t.m,s=n[0],a=n[1],u=n[2],h=n[3],f=n[4],l=n[5],c=n[6],p=n[7],d=n[8],g=n[9],v=n[10],P=n[11],b=n[12],E=n[13],A=n[14],I=n[15],F=o[0],C=o[1],B=o[2],W=o[3],tt=o[4],X=o[5],it=o[6],et=o[7],x=o[8],rt=o[9],gt=o[10],Z=o[11],Q=o[12],J=o[13],$=o[14],ut=o[15];return e[r]=s*F+a*tt+u*x+h*Q,e[r+1]=s*C+a*X+u*rt+h*J,e[r+2]=s*B+a*it+u*gt+h*$,e[r+3]=s*W+a*et+u*Z+h*ut,e[r+4]=f*F+l*tt+c*x+p*Q,e[r+5]=f*C+l*X+c*rt+p*J,e[r+6]=f*B+l*it+c*gt+p*$,e[r+7]=f*W+l*et+c*Z+p*ut,e[r+8]=d*F+g*tt+v*x+P*Q,e[r+9]=d*C+g*X+v*rt+P*J,e[r+10]=d*B+g*it+v*gt+P*$,e[r+11]=d*W+g*et+v*Z+P*ut,e[r+12]=b*F+E*tt+A*x+I*Q,e[r+13]=b*C+E*X+A*rt+I*J,e[r+14]=b*B+E*it+A*gt+I*$,e[r+15]=b*W+E*et+A*Z+I*ut,this},i.prototype.equals=function(t){var e=t;if(!e)return!1;if((this._isIdentity||e._isIdentity)&&!this._isIdentityDirty&&!e._isIdentityDirty)return this._isIdentity&&e._isIdentity;var r=this.m,n=e.m;return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]&&r[9]===n[9]&&r[10]===n[10]&&r[11]===n[11]&&r[12]===n[12]&&r[13]===n[13]&&r[14]===n[14]&&r[15]===n[15]},i.prototype.clone=function(){var t=new i;return t.copyFrom(this),t},i.prototype.getClassName=function(){return"Matrix"},i.prototype.getHashCode=function(){for(var t=this._m[0]|0,e=1;e<16;e++)t=t*397^(this._m[e]|0);return t},i.prototype.decompose=function(t,e,r){if(this._isIdentity)return r&&r.setAll(0),t&&t.setAll(1),e&&e.copyFromFloats(0,0,0,1),!0;var n=this._m;if(r&&r.copyFromFloats(n[12],n[13],n[14]),t=t||O.Vector3[0],t.x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),t.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),t.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(t.y*=-1),t._x===0||t._y===0||t._z===0)return e&&e.copyFromFloats(0,0,0,1),!1;if(e){var o=1/t._x,s=1/t._y,a=1/t._z;i.FromValuesToRef(n[0]*o,n[1]*o,n[2]*o,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*a,n[9]*a,n[10]*a,0,0,0,0,1,O.Matrix[0]),L.FromRotationMatrixToRef(O.Matrix[0],e)}return!0},i.prototype.getRow=function(t){if(t<0||t>3)return null;var e=t*4;return new bt(this._m[e+0],this._m[e+1],this._m[e+2],this._m[e+3])},i.prototype.setRow=function(t,e){return this.setRowFromFloats(t,e.x,e.y,e.z,e.w)},i.prototype.transpose=function(){return i.Transpose(this)},i.prototype.transposeToRef=function(t){return i.TransposeToRef(this,t),this},i.prototype.setRowFromFloats=function(t,e,r,n,o){if(t<0||t>3)return this;var s=t*4;return this._m[s+0]=e,this._m[s+1]=r,this._m[s+2]=n,this._m[s+3]=o,this._markAsUpdated(),this},i.prototype.scale=function(t){var e=new i;return this.scaleToRef(t,e),e},i.prototype.scaleToRef=function(t,e){for(var r=0;r<16;r++)e._m[r]=this._m[r]*t;return e._markAsUpdated(),this},i.prototype.scaleAndAddToRef=function(t,e){for(var r=0;r<16;r++)e._m[r]+=this._m[r]*t;return e._markAsUpdated(),this},i.prototype.toNormalMatrix=function(t){var e=O.Matrix[0];this.invertToRef(e),e.transposeToRef(t);var r=t._m;i.FromValuesToRef(r[0],r[1],r[2],0,r[4],r[5],r[6],0,r[8],r[9],r[10],0,0,0,0,1,t)},i.prototype.getRotationMatrix=function(){var t=new i;return this.getRotationMatrixToRef(t),t},i.prototype.getRotationMatrixToRef=function(t){var e=O.Vector3[0];if(!this.decompose(e))return i.IdentityToRef(t),this;var r=this._m,n=1/e._x,o=1/e._y,s=1/e._z;return i.FromValuesToRef(r[0]*n,r[1]*n,r[2]*n,0,r[4]*o,r[5]*o,r[6]*o,0,r[8]*s,r[9]*s,r[10]*s,0,0,0,0,1,t),this},i.prototype.toggleModelMatrixHandInPlace=function(){var t=this._m;t[2]*=-1,t[6]*=-1,t[8]*=-1,t[9]*=-1,t[14]*=-1,this._markAsUpdated()},i.prototype.toggleProjectionMatrixHandInPlace=function(){var t=this._m;t[8]*=-1,t[9]*=-1,t[10]*=-1,t[11]*=-1,this._markAsUpdated()},i.FromArray=function(t,e){e===void 0&&(e=0);var r=new i;return i.FromArrayToRef(t,e,r),r},i.FromArrayToRef=function(t,e,r){for(var n=0;n<16;n++)r._m[n]=t[n+e];r._markAsUpdated()},i.FromFloat32ArrayToRefScaled=function(t,e,r,n){for(var o=0;o<16;o++)n._m[o]=t[o+e]*r;n._markAsUpdated()},Object.defineProperty(i,"IdentityReadOnly",{get:function(){return i._identityReadOnly},enumerable:!1,configurable:!0}),i.FromValuesToRef=function(t,e,r,n,o,s,a,u,h,f,l,c,p,d,g,v,P){var b=P._m;b[0]=t,b[1]=e,b[2]=r,b[3]=n,b[4]=o,b[5]=s,b[6]=a,b[7]=u,b[8]=h,b[9]=f,b[10]=l,b[11]=c,b[12]=p,b[13]=d,b[14]=g,b[15]=v,P._markAsUpdated()},i.FromValues=function(t,e,r,n,o,s,a,u,h,f,l,c,p,d,g,v){var P=new i,b=P._m;return b[0]=t,b[1]=e,b[2]=r,b[3]=n,b[4]=o,b[5]=s,b[6]=a,b[7]=u,b[8]=h,b[9]=f,b[10]=l,b[11]=c,b[12]=p,b[13]=d,b[14]=g,b[15]=v,P._markAsUpdated(),P},i.Compose=function(t,e,r){var n=new i;return i.ComposeToRef(t,e,r,n),n},i.ComposeToRef=function(t,e,r,n){var o=n._m,s=e._x,a=e._y,u=e._z,h=e._w,f=s+s,l=a+a,c=u+u,p=s*f,d=s*l,g=s*c,v=a*l,P=a*c,b=u*c,E=h*f,A=h*l,I=h*c,F=t._x,C=t._y,B=t._z;o[0]=(1-(v+b))*F,o[1]=(d+I)*F,o[2]=(g-A)*F,o[3]=0,o[4]=(d-I)*C,o[5]=(1-(p+b))*C,o[6]=(P+E)*C,o[7]=0,o[8]=(g+A)*B,o[9]=(P-E)*B,o[10]=(1-(p+v))*B,o[11]=0,o[12]=r._x,o[13]=r._y,o[14]=r._z,o[15]=1,n._markAsUpdated()},i.Identity=function(){var t=i.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},i.IdentityToRef=function(t){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},i.Zero=function(){var t=i.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},i.RotationX=function(t){var e=new i;return i.RotationXToRef(t,e),e},i.Invert=function(t){var e=new i;return t.invertToRef(e),e},i.RotationXToRef=function(t,e){var r=Math.sin(t),n=Math.cos(t);i.FromValuesToRef(1,0,0,0,0,n,r,0,0,-r,n,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&r===0)},i.RotationY=function(t){var e=new i;return i.RotationYToRef(t,e),e},i.RotationYToRef=function(t,e){var r=Math.sin(t),n=Math.cos(t);i.FromValuesToRef(n,0,-r,0,0,1,0,0,r,0,n,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&r===0)},i.RotationZ=function(t){var e=new i;return i.RotationZToRef(t,e),e},i.RotationZToRef=function(t,e){var r=Math.sin(t),n=Math.cos(t);i.FromValuesToRef(n,r,0,0,-r,n,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(n===1&&r===0)},i.RotationAxis=function(t,e){var r=new i;return i.RotationAxisToRef(t,e,r),r},i.RotationAxisToRef=function(t,e,r){var n=Math.sin(-e),o=Math.cos(-e),s=1-o;t.normalize();var a=r._m;a[0]=t._x*t._x*s+o,a[1]=t._x*t._y*s-t._z*n,a[2]=t._x*t._z*s+t._y*n,a[3]=0,a[4]=t._y*t._x*s+t._z*n,a[5]=t._y*t._y*s+o,a[6]=t._y*t._z*s-t._x*n,a[7]=0,a[8]=t._z*t._x*s-t._y*n,a[9]=t._z*t._y*s+t._x*n,a[10]=t._z*t._z*s+o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,r._markAsUpdated()},i.RotationAlignToRef=function(t,e,r){var n=_.Cross(e,t),o=_.Dot(e,t),s=1/(1+o),a=r._m;a[0]=n._x*n._x*s+o,a[1]=n._y*n._x*s-n._z,a[2]=n._z*n._x*s+n._y,a[3]=0,a[4]=n._x*n._y*s+n._z,a[5]=n._y*n._y*s+o,a[6]=n._z*n._y*s-n._x,a[7]=0,a[8]=n._x*n._z*s-n._y,a[9]=n._y*n._z*s+n._x,a[10]=n._z*n._z*s+o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,r._markAsUpdated()},i.RotationYawPitchRoll=function(t,e,r){var n=new i;return i.RotationYawPitchRollToRef(t,e,r,n),n},i.RotationYawPitchRollToRef=function(t,e,r,n){L.RotationYawPitchRollToRef(t,e,r,O.Quaternion[0]),O.Quaternion[0].toRotationMatrix(n)},i.Scaling=function(t,e,r){var n=new i;return i.ScalingToRef(t,e,r,n),n},i.ScalingToRef=function(t,e,r,n){i.FromValuesToRef(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1,n),n._updateIdentityStatus(t===1&&e===1&&r===1)},i.Translation=function(t,e,r){var n=new i;return i.TranslationToRef(t,e,r,n),n},i.TranslationToRef=function(t,e,r,n){i.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1,n),n._updateIdentityStatus(t===0&&e===0&&r===0)},i.Lerp=function(t,e,r){var n=new i;return i.LerpToRef(t,e,r,n),n},i.LerpToRef=function(t,e,r,n){for(var o=n._m,s=t.m,a=e.m,u=0;u<16;u++)o[u]=s[u]*(1-r)+a[u]*r;n._markAsUpdated()},i.DecomposeLerp=function(t,e,r){var n=new i;return i.DecomposeLerpToRef(t,e,r,n),n},i.DecomposeLerpToRef=function(t,e,r,n){var o=O.Vector3[0],s=O.Quaternion[0],a=O.Vector3[1];t.decompose(o,s,a);var u=O.Vector3[2],h=O.Quaternion[1],f=O.Vector3[3];e.decompose(u,h,f);var l=O.Vector3[4];_.LerpToRef(o,u,r,l);var c=O.Quaternion[2];L.SlerpToRef(s,h,r,c);var p=O.Vector3[5];_.LerpToRef(a,f,r,p),i.ComposeToRef(l,c,p,n)},i.LookAtLH=function(t,e,r){var n=new i;return i.LookAtLHToRef(t,e,r,n),n},i.LookAtLHToRef=function(t,e,r,n){var o=O.Vector3[0],s=O.Vector3[1],a=O.Vector3[2];e.subtractToRef(t,a),a.normalize(),_.CrossToRef(r,a,o);var u=o.lengthSquared();u===0?o.x=1:o.normalizeFromLength(Math.sqrt(u)),_.CrossToRef(a,o,s),s.normalize();var h=-_.Dot(o,t),f=-_.Dot(s,t),l=-_.Dot(a,t);i.FromValuesToRef(o._x,s._x,a._x,0,o._y,s._y,a._y,0,o._z,s._z,a._z,0,h,f,l,1,n)},i.LookAtRH=function(t,e,r){var n=new i;return i.LookAtRHToRef(t,e,r,n),n},i.LookAtRHToRef=function(t,e,r,n){var o=O.Vector3[0],s=O.Vector3[1],a=O.Vector3[2];t.subtractToRef(e,a),a.normalize(),_.CrossToRef(r,a,o);var u=o.lengthSquared();u===0?o.x=1:o.normalizeFromLength(Math.sqrt(u)),_.CrossToRef(a,o,s),s.normalize();var h=-_.Dot(o,t),f=-_.Dot(s,t),l=-_.Dot(a,t);i.FromValuesToRef(o._x,s._x,a._x,0,o._y,s._y,a._y,0,o._z,s._z,a._z,0,h,f,l,1,n)},i.OrthoLH=function(t,e,r,n){var o=new i;return i.OrthoLHToRef(t,e,r,n,o),o},i.OrthoLHToRef=function(t,e,r,n,o){var s=r,a=n,u=2/t,h=2/e,f=2/(a-s),l=-(a+s)/(a-s);i.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,f,0,0,0,l,1,o),o._updateIdentityStatus(u===1&&h===1&&f===1&&l===0)},i.OrthoOffCenterLH=function(t,e,r,n,o,s){var a=new i;return i.OrthoOffCenterLHToRef(t,e,r,n,o,s,a),a},i.OrthoOffCenterLHToRef=function(t,e,r,n,o,s,a){var u=o,h=s,f=2/(e-t),l=2/(n-r),c=2/(h-u),p=-(h+u)/(h-u),d=(t+e)/(t-e),g=(n+r)/(r-n);i.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,0,d,g,p,1,a),a._markAsUpdated()},i.OrthoOffCenterRH=function(t,e,r,n,o,s){var a=new i;return i.OrthoOffCenterRHToRef(t,e,r,n,o,s,a),a},i.OrthoOffCenterRHToRef=function(t,e,r,n,o,s,a){i.OrthoOffCenterLHToRef(t,e,r,n,o,s,a),a._m[10]*=-1},i.PerspectiveLH=function(t,e,r,n){var o=new i,s=r,a=n,u=2*s/t,h=2*s/e,f=(a+s)/(a-s),l=-2*a*s/(a-s);return i.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,f,1,0,0,l,0,o),o._updateIdentityStatus(!1),o},i.PerspectiveFovLH=function(t,e,r,n){var o=new i;return i.PerspectiveFovLHToRef(t,e,r,n,o),o},i.PerspectiveFovLHToRef=function(t,e,r,n,o,s){s===void 0&&(s=!0);var a=r,u=n,h=1/Math.tan(t*.5),f=s?h/e:h,l=s?h:h*e,c=(u+a)/(u-a),p=-2*u*a/(u-a);i.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,1,0,0,p,0,o),o._updateIdentityStatus(!1)},i.PerspectiveFovReverseLHToRef=function(t,e,r,n,o,s){s===void 0&&(s=!0);var a=1/Math.tan(t*.5),u=s?a/e:a,h=s?a:a*e;i.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-r,1,0,0,1,0,o),o._updateIdentityStatus(!1)},i.PerspectiveFovRH=function(t,e,r,n){var o=new i;return i.PerspectiveFovRHToRef(t,e,r,n,o),o},i.PerspectiveFovRHToRef=function(t,e,r,n,o,s){s===void 0&&(s=!0);var a=r,u=n,h=1/Math.tan(t*.5),f=s?h/e:h,l=s?h:h*e,c=-(u+a)/(u-a),p=-2*u*a/(u-a);i.FromValuesToRef(f,0,0,0,0,l,0,0,0,0,c,-1,0,0,p,0,o),o._updateIdentityStatus(!1)},i.PerspectiveFovReverseRHToRef=function(t,e,r,n,o,s){s===void 0&&(s=!0);var a=1/Math.tan(t*.5),u=s?a/e:a,h=s?a:a*e;i.FromValuesToRef(u,0,0,0,0,h,0,0,0,0,-r,-1,0,0,-1,0,o),o._updateIdentityStatus(!1)},i.PerspectiveFovWebVRToRef=function(t,e,r,n,o){o===void 0&&(o=!1);var s=o?-1:1,a=Math.tan(t.upDegrees*Math.PI/180),u=Math.tan(t.downDegrees*Math.PI/180),h=Math.tan(t.leftDegrees*Math.PI/180),f=Math.tan(t.rightDegrees*Math.PI/180),l=2/(h+f),c=2/(a+u),p=n._m;p[0]=l,p[1]=p[2]=p[3]=p[4]=0,p[5]=c,p[6]=p[7]=0,p[8]=(h-f)*l*.5,p[9]=-((a-u)*c*.5),p[10]=-r/(e-r),p[11]=1*s,p[12]=p[13]=p[15]=0,p[14]=-(2*r*e)/(r-e),n._markAsUpdated()},i.GetFinalMatrix=function(t,e,r,n,o,s){var a=t.width,u=t.height,h=t.x,f=t.y,l=i.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,s-o,0,h+a/2,u/2+f,o,1),c=O.Matrix[0];return e.multiplyToRef(r,c),c.multiplyToRef(n,c),c.multiply(l)},i.GetAsMatrix2x2=function(t){var e=t.m,r=[e[0],e[1],e[4],e[5]];return Et.MatrixUse64Bits?r:new Float32Array(r)},i.GetAsMatrix3x3=function(t){var e=t.m,r=[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]];return Et.MatrixUse64Bits?r:new Float32Array(r)},i.Transpose=function(t){var e=new i;return i.TransposeToRef(t,e),e},i.TransposeToRef=function(t,e){var r=e._m,n=t.m;r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15],e._updateIdentityStatus(t._isIdentity,t._isIdentityDirty)},i.Reflection=function(t){var e=new i;return i.ReflectionToRef(t,e),e},i.ReflectionToRef=function(t,e){t.normalize();var r=t.normal.x,n=t.normal.y,o=t.normal.z,s=-2*r,a=-2*n,u=-2*o;i.FromValuesToRef(s*r+1,a*r,u*r,0,s*n,a*n+1,u*n,0,s*o,a*o,u*o+1,0,s*t.d,a*t.d,u*t.d,1,e)},i.FromXYZAxesToRef=function(t,e,r,n){i.FromValuesToRef(t._x,t._y,t._z,0,e._x,e._y,e._z,0,r._x,r._y,r._z,0,0,0,0,1,n)},i.FromQuaternionToRef=function(t,e){var r=t._x*t._x,n=t._y*t._y,o=t._z*t._z,s=t._x*t._y,a=t._z*t._w,u=t._z*t._x,h=t._y*t._w,f=t._y*t._z,l=t._x*t._w;e._m[0]=1-2*(n+o),e._m[1]=2*(s+a),e._m[2]=2*(u-h),e._m[3]=0,e._m[4]=2*(s-a),e._m[5]=1-2*(o+r),e._m[6]=2*(f+l),e._m[7]=0,e._m[8]=2*(u+h),e._m[9]=2*(f-l),e._m[10]=1-2*(n+r),e._m[11]=0,e._m[12]=0,e._m[13]=0,e._m[14]=0,e._m[15]=1,e._markAsUpdated()},i._updateFlagSeed=0,i._identityReadOnly=i.Identity(),i}(),O=function(){function i(){}return i.Vector3=G.BuildArray(6,_.Zero),i.Matrix=G.BuildArray(2,D.Identity),i.Quaternion=G.BuildArray(3,L.Zero),i}(),R=function(){function i(){}return i.Vector2=G.BuildArray(3,at.Zero),i.Vector3=G.BuildArray(13,_.Zero),i.Vector4=G.BuildArray(3,bt.Zero),i.Quaternion=G.BuildArray(2,L.Zero),i.Matrix=G.BuildArray(8,D.Identity),i}();_t.RegisteredTypes["BABYLON.Vector2"]=at;_t.RegisteredTypes["BABYLON.Vector3"]=_;_t.RegisteredTypes["BABYLON.Vector4"]=bt;_t.RegisteredTypes["BABYLON.Matrix"]=D;var Mt=function(){function i(t,e,r){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this.r=t,this.g=e,this.b=r}return i.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},i.prototype.getClassName=function(){return"Color3"},i.prototype.getHashCode=function(){var t=this.r*255|0;return t=t*397^(this.g*255|0),t=t*397^(this.b*255|0),t},i.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,this},i.prototype.fromArray=function(t,e){return e===void 0&&(e=0),i.FromArrayToRef(t,e,this),this},i.prototype.toColor4=function(t){return t===void 0&&(t=1),new H(this.r,this.g,this.b,t)},i.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},i.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},i.prototype.multiply=function(t){return new i(this.r*t.r,this.g*t.g,this.b*t.b)},i.prototype.multiplyToRef=function(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,this},i.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},i.prototype.equalsFloats=function(t,e,r){return this.r===t&&this.g===e&&this.b===r},i.prototype.scale=function(t){return new i(this.r*t,this.g*t,this.b*t)},i.prototype.scaleToRef=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,this},i.prototype.scaleAndAddToRef=function(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,this},i.prototype.clampToRef=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=1),r.r=w.Clamp(this.r,t,e),r.g=w.Clamp(this.g,t,e),r.b=w.Clamp(this.b,t,e),this},i.prototype.add=function(t){return new i(this.r+t.r,this.g+t.g,this.b+t.b)},i.prototype.addToRef=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,this},i.prototype.subtract=function(t){return new i(this.r-t.r,this.g-t.g,this.b-t.b)},i.prototype.subtractToRef=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b)},i.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},i.prototype.copyFromFloats=function(t,e,r){return this.r=t,this.g=e,this.b=r,this},i.prototype.set=function(t,e,r){return this.copyFromFloats(t,e,r)},i.prototype.toHexString=function(){var t=this.r*255|0,e=this.g*255|0,r=this.b*255|0;return"#"+w.ToHex(t)+w.ToHex(e)+w.ToHex(r)},i.prototype.toLinearSpace=function(){var t=new i;return this.toLinearSpaceToRef(t),t},i.prototype.toHSV=function(){var t=new i;return this.toHSVToRef(t),t},i.prototype.toHSVToRef=function(t){var e=this.r,r=this.g,n=this.b,o=Math.max(e,r,n),s=Math.min(e,r,n),a=0,u=0,h=o,f=o-s;o!==0&&(u=f/o),o!=s&&(o==e?(a=(r-n)/f,r<n&&(a+=6)):o==r?a=(n-e)/f+2:o==n&&(a=(e-r)/f+4),a*=60),t.r=a,t.g=u,t.b=h},i.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,Ot),t.g=Math.pow(this.g,Ot),t.b=Math.pow(this.b,Ot),this},i.prototype.toGammaSpace=function(){var t=new i;return this.toGammaSpaceToRef(t),t},i.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,Ct),t.g=Math.pow(this.g,Ct),t.b=Math.pow(this.b,Ct),this},i.HSVtoRGBToRef=function(t,e,r,n){var o=r*e,s=t/60,a=o*(1-Math.abs(s%2-1)),u=0,h=0,f=0;s>=0&&s<=1?(u=o,h=a):s>=1&&s<=2?(u=a,h=o):s>=2&&s<=3?(h=o,f=a):s>=3&&s<=4?(h=a,f=o):s>=4&&s<=5?(u=a,f=o):s>=5&&s<=6&&(u=o,f=a);var l=r-o;n.set(u+l,h+l,f+l)},i.FromHexString=function(t){if(t.substring(0,1)!=="#"||t.length!==7)return new i(0,0,0);var e=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return i.FromInts(e,r,n)},i.FromArray=function(t,e){return e===void 0&&(e=0),new i(t[e],t[e+1],t[e+2])},i.FromArrayToRef=function(t,e,r){e===void 0&&(e=0),r.r=t[e],r.g=t[e+1],r.b=t[e+2]},i.FromInts=function(t,e,r){return new i(t/255,e/255,r/255)},i.Lerp=function(t,e,r){var n=new i(0,0,0);return i.LerpToRef(t,e,r,n),n},i.LerpToRef=function(t,e,r,n){n.r=t.r+(e.r-t.r)*r,n.g=t.g+(e.g-t.g)*r,n.b=t.b+(e.b-t.b)*r},i.Red=function(){return new i(1,0,0)},i.Green=function(){return new i(0,1,0)},i.Blue=function(){return new i(0,0,1)},i.Black=function(){return new i(0,0,0)},Object.defineProperty(i,"BlackReadOnly",{get:function(){return i._BlackReadOnly},enumerable:!1,configurable:!0}),i.White=function(){return new i(1,1,1)},i.Purple=function(){return new i(.5,0,.5)},i.Magenta=function(){return new i(1,0,1)},i.Yellow=function(){return new i(1,1,0)},i.Gray=function(){return new i(.5,.5,.5)},i.Teal=function(){return new i(0,1,1)},i.Random=function(){return new i(Math.random(),Math.random(),Math.random())},i._BlackReadOnly=i.Black(),i}(),H=function(){function i(t,e,r,n){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n}return i.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},i.prototype.asArray=function(){var t=new Array;return this.toArray(t,0),t},i.prototype.toArray=function(t,e){return e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,this},i.prototype.fromArray=function(t,e){return e===void 0&&(e=0),i.FromArrayToRef(t,e,this),this},i.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},i.prototype.add=function(t){return new i(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},i.prototype.subtract=function(t){return new i(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},i.prototype.subtractToRef=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,this},i.prototype.scale=function(t){return new i(this.r*t,this.g*t,this.b*t,this.a*t)},i.prototype.scaleToRef=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this},i.prototype.scaleAndAddToRef=function(t,e){return e.r+=this.r*t,e.g+=this.g*t,e.b+=this.b*t,e.a+=this.a*t,this},i.prototype.clampToRef=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=1),r.r=w.Clamp(this.r,t,e),r.g=w.Clamp(this.g,t,e),r.b=w.Clamp(this.b,t,e),r.a=w.Clamp(this.a,t,e),this},i.prototype.multiply=function(t){return new i(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},i.prototype.multiplyToRef=function(t,e){return e.r=this.r*t.r,e.g=this.g*t.g,e.b=this.b*t.b,e.a=this.a*t.a,e},i.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},i.prototype.getClassName=function(){return"Color4"},i.prototype.getHashCode=function(){var t=this.r*255|0;return t=t*397^(this.g*255|0),t=t*397^(this.b*255|0),t=t*397^(this.a*255|0),t},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.copyFromFloats=function(t,e,r,n){return this.r=t,this.g=e,this.b=r,this.a=n,this},i.prototype.set=function(t,e,r,n){return this.copyFromFloats(t,e,r,n)},i.prototype.toHexString=function(t){t===void 0&&(t=!1);var e=this.r*255|0,r=this.g*255|0,n=this.b*255|0;if(t)return"#"+w.ToHex(e)+w.ToHex(r)+w.ToHex(n);var o=this.a*255|0;return"#"+w.ToHex(e)+w.ToHex(r)+w.ToHex(n)+w.ToHex(o)},i.prototype.toLinearSpace=function(){var t=new i;return this.toLinearSpaceToRef(t),t},i.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,Ot),t.g=Math.pow(this.g,Ot),t.b=Math.pow(this.b,Ot),t.a=this.a,this},i.prototype.toGammaSpace=function(){var t=new i;return this.toGammaSpaceToRef(t),t},i.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,Ct),t.g=Math.pow(this.g,Ct),t.b=Math.pow(this.b,Ct),t.a=this.a,this},i.FromHexString=function(t){if(t.substring(0,1)!=="#"||t.length!==9)return new i(0,0,0,0);var e=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),o=parseInt(t.substring(7,9),16);return i.FromInts(e,r,n,o)},i.Lerp=function(t,e,r){var n=new i(0,0,0,0);return i.LerpToRef(t,e,r,n),n},i.LerpToRef=function(t,e,r,n){n.r=t.r+(e.r-t.r)*r,n.g=t.g+(e.g-t.g)*r,n.b=t.b+(e.b-t.b)*r,n.a=t.a+(e.a-t.a)*r},i.FromColor3=function(t,e){return e===void 0&&(e=1),new i(t.r,t.g,t.b,e)},i.FromArray=function(t,e){return e===void 0&&(e=0),new i(t[e],t[e+1],t[e+2],t[e+3])},i.FromArrayToRef=function(t,e,r){e===void 0&&(e=0),r.r=t[e],r.g=t[e+1],r.b=t[e+2],r.a=t[e+3]},i.FromInts=function(t,e,r,n){return new i(t/255,e/255,r/255,n/255)},i.CheckColors4=function(t,e){if(t.length===e*3){for(var r=[],n=0;n<t.length;n+=3){var o=n/3*4;r[o]=t[n],r[o+1]=t[n+1],r[o+2]=t[n+2],r[o+3]=1}return r}return t},i}(),qt=function(){function i(){}return i.Color3=G.BuildArray(3,Mt.Black),i.Color4=G.BuildArray(3,function(){return new H(0,0,0,0)}),i}();_t.RegisteredTypes["BABYLON.Color3"]=Mt;_t.RegisteredTypes["BABYLON.Color4"]=H;var Qt={},Xt={},ge=function(i,t,e){var r=i();Rt&&Rt.AddTagsTo(r,t.tags);var n=se(r);for(var o in n){var s=n[o],a=t[o],u=s.type;if(a!=null&&o!=="uniqueId")switch(u){case 0:case 6:case 11:r[o]=a;break;case 1:r[o]=e||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:r[o]=e?a:a.clone();break}}return r};function Qe(i){var t=i.getClassName();return Qt[t]||(Qt[t]={}),Qt[t]}function se(i){var t=i.getClassName();if(Xt[t])return Xt[t];Xt[t]={};for(var e=Xt[t],r=i,n=t;n;){var o=Qt[n];for(var s in o)e[s]=o[s];var a=void 0,u=!1;do{if(a=Object.getPrototypeOf(r),!a.getClassName){u=!0;break}if(a.getClassName()!==n)break;r=a}while(a);if(u)break;n=a.getClassName(),r=a}return e}function Pt(i,t){return function(e,r){var n=Qe(e);n[r]||(n[r]={type:i,sourceName:t})}}function Je(i,t){return t===void 0&&(t=null),function(e,r){var n=t||"_"+r;Object.defineProperty(e,r,{get:function(){return this[n]},set:function(o){this[n]!==o&&(this[n]=o,e[i].apply(this))},enumerable:!0,configurable:!0})}}function $e(i,t){return t===void 0&&(t=null),Je(i,t)}function M(i){return Pt(0,i)}function tr(i){return Pt(1,i)}function ve(i){return Pt(2,i)}function Er(i){return Pt(3,i)}function zt(i){return Pt(5,i)}function Dr(i){return Pt(6,i)}function er(i){return Pt(7,i)}function rr(i){return Pt(8,i)}function ir(i){return Pt(10,i)}var k=function(){function i(){}return i.AppendSerializedAnimations=function(t,e){if(t.animations){e.animations=[];for(var r=0;r<t.animations.length;r++){var n=t.animations[r];e.animations.push(n.serialize())}}},i.Serialize=function(t,e){e||(e={}),Rt&&(e.tags=Rt.GetTags(t));var r=se(t);for(var n in r){var o=r[n],s=o.sourceName||n,a=o.type,u=t[n];if(u!=null&&n!=="uniqueId")switch(a){case 0:e[s]=u;break;case 1:e[s]=u.serialize();break;case 2:e[s]=u.asArray();break;case 3:e[s]=u.serialize();break;case 4:e[s]=u.asArray();break;case 5:e[s]=u.asArray();break;case 6:e[s]=u.id;break;case 7:e[s]=u.serialize();break;case 8:e[s]=u.asArray();break;case 9:e[s]=u.serialize();break;case 10:e[s]=u.asArray();break;case 11:e[s]=u.id;case 12:e[s]=u.asArray();break}}return e},i.Parse=function(t,e,r,n){n===void 0&&(n=null);var o=t();n||(n=""),Rt&&Rt.AddTagsTo(o,e.tags);var s=se(o);for(var a in s){var u=s[a],h=e[u.sourceName||a],f=u.type;if(h!=null&&a!=="uniqueId"){var l=o;switch(f){case 0:l[a]=h;break;case 1:r&&(l[a]=i._TextureParser(h,r,n));break;case 2:l[a]=Mt.FromArray(h);break;case 3:l[a]=i._FresnelParametersParser(h);break;case 4:l[a]=at.FromArray(h);break;case 5:l[a]=_.FromArray(h);break;case 6:r&&(l[a]=r.getLastMeshByID(h));break;case 7:l[a]=i._ColorCurvesParser(h);break;case 8:l[a]=H.FromArray(h);break;case 9:l[a]=i._ImageProcessingConfigurationParser(h);break;case 10:l[a]=L.FromArray(h);break;case 11:r&&(l[a]=r.getCameraByID(h));case 12:l[a]=D.FromArray(h);break}}}return o},i.Clone=function(t,e){return ge(t,e,!1)},i.Instanciate=function(t,e){return ge(t,e,!0)},i._ImageProcessingConfigurationParser=function(t){throw S.WarnImport("ImageProcessingConfiguration")},i._FresnelParametersParser=function(t){throw S.WarnImport("FresnelParameters")},i._ColorCurvesParser=function(t){throw S.WarnImport("ColorCurves")},i._TextureParser=function(t,e,r){throw S.WarnImport("Texture")},i}(),At=function(){function i(t,e){e===void 0&&(e=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=D.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new T,this._onDisposeObserver=null,this._behaviors=new Array,this.name=t,this.id=t,this._scene=e||st.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return i.AddNodeConstructor=function(t,e){this._NodeConstructors[t]=e},i.Construct=function(t,e,r,n){var o=this._NodeConstructors[t];return o?o(e,r,n):null},Object.defineProperty(i.prototype,"doNotSerialize",{get:function(){return this._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1},set:function(t){this._doNotSerialize=t},enumerable:!1,configurable:!0}),i.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(i.prototype,"parent",{get:function(){return this._parentNode},set:function(t){if(this._parentNode!==t){var e=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var r=this._parentNode._children.indexOf(this);r!==-1&&this._parentNode._children.splice(r,1),!t&&!this._isDisposed&&this._addToSceneRootNodes()}this._parentNode=t,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),e||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),i.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},i.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var t=this._scene.rootNodes,e=t.length-1;t[this._sceneRootNodesIndex]=t[e],t[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Node"},Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),i.prototype.getScene=function(){return this._scene},i.prototype.getEngine=function(){return this._scene.getEngine()},i.prototype.addBehavior=function(t,e){var r=this;e===void 0&&(e=!1);var n=this._behaviors.indexOf(t);return n!==-1?this:(t.init(),this._scene.isLoading&&!e?this._scene.onDataLoadedObservable.addOnce(function(){t.attach(r)}):t.attach(this),this._behaviors.push(t),this)},i.prototype.removeBehavior=function(t){var e=this._behaviors.indexOf(t);return e===-1?this:(this._behaviors[e].detach(),this._behaviors.splice(e,1),this)},Object.defineProperty(i.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),i.prototype.getBehaviorByName=function(t){for(var e=0,r=this._behaviors;e<r.length;e++){var n=r[e];if(n.name===t)return n}return null},i.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},i.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(i.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),i.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},i.prototype.updateCache=function(t){!t&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},i.prototype._getActionManagerForTrigger=function(t,e){return this.parent?this.parent._getActionManagerForTrigger(t,!1):null},i.prototype._updateCache=function(t){},i.prototype._isSynchronized=function(){return!0},i.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},i.prototype.isSynchronizedWithParent=function(){return this._parentNode?this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0},i.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()},i.prototype.isReady=function(t){return this._isReady},i.prototype.isEnabled=function(t){return t===void 0&&(t=!0),t===!1?this._isEnabled:this._isEnabled?this._isParentEnabled:!1},i.prototype._syncParentEnabledState=function(){this._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(function(t){t._syncParentEnabledState()})},i.prototype.setEnabled=function(t){this._isEnabled=t,this._syncParentEnabledState()},i.prototype.isDescendantOf=function(t){return this.parent?this.parent===t?!0:this.parent.isDescendantOf(t):!1},i.prototype._getDescendants=function(t,e,r){if(e===void 0&&(e=!1),!!this._children)for(var n=0;n<this._children.length;n++){var o=this._children[n];(!r||r(o))&&t.push(o),e||o._getDescendants(t,!1,r)}},i.prototype.getDescendants=function(t,e){var r=new Array;return this._getDescendants(r,t,e),r},i.prototype.getChildMeshes=function(t,e){var r=[];return this._getDescendants(r,t,function(n){return(!e||e(n))&&n.cullingStrategy!==void 0}),r},i.prototype.getChildren=function(t,e){return e===void 0&&(e=!0),this.getDescendants(e,t)},i.prototype._setReady=function(t){if(t!==this._isReady){if(!t){this._isReady=!1;return}this.onReady&&this.onReady(this),this._isReady=!0}},i.prototype.getAnimationByName=function(t){for(var e=0;e<this.animations.length;e++){var r=this.animations[e];if(r.name===t)return r}return null},i.prototype.createAnimationRange=function(t,e,r){if(!this._ranges[t]){this._ranges[t]=i._AnimationRangeFactory(t,e,r);for(var n=0,o=this.animations.length;n<o;n++)this.animations[n]&&this.animations[n].createRange(t,e,r)}},i.prototype.deleteAnimationRange=function(t,e){e===void 0&&(e=!0);for(var r=0,n=this.animations.length;r<n;r++)this.animations[r]&&this.animations[r].deleteRange(t,e);this._ranges[t]=null},i.prototype.getAnimationRange=function(t){return this._ranges[t]||null},i.prototype.getAnimationRanges=function(){var t=[],e;for(e in this._ranges)t.push(this._ranges[e]);return t},i.prototype.beginAnimation=function(t,e,r,n){var o=this.getAnimationRange(t);return o?this._scene.beginAnimation(this,o.from,o.to,e,r,n):null},i.prototype.serializeAnimationRanges=function(){var t=[];for(var e in this._ranges){var r=this._ranges[e];if(!!r){var n={};n.name=e,n.from=r.from,n.to=r.to,t.push(n)}}return t},i.prototype.computeWorldMatrix=function(t){return this._worldMatrix||(this._worldMatrix=D.Identity()),this._worldMatrix},i.prototype.dispose=function(t,e){if(e===void 0&&(e=!1),this._isDisposed=!0,!t)for(var r=this.getDescendants(!0),n=0,o=r;n<o.length;n++){var s=o[n];s.dispose(t,e)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var a=0,u=this._behaviors;a<u.length;a++){var h=u[a];h.detach()}this._behaviors=[]},i.ParseAnimationRanges=function(t,e,r){if(e.ranges)for(var n=0;n<e.ranges.length;n++){var o=e.ranges[n];t.createAnimationRange(o.name,o.from,o.to)}},i.prototype.getHierarchyBoundingVectors=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var r,n,o=this;if(o.getBoundingInfo&&o.subMeshes){var s=o.getBoundingInfo();r=s.boundingBox.minimumWorld.clone(),n=s.boundingBox.maximumWorld.clone()}else r=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new _(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(t)for(var a=this.getDescendants(!1),u=0,h=a;u<h.length;u++){var f=h[u],l=f;if(l.computeWorldMatrix(!0),!(e&&!e(l))&&!(!l.getBoundingInfo||l.getTotalVertices()===0)){var c=l.getBoundingInfo(),p=c.boundingBox,d=p.minimumWorld,g=p.maximumWorld;_.CheckExtends(d,r,n),_.CheckExtends(g,r,n)}}return{min:r,max:n}},i._AnimationRangeFactory=function(t,e,r){throw S.WarnImport("AnimationRange")},i._NodeConstructors={},m([M()],i.prototype,"name",void 0),m([M()],i.prototype,"id",void 0),m([M()],i.prototype,"uniqueId",void 0),m([M()],i.prototype,"state",void 0),m([M()],i.prototype,"metadata",void 0),i}(),yt;(function(i){i[i.LOCAL=0]="LOCAL",i[i.WORLD=1]="WORLD",i[i.BONE=2]="BONE"})(yt||(yt={}));var nr=function(){function i(){}return i.X=new _(1,0,0),i.Y=new _(0,1,0),i.Z=new _(0,0,1),i}(),ye;(function(i){i[i.X=0]="X",i[i.Y=1]="Y",i[i.Z=2]="Z"})(ye||(ye={}));var pt=function(i){Y(t,i);function t(e,r,n){r===void 0&&(r=null),n===void 0&&(n=!0);var o=i.call(this,e,r)||this;return o._forward=new _(0,0,1),o._forwardInverted=new _(0,0,-1),o._up=new _(0,1,0),o._right=new _(1,0,0),o._rightInverted=new _(-1,0,0),o._position=_.Zero(),o._rotation=_.Zero(),o._rotationQuaternion=null,o._scaling=_.One(),o._isDirty=!1,o._transformToBoneReferal=null,o._isAbsoluteSynced=!1,o._billboardMode=t.BILLBOARDMODE_NONE,o._preserveParentRotationForBillboard=!1,o.scalingDeterminant=1,o._infiniteDistance=!1,o.ignoreNonUniformScaling=!1,o.reIntegrateRotationIntoRotationQuaternion=!1,o._poseMatrix=null,o._localMatrix=D.Zero(),o._usePivotMatrix=!1,o._absolutePosition=_.Zero(),o._absoluteScaling=_.Zero(),o._absoluteRotationQuaternion=L.Identity(),o._pivotMatrix=D.Identity(),o._postMultiplyPivotMatrix=!1,o._isWorldMatrixFrozen=!1,o._indexInSceneTransformNodesArray=-1,o.onAfterWorldMatrixUpdateObservable=new T,o._nonUniformScaling=!1,n&&o.getScene().addTransformNode(o),o}return Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return _.Normalize(_.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return _.Normalize(_.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return _.Normalize(_.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=D.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;return!(this.billboardMode!==e.billboardMode||this.billboardMode!==t.BILLBOARDMODE_NONE||e.pivotMatrixUpdated||this.infiniteDistance||this.position._isDirty||this.scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},t.prototype._initCache=function(){i.prototype._initCache.call(this);var e=this._cache;e.localMatrixUpdated=!1,e.billboardMode=-1,e.infiniteDistance=!1},t.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,r){return r===void 0&&(r=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=r,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=D.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.instantiateHierarchy=function(e,r,n){e===void 0&&(e=null);var o=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);o&&n&&n(this,o);for(var s=0,a=this.getChildTransformNodes(!0);s<a.length;s++){var u=a[s];u.instantiateHierarchy(o,r,n)}return o},t.prototype.freezeWorldMatrix=function(e){return e===void 0&&(e=null),e?this._worldMatrix=e:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var r,n,o;if(e.x===void 0){if(arguments.length<3)return this;r=arguments[0],n=arguments[1],o=arguments[2]}else r=e.x,n=e.y,o=e.z;if(this.parent){var s=R.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),_.TransformCoordinatesFromFloatsToRef(r,n,o,s,this.position)}else this.position.x=r,this.position.y=n,this.position.z=o;return this._absolutePosition.copyFrom(e),this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=_.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=R.Matrix[0];return this._localMatrix.invertToRef(e),_.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=_.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,r,n,o,s){r===void 0&&(r=0),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=yt.LOCAL);var a=t._lookAtVectorCache,u=s===yt.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(u,a),this.setDirection(a,r,n,o),s===yt.WORLD&&this.parent)if(this.rotationQuaternion){var h=R.Matrix[0];this.rotationQuaternion.toRotationMatrix(h);var f=R.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),this.rotationQuaternion.fromRotationMatrix(h)}else{var l=R.Quaternion[0];L.FromEulerVectorToRef(this.rotation,l);var h=R.Matrix[0];l.toRotationMatrix(h);var f=R.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),h.multiplyToRef(f,h),l.fromRotationMatrix(h),l.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var r=_.Zero();return this.getDirectionToRef(e,r),r},t.prototype.getDirectionToRef=function(e,r){return _.TransformNormalToRef(e,this.getWorldMatrix(),r),this},t.prototype.setDirection=function(e,r,n,o){r===void 0&&(r=0),n===void 0&&(n=0),o===void 0&&(o=0);var s=-Math.atan2(e.z,e.x)+Math.PI/2,a=Math.sqrt(e.x*e.x+e.z*e.z),u=-Math.atan2(e.y,a);return this.rotationQuaternion?L.RotationYawPitchRollToRef(s+r,u+n,o,this.rotationQuaternion):(this.rotation.x=u+n,this.rotation.y=s+r,this.rotation.z=o),this},t.prototype.setPivotPoint=function(e,r){r===void 0&&(r=yt.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(r==yt.WORLD){var o=R.Matrix[0];n.invertToRef(o),e=_.TransformCoordinates(e,o)}return this.setPivotMatrix(D.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=_.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=_.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return this.getPivotPointToRef(e),_.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.setParent=function(e){if(!e&&!this.parent)return this;var r=R.Quaternion[0],n=R.Vector3[0],o=R.Vector3[1];if(!e)this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(o,r,n);else{var s=R.Matrix[0],a=R.Matrix[1];this.computeWorldMatrix(!0),e.computeWorldMatrix(!0),e.getWorldMatrix().invertToRef(a),this.getWorldMatrix().multiplyToRef(a,s),s.decompose(o,r,n)}return this.rotationQuaternion?this.rotationQuaternion.copyFrom(r):r.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(o),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling===e?!1:(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,r){return this._transformToBoneReferal=r,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},t.prototype.rotate=function(e,r,n){e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));var o;if(!n||n===yt.LOCAL)o=L.RotationAxisToRef(e,r,t._rotationAxisCache),this.rotationQuaternion.multiplyToRef(o,this.rotationQuaternion);else{if(this.parent){var s=R.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),e=_.TransformNormal(e,s)}o=L.RotationAxisToRef(e,r,t._rotationAxisCache),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},t.prototype.rotateAround=function(e,r,n){r.normalize(),this.rotationQuaternion||(this.rotationQuaternion=L.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var o=R.Vector3[0],s=R.Vector3[1],a=R.Vector3[2],u=R.Quaternion[0],h=R.Matrix[0],f=R.Matrix[1],l=R.Matrix[2],c=R.Matrix[3];return e.subtractToRef(this.position,o),D.TranslationToRef(o.x,o.y,o.z,h),D.TranslationToRef(-o.x,-o.y,-o.z,f),D.RotationAxisToRef(r,n,l),f.multiplyToRef(l,c),c.multiplyToRef(h,c),c.decompose(s,u,a),this.position.addInPlace(a),u.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,r,n){var o=e.scale(r);if(!n||n===yt.LOCAL){var s=this.getPositionExpressedInLocalSpace().add(o);this.setPositionWithLocalVector(s)}else this.setAbsolutePosition(this.getAbsolutePosition().add(o));return this},t.prototype.addRotation=function(e,r,n){var o;this.rotationQuaternion?o=this.rotationQuaternion:(o=R.Quaternion[1],L.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,o));var s=R.Quaternion[0];return L.RotationYawPitchRollToRef(r,e,n,s),o.multiplyInPlace(s),this.rotationQuaternion||o.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var r=this.getScene().getRenderId();if(!this._isDirty&&!e&&this.isSynchronized())return this._currentRenderId=r,this._worldMatrix;var n=this.getScene().activeCamera,o=(this._billboardMode&t.BILLBOARDMODE_USE_POSITION)!==0,s=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;s&&n&&o&&(this.lookAt(n.position),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var a=this._cache;a.pivotMatrixUpdated=!1,a.billboardMode=this.billboardMode,a.infiniteDistance=this.infiniteDistance,this._currentRenderId=r,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var u=this._getEffectiveParent(),h=t._TmpScaling,f=this._position;if(this._infiniteDistance&&!this.parent&&n){var l=n.getWorldMatrix(),c=new _(l.m[12],l.m[13],l.m[14]);f=t._TmpTranslation,f.copyFromFloats(this._position.x+c.x,this._position.y+c.y,this._position.z+c.z)}h.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var p;if(this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){var d=this.rotation.lengthSquared();d&&(this._rotationQuaternion.multiplyInPlace(L.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else p=t._TmpRotation,L.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){var g=R.Matrix[1];D.ScalingToRef(h.x,h.y,h.z,g);var v=R.Matrix[0];p.toRotationMatrix(v),this._pivotMatrix.multiplyToRef(g,R.Matrix[4]),R.Matrix[4].multiplyToRef(v,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(f.x,f.y,f.z)}else D.ComposeToRef(h,p,f,this._localMatrix);if(u&&u.getWorldMatrix){if(e&&u.computeWorldMatrix(),s){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),R.Matrix[7]):R.Matrix[7].copyFrom(u.getWorldMatrix());var P=R.Vector3[5],b=R.Vector3[6];R.Matrix[7].decompose(b,void 0,P),D.ScalingToRef(b.x,b.y,b.z,R.Matrix[7]),R.Matrix[7].setTranslation(P),this._localMatrix.multiplyToRef(R.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),R.Matrix[6]),R.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s&&n&&this.billboardMode&&!o){var E=R.Vector3[0];if(this._worldMatrix.getTranslationToRef(E),R.Matrix[1].copyFrom(n.getViewMatrix()),R.Matrix[1].setTranslationFromFloats(0,0,0),R.Matrix[1].invertToRef(R.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){R.Matrix[0].decompose(void 0,R.Quaternion[0],void 0);var A=R.Vector3[1];R.Quaternion[0].toEulerAnglesToRef(A),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(A.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(A.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(A.z=0),D.RotationYawPitchRollToRef(A.y,A.x,A.z,R.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(R.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(R.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=D.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype.resetLocalMatrix=function(e){if(e===void 0&&(e=!0),this.computeWorldMatrix(),e)for(var r=this.getChildren(),n=0;n<r.length;++n){var o=r[n];if(o){o.computeWorldMatrix();var s=R.Matrix[0];o._localMatrix.multiplyToRef(this._localMatrix,s);var a=R.Quaternion[0];s.decompose(o.scaling,a,o.position),o.rotationQuaternion?o.rotationQuaternion=a:a.toEulerAnglesToRef(o.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=L.Identity()),this._worldMatrix=D.Identity()},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return e===void 0&&(e=null),e||(e=this.getScene().activeCamera),_.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return e===void 0&&(e=null),e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()},t.prototype.clone=function(e,r,n){var o=this,s=k.Clone(function(){return new t(e,o.getScene())},this);if(s.name=e,s.id=e,r&&(s.parent=r),!n)for(var a=this.getDescendants(!0),u=0;u<a.length;u++){var h=a[u];h.clone&&h.clone(e+"."+h.name,s)}return s},t.prototype.serialize=function(e){var r=k.Serialize(this,e);return r.type=this.getClassName(),this.parent&&(r.parentId=this.parent.id),r.localMatrix=this.getPivotMatrix().asArray(),r.isEnabled=this.isEnabled(),this.parent&&(r.parentId=this.parent.id),r},t.Parse=function(e,r,n){var o=k.Parse(function(){return new t(e.name,r)},e,r,n);return e.localMatrix?o.setPreTransformMatrix(D.FromArray(e.localMatrix)):e.pivotMatrix&&o.setPivotMatrix(D.FromArray(e.pivotMatrix)),o.setEnabled(e.isEnabled),e.parentId&&(o._waitingParentId=e.parentId),o},t.prototype.getChildTransformNodes=function(e,r){var n=[];return this._getDescendants(n,e,function(o){return(!r||r(o))&&o instanceof t}),n},t.prototype.dispose=function(e,r){if(r===void 0&&(r=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),e)for(var n=this.getChildTransformNodes(!0),o=0,s=n;o<s.length;o++){var a=s[o];a.parent=null,a.computeWorldMatrix(!0)}i.prototype.dispose.call(this,e,r)},t.prototype.normalizeToUnitCube=function(e,r,n){e===void 0&&(e=!0),r===void 0&&(r=!1);var o=null,s=null;r&&(this.rotationQuaternion?(s=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(o=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var a=this.getHierarchyBoundingVectors(e,n),u=a.max.subtract(a.min),h=Math.max(u.x,u.y,u.z);if(h===0)return this;var f=1/h;return this.scaling.scaleInPlace(f),r&&(this.rotationQuaternion&&s?this.rotationQuaternion.copyFrom(s):this.rotation&&o&&this.rotation.copyFrom(o)),this},t.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t._TmpRotation=L.Zero(),t._TmpScaling=_.Zero(),t._TmpTranslation=_.Zero(),t._lookAtVectorCache=new _(0,0,0),t._rotationAxisCache=new L,m([zt("position")],t.prototype,"_position",void 0),m([zt("rotation")],t.prototype,"_rotation",void 0),m([ir("rotationQuaternion")],t.prototype,"_rotationQuaternion",void 0),m([zt("scaling")],t.prototype,"_scaling",void 0),m([M("billboardMode")],t.prototype,"_billboardMode",void 0),m([M()],t.prototype,"scalingDeterminant",void 0),m([M("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),m([M()],t.prototype,"ignoreNonUniformScaling",void 0),m([M()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(At),me=function(){function i(t,e,r,n,o,s,a,u){n===void 0&&(n=0),o===void 0&&(o=!1),s===void 0&&(s=!1),a===void 0&&(a=!1),this._isAlreadyOwned=!1,t.getScene?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=r,this._instanced=s,this._divisor=u||1,this._data=e,this.byteStride=a?n:n*Float32Array.BYTES_PER_ELEMENT,o||this.create()}return i.prototype.createVertexBuffer=function(t,e,r,n,o,s,a){s===void 0&&(s=!1);var u=s?e:e*Float32Array.BYTES_PER_ELEMENT,h=n?s?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new y(this._engine,this,t,this._updatable,!0,h,o===void 0?this._instanced:o,u,r,void 0,void 0,!0,this._divisor||a)},i.prototype.isUpdatable=function(){return this._updatable},i.prototype.getData=function(){return this._data},i.prototype.getBuffer=function(){return this._buffer},i.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},i.prototype.create=function(t){t===void 0&&(t=null),!(!t&&this._buffer)&&(t=t||this._data,!!t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t),this._data=t):this._buffer=this._engine.createVertexBuffer(t)))},i.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},i.prototype.update=function(t){this.create(t)},i.prototype.updateDirectly=function(t,e,r,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,n?e:e*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=null)},i.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},i.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},i}(),y=function(){function i(t,e,r,n,o,s,a,u,h,f,l,c,p,d){if(l===void 0&&(l=!1),c===void 0&&(c=!1),p===void 0&&(p=1),d===void 0&&(d=!1),e instanceof me?(this._buffer=e,this._ownsBuffer=d,d&&this._buffer._increaseReferences()):(this._buffer=new me(t,e,n,s,o,a,c),this._ownsBuffer=!0),this._kind=r,f==null){var g=this.getData();this.type=i.FLOAT,g instanceof Int8Array?this.type=i.BYTE:g instanceof Uint8Array?this.type=i.UNSIGNED_BYTE:g instanceof Int16Array?this.type=i.SHORT:g instanceof Uint16Array?this.type=i.UNSIGNED_SHORT:g instanceof Int32Array?this.type=i.INT:g instanceof Uint32Array&&(this.type=i.UNSIGNED_INT)}else this.type=f;var v=i.GetTypeByteLength(this.type);c?(this._size=h||(s?s/v:i.DeduceStride(r)),this.byteStride=s||this._buffer.byteStride||this._size*v,this.byteOffset=u||0):(this._size=h||s||i.DeduceStride(r),this.byteStride=s?s*v:this._buffer.byteStride||this._size*v,this.byteOffset=(u||0)*v),this.normalized=l,this._instanced=a!==void 0?a:!1,this._instanceDivisor=a?p:0}return Object.defineProperty(i.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(t){this._instanceDivisor=t,t==0?this._instanced=!1:this._instanced=!0},enumerable:!1,configurable:!0}),i.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},i.prototype.getKind=function(){return this._kind},i.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},i.prototype.getData=function(){return this._buffer.getData()},i.prototype.getBuffer=function(){return this._buffer.getBuffer()},i.prototype.getStrideSize=function(){return this.byteStride/i.GetTypeByteLength(this.type)},i.prototype.getOffset=function(){return this.byteOffset/i.GetTypeByteLength(this.type)},i.prototype.getSize=function(){return this._size},i.prototype.getIsInstanced=function(){return this._instanced},i.prototype.getInstanceDivisor=function(){return this._instanceDivisor},i.prototype.create=function(t){this._buffer.create(t)},i.prototype.update=function(t){this._buffer.update(t)},i.prototype.updateDirectly=function(t,e,r){r===void 0&&(r=!1),this._buffer.updateDirectly(t,e,void 0,r)},i.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},i.prototype.forEach=function(t,e){i.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,e)},i.DeduceStride=function(t){switch(t){case i.UVKind:case i.UV2Kind:case i.UV3Kind:case i.UV4Kind:case i.UV5Kind:case i.UV6Kind:return 2;case i.NormalKind:case i.PositionKind:return 3;case i.ColorKind:case i.MatricesIndicesKind:case i.MatricesIndicesExtraKind:case i.MatricesWeightsKind:case i.MatricesWeightsExtraKind:case i.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},i.GetTypeByteLength=function(t){switch(t){case i.BYTE:case i.UNSIGNED_BYTE:return 1;case i.SHORT:case i.UNSIGNED_SHORT:return 2;case i.INT:case i.UNSIGNED_INT:case i.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},i.ForEach=function(t,e,r,n,o,s,a,u){if(t instanceof Array)for(var h=e/4,f=r/4,l=0;l<s;l+=n){for(var c=0;c<n;c++)u(t[h+c],l+c);h+=f}else for(var p=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),d=i.GetTypeByteLength(o),l=0;l<s;l+=n){for(var g=e,c=0;c<n;c++){var v=i._GetFloatValue(p,o,g,a);u(v,l+c),g+=d}e+=r}},i._GetFloatValue=function(t,e,r,n){switch(e){case i.BYTE:{var o=t.getInt8(r);return n&&(o=Math.max(o/127,-1)),o}case i.UNSIGNED_BYTE:{var o=t.getUint8(r);return n&&(o=o/255),o}case i.SHORT:{var o=t.getInt16(r,!0);return n&&(o=Math.max(o/32767,-1)),o}case i.UNSIGNED_SHORT:{var o=t.getUint16(r,!0);return n&&(o=o/65535),o}case i.INT:return t.getInt32(r,!0);case i.UNSIGNED_INT:return t.getUint32(r,!0);case i.FLOAT:return t.getFloat32(r,!0);default:throw new Error("Invalid component type "+e)}},i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra",i}(),be=function(){function i(){}return i.prototype.set=function(t,e){switch(t.length||K.Warn("Setting vertex data kind '"+e+"' with an empty array"),e){case y.PositionKind:this.positions=t;break;case y.NormalKind:this.normals=t;break;case y.TangentKind:this.tangents=t;break;case y.UVKind:this.uvs=t;break;case y.UV2Kind:this.uvs2=t;break;case y.UV3Kind:this.uvs3=t;break;case y.UV4Kind:this.uvs4=t;break;case y.UV5Kind:this.uvs5=t;break;case y.UV6Kind:this.uvs6=t;break;case y.ColorKind:this.colors=t;break;case y.MatricesIndicesKind:this.matricesIndices=t;break;case y.MatricesWeightsKind:this.matricesWeights=t;break;case y.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case y.MatricesWeightsExtraKind:this.matricesWeightsExtra=t;break}},i.prototype.applyToMesh=function(t,e){return this._applyTo(t,e),this},i.prototype.applyToGeometry=function(t,e){return this._applyTo(t,e),this},i.prototype.updateMesh=function(t){return this._update(t),this},i.prototype.updateGeometry=function(t){return this._update(t),this},i.prototype._applyTo=function(t,e){return e===void 0&&(e=!1),this.positions&&t.setVerticesData(y.PositionKind,this.positions,e),this.normals&&t.setVerticesData(y.NormalKind,this.normals,e),this.tangents&&t.setVerticesData(y.TangentKind,this.tangents,e),this.uvs&&t.setVerticesData(y.UVKind,this.uvs,e),this.uvs2&&t.setVerticesData(y.UV2Kind,this.uvs2,e),this.uvs3&&t.setVerticesData(y.UV3Kind,this.uvs3,e),this.uvs4&&t.setVerticesData(y.UV4Kind,this.uvs4,e),this.uvs5&&t.setVerticesData(y.UV5Kind,this.uvs5,e),this.uvs6&&t.setVerticesData(y.UV6Kind,this.uvs6,e),this.colors&&t.setVerticesData(y.ColorKind,this.colors,e),this.matricesIndices&&t.setVerticesData(y.MatricesIndicesKind,this.matricesIndices,e),this.matricesWeights&&t.setVerticesData(y.MatricesWeightsKind,this.matricesWeights,e),this.matricesIndicesExtra&&t.setVerticesData(y.MatricesIndicesExtraKind,this.matricesIndicesExtra,e),this.matricesWeightsExtra&&t.setVerticesData(y.MatricesWeightsExtraKind,this.matricesWeightsExtra,e),this.indices?t.setIndices(this.indices,null,e):t.setIndices([],null),this},i.prototype._update=function(t,e,r){return this.positions&&t.updateVerticesData(y.PositionKind,this.positions,e,r),this.normals&&t.updateVerticesData(y.NormalKind,this.normals,e,r),this.tangents&&t.updateVerticesData(y.TangentKind,this.tangents,e,r),this.uvs&&t.updateVerticesData(y.UVKind,this.uvs,e,r),this.uvs2&&t.updateVerticesData(y.UV2Kind,this.uvs2,e,r),this.uvs3&&t.updateVerticesData(y.UV3Kind,this.uvs3,e,r),this.uvs4&&t.updateVerticesData(y.UV4Kind,this.uvs4,e,r),this.uvs5&&t.updateVerticesData(y.UV5Kind,this.uvs5,e,r),this.uvs6&&t.updateVerticesData(y.UV6Kind,this.uvs6,e,r),this.colors&&t.updateVerticesData(y.ColorKind,this.colors,e,r),this.matricesIndices&&t.updateVerticesData(y.MatricesIndicesKind,this.matricesIndices,e,r),this.matricesWeights&&t.updateVerticesData(y.MatricesWeightsKind,this.matricesWeights,e,r),this.matricesIndicesExtra&&t.updateVerticesData(y.MatricesIndicesExtraKind,this.matricesIndicesExtra,e,r),this.matricesWeightsExtra&&t.updateVerticesData(y.MatricesWeightsExtraKind,this.matricesWeightsExtra,e,r),this.indices&&t.setIndices(this.indices,null),this},i.prototype.transform=function(t){var e=t.determinant()<0,r=_.Zero(),n;if(this.positions){var o=_.Zero();for(n=0;n<this.positions.length;n+=3)_.FromArrayToRef(this.positions,n,o),_.TransformCoordinatesToRef(o,t,r),this.positions[n]=r.x,this.positions[n+1]=r.y,this.positions[n+2]=r.z}if(this.normals){var s=_.Zero();for(n=0;n<this.normals.length;n+=3)_.FromArrayToRef(this.normals,n,s),_.TransformNormalToRef(s,t,r),this.normals[n]=r.x,this.normals[n+1]=r.y,this.normals[n+2]=r.z}if(this.tangents){var a=bt.Zero(),u=bt.Zero();for(n=0;n<this.tangents.length;n+=4)bt.FromArrayToRef(this.tangents,n,a),bt.TransformNormalToRef(a,t,u),this.tangents[n]=u.x,this.tangents[n+1]=u.y,this.tangents[n+2]=u.z,this.tangents[n+3]=u.w}if(e&&this.indices)for(n=0;n<this.indices.length;n+=3){var h=this.indices[n+1];this.indices[n+1]=this.indices[n+2],this.indices[n+2]=h}return this},i.prototype.merge=function(t,e){if(e===void 0&&(e=!1),this._validate(),t._validate(),!this.normals!=!t.normals||!this.tangents!=!t.tangents||!this.uvs!=!t.uvs||!this.uvs2!=!t.uvs2||!this.uvs3!=!t.uvs3||!this.uvs4!=!t.uvs4||!this.uvs5!=!t.uvs5||!this.uvs6!=!t.uvs6||!this.colors!=!t.colors||!this.matricesIndices!=!t.matricesIndices||!this.matricesWeights!=!t.matricesWeights||!this.matricesIndicesExtra!=!t.matricesIndicesExtra||!this.matricesWeightsExtra!=!t.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(t.indices){this.indices||(this.indices=[]);var r=this.positions?this.positions.length/3:0,n=this.indices.BYTES_PER_ELEMENT!==void 0;if(n){var o=this.indices.length+t.indices.length,s=e||this.indices instanceof Uint32Array?new Uint32Array(o):new Uint16Array(o);s.set(this.indices);for(var a=this.indices.length,u=0;u<t.indices.length;u++)s[a+u]=t.indices[u]+r;this.indices=s}else for(var u=0;u<t.indices.length;u++)this.indices.push(t.indices[u]+r)}return this.positions=this._mergeElement(this.positions,t.positions),this.normals=this._mergeElement(this.normals,t.normals),this.tangents=this._mergeElement(this.tangents,t.tangents),this.uvs=this._mergeElement(this.uvs,t.uvs),this.uvs2=this._mergeElement(this.uvs2,t.uvs2),this.uvs3=this._mergeElement(this.uvs3,t.uvs3),this.uvs4=this._mergeElement(this.uvs4,t.uvs4),this.uvs5=this._mergeElement(this.uvs5,t.uvs5),this.uvs6=this._mergeElement(this.uvs6,t.uvs6),this.colors=this._mergeElement(this.colors,t.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,t.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,t.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,t.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,t.matricesWeightsExtra),this},i.prototype._mergeElement=function(t,e){if(!t)return e;if(!e)return t;var r=e.length+t.length,n=t instanceof Float32Array,o=e instanceof Float32Array;if(n){var s=new Float32Array(r);return s.set(t),s.set(e,t.length),s}else if(o){for(var a=t.slice(0),u=0,r=e.length;u<r;u++)a.push(e[u]);return a}else return t.concat(e)},i.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var t=function(n,o){var s=y.DeduceStride(n);if(o.length%s!==0)throw new Error("The "+n+"s array count must be a multiple of "+s);return o.length/s},e=t(y.PositionKind,this.positions),r=function(n,o){var s=t(n,o);if(s!==e)throw new Error("The "+n+"s element count ("+s+") does not match the positions count ("+e+")")};this.normals&&r(y.NormalKind,this.normals),this.tangents&&r(y.TangentKind,this.tangents),this.uvs&&r(y.UVKind,this.uvs),this.uvs2&&r(y.UV2Kind,this.uvs2),this.uvs3&&r(y.UV3Kind,this.uvs3),this.uvs4&&r(y.UV4Kind,this.uvs4),this.uvs5&&r(y.UV5Kind,this.uvs5),this.uvs6&&r(y.UV6Kind,this.uvs6),this.colors&&r(y.ColorKind,this.colors),this.matricesIndices&&r(y.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(y.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(y.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(y.MatricesWeightsExtraKind,this.matricesWeightsExtra)},i.prototype.serialize=function(){var t=this.serialize();return this.positions&&(t.positions=this.positions),this.normals&&(t.normals=this.normals),this.tangents&&(t.tangents=this.tangents),this.uvs&&(t.uvs=this.uvs),this.uvs2&&(t.uvs2=this.uvs2),this.uvs3&&(t.uvs3=this.uvs3),this.uvs4&&(t.uvs4=this.uvs4),this.uvs5&&(t.uvs5=this.uvs5),this.uvs6&&(t.uvs6=this.uvs6),this.colors&&(t.colors=this.colors),this.matricesIndices&&(t.matricesIndices=this.matricesIndices,t.matricesIndices._isExpanded=!0),this.matricesWeights&&(t.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(t.matricesIndicesExtra=this.matricesIndicesExtra,t.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(t.matricesWeightsExtra=this.matricesWeightsExtra),t.indices=this.indices,t},i.ExtractFromMesh=function(t,e,r){return i._ExtractFrom(t,e,r)},i.ExtractFromGeometry=function(t,e,r){return i._ExtractFrom(t,e,r)},i._ExtractFrom=function(t,e,r){var n=new i;return t.isVerticesDataPresent(y.PositionKind)&&(n.positions=t.getVerticesData(y.PositionKind,e,r)),t.isVerticesDataPresent(y.NormalKind)&&(n.normals=t.getVerticesData(y.NormalKind,e,r)),t.isVerticesDataPresent(y.TangentKind)&&(n.tangents=t.getVerticesData(y.TangentKind,e,r)),t.isVerticesDataPresent(y.UVKind)&&(n.uvs=t.getVerticesData(y.UVKind,e,r)),t.isVerticesDataPresent(y.UV2Kind)&&(n.uvs2=t.getVerticesData(y.UV2Kind,e,r)),t.isVerticesDataPresent(y.UV3Kind)&&(n.uvs3=t.getVerticesData(y.UV3Kind,e,r)),t.isVerticesDataPresent(y.UV4Kind)&&(n.uvs4=t.getVerticesData(y.UV4Kind,e,r)),t.isVerticesDataPresent(y.UV5Kind)&&(n.uvs5=t.getVerticesData(y.UV5Kind,e,r)),t.isVerticesDataPresent(y.UV6Kind)&&(n.uvs6=t.getVerticesData(y.UV6Kind,e,r)),t.isVerticesDataPresent(y.ColorKind)&&(n.colors=t.getVerticesData(y.ColorKind,e,r)),t.isVerticesDataPresent(y.MatricesIndicesKind)&&(n.matricesIndices=t.getVerticesData(y.MatricesIndicesKind,e,r)),t.isVerticesDataPresent(y.MatricesWeightsKind)&&(n.matricesWeights=t.getVerticesData(y.MatricesWeightsKind,e,r)),t.isVerticesDataPresent(y.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=t.getVerticesData(y.MatricesIndicesExtraKind,e,r)),t.isVerticesDataPresent(y.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=t.getVerticesData(y.MatricesWeightsExtraKind,e,r)),n.indices=t.getIndices(e,r),n},i.CreateRibbon=function(t){throw S.WarnImport("ribbonBuilder")},i.CreateBox=function(t){throw S.WarnImport("boxBuilder")},i.CreateTiledBox=function(t){throw S.WarnImport("tiledBoxBuilder")},i.CreateTiledPlane=function(t){throw S.WarnImport("tiledPlaneBuilder")},i.CreateSphere=function(t){throw S.WarnImport("sphereBuilder")},i.CreateCylinder=function(t){throw S.WarnImport("cylinderBuilder")},i.CreateTorus=function(t){throw S.WarnImport("torusBuilder")},i.CreateLineSystem=function(t){throw S.WarnImport("linesBuilder")},i.CreateDashedLines=function(t){throw S.WarnImport("linesBuilder")},i.CreateGround=function(t){throw S.WarnImport("groundBuilder")},i.CreateTiledGround=function(t){throw S.WarnImport("groundBuilder")},i.CreateGroundFromHeightMap=function(t){throw S.WarnImport("groundBuilder")},i.CreatePlane=function(t){throw S.WarnImport("planeBuilder")},i.CreateDisc=function(t){throw S.WarnImport("discBuilder")},i.CreatePolygon=function(t,e,r,n,o,s,a){throw S.WarnImport("polygonBuilder")},i.CreateIcoSphere=function(t){throw S.WarnImport("icoSphereBuilder")},i.CreatePolyhedron=function(t){throw S.WarnImport("polyhedronBuilder")},i.CreateCapsule=function(t){throw t===void 0&&(t={orientation:_.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),S.WarnImport("capsuleBuilder")},i.CreateTorusKnot=function(t){throw S.WarnImport("torusKnotBuilder")},i.ComputeNormals=function(t,e,r,n){var o=0,s=0,a=0,u=0,h=0,f=0,l=0,c=0,p=0,d=0,g=0,v=0,P=0,b=0,E=0,A=0,I=0,F=0,C=0,B=0,W=!1,tt=!1,X=!1,it=!1,et=1,x=0,rt=null;if(n&&(W=!!n.facetNormals,tt=!!n.facetPositions,X=!!n.facetPartitioning,et=n.useRightHandedSystem===!0?-1:1,x=n.ratio||0,it=!!n.depthSort,rt=n.distanceTo,it)){rt===void 0&&(rt=_.Zero());var gt=n.depthSortedFacets}var Z=0,Q=0,J=0,$=0;if(X&&n&&n.bbSize){var ut=0,It=0,xt=0,Ft=0,wt=0,Bt=0,kt=0,Kt=0,Wt=0,Gt=0,Vt=0,jt=0,ht=0,ft=0,lt=0,ct=0,Nt=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;Nt=Nt>n.bbSize.z?Nt:n.bbSize.z,Z=n.subDiv.X*x/n.bbSize.x,Q=n.subDiv.Y*x/n.bbSize.y,J=n.subDiv.Z*x/n.bbSize.z,$=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(o=0;o<t.length;o++)r[o]=0;var re=e.length/3|0;for(o=0;o<re;o++){if(v=e[o*3]*3,P=v+1,b=v+2,E=e[o*3+1]*3,A=E+1,I=E+2,F=e[o*3+2]*3,C=F+1,B=F+2,s=t[v]-t[E],a=t[P]-t[A],u=t[b]-t[I],h=t[F]-t[E],f=t[C]-t[A],l=t[B]-t[I],c=et*(a*l-u*f),p=et*(u*h-s*l),d=et*(s*f-a*h),g=Math.sqrt(c*c+p*p+d*d),g=g===0?1:g,c/=g,p/=g,d/=g,W&&n&&(n.facetNormals[o].x=c,n.facetNormals[o].y=p,n.facetNormals[o].z=d),tt&&n&&(n.facetPositions[o].x=(t[v]+t[E]+t[F])/3,n.facetPositions[o].y=(t[P]+t[A]+t[C])/3,n.facetPositions[o].z=(t[b]+t[I]+t[B])/3),X&&n&&(ut=Math.floor((n.facetPositions[o].x-n.bInfo.minimum.x*x)*Z),It=Math.floor((n.facetPositions[o].y-n.bInfo.minimum.y*x)*Q),xt=Math.floor((n.facetPositions[o].z-n.bInfo.minimum.z*x)*J),Ft=Math.floor((t[v]-n.bInfo.minimum.x*x)*Z),wt=Math.floor((t[P]-n.bInfo.minimum.y*x)*Q),Bt=Math.floor((t[b]-n.bInfo.minimum.z*x)*J),kt=Math.floor((t[E]-n.bInfo.minimum.x*x)*Z),Kt=Math.floor((t[A]-n.bInfo.minimum.y*x)*Q),Wt=Math.floor((t[I]-n.bInfo.minimum.z*x)*J),Gt=Math.floor((t[F]-n.bInfo.minimum.x*x)*Z),Vt=Math.floor((t[C]-n.bInfo.minimum.y*x)*Q),jt=Math.floor((t[B]-n.bInfo.minimum.z*x)*J),ft=Ft+n.subDiv.max*wt+$*Bt,lt=kt+n.subDiv.max*Kt+$*Wt,ct=Gt+n.subDiv.max*Vt+$*jt,ht=ut+n.subDiv.max*It+$*xt,n.facetPartitioning[ht]=n.facetPartitioning[ht]?n.facetPartitioning[ht]:new Array,n.facetPartitioning[ft]=n.facetPartitioning[ft]?n.facetPartitioning[ft]:new Array,n.facetPartitioning[lt]=n.facetPartitioning[lt]?n.facetPartitioning[lt]:new Array,n.facetPartitioning[ct]=n.facetPartitioning[ct]?n.facetPartitioning[ct]:new Array,n.facetPartitioning[ft].push(o),lt!=ft&&n.facetPartitioning[lt].push(o),ct==lt||ct==ft||n.facetPartitioning[ct].push(o),ht==ft||ht==lt||ht==ct||n.facetPartitioning[ht].push(o)),it&&n&&n.facetPositions){var ce=gt[o];ce.ind=o*3,ce.sqDistance=_.DistanceSquared(n.facetPositions[o],rt)}r[v]+=c,r[P]+=p,r[b]+=d,r[E]+=c,r[A]+=p,r[I]+=d,r[F]+=c,r[C]+=p,r[B]+=d}for(o=0;o<r.length/3;o++)c=r[o*3],p=r[o*3+1],d=r[o*3+2],g=Math.sqrt(c*c+p*p+d*d),g=g===0?1:g,c/=g,p/=g,d/=g,r[o*3]=c,r[o*3+1]=p,r[o*3+2]=d},i._ComputeSides=function(t,e,r,n,o,s,a){var u=r.length,h=n.length,f,l;switch(t=t||i.DEFAULTSIDE,t){case i.FRONTSIDE:break;case i.BACKSIDE:var c;for(f=0;f<u;f+=3)c=r[f],r[f]=r[f+2],r[f+2]=c;for(l=0;l<h;l++)n[l]=-n[l];break;case i.DOUBLESIDE:for(var p=e.length,d=p/3,g=0;g<p;g++)e[p+g]=e[g];for(f=0;f<u;f+=3)r[f+u]=r[f+2]+d,r[f+1+u]=r[f+1]+d,r[f+2+u]=r[f]+d;for(l=0;l<h;l++)n[h+l]=-n[l];var v=o.length,P=0;for(P=0;P<v;P++)o[P+v]=o[P];for(s=s||new bt(0,0,1,1),a=a||new bt(0,0,1,1),P=0,f=0;f<v/2;f++)o[P]=s.x+(s.z-s.x)*o[P],o[P+1]=s.y+(s.w-s.y)*o[P+1],o[P+v]=a.x+(a.z-a.x)*o[P+v],o[P+v+1]=a.y+(a.w-a.y)*o[P+v+1],P+=2;break}},i.ImportVertexData=function(t,e){var r=new i,n=t.positions;n&&r.set(n,y.PositionKind);var o=t.normals;o&&r.set(o,y.NormalKind);var s=t.tangents;s&&r.set(s,y.TangentKind);var a=t.uvs;a&&r.set(a,y.UVKind);var u=t.uv2s;u&&r.set(u,y.UV2Kind);var h=t.uv3s;h&&r.set(h,y.UV3Kind);var f=t.uv4s;f&&r.set(f,y.UV4Kind);var l=t.uv5s;l&&r.set(l,y.UV5Kind);var c=t.uv6s;c&&r.set(c,y.UV6Kind);var p=t.colors;p&&r.set(H.CheckColors4(p,n.length/3),y.ColorKind);var d=t.matricesIndices;d&&r.set(d,y.MatricesIndicesKind);var g=t.matricesWeights;g&&r.set(g,y.MatricesWeightsKind);var v=t.indices;v&&(r.indices=v),e.setAllVerticesData(r,t.updatable)},i.FRONTSIDE=0,i.BACKSIDE=1,i.DOUBLESIDE=2,i.DEFAULTSIDE=0,i}(),ae=function(){function i(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return i.prototype.getNormal=function(t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(y.NormalKind))return null;var r=this.pickedMesh.getIndices();if(!r)return null;var n;if(e){var o=this.pickedMesh.getVerticesData(y.NormalKind),s=_.FromArray(o,r[this.faceId*3]*3),a=_.FromArray(o,r[this.faceId*3+1]*3),u=_.FromArray(o,r[this.faceId*3+2]*3);s=s.scale(this.bu),a=a.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new _(s.x+a.x+u.x,s.y+a.y+u.y,s.z+a.z+u.z)}else{var h=this.pickedMesh.getVerticesData(y.PositionKind),f=_.FromArray(h,r[this.faceId*3]*3),l=_.FromArray(h,r[this.faceId*3+1]*3),c=_.FromArray(h,r[this.faceId*3+2]*3),p=f.subtract(l),d=c.subtract(l);n=_.Cross(p,d)}if(t){var g=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(R.Matrix[0].copyFrom(g),g=R.Matrix[0],g.setTranslationFromFloats(0,0,0),g.invert(),g.transposeToRef(R.Matrix[1]),g=R.Matrix[1]),n=_.TransformNormal(n,g)}return n.normalize(),n},i.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(y.UVKind))return null;var t=this.pickedMesh.getIndices();if(!t)return null;var e=this.pickedMesh.getVerticesData(y.UVKind);if(!e)return null;var r=at.FromArray(e,t[this.faceId*3]*2),n=at.FromArray(e,t[this.faceId*3+1]*2),o=at.FromArray(e,t[this.faceId*3+2]*2);return r=r.scale(this.bu),n=n.scale(this.bv),o=o.scale(1-this.bu-this.bv),new at(r.x+n.x+o.x,r.y+n.y+o.y)},i}(),Me=function(){function i(t,e,r){this.vectors=G.BuildArray(8,_.Zero),this.center=_.Zero(),this.centerWorld=_.Zero(),this.extendSize=_.Zero(),this.extendSizeWorld=_.Zero(),this.directions=G.BuildArray(3,_.Zero),this.vectorsWorld=G.BuildArray(8,_.Zero),this.minimumWorld=_.Zero(),this.maximumWorld=_.Zero(),this.minimum=_.Zero(),this.maximum=_.Zero(),this.reConstruct(t,e,r)}return i.prototype.reConstruct=function(t,e,r){var n=t.x,o=t.y,s=t.z,a=e.x,u=e.y,h=e.z,f=this.vectors;this.minimum.copyFromFloats(n,o,s),this.maximum.copyFromFloats(a,u,h),f[0].copyFromFloats(n,o,s),f[1].copyFromFloats(a,u,h),f[2].copyFromFloats(a,o,s),f[3].copyFromFloats(n,u,s),f[4].copyFromFloats(n,o,h),f[5].copyFromFloats(a,u,s),f[6].copyFromFloats(n,u,h),f[7].copyFromFloats(a,o,h),e.addToRef(t,this.center).scaleInPlace(.5),e.subtractToRef(t,this.extendSize).scaleInPlace(.5),this._worldMatrix=r||D.IdentityReadOnly,this._update(this._worldMatrix)},i.prototype.scale=function(t){var e=i.TmpVector3,r=this.maximum.subtractToRef(this.minimum,e[0]),n=r.length();r.normalizeFromLength(n);var o=n*t,s=r.scaleInPlace(o*.5),a=this.center.subtractToRef(s,e[1]),u=this.center.addToRef(s,e[2]);return this.reConstruct(a,u,this._worldMatrix),this},i.prototype.getWorldMatrix=function(){return this._worldMatrix},i.prototype._update=function(t){var e=this.minimumWorld,r=this.maximumWorld,n=this.directions,o=this.vectorsWorld,s=this.vectors;if(t.isIdentity()){e.copyFrom(this.minimum),r.copyFrom(this.maximum);for(var a=0;a<8;++a)o[a].copyFrom(s[a]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{e.setAll(Number.MAX_VALUE),r.setAll(-Number.MAX_VALUE);for(var a=0;a<8;++a){var u=o[a];_.TransformCoordinatesToRef(s[a],t,u),e.minimizeInPlace(u),r.maximizeInPlace(u)}r.subtractToRef(e,this.extendSizeWorld).scaleInPlace(.5),r.addToRef(e,this.centerWorld).scaleInPlace(.5)}_.FromArrayToRef(t.m,0,n[0]),_.FromArrayToRef(t.m,4,n[1]),_.FromArrayToRef(t.m,8,n[2]),this._worldMatrix=t},i.prototype.isInFrustum=function(t){return i.IsInFrustum(this.vectorsWorld,t)},i.prototype.isCompletelyInFrustum=function(t){return i.IsCompletelyInFrustum(this.vectorsWorld,t)},i.prototype.intersectsPoint=function(t){var e=this.minimumWorld,r=this.maximumWorld,n=e.x,o=e.y,s=e.z,a=r.x,u=r.y,h=r.z,f=t.x,l=t.y,c=t.z,p=-ot;return!(a-f<p||p>f-n||u-l<p||p>l-o||h-c<p||p>c-s)},i.prototype.intersectsSphere=function(t){return i.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)},i.prototype.intersectsMinMax=function(t,e){var r=this.minimumWorld,n=this.maximumWorld,o=r.x,s=r.y,a=r.z,u=n.x,h=n.y,f=n.z,l=t.x,c=t.y,p=t.z,d=e.x,g=e.y,v=e.z;return!(u<l||o>d||h<c||s>g||f<p||a>v)},i.Intersects=function(t,e){return t.intersectsMinMax(e.minimumWorld,e.maximumWorld)},i.IntersectsSphere=function(t,e,r,n){var o=i.TmpVector3[0];_.ClampToRef(r,t,e,o);var s=_.DistanceSquared(r,o);return s<=n*n},i.IsCompletelyInFrustum=function(t,e){for(var r=0;r<6;++r)for(var n=e[r],o=0;o<8;++o)if(n.dotCoordinate(t[o])<0)return!1;return!0},i.IsInFrustum=function(t,e){for(var r=0;r<6;++r){for(var n=!0,o=e[r],s=0;s<8;++s)if(o.dotCoordinate(t[s])>=0){n=!1;break}if(n)return!1}return!0},i.TmpVector3=G.BuildArray(3,_.Zero),i}(),Pe=function(){function i(t,e,r){this.center=_.Zero(),this.centerWorld=_.Zero(),this.minimum=_.Zero(),this.maximum=_.Zero(),this.reConstruct(t,e,r)}return i.prototype.reConstruct=function(t,e,r){this.minimum.copyFrom(t),this.maximum.copyFrom(e);var n=_.Distance(t,e);e.addToRef(t,this.center).scaleInPlace(.5),this.radius=n*.5,this._update(r||D.IdentityReadOnly)},i.prototype.scale=function(t){var e=this.radius*t,r=i.TmpVector3,n=r[0].setAll(e),o=this.center.subtractToRef(n,r[1]),s=this.center.addToRef(n,r[2]);return this.reConstruct(o,s,this._worldMatrix),this},i.prototype.getWorldMatrix=function(){return this._worldMatrix},i.prototype._update=function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{_.TransformCoordinatesToRef(this.center,t,this.centerWorld);var e=i.TmpVector3[0];_.TransformNormalFromFloatsToRef(1,1,1,t,e),this.radiusWorld=Math.max(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))*this.radius}},i.prototype.isInFrustum=function(t){for(var e=this.centerWorld,r=this.radiusWorld,n=0;n<6;n++)if(t[n].dotCoordinate(e)<=-r)return!1;return!0},i.prototype.isCenterInFrustum=function(t){for(var e=this.centerWorld,r=0;r<6;r++)if(t[r].dotCoordinate(e)<0)return!1;return!0},i.prototype.intersectsPoint=function(t){var e=_.DistanceSquared(this.centerWorld,t);return!(this.radiusWorld*this.radiusWorld<e)},i.Intersects=function(t,e){var r=_.DistanceSquared(t.centerWorld,e.centerWorld),n=t.radiusWorld+e.radiusWorld;return!(n*n<r)},i.TmpVector3=G.BuildArray(3,_.Zero),i}(),ne={min:0,max:0},oe={min:0,max:0},Re=function(i,t,e){var r=_.Dot(t.centerWorld,i),n=Math.abs(_.Dot(t.directions[0],i))*t.extendSize.x,o=Math.abs(_.Dot(t.directions[1],i))*t.extendSize.y,s=Math.abs(_.Dot(t.directions[2],i))*t.extendSize.z,a=n+o+s;e.min=r-a,e.max=r+a},V=function(i,t,e){return Re(i,t,ne),Re(i,e,oe),!(ne.min>oe.max||oe.min>ne.max)},te=function(){function i(t,e,r){this._isLocked=!1,this.boundingBox=new Me(t,e,r),this.boundingSphere=new Pe(t,e,r)}return i.prototype.reConstruct=function(t,e,r){this.boundingBox.reConstruct(t,e,r),this.boundingSphere.reConstruct(t,e,r)},Object.defineProperty(i.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isLocked",{get:function(){return this._isLocked},set:function(t){this._isLocked=t},enumerable:!1,configurable:!0}),i.prototype.update=function(t){this._isLocked||(this.boundingBox._update(t),this.boundingSphere._update(t))},i.prototype.centerOn=function(t,e){var r=i.TmpVector3[0].copyFrom(t).subtractInPlace(e),n=i.TmpVector3[1].copyFrom(t).addInPlace(e);return this.boundingBox.reConstruct(r,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(r,n,this.boundingBox.getWorldMatrix()),this},i.prototype.scale=function(t){return this.boundingBox.scale(t),this.boundingSphere.scale(t),this},i.prototype.isInFrustum=function(t,e){e===void 0&&(e=0);var r=e===2||e===3;if(r&&this.boundingSphere.isCenterInFrustum(t))return!0;if(!this.boundingSphere.isInFrustum(t))return!1;var n=e===1||e===3;return n?!0:this.boundingBox.isInFrustum(t)},Object.defineProperty(i.prototype,"diagonalLength",{get:function(){var t=this.boundingBox,e=t.maximumWorld.subtractToRef(t.minimumWorld,i.TmpVector3[0]);return e.length()},enumerable:!1,configurable:!0}),i.prototype.isCompletelyInFrustum=function(t){return this.boundingBox.isCompletelyInFrustum(t)},i.prototype._checkCollision=function(t){return t._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},i.prototype.intersectsPoint=function(t){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(t)||!this.boundingBox.intersectsPoint(t))},i.prototype.intersects=function(t,e){if(!Pe.Intersects(this.boundingSphere,t.boundingSphere)||!Me.Intersects(this.boundingBox,t.boundingBox))return!1;if(!e)return!0;var r=this.boundingBox,n=t.boundingBox;return!(!V(r.directions[0],r,n)||!V(r.directions[1],r,n)||!V(r.directions[2],r,n)||!V(n.directions[0],r,n)||!V(n.directions[1],r,n)||!V(n.directions[2],r,n)||!V(_.Cross(r.directions[0],n.directions[0]),r,n)||!V(_.Cross(r.directions[0],n.directions[1]),r,n)||!V(_.Cross(r.directions[0],n.directions[2]),r,n)||!V(_.Cross(r.directions[1],n.directions[0]),r,n)||!V(_.Cross(r.directions[1],n.directions[1]),r,n)||!V(_.Cross(r.directions[1],n.directions[2]),r,n)||!V(_.Cross(r.directions[2],n.directions[0]),r,n)||!V(_.Cross(r.directions[2],n.directions[1]),r,n)||!V(_.Cross(r.directions[2],n.directions[2]),r,n))},i.TmpVector3=G.BuildArray(2,_.Zero),i}(),or=function(){function i(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new _(0,0,0),this._diffPositionForCollisions=new _(0,0,0),this._collisionResponse=!0}return i}();function sr(i,t,e,r,n){n===void 0&&(n=null);for(var o=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new _(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),a=e;a<e+r;a++){var u=t[a]*3,h=i[u],f=i[u+1],l=i[u+2];o.minimizeInPlaceFromFloats(h,f,l),s.maximizeInPlaceFromFloats(h,f,l)}return n&&(o.x-=o.x*n.x+n.y,o.y-=o.y*n.x+n.y,o.z-=o.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:o,maximum:s}}function ar(i,t,e,r,n){r===void 0&&(r=null);var o=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new _(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);n||(n=3);for(var a=t,u=t*n;a<t+e;a++,u+=n){var h=i[u],f=i[u+1],l=i[u+2];o.minimizeInPlaceFromFloats(h,f,l),s.maximizeInPlaceFromFloats(h,f,l)}return r&&(o.x-=o.x*r.x+r.y,o.y-=o.y*r.x+r.y,o.z-=o.z*r.x+r.y,s.x+=s.x*r.x+r.y,s.y+=s.y*r.x+r.y,s.z+=s.z*r.x+r.y),{minimum:o,maximum:s}}var ur=function(){function i(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=_.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return i}(),hr=function(){function i(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new ur,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1}return i}(),ue=function(i){Y(t,i);function t(e,r){r===void 0&&(r=null);var n=i.call(this,e,r,!1)||this;return n._internalAbstractMeshDataInfo=new hr,n.cullingStrategy=t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,n.onCollideObservable=new T,n.onCollisionPositionChangeObservable=new T,n.onMaterialChangedObservable=new T,n.definedFacingForward=!0,n._occlusionQuery=null,n._renderingGroup=null,n.alphaIndex=Number.MAX_VALUE,n.isVisible=!0,n.isPickable=!0,n.showSubMeshesBoundingBox=!1,n.isBlocker=!1,n.enablePointerMoveEvents=!1,n._renderingGroupId=0,n._material=null,n.outlineColor=Mt.Red(),n.outlineWidth=.02,n.overlayColor=Mt.Red(),n.overlayAlpha=.5,n.useOctreeForRenderingSelection=!0,n.useOctreeForPicking=!0,n.useOctreeForCollisions=!0,n.alwaysSelectAsActiveMesh=!1,n.doNotSyncBoundingInfo=!1,n.actionManager=null,n._meshCollisionData=new or,n.ellipsoid=new _(.5,1,.5),n.ellipsoidOffset=new _(0,0,0),n.edgesWidth=1,n.edgesColor=new H(1,0,0,1),n._edgesRenderer=null,n._masterMesh=null,n._boundingInfo=null,n._renderId=0,n._intersectionsInProgress=new Array,n._unIndexed=!1,n._lightSources=new Array,n._waitingData={lods:null,actions:null,freezeWorldMatrix:null},n._bonesTransformMatrices=null,n._transformMatrixTexture=null,n.onRebuildObservable=new T,n._onCollisionPositionChange=function(o,s,a){a===void 0&&(a=null),s.subtractToRef(n._meshCollisionData._oldPositionForCollisions,n._meshCollisionData._diffPositionForCollisions),n._meshCollisionData._diffPositionForCollisions.length()>Ue.CollisionsEpsilon&&n.position.addInPlace(n._meshCollisionData._diffPositionForCollisions),a&&n.onCollideObservable.notifyObservers(a),n.onCollisionPositionChangeObservable.notifyObservers(n.position)},n.getScene().addMesh(n),n._resyncLightSources(),n}return Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return pt.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return pt.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return pt.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return pt.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return pt.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_USE_POSITION",{get:function(){return pt.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return i.prototype._updateNonUniformScalingState.call(this,e)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(t.prototype,"onCollide",{set:function(e){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(e){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){this._internalAbstractMeshDataInfo._visibility!==e&&(this._internalAbstractMeshDataInfo._visibility=e,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(e){this._renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material!==e&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),!!this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(e){this._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(e){this._meshCollisionData._collisionResponse=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(e){this._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(e){this._meshCollisionData._surroundingMeshes=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var r=this._internalAbstractMeshDataInfo._skeleton;r&&r.needInitialSkinMatrix&&r._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(e){var r="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");r+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(r+=", skeleton: "+n.name),e&&(r+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],r+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),r},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==pt.BILLBOARDMODE_NONE?this._masterMesh:i.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(e,r){if(r===void 0&&(r=!0),this.actionManager&&(r||this.actionManager.isRecursive))if(e){if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},t.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),!!this.subMeshes)for(var e=0,r=this.subMeshes;e<r.length;e++){var n=r[e];n._rebuild()}},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,r=this.getScene().lights;e<r.length;e++){var n=r[e];!n.isEnabled()||n.canAffectMesh(this)&&this._lightSources.push(n)}this._markSubMeshesAsLightDirty()},t.prototype._resyncLightSource=function(e){var r=e.isEnabled()&&e.canAffectMesh(this),n=this._lightSources.indexOf(e),o=!1;if(n===-1){if(!r)return;this._lightSources.push(e)}else{if(r)return;o=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(o)},t.prototype._unBindEffect=function(){for(var e=0,r=this.subMeshes;e<r.length;e++){var n=r[e];n.setEffect(null)}},t.prototype._removeLightSource=function(e,r){var n=this._lightSources.indexOf(e);n!==-1&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(r))},t.prototype._markSubMeshesAsDirty=function(e){if(!!this.subMeshes)for(var r=0,n=this.subMeshes;r<n.length;r++){var o=n[r];o._materialDefines&&e(o._materialDefines)}},t.prototype._markSubMeshesAsLightDirty=function(e){e===void 0&&(e=!1),this._markSubMeshesAsDirty(function(r){return r.markAsLightDirty(e)})},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsAttributesDirty()})},t.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(e){return e.markAsMiscDirty()})},Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getLOD=function(e){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(e){return null},t.prototype.setVerticesData=function(e,r,n,o){return this},t.prototype.updateVerticesData=function(e,r,n,o){return this},t.prototype.setIndices=function(e,r){return this},t.prototype.isVerticesDataPresent=function(e){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},t.prototype.normalizeToUnitCube=function(e,r,n){return e===void 0&&(e=!0),r===void 0&&(r=!1),i.prototype.normalizeToUnitCube.call(this,e,r,n)},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(y.MatricesIndicesKind)&&this.isVerticesDataPresent(y.MatricesWeightsKind)},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(e){},t.prototype._activate=function(e,r){return this._renderId=e,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===pt.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():i.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():i.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.movePOV=function(e,r,n){return this.position.addInPlace(this.calcMovePOV(e,r,n)),this},t.prototype.calcMovePOV=function(e,r,n){var o=new D,s=this.rotationQuaternion?this.rotationQuaternion:L.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);s.toRotationMatrix(o);var a=_.Zero(),u=this.definedFacingForward?-1:1;return _.TransformCoordinatesFromFloatsToRef(e*u,r,n*u,o,a),a},t.prototype.rotatePOV=function(e,r,n){return this.rotation.addInPlace(this.calcRotatePOV(e,r,n)),this},t.prototype.calcRotatePOV=function(e,r,n){var o=this.definedFacingForward?1:-1;return new _(e*o,r,n*o)},t.prototype.refreshBoundingInfo=function(e){return e===void 0&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(e),null),this)},t.prototype._refreshBoundingInfo=function(e,r){if(e){var n=ar(e,0,this.getTotalVertices(),r);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new te(n.minimum,n.maximum)}if(this.subMeshes)for(var o=0;o<this.subMeshes.length;o++)this.subMeshes[o].refreshBoundingInfo(e);this._updateBoundingInfo()},t.prototype._getPositionData=function(e){var r=this.getVerticesData(y.PositionKind);if(r&&e&&this.skeleton){r=q.Slice(r),this._generatePointsArray();var n=this.getVerticesData(y.MatricesIndicesKind),o=this.getVerticesData(y.MatricesWeightsKind);if(o&&n){var s=this.numBoneInfluencers>4,a=s?this.getVerticesData(y.MatricesIndicesExtraKind):null,u=s?this.getVerticesData(y.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var h=this.skeleton.getTransformMatrices(this),f=R.Vector3[0],l=R.Matrix[0],c=R.Matrix[1],p=0,d=0;d<r.length;d+=3,p+=4){l.reset();var g,v;for(g=0;g<4;g++)v=o[p+g],v>0&&(D.FromFloat32ArrayToRefScaled(h,Math.floor(n[p+g]*16),v,c),l.addToSelf(c));if(s)for(g=0;g<4;g++)v=u[p+g],v>0&&(D.FromFloat32ArrayToRefScaled(h,Math.floor(a[p+g]*16),v,c),l.addToSelf(c));_.TransformCoordinatesFromFloatsToRef(r[d],r[d+1],r[d+2],l,f),f.toArray(r,d),this._positions&&this._positions[d/3].copyFrom(f)}}}return r},t.prototype._updateBoundingInfo=function(){var e=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new te(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var r=this.subMeshes.length,n=0;n<r;n++){var o=this.subMeshes[n];(r>1||!o.IsGlobal)&&o.updateBoundingInfo(e)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(t.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),t.prototype.isInFrustum=function(e){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(e,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(e)},t.prototype.intersectsMesh=function(e,r,n){if(r===void 0&&(r=!1),!this._boundingInfo||!e._boundingInfo)return!1;if(this._boundingInfo.intersects(e._boundingInfo,r))return!0;if(n)for(var o=0,s=this.getChildMeshes();o<s.length;o++){var a=s[o];if(a.intersectsMesh(e,r,!0))return!0}return!1},t.prototype.intersectsPoint=function(e){return this._boundingInfo?this._boundingInfo.intersectsPoint(e):!1},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(e){this._meshCollisionData._checkCollisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),t.prototype.moveWithCollisions=function(e){var r=this.getAbsolutePosition();r.addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var n=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=n.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,n.getNewPosition(this._meshCollisionData._oldPositionForCollisions,e,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(e,r,n){if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(r)){e._lastColliderTransformMatrix=r.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var o=e.verticesStart,s=e.verticesStart+e.verticesCount,a=o;a<s;a++)e._lastColliderWorldVertices.push(_.TransformCoordinates(this._positions[a],r))}return n._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this),this},t.prototype._processCollisionsForSubMeshes=function(e,r){for(var n=this._scene.getCollidingSubMeshCandidates(this,e),o=n.length,s=0;s<o;s++){var a=n.data[s];o>1&&!a._checkCollision(e)||this._collideForSubMesh(a,r,e)}return this},t.prototype._checkCollision=function(e){if(!this._boundingInfo||!this._boundingInfo._checkCollision(e))return this;var r=R.Matrix[0],n=R.Matrix[1];return D.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,r),this.worldMatrixFromCache.multiplyToRef(r,n),this._processCollisionsForSubMeshes(e,n),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(e,r,n,o,s,a){var u;o===void 0&&(o=!1),a===void 0&&(a=!1);var h=new ae,f=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,l=this._boundingInfo;if(!this.subMeshes||!l||!a&&(!e.intersectsSphere(l.boundingSphere,f)||!e.intersectsBox(l.boundingBox,f)))return h;if(o)return h.hit=!a,h.pickedMesh=a?null:this,h.distance=a?0:_.Distance(e.origin,l.boundingSphere.center),h.subMeshId=0,h;if(!this._generatePointsArray())return h;for(var c=null,p=this._scene.getIntersectingSubMeshCandidates(this,e),d=p.length,g=!1,v=0;v<d;v++){var P=p.data[v],b=P.getMaterial();if(!!b&&((u=this.getIndices())===null||u===void 0?void 0:u.length)&&(b.fillMode==7||b.fillMode==0||b.fillMode==1||b.fillMode==2)){g=!0;break}}if(!g)return h.hit=!0,h.pickedMesh=this,h.distance=_.Distance(e.origin,l.boundingSphere.center),h.subMeshId=-1,h;for(var v=0;v<d;v++){var P=p.data[v];if(!(d>1&&!P.canIntersects(e))){var E=P.intersects(e,this._positions,this.getIndices(),r,n);if(E&&(r||!c||E.distance<c.distance)&&(c=E,c.subMeshId=v,r))break}}if(c){var A=s!=null?s:this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix(),I=R.Vector3[0],F=R.Vector3[1];_.TransformCoordinatesToRef(e.origin,A,I),e.direction.scaleToRef(c.distance,F);var C=_.TransformNormal(F,A),B=C.addInPlace(I);return h.hit=!0,h.distance=_.Distance(I,B),h.pickedPoint=B,h.pickedMesh=this,h.bu=c.bu||0,h.bv=c.bv||0,h.subMeshFaceId=c.faceId,h.faceId=c.faceId+p.data[c.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),h.subMeshId=c.subMeshId,h}return h},t.prototype.clone=function(e,r,n){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(e,r){var n=this;r===void 0&&(r=!1);var o;for(this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),o=0;o<this._intersectionsInProgress.length;o++){var s=this._intersectionsInProgress[o],a=s._intersectionsInProgress.indexOf(this);s._intersectionsInProgress.splice(a,1)}this._intersectionsInProgress=[];var u=this.getScene().lights;u.forEach(function(f){var l=f.includedOnlyMeshes.indexOf(n);l!==-1&&f.includedOnlyMeshes.splice(l,1),l=f.excludedMeshes.indexOf(n),l!==-1&&f.excludedMeshes.splice(l,1);var c=f.getShadowGenerator();if(c){var p=c.getShadowMap();p&&p.renderList&&(l=p.renderList.indexOf(n),l!==-1&&p.renderList.splice(l,1))}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();var h=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,h.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),h.wipeCaches(),this.getScene().removeMesh(this),r&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!e)for(o=0;o<this.getScene().particleSystems.length;o++)this.getScene().particleSystems[o].emitter===this&&(this.getScene().particleSystems[o].dispose(),o--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),i.prototype.dispose.call(this,e,r)},t.prototype.addChild=function(e){return e.setParent(this),this},t.prototype.removeChild=function(e){return e.setParent(null),this},t.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var r=0;r<e.facetNb;r++)e.facetNormals[r]=_.Zero(),e.facetPositions[r]=_.Zero();return e.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var r=this.getVerticesData(y.PositionKind),n=this.getIndices(),o=this.getVerticesData(y.NormalKind),s=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,n instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(n);else{for(var a=!1,u=0;u<n.length;u++)if(n[u]>65535){a=!0;break}a?e.depthSortedIndices=new Uint32Array(n):e.depthSortedIndices=new Uint16Array(n)}if(e.facetDepthSortFunction=function(g,v){return v.sqDistance-g.sqDistance},!e.facetDepthSortFrom){var h=this.getScene().activeCamera;e.facetDepthSortFrom=h?h.position:_.Zero()}e.depthSortedFacets=[];for(var f=0;f<e.facetNb;f++){var l={ind:f*3,sqDistance:0};e.depthSortedFacets.push(l)}e.invertedMatrix=D.Identity(),e.facetDepthSortOrigin=_.Zero()}e.bbSize.x=s.maximum.x-s.minimum.x>ot?s.maximum.x-s.minimum.x:ot,e.bbSize.y=s.maximum.y-s.minimum.y>ot?s.maximum.y-s.minimum.y:ot,e.bbSize.z=s.maximum.z-s.minimum.z>ot?s.maximum.z-s.minimum.z:ot;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=s,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),_.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,be.ComputeNormals(r,n,o,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);for(var p=e.depthSortedIndices.length/3|0,f=0;f<p;f++){var d=e.depthSortedFacets[f].ind;e.depthSortedIndices[f*3]=n[d],e.depthSortedIndices[f*3+1]=n[d+1],e.depthSortedIndices[f*3+2]=n[d+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},t.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},t.prototype.getFacetPosition=function(e){var r=_.Zero();return this.getFacetPositionToRef(e,r),r},t.prototype.getFacetPositionToRef=function(e,r){var n=this.getFacetLocalPositions()[e],o=this.getWorldMatrix();return _.TransformCoordinatesToRef(n,o,r),this},t.prototype.getFacetNormal=function(e){var r=_.Zero();return this.getFacetNormalToRef(e,r),r},t.prototype.getFacetNormalToRef=function(e,r){var n=this.getFacetLocalNormals()[e];return _.TransformNormalToRef(n,this.getWorldMatrix(),r),this},t.prototype.getFacetsAtLocalCoordinates=function(e,r,n){var o=this.getBoundingInfo(),s=this._internalAbstractMeshDataInfo._facetData,a=Math.floor((e-o.minimum.x*s.partitioningBBoxRatio)*s.subDiv.X*s.partitioningBBoxRatio/s.bbSize.x),u=Math.floor((r-o.minimum.y*s.partitioningBBoxRatio)*s.subDiv.Y*s.partitioningBBoxRatio/s.bbSize.y),h=Math.floor((n-o.minimum.z*s.partitioningBBoxRatio)*s.subDiv.Z*s.partitioningBBoxRatio/s.bbSize.z);return a<0||a>s.subDiv.max||u<0||u>s.subDiv.max||h<0||h>s.subDiv.max?null:s.facetPartitioning[a+s.subDiv.max*u+s.subDiv.max*s.subDiv.max*h]},t.prototype.getClosestFacetAtCoordinates=function(e,r,n,o,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0);var u=this.getWorldMatrix(),h=R.Matrix[5];u.invertToRef(h);var f=R.Vector3[8];_.TransformCoordinatesFromFloatsToRef(e,r,n,h,f);var l=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,o,s,a);return o&&_.TransformCoordinatesFromFloatsToRef(o.x,o.y,o.z,u,o),l},t.prototype.getClosestFacetAtLocalCoordinates=function(e,r,n,o,s,a){s===void 0&&(s=!1),a===void 0&&(a=!0);var u=null,h=0,f=0,l=0,c=0,p=0,d=0,g=0,v=0,P=this.getFacetLocalPositions(),b=this.getFacetLocalNormals(),E=this.getFacetsAtLocalCoordinates(e,r,n);if(!E)return null;for(var A=Number.MAX_VALUE,I=A,F,C,B,W=0;W<E.length;W++)F=E[W],C=b[F],B=P[F],c=(e-B.x)*C.x+(r-B.y)*C.y+(n-B.z)*C.z,(!s||s&&a&&c>=0||s&&!a&&c<=0)&&(c=C.x*B.x+C.y*B.y+C.z*B.z,p=-(C.x*e+C.y*r+C.z*n-c)/(C.x*C.x+C.y*C.y+C.z*C.z),d=e+C.x*p,g=r+C.y*p,v=n+C.z*p,h=d-e,f=g-r,l=v-n,I=h*h+f*f+l*l,I<A&&(A=I,u=F,o&&(o.x=d,o.y=g,o.z=v)));return u},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(e,r,n){return this},t.prototype.createNormals=function(e){var r=this.getVerticesData(y.PositionKind),n=this.getIndices(),o;return this.isVerticesDataPresent(y.NormalKind)?o=this.getVerticesData(y.NormalKind):o=[],be.ComputeNormals(r,n,o,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(y.NormalKind,o,e),this},t.prototype.alignWithNormal=function(e,r){r||(r=nr.Y);var n=R.Vector3[0],o=R.Vector3[1];return _.CrossToRef(r,e,o),_.CrossToRef(e,o,n),this.rotationQuaternion?L.RotationQuaternionFromAxisToRef(n,e,o,this.rotationQuaternion):_.RotationFromAxisToRef(n,e,o,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw S.WarnImport("EdgesRenderer")},t.prototype.enableEdgesRendering=function(e,r,n){throw S.WarnImport("EdgesRenderer")},t.prototype.getConnectedParticleSystems=function(){var e=this;return this._scene.particleSystems.filter(function(r){return r.emitter===e})},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=0,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,t}(pt);_t.RegisteredTypes["BABYLON.AbstractMesh"]=ue;var fr=function(){function i(t,e,r,n){this.x=t,this.y=e,this.width=r,this.height=n}return i.prototype.toGlobal=function(t,e){return new i(this.x*t,this.y*e,this.width*t,this.height*e)},i.prototype.toGlobalToRef=function(t,e,r){return r.x=this.x*t,r.y=this.y*e,r.width=this.width*t,r.height=this.height*e,this},i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i}(),we=function(){function i(t,e,r,n){this.normal=new _(t,e,r),this.d=n}return i.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},i.prototype.clone=function(){return new i(this.normal.x,this.normal.y,this.normal.z,this.d)},i.prototype.getClassName=function(){return"Plane"},i.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=t*397^(this.d|0),t},i.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),e=0;return t!==0&&(e=1/t),this.normal.x*=e,this.normal.y*=e,this.normal.z*=e,this.d*=e,this},i.prototype.transform=function(t){var e=i._TmpMatrix;t.invertToRef(e);var r=e.m,n=this.normal.x,o=this.normal.y,s=this.normal.z,a=this.d,u=n*r[0]+o*r[1]+s*r[2]+a*r[3],h=n*r[4]+o*r[5]+s*r[6]+a*r[7],f=n*r[8]+o*r[9]+s*r[10]+a*r[11],l=n*r[12]+o*r[13]+s*r[14]+a*r[15];return new i(u,h,f,l)},i.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},i.prototype.copyFromPoints=function(t,e,r){var n=e.x-t.x,o=e.y-t.y,s=e.z-t.z,a=r.x-t.x,u=r.y-t.y,h=r.z-t.z,f=o*h-s*u,l=s*a-n*h,c=n*u-o*a,p=Math.sqrt(f*f+l*l+c*c),d;return p!==0?d=1/p:d=0,this.normal.x=f*d,this.normal.y=l*d,this.normal.z=c*d,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},i.prototype.isFrontFacingTo=function(t,e){var r=_.Dot(this.normal,t);return r<=e},i.prototype.signedDistanceTo=function(t){return _.Dot(t,this.normal)+this.d},i.FromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.FromPoints=function(t,e,r){var n=new i(0,0,0,0);return n.copyFromPoints(t,e,r),n},i.FromPositionAndNormal=function(t,e){var r=new i(0,0,0,0);return e.normalize(),r.normal=e,r.d=-(e.x*t.x+e.y*t.y+e.z*t.z),r},i.SignedDistanceToPlaneFromPositionAndNormal=function(t,e,r){var n=-(e.x*t.x+e.y*t.y+e.z*t.z);return _.Dot(r,e)+n},i._TmpMatrix=D.Identity(),i}(),ee=function(){function i(){}return i.GetPlanes=function(t){for(var e=[],r=0;r<6;r++)e.push(new we(0,0,0,0));return i.GetPlanesToRef(t,e),e},i.GetNearPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[2],e.normal.y=r[7]+r[6],e.normal.z=r[11]+r[10],e.d=r[15]+r[14],e.normalize()},i.GetFarPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[2],e.normal.y=r[7]-r[6],e.normal.z=r[11]-r[10],e.d=r[15]-r[14],e.normalize()},i.GetLeftPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[0],e.normal.y=r[7]+r[4],e.normal.z=r[11]+r[8],e.d=r[15]+r[12],e.normalize()},i.GetRightPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[0],e.normal.y=r[7]-r[4],e.normal.z=r[11]-r[8],e.d=r[15]-r[12],e.normalize()},i.GetTopPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]-r[1],e.normal.y=r[7]-r[5],e.normal.z=r[11]-r[9],e.d=r[15]-r[13],e.normalize()},i.GetBottomPlaneToRef=function(t,e){var r=t.m;e.normal.x=r[3]+r[1],e.normal.y=r[7]+r[5],e.normal.z=r[11]+r[9],e.d=r[15]+r[13],e.normalize()},i.GetPlanesToRef=function(t,e){i.GetNearPlaneToRef(t,e[0]),i.GetFarPlaneToRef(t,e[1]),i.GetLeftPlaneToRef(t,e[2]),i.GetRightPlaneToRef(t,e[3]),i.GetTopPlaneToRef(t,e[4]),i.GetBottomPlaneToRef(t,e[5])},i}(),Zt=function(i){Y(t,i);function t(e,r,n,o){o===void 0&&(o=!0);var s=i.call(this,e,n)||this;return s._position=_.Zero(),s._upVector=_.Up(),s.orthoLeft=null,s.orthoRight=null,s.orthoBottom=null,s.orthoTop=null,s.fov=.8,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s.mode=t.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new fr(0,0,1,1),s.layerMask=268435455,s.fovMode=t.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=t.RIG_MODE_NONE,s.customRenderTargets=new Array,s.outputRenderTarget=null,s.onViewMatrixChangedObservable=new T,s.onProjectionMatrixChangedObservable=new T,s.onAfterCheckInputsObservable=new T,s.onRestoreStateObservable=new T,s.isRigCamera=!1,s._rigCameras=new Array,s._webvrViewMatrix=D.Identity(),s._skipRendering=!1,s._projectionMatrix=new D,s._postProcesses=new Array,s._activeMeshes=new nt(256),s._globalPosition=_.Zero(),s._computedViewMatrix=D.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=D.Zero(),s._refreshFrustumPlanes=!0,s._isCamera=!0,s._isLeftCamera=!1,s._isRightCamera=!1,s.getScene().addCamera(s),o&&!s.getScene().activeCamera&&(s.getScene().activeCamera=s),s.position=r,s}return Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upVector=e},enumerable:!1,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},t.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var r="Name: "+this.name;if(r+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)r+=", animation[0]: "+this.animations[n].toString(e);return r},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},t.prototype.isReady=function(e){if(e===void 0&&(e=!1),e)for(var r=0,n=this._postProcesses;r<n.length;r++){var o=n[r];if(o&&!o.isReady())return!1}return i.prototype.isReady.call(this,e)},t.prototype._initCache=function(){i.prototype._initCache.call(this),this._cache.position=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(e){e||i.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return i.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},t.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var r=this.getEngine();return this.mode===t.PERSPECTIVE_CAMERA?e=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===r.getAspectRatio(this):e=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===r.getRenderWidth()&&this._cache.renderHeight===r.getRenderHeight(),e},t.prototype.attachControl=function(e,r){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(this._postProcesses[e]!==null)return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var r=0,n=this._rigCameras.length;r<n;r++){var o=this._rigCameras[r],s=o._rigPostProcess;if(s){var a=s.getEffectName()==="pass";a&&(o.isIntermediate=this._postProcesses.length===0),o._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()}else o._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,r){return r===void 0&&(r=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(K.Error("You're trying to reuse a post process not defined as reusable."),0):(r==null||r<0?this._postProcesses.push(e):this._postProcesses[r]===null?this._postProcesses[r]=e:this._postProcesses.splice(r,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var r=this._postProcesses.indexOf(e);r!==-1&&(this._postProcesses[r]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},t.prototype._getViewMatrix=function(){return D.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,e!==void 0&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){var r,n,o,s,a,u,h,f;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var l=this.getEngine(),c=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=l.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var p=l.useReverseDepthBuffer,d=void 0;c.useRightHandedSystem?d=p?D.PerspectiveFovReverseRHToRef:D.PerspectiveFovRHToRef:d=p?D.PerspectiveFovReverseLHToRef:D.PerspectiveFovLHToRef,d(this.fov,l.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED)}else{var g=l.getRenderWidth()/2,v=l.getRenderHeight()/2;c.useRightHandedSystem?D.OrthoOffCenterRHToRef((r=this.orthoLeft)!==null&&r!==void 0?r:-g,(n=this.orthoRight)!==null&&n!==void 0?n:g,(o=this.orthoBottom)!==null&&o!==void 0?o:-v,(s=this.orthoTop)!==null&&s!==void 0?s:v,this.minZ,this.maxZ,this._projectionMatrix):D.OrthoOffCenterLHToRef((a=this.orthoLeft)!==null&&a!==void 0?a:-g,(u=this.orthoRight)!==null&&u!==void 0?u:g,(h=this.orthoBottom)!==null&&h!==void 0?h:-v,(f=this.orthoTop)!==null&&f!==void 0?f:v,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=l.getRenderWidth(),this._cache.renderHeight=l.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){!this._refreshFrustumPlanes||(this.getTransformationMatrix(),this._frustumPlanes?ee.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ee.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,r){if(r===void 0&&(r=!1),this._updateFrustumPlanes(),r&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(o){o._updateFrustumPlanes(),n=n||e.isInFrustum(o._frustumPlanes)}),n}else return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,r,n){throw S.WarnImport("Ray")},t.prototype.getForwardRayToRef=function(e,r,n,o){throw S.WarnImport("Ray")},t.prototype.dispose=function(e,r){for(r===void 0&&(r=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var s=this._postProcesses.length;--s>=0;){var o=this._postProcesses[s];o&&o.dispose(this)}for(var s=this.customRenderTargets.length;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),i.prototype.dispose.call(this,e,r)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,r){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=r.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=q.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var o=this.createRigCamera(this.name+"_L",0);o&&(o._isLeftCamera=!0);var s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),o&&s&&(this._rigCameras.push(o),this._rigCameras.push(s))}switch(this.cameraRigMode){case t.RIG_MODE_STEREOSCOPIC_ANAGLYPH:t._setStereoscopicAnaglyphRigMode(this);break;case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case t.RIG_MODE_STEREOSCOPIC_OVERUNDER:case t.RIG_MODE_STEREOSCOPIC_INTERLACED:t._setStereoscopicRigMode(this);break;case t.RIG_MODE_VR:t._setVRRigMode(this,r);break;case t.RIG_MODE_WEBVR:t._setWebVRRigMode(this,r);break}this._cascadePostProcessesToRigCams(),this.update()}},t._setStereoscopicRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},t._setStereoscopicAnaglyphRigMode=function(e){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},t._setVRRigMode=function(e,r){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},t._setWebVRRigMode=function(e,r){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},t.prototype._getVRProjectionMatrix=function(){return D.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return D.Identity()},t.prototype._getWebVRViewMatrix=function(){return D.Identity()},t.prototype.setCameraRigParameter=function(e,r){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=r,e==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=q.ToRadians(r/.0637))},t.prototype.createRigCamera=function(e,r){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=k.Serialize(this);return e.type=this.getClassName(),this.parent&&(e.parentId=this.parent.id),this.inputs&&this.inputs.serialize(e),k.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.prototype.clone=function(e){return k.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},t.prototype.getDirection=function(e){var r=_.Zero();return this.getDirectionToRef(e,r),r},Object.defineProperty(t.prototype,"absoluteRotation",{get:function(){var e=L.Zero();return this.getWorldMatrix().decompose(void 0,e),e},enumerable:!1,configurable:!0}),t.prototype.getDirectionToRef=function(e,r){_.TransformNormalToRef(e,this.getWorldMatrix(),r)},t.GetConstructorFromName=function(e,r,n,o,s){o===void 0&&(o=0),s===void 0&&(s=!0);var a=At.Construct(e,r,n,{interaxial_distance:o,isStereoscopicSideBySide:s});return a||function(){return t._createDefaultParsedCamera(r,n)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,r){var n=e.type,o=t.GetConstructorFromName(n,e.name,r,e.interaxial_distance,e.isStereoscopicSideBySide),s=k.Parse(o,e,r);if(e.parentId&&(s._waitingParentId=e.parentId),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=_.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(_.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(_.FromArray(e.target)),e.cameraRigMode){var a=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,a)}if(e.animations){for(var u=0;u<e.animations.length;u++){var h=e.animations[u],f=_t.GetClass("BABYLON.Animation");f&&s.animations.push(f.Parse(h))}At.ParseAnimationRanges(s,e,r)}return e.autoAnimate&&r.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),s},t._createDefaultParsedCamera=function(e,r){throw S.WarnImport("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,m([zt("position")],t.prototype,"_position",void 0),m([zt("upVector")],t.prototype,"_upVector",void 0),m([M()],t.prototype,"orthoLeft",void 0),m([M()],t.prototype,"orthoRight",void 0),m([M()],t.prototype,"orthoBottom",void 0),m([M()],t.prototype,"orthoTop",void 0),m([M()],t.prototype,"fov",void 0),m([M()],t.prototype,"minZ",void 0),m([M()],t.prototype,"maxZ",void 0),m([M()],t.prototype,"inertia",void 0),m([M()],t.prototype,"mode",void 0),m([M()],t.prototype,"layerMask",void 0),m([M()],t.prototype,"fovMode",void 0),m([M()],t.prototype,"cameraRigMode",void 0),m([M()],t.prototype,"interaxialDistance",void 0),m([M()],t.prototype,"isStereoscopicSideBySide",void 0),t}(At),lr=function(){function i(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return i.AddParser=function(t,e){this._BabylonFileParsers[t]=e},i.GetParser=function(t){return this._BabylonFileParsers[t]?this._BabylonFileParsers[t]:null},i.AddIndividualParser=function(t,e){this._IndividualBabylonFileParsers[t]=e},i.GetIndividualParser=function(t){return this._IndividualBabylonFileParsers[t]?this._IndividualBabylonFileParsers[t]:null},i.Parse=function(t,e,r,n){for(var o in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(o)&&this._BabylonFileParsers[o](t,e,r,n)},Object.defineProperty(i.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture=t},enumerable:!1,configurable:!0}),i.prototype.getNodes=function(){var t=new Array;return t=t.concat(this.meshes),t=t.concat(this.lights),t=t.concat(this.cameras),t=t.concat(this.transformNodes),this.skeletons.forEach(function(e){return t=t.concat(e.bones)}),t},i._BabylonFileParsers={},i._IndividualBabylonFileParsers={},i}(),cr=function(){function i(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(i.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),i.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},i.prototype.markAsUnprocessed=function(){this._isDirty=!0},i.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},i.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},i.prototype.markAsLightDirty=function(t){t===void 0&&(t=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||t,this._isDirty=!0},i.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},i.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},i.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},i.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},i.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},i.prototype.rebuild=function(){this._keys=[];for(var t=0,e=Object.keys(this);t<e.length;t++){var r=e[t];r[0]!=="_"&&this._keys.push(r)}},i.prototype.isEqual=function(t){if(this._keys.length!==t._keys.length)return!1;for(var e=0;e<this._keys.length;e++){var r=this._keys[e];if(this[r]!==t[r])return!1}return!0},i.prototype.cloneTo=function(t){this._keys.length!==t._keys.length&&(t._keys=this._keys.slice(0));for(var e=0;e<this._keys.length;e++){var r=this._keys[e];t[r]=this[r]}},i.prototype.reset=function(){for(var t=0;t<this._keys.length;t++){var e=this._keys[t],r=typeof this[e];switch(r){case"number":this[e]=0;break;case"string":this[e]="";break;default:this[e]=!1;break}}},i.prototype.toString=function(){for(var t="",e=0;e<this._keys.length;e++){var r=this._keys[e],n=this[r],o=typeof n;switch(o){case"number":case"string":t+="#define "+r+" "+n+`
`;break;default:n&&(t+="#define "+r+`
`);break}}return t},i}(),Jt=function(){function i(){this._dirty=!0,this._tempColor=new H(0,0,0,0),this._globalCurve=new H(0,0,0,0),this._highlightsCurve=new H(0,0,0,0),this._midtonesCurve=new H(0,0,0,0),this._shadowsCurve=new H(0,0,0,0),this._positiveCurve=new H(0,0,0,0),this._negativeCurve=new H(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(i.prototype,"globalHue",{get:function(){return this._globalHue},set:function(t){this._globalHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(t){this._globalDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(t){this._globalSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(t){this._globalExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(t){this._highlightsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(t){this._highlightsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(t){this._highlightsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(t){this._highlightsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(t){this._midtonesHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(t){this._midtonesDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(t){this._midtonesSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(t){this._midtonesExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(t){this._shadowsHue=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(t){this._shadowsDensity=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(t){this._shadowsSaturation=t,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(t){this._shadowsExposure=t,this._dirty=!0},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"ColorCurves"},i.Bind=function(t,e,r,n,o){r===void 0&&(r="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),o===void 0&&(o="vCameraColorCurveNegative"),t._dirty&&(t._dirty=!1,t.getColorGradingDataToRef(t._globalHue,t._globalDensity,t._globalSaturation,t._globalExposure,t._globalCurve),t.getColorGradingDataToRef(t._highlightsHue,t._highlightsDensity,t._highlightsSaturation,t._highlightsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._highlightsCurve),t.getColorGradingDataToRef(t._midtonesHue,t._midtonesDensity,t._midtonesSaturation,t._midtonesExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._midtonesCurve),t.getColorGradingDataToRef(t._shadowsHue,t._shadowsDensity,t._shadowsSaturation,t._shadowsExposure,t._tempColor),t._tempColor.multiplyToRef(t._globalCurve,t._shadowsCurve),t._highlightsCurve.subtractToRef(t._midtonesCurve,t._positiveCurve),t._midtonesCurve.subtractToRef(t._shadowsCurve,t._negativeCurve)),e&&(e.setFloat4(r,t._positiveCurve.r,t._positiveCurve.g,t._positiveCurve.b,t._positiveCurve.a),e.setFloat4(n,t._midtonesCurve.r,t._midtonesCurve.g,t._midtonesCurve.b,t._midtonesCurve.a),e.setFloat4(o,t._negativeCurve.r,t._negativeCurve.g,t._negativeCurve.b,t._negativeCurve.a))},i.PrepareUniforms=function(t){t.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},i.prototype.getColorGradingDataToRef=function(t,e,r,n,o){t!=null&&(t=i.clamp(t,0,360),e=i.clamp(e,-100,100),r=i.clamp(r,-100,100),n=i.clamp(n,-100,100),e=i.applyColorGradingSliderNonlinear(e),e*=.5,n=i.applyColorGradingSliderNonlinear(n),e<0&&(e*=-1,t=(t+180)%360),i.fromHSBToRef(t,e,50+.25*n,o),o.scaleToRef(2,o),o.a=1+.01*r)},i.applyColorGradingSliderNonlinear=function(t){t/=100;var e=Math.abs(t);return e=Math.pow(e,2),t<0&&(e*=-1),e*=100,e},i.fromHSBToRef=function(t,e,r,n){var o=i.clamp(t,0,360),s=i.clamp(e/100,0,1),a=i.clamp(r/100,0,1);if(s===0)n.r=a,n.g=a,n.b=a;else{o/=60;var u=Math.floor(o),h=o-u,f=a*(1-s),l=a*(1-s*h),c=a*(1-s*(1-h));switch(u){case 0:n.r=a,n.g=c,n.b=f;break;case 1:n.r=l,n.g=a,n.b=f;break;case 2:n.r=f,n.g=a,n.b=c;break;case 3:n.r=f,n.g=l,n.b=a;break;case 4:n.r=c,n.g=f,n.b=a;break;default:n.r=a,n.g=f,n.b=l;break}}n.a=1},i.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)},i.prototype.clone=function(){return k.Clone(function(){return new i},this)},i.prototype.serialize=function(){return k.Serialize(this)},i.Parse=function(t){return k.Parse(function(){return new i},t,null,null)},m([M()],i.prototype,"_globalHue",void 0),m([M()],i.prototype,"_globalDensity",void 0),m([M()],i.prototype,"_globalSaturation",void 0),m([M()],i.prototype,"_globalExposure",void 0),m([M()],i.prototype,"_highlightsHue",void 0),m([M()],i.prototype,"_highlightsDensity",void 0),m([M()],i.prototype,"_highlightsSaturation",void 0),m([M()],i.prototype,"_highlightsExposure",void 0),m([M()],i.prototype,"_midtonesHue",void 0),m([M()],i.prototype,"_midtonesDensity",void 0),m([M()],i.prototype,"_midtonesSaturation",void 0),m([M()],i.prototype,"_midtonesExposure",void 0),i}();k._ColorCurvesParser=Jt.Parse;(function(i){Y(t,i);function t(){var e=i.call(this)||this;return e.IMAGEPROCESSING=!1,e.VIGNETTE=!1,e.VIGNETTEBLENDMODEMULTIPLY=!1,e.VIGNETTEBLENDMODEOPAQUE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=!1,e.SAMPLER3DBGRMAP=!1,e.IMAGEPROCESSINGPOSTPROCESS=!1,e.EXPOSURE=!1,e.rebuild(),e}return t})(cr);var he=function(){function i(){this.colorCurves=new Jt,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=i.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new H(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=i.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new T}return Object.defineProperty(i.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(t){this._colorCurvesEnabled!==t&&(this._colorCurvesEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(t){this._colorGradingTexture!==t&&(this._colorGradingTexture=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(t){this._colorGradingEnabled!==t&&(this._colorGradingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(t){this._colorGradingWithGreenDepth!==t&&(this._colorGradingWithGreenDepth=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(t){this._colorGradingBGR!==t&&(this._colorGradingBGR=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"exposure",{get:function(){return this._exposure},set:function(t){this._exposure!==t&&(this._exposure=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(t){this._toneMappingEnabled!==t&&(this._toneMappingEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(t){this._toneMappingType!==t&&(this._toneMappingType=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"contrast",{get:function(){return this._contrast},set:function(t){this._contrast!==t&&(this._contrast=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(t){this._vignetteBlendMode!==t&&(this._vignetteBlendMode=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(t){this._vignetteEnabled!==t&&(this._vignetteEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(t){this._applyByPostProcess!==t&&(this._applyByPostProcess=t,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._updateParameters())},enumerable:!1,configurable:!0}),i.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},i.prototype.getClassName=function(){return"ImageProcessingConfiguration"},i.PrepareUniforms=function(t,e){e.EXPOSURE&&t.push("exposureLinear"),e.CONTRAST&&t.push("contrast"),e.COLORGRADING&&t.push("colorTransformSettings"),e.VIGNETTE&&(t.push("vInverseScreenSize"),t.push("vignetteSettings1"),t.push("vignetteSettings2")),e.COLORCURVES&&Jt.PrepareUniforms(t)},i.PrepareSamplers=function(t,e){e.COLORGRADING&&t.push("txColorTransform")},i.prototype.prepareDefines=function(t,e){if(e===void 0&&(e=!1),e!==this.applyByPostProcess||!this._isEnabled){t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===i._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case i.TONEMAPPING_ACES:t.TONEMAPPING_ACES=!0;break;default:t.TONEMAPPING_ACES=!1;break}t.CONTRAST=this.contrast!==1,t.EXPOSURE=this.exposure!==1,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},i.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},i.prototype.bind=function(t,e){if(this._colorCurvesEnabled&&this.colorCurves&&Jt.Bind(this.colorCurves,t),this._vignetteEnabled){var r=1/t.getEngine().getRenderWidth(),n=1/t.getEngine().getRenderHeight();t.setFloat2("vInverseScreenSize",r,n);var o=e!=null?e:n/r,s=Math.tan(this.vignetteCameraFov*.5),a=s*o,u=Math.sqrt(a*s);a=q.Mix(a,u,this.vignetteStretch),s=q.Mix(s,u,this.vignetteStretch),t.setFloat4("vignetteSettings1",a,s,-a*this.vignetteCentreX,-s*this.vignetteCentreY);var h=-2*this.vignetteWeight;t.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,h)}if(t.setFloat("exposureLinear",this.exposure),t.setFloat("contrast",this.contrast),this.colorGradingTexture){t.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;t.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},i.prototype.clone=function(){return k.Clone(function(){return new i},this)},i.prototype.serialize=function(){return k.Serialize(this)},i.Parse=function(t){return k.Parse(function(){return new i},t,null,null)},Object.defineProperty(i,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(i,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),i.TONEMAPPING_STANDARD=0,i.TONEMAPPING_ACES=1,i._VIGNETTEMODE_MULTIPLY=0,i._VIGNETTEMODE_OPAQUE=1,m([er()],i.prototype,"colorCurves",void 0),m([M()],i.prototype,"_colorCurvesEnabled",void 0),m([tr("colorGradingTexture")],i.prototype,"_colorGradingTexture",void 0),m([M()],i.prototype,"_colorGradingEnabled",void 0),m([M()],i.prototype,"_colorGradingWithGreenDepth",void 0),m([M()],i.prototype,"_colorGradingBGR",void 0),m([M()],i.prototype,"_exposure",void 0),m([M()],i.prototype,"_toneMappingEnabled",void 0),m([M()],i.prototype,"_toneMappingType",void 0),m([M()],i.prototype,"_contrast",void 0),m([M()],i.prototype,"vignetteStretch",void 0),m([M()],i.prototype,"vignetteCentreX",void 0),m([M()],i.prototype,"vignetteCentreY",void 0),m([M()],i.prototype,"vignetteWeight",void 0),m([rr()],i.prototype,"vignetteColor",void 0),m([M()],i.prototype,"vignetteCameraFov",void 0),m([M()],i.prototype,"_vignetteBlendMode",void 0),m([M()],i.prototype,"_vignetteEnabled",void 0),m([M()],i.prototype,"_applyByPostProcess",void 0),m([M()],i.prototype,"_isEnabled",void 0),i}();k._ImageProcessingConfigurationParser=he.Parse;Tt.prototype.createUniformBuffer=function(i){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var e=new xe(t);return this.bindUniformBuffer(e),i instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,i,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(i),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),e.references=1,e};Tt.prototype.createDynamicUniformBuffer=function(i){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var e=new xe(t);return this.bindUniformBuffer(e),i instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,i,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(i),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),e.references=1,e};Tt.prototype.updateUniformBuffer=function(i,t,e,r){this.bindUniformBuffer(i),e===void 0&&(e=0),r===void 0?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(e,e+r)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(e,e+r)),this.bindUniformBuffer(null)};Tt.prototype.bindUniformBuffer=function(i){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,i?i.underlyingResource:null)};Tt.prototype.bindUniformBufferBase=function(i,t){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,i?i.underlyingResource:null)};Tt.prototype.bindUniformBlock=function(i,t,e){var r=i.program,n=this._gl.getUniformBlockIndex(r,t);this._gl.uniformBlockBinding(r,n,e)};var le=function(){function i(t,e,r){this._alreadyBound=!1,this._valueCache={},this._engine=t,this._noUBO=!t.supportsUniformBuffers,this._dynamic=r,this._data=e||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(i.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),i.prototype.isDynamic=function(){return this._dynamic!==void 0},i.prototype.getData=function(){return this._bufferData},i.prototype.getBuffer=function(){return this._buffer},i.prototype._fillAlignment=function(t){var e;if(t<=2?e=t:e=4,this._uniformLocationPointer%e!==0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=e-this._uniformLocationPointer%e;for(var n=this._uniformLocationPointer-r,o=0;o<n;o++)this._data.push(0)}},i.prototype.addUniform=function(t,e){if(!this._noUBO&&this._uniformLocations[t]===void 0){var r;if(e instanceof Array)r=e,e=r.length;else{e=e,r=[];for(var n=0;n<e;n++)r.push(0)}this._fillAlignment(e),this._uniformSizes[t]=e,this._uniformLocations[t]=this._uniformLocationPointer,this._uniformLocationPointer+=e;for(var n=0;n<e;n++)this._data.push(r[n]);this._needSync=!0}},i.prototype.addMatrix=function(t,e){this.addUniform(t,Array.prototype.slice.call(e.toArray()))},i.prototype.addFloat2=function(t,e,r){var n=[e,r];this.addUniform(t,n)},i.prototype.addFloat3=function(t,e,r,n){var o=[e,r,n];this.addUniform(t,o)},i.prototype.addColor3=function(t,e){var r=new Array;e.toArray(r),this.addUniform(t,r)},i.prototype.addColor4=function(t,e,r){var n=new Array;e.toArray(n),n.push(r),this.addUniform(t,n)},i.prototype.addVector3=function(t,e){var r=new Array;e.toArray(r),this.addUniform(t,r)},i.prototype.addMatrix3x3=function(t){this.addUniform(t,12)},i.prototype.addMatrix2x2=function(t){this.addUniform(t,8)},i.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},i.prototype._rebuild=function(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},i.prototype.update=function(){if(!this._buffer){this.create();return}!this._dynamic&&!this._needSync||(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1)},i.prototype.updateUniform=function(t,e,r){var n=this._uniformLocations[t];if(n===void 0){if(this._buffer){K.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(t,r),n=this._uniformLocations[t]}if(this._buffer||this.create(),this._dynamic)for(var s=0;s<r;s++)this._bufferData[n+s]=e[s];else{for(var o=!1,s=0;s<r;s++)(r===16||this._bufferData[n+s]!==e[s])&&(o=!0,this._bufferData[n+s]=e[s]);this._needSync=this._needSync||o}},i.prototype._cacheMatrix=function(t,e){var r=this._valueCache[t],n=e.updateFlag;return r!==void 0&&r===n?!1:(this._valueCache[t]=n,!0)},i.prototype._updateMatrix3x3ForUniform=function(t,e){for(var r=0;r<3;r++)i._tempBuffer[r*4]=e[r*3],i._tempBuffer[r*4+1]=e[r*3+1],i._tempBuffer[r*4+2]=e[r*3+2],i._tempBuffer[r*4+3]=0;this.updateUniform(t,i._tempBuffer,12)},i.prototype._updateMatrix3x3ForEffect=function(t,e){this._currentEffect.setMatrix3x3(t,e)},i.prototype._updateMatrix2x2ForEffect=function(t,e){this._currentEffect.setMatrix2x2(t,e)},i.prototype._updateMatrix2x2ForUniform=function(t,e){for(var r=0;r<2;r++)i._tempBuffer[r*4]=e[r*2],i._tempBuffer[r*4+1]=e[r*2+1],i._tempBuffer[r*4+2]=0,i._tempBuffer[r*4+3]=0;this.updateUniform(t,i._tempBuffer,8)},i.prototype._updateFloatForEffect=function(t,e){this._currentEffect.setFloat(t,e)},i.prototype._updateFloatForUniform=function(t,e){i._tempBuffer[0]=e,this.updateUniform(t,i._tempBuffer,1)},i.prototype._updateFloat2ForEffect=function(t,e,r,n){n===void 0&&(n=""),this._currentEffect.setFloat2(t+n,e,r)},i.prototype._updateFloat2ForUniform=function(t,e,r){i._tempBuffer[0]=e,i._tempBuffer[1]=r,this.updateUniform(t,i._tempBuffer,2)},i.prototype._updateFloat3ForEffect=function(t,e,r,n,o){o===void 0&&(o=""),this._currentEffect.setFloat3(t+o,e,r,n)},i.prototype._updateFloat3ForUniform=function(t,e,r,n){i._tempBuffer[0]=e,i._tempBuffer[1]=r,i._tempBuffer[2]=n,this.updateUniform(t,i._tempBuffer,3)},i.prototype._updateFloat4ForEffect=function(t,e,r,n,o,s){s===void 0&&(s=""),this._currentEffect.setFloat4(t+s,e,r,n,o)},i.prototype._updateFloat4ForUniform=function(t,e,r,n,o){i._tempBuffer[0]=e,i._tempBuffer[1]=r,i._tempBuffer[2]=n,i._tempBuffer[3]=o,this.updateUniform(t,i._tempBuffer,4)},i.prototype._updateMatrixForEffect=function(t,e){this._currentEffect.setMatrix(t,e)},i.prototype._updateMatrixForUniform=function(t,e){this._cacheMatrix(t,e)&&this.updateUniform(t,e.toArray(),16)},i.prototype._updateVector3ForEffect=function(t,e){this._currentEffect.setVector3(t,e)},i.prototype._updateVector3ForUniform=function(t,e){e.toArray(i._tempBuffer),this.updateUniform(t,i._tempBuffer,3)},i.prototype._updateVector4ForEffect=function(t,e){this._currentEffect.setVector4(t,e)},i.prototype._updateVector4ForUniform=function(t,e){e.toArray(i._tempBuffer),this.updateUniform(t,i._tempBuffer,4)},i.prototype._updateColor3ForEffect=function(t,e,r){r===void 0&&(r=""),this._currentEffect.setColor3(t+r,e)},i.prototype._updateColor3ForUniform=function(t,e){e.toArray(i._tempBuffer),this.updateUniform(t,i._tempBuffer,3)},i.prototype._updateColor4ForEffect=function(t,e,r,n){n===void 0&&(n=""),this._currentEffect.setColor4(t+n,e,r)},i.prototype._updateColor4ForUniform=function(t,e,r){e.toArray(i._tempBuffer),i._tempBuffer[3]=r,this.updateUniform(t,i._tempBuffer,4)},i.prototype.setTexture=function(t,e){this._currentEffect.setTexture(t,e)},i.prototype.updateUniformDirectly=function(t,e){this.updateUniform(t,e,e.length),this.update()},i.prototype.bindToEffect=function(t,e){this._currentEffect=t,!(this._noUBO||!this._buffer)&&(this._alreadyBound=!0,t.bindUniformBuffer(this._buffer,e))},i.prototype.dispose=function(){if(!this._noUBO){var t=this._engine._uniformBuffers,e=t.indexOf(this);e!==-1&&(t[e]=t[t.length-1],t.pop()),!!this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},i._MAX_UNIFORM_SIZE=256,i._tempBuffer=new Float32Array(i._MAX_UNIFORM_SIZE),i}(),pr=function(i){Y(t,i);function t(e,r){var n=i.call(this,e,r)||this;return n.diffuse=new Mt(1,1,1),n.specular=new Mt(1,1,1),n.falloffType=t.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=t.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new le(n.getScene().getEngine()),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),t.prototype.transferTexturesToEffect=function(e,r){return this},t.prototype._bindLight=function(e,r,n,o,s){s===void 0&&(s=!1);var a=e.toString(),u=!1;if(!(s&&this._uniformBuffer._alreadyBound)){if(this._uniformBuffer.bindToEffect(n,"Light"+a),this._renderId!==r.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=r.getRenderId();var h=this.getScaledIntensity();this.transferToEffect(n,a),this.diffuse.scaleToRef(h,qt.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",qt.Color3[0],this.range,a),o&&(this.specular.scaleToRef(h,qt.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",qt.Color3[1],this.radius,a)),u=!0}if(this.transferTexturesToEffect(n,a),r.shadowsEnabled&&this.shadowEnabled){var f=this.getShadowGenerator();f&&(f.bindShadowLight(a,n),u=!0)}u&&this._uniformBuffer.update()}},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var r="Name: "+this.name;if(r+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)r+=", animation[0]: "+this.animations[n].toString(e);return r},t.prototype._syncParentEnabledState=function(){i.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(e){i.prototype.setEnabled.call(this,e),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return _.Zero()},t.prototype.canAffectMesh=function(e){return e?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(e)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(e)!==-1||this.includeOnlyWithLayerMask!==0&&(this.includeOnlyWithLayerMask&e.layerMask)===0||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&e.layerMask):!0},t.CompareLightsPriority=function(e,r){return e.shadowEnabled!==r.shadowEnabled?(r.shadowEnabled?1:0)-(e.shadowEnabled?1:0):r.renderPriority-e.renderPriority},t.prototype.dispose=function(e,r){r===void 0&&(r=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var n=0,o=this.getScene().meshes;n<o.length;n++){var s=o[n];s._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),i.prototype.dispose.call(this,e,r)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e,r){r===void 0&&(r=null);var n=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!n)return null;var o=k.Clone(n,this);return r&&(o.parent=r),o.setEnabled(this.isEnabled()),o},t.prototype.serialize=function(){var e=k.Serialize(this);return e.type=this.getTypeID(),this.parent&&(e.parentId=this.parent.id),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach(function(r){e.excludedMeshesIds.push(r.id)})),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(r){e.includedOnlyMeshesIds.push(r.id)})),k.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e},t.GetConstructorFromName=function(e,r,n){var o=At.Construct("Light_Type_"+e,r,n);return o||null},t.Parse=function(e,r){var n=t.GetConstructorFromName(e.type,e.name,r);if(!n)return null;var o=k.Parse(n,e,r);if(e.excludedMeshesIds&&(o._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(o._includedOnlyMeshesIds=e.includedOnlyMeshesIds),e.parentId&&(o._waitingParentId=e.parentId),e.falloffType!==void 0&&(o.falloffType=e.falloffType),e.lightmapMode!==void 0&&(o.lightmapMode=e.lightmapMode),e.animations){for(var s=0;s<e.animations.length;s++){var a=e.animations[s],u=_t.GetClass("BABYLON.Animation");u&&o.animations.push(u.Parse(a))}At.ParseAnimationRanges(o,e,r)}return e.autoAnimate&&r.beginAnimation(o,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),o},t.prototype._hookArrayForExcluded=function(e){var r=this,n=e.push;e.push=function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];for(var l=n.apply(e,h),c=0,p=h;c<p.length;c++){var d=p[c];d._resyncLightSource(r)}return l};var o=e.splice;e.splice=function(h,f){for(var l=o.apply(e,[h,f]),c=0,p=l;c<p.length;c++){var d=p[c];d._resyncLightSource(r)}return l};for(var s=0,a=e;s<a.length;s++){var u=a[s];u._resyncLightSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var r=this,n=e.push;e.push=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var u=n.apply(e,s);return r._resyncMeshes(),u};var o=e.splice;e.splice=function(s,a){var u=o.apply(e,[s,a]);return r._resyncMeshes(),u},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,r=this.getScene().meshes;e<r.length;e++){var n=r[e];n._resyncLightSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,r=this.getScene().meshes;e<r.length;e++){var n=r[e];n.lightSources.indexOf(this)!==-1&&n._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,r=this.getTypeID(),n=this.intensityMode;switch(n===t.INTENSITYMODE_AUTOMATIC&&(r===t.LIGHTTYPEID_DIRECTIONALLIGHT?n=t.INTENSITYMODE_ILLUMINANCE:n=t.INTENSITYMODE_LUMINOUSINTENSITY),r){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(n){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius;break}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var o=this.radius;o=Math.max(o,.001);var s=2*Math.PI*(1-Math.cos(o));e=s;break}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1;break}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();this._renderPriority!=0&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=0,t.FALLOFF_PHYSICAL=1,t.FALLOFF_GLTF=2,t.FALLOFF_STANDARD=3,t.LIGHTMAP_DEFAULT=0,t.LIGHTMAP_SPECULAR=1,t.LIGHTMAP_SHADOWSONLY=2,t.INTENSITYMODE_AUTOMATIC=0,t.INTENSITYMODE_LUMINOUSPOWER=1,t.INTENSITYMODE_LUMINOUSINTENSITY=2,t.INTENSITYMODE_ILLUMINANCE=3,t.INTENSITYMODE_LUMINANCE=4,t.LIGHTTYPEID_POINTLIGHT=0,t.LIGHTTYPEID_DIRECTIONALLIGHT=1,t.LIGHTTYPEID_SPOTLIGHT=2,t.LIGHTTYPEID_HEMISPHERICLIGHT=3,m([ve()],t.prototype,"diffuse",void 0),m([ve()],t.prototype,"specular",void 0),m([M()],t.prototype,"falloffType",void 0),m([M()],t.prototype,"intensity",void 0),m([M()],t.prototype,"range",null),m([M()],t.prototype,"intensityMode",null),m([M()],t.prototype,"radius",null),m([M()],t.prototype,"_renderPriority",void 0),m([$e("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),m([M("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),m([M("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),m([M("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),m([M("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(At),j=function(){function i(t,e,r,n,o,s){this.source=t,this.pointerX=e,this.pointerY=r,this.meshUnderPointer=n,this.sourceEvent=o,this.additionalData=s}return i.CreateNew=function(t,e,r){var n=t.getScene();return new i(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,e,r)},i.CreateNewFromSprite=function(t,e,r,n){return new i(t,e.pointerX,e.pointerY,e.meshUnderPointer,r,n)},i.CreateNewFromScene=function(t,e){return new i(null,t.pointerX,t.pointerY,t.meshUnderPointer,e)},i.CreateNewFromPrimitive=function(t,e,r,n){return new i(t,e.x,e.y,null,r,n)},i}(),Te=function(){function i(t,e,r){this.bu=t,this.bv=e,this.distance=r,this.faceId=0,this.subMeshId=0}return i}(),dr=function(){function i(t,e,r,n,o,s,a,u,h){u===void 0&&(u=!0),h===void 0&&(h=!0),this.materialIndex=t,this.verticesStart=e,this.verticesCount=r,this.indexStart=n,this.indexCount=o,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=a||s,h&&s.subMeshes.push(this),this._trianglePlanes=[],this._id=s.subMeshes.length-1,u&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return Object.defineProperty(i.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(t){this._materialDefines=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"effect",{get:function(){var t;return(t=this._effectOverride)!==null&&t!==void 0?t:this._materialEffect},enumerable:!1,configurable:!0}),i.prototype.setEffect=function(t,e){if(e===void 0&&(e=null),this._materialEffect===t){t||(this._materialDefines=null);return}this._materialDefines=e,this._materialEffect=t},i.AddToMesh=function(t,e,r,n,o,s,a,u){return u===void 0&&(u=!0),new i(t,e,r,n,o,s,a,u)},Object.defineProperty(i.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),i.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},i.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},i.prototype.getMesh=function(){return this._mesh},i.prototype.getRenderingMesh=function(){return this._renderingMesh},i.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},i.prototype.getEffectiveMesh=function(){var t=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return t||this._renderingMesh},i.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(t==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(t)){var e=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==e&&(this._currentMaterial=e,this._materialDefines=null),e}return t},i.prototype._IsMultiMaterial=function(t){return t.getSubMaterial!==void 0},i.prototype.refreshBoundingInfo=function(t){if(t===void 0&&(t=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(t||(t=this._renderingMesh.getVerticesData(y.PositionKind)),!t)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var e=this._renderingMesh.getIndices(),r;if(this.indexStart===0&&this.indexCount===e.length){var n=this._renderingMesh.getBoundingInfo();r={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else r=sr(t,e,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new te(r.minimum,r.maximum),this},i.prototype._checkCollision=function(t){var e=this.getBoundingInfo();return e._checkCollision(t)},i.prototype.updateBoundingInfo=function(t){var e=this.getBoundingInfo();return e||(this.refreshBoundingInfo(),e=this.getBoundingInfo()),e&&e.update(t),this},i.prototype.isInFrustum=function(t){var e=this.getBoundingInfo();return e?e.isInFrustum(t,this._mesh.cullingStrategy):!1},i.prototype.isCompletelyInFrustum=function(t){var e=this.getBoundingInfo();return e?e.isCompletelyInFrustum(t):!1},i.prototype.render=function(t){return this._renderingMesh.render(this,t,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},i.prototype._getLinesIndexBuffer=function(t,e){if(!this._linesIndexBuffer){for(var r=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)r.push(t[n],t[n+1],t[n+1],t[n+2],t[n+2],t[n]);this._linesIndexBuffer=e.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer},i.prototype.canIntersects=function(t){var e=this.getBoundingInfo();return e?t.intersectsBox(e.boundingBox):!1},i.prototype.intersects=function(t,e,r,n,o){var s=this.getMaterial();if(!s)return null;var a=3,u=!1;switch(s.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:a=1,u=!0;break}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?r.length?this._intersectLines(t,e,r,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(t,e,r,this._mesh.intersectionThreshold,n):!r.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(t,e,r,n,o):this._intersectTriangles(t,e,r,a,u,n,o)},i.prototype._intersectLines=function(t,e,r,n,o){for(var s=null,a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){var u=e[r[a]],h=e[r[a+1]],f=t.intersectionSegment(u,h,n);if(!(f<0)&&(o||!s||f<s.distance)&&(s=new Te(null,null,f),s.faceId=a/2,o))break}return s},i.prototype._intersectUnIndexedLines=function(t,e,r,n,o){for(var s=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=2){var u=e[a],h=e[a+1],f=t.intersectionSegment(u,h,n);if(!(f<0)&&(o||!s||f<s.distance)&&(s=new Te(null,null,f),s.faceId=a/2,o))break}return s},i.prototype._intersectTriangles=function(t,e,r,n,o,s,a){for(var u=null,h=-1,f=this.indexStart;f<this.indexStart+this.indexCount;f+=n){h++;var l=r[f],c=r[f+1],p=r[f+2];if(o&&p===4294967295){f+=2;continue}var d=e[l],g=e[c],v=e[p];if(!(a&&!a(d,g,v,t))){var P=t.intersectsTriangle(d,g,v);if(P){if(P.distance<0)continue;if((s||!u||P.distance<u.distance)&&(u=P,u.faceId=h,s))break}}}return u},i.prototype._intersectUnIndexedTriangles=function(t,e,r,n,o){for(var s=null,a=this.verticesStart;a<this.verticesStart+this.verticesCount;a+=3){var u=e[a],h=e[a+1],f=e[a+2];if(!(o&&!o(u,h,f,t))){var l=t.intersectsTriangle(u,h,f);if(l){if(l.distance<0)continue;if((n||!s||l.distance<s.distance)&&(s=l,s.faceId=a/3,n))break}}}return s},i.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},i.prototype.clone=function(t,e){var r=new i(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,e,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return r;r._boundingInfo=new te(n.minimum,n.maximum)}return r},i.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var t=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(t,1)},i.prototype.getClassName=function(){return"SubMesh"},i.CreateFromIndices=function(t,e,r,n,o){for(var s=Number.MAX_VALUE,a=-Number.MAX_VALUE,u=o||n,h=u.getIndices(),f=e;f<e+r;f++){var l=h[f];l<s&&(s=l),l>a&&(a=l)}return new i(t,s,a-s+1,e,r,n,o)},i}(),Ae=function(){function i(t,e,r){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new T,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=i.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var n=1;for(this._scene=e||st.LastCreatedScene,this.id=t||q.RandomId();this._scene.getMaterialByID(this.id);)this.id=t+" "+n++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=i.ClockWiseSideOrientation:this.sideOrientation=i.CounterClockWiseSideOrientation,this._uniformBuffer=new le(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,r||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(i.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alpha=t,this.markAsDirty(i.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(i.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new T),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onBind",{set:function(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new T),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new T),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(i.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(i.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wireframe",{get:function(){switch(this._fillMode){case i.WireFrameFillMode:case i.LineListDrawMode:case i.LineLoopDrawMode:case i.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?i.WireFrameFillMode:i.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case i.PointFillMode:case i.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?i.PointFillMode:i.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(i.MiscDirtyFlag))},enumerable:!1,configurable:!0}),i.prototype.toString=function(t){var e="Name: "+this.name;return e},i.prototype.getClassName=function(){return"Material"},Object.defineProperty(i.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),i.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},i.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},i.prototype.isReady=function(t,e){return!0},i.prototype.isReadyForSubMesh=function(t,e,r){return!1},i.prototype.getEffect=function(){return this._effect},i.prototype.getScene=function(){return this._scene},Object.defineProperty(i.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===i.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===i.MATERIAL_OPAQUE||this._transparencyMode===i.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),i.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1},i.prototype.needAlphaBlendingForMesh=function(t){return this._disableAlphaBlending&&t.visibility>=1?!1:this.needAlphaBlending()||t.visibility<1||t.hasVertexAlpha},i.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},i.prototype._shouldTurnAlphaTestOn=function(t){return!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()},i.prototype.getAlphaTestTexture=function(){return null},i.prototype.markDirty=function(){for(var t=this.getScene().meshes,e=0,r=t;e<r.length;e++){var n=r[e];if(!!n.subMeshes)for(var o=0,s=n.subMeshes;o<s.length;o++){var a=s[o];a.getMaterial()===this&&(!a.effect||(a.effect._wasPreviouslyReady=!1))}}},i.prototype._preBind=function(t,e){e===void 0&&(e=null);var r=this._scene.getEngine(),n=e==null?this.sideOrientation:e,o=n===i.ClockWiseSideOrientation;return r.enableEffect(t||this._effect),r.setState(this.backFaceCulling,this.zOffset,!1,o),o},i.prototype.bind=function(t,e){},i.prototype.bindForSubMesh=function(t,e,r){},i.prototype.bindOnlyWorldMatrix=function(t){},i.prototype.bindSceneUniformBuffer=function(t,e){e.bindToEffect(t,"Scene")},i.prototype.bindView=function(t){this._useUBO?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("view",this.getScene().getViewMatrix())},i.prototype.bindViewProjection=function(t){this._useUBO?this.bindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()):t.setMatrix("viewProjection",this.getScene().getTransformMatrix())},i.prototype._afterBind=function(t){if(this._scene._cachedMaterial=this,t?this._scene._cachedVisibility=t.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){var e=this._scene.getEngine();this._cachedDepthWriteState=e.getDepthWrite(),e.setDepthWrite(!1)}if(this.disableColorWrite){var e=this._scene.getEngine();this._cachedColorWriteState=e.getColorWrite(),e.setColorWrite(!1)}if(this.depthFunction!==0){var e=this._scene.getEngine();this._cachedDepthFunctionState=e.getDepthFunction()||0,e.setDepthFunction(this.depthFunction)}},i.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0){var t=this._scene.getEngine();t.setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){var t=this._scene.getEngine();t.setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){var t=this._scene.getEngine();t.setColorWrite(this._cachedColorWriteState)}},i.prototype.getActiveTextures=function(){return[]},i.prototype.hasTexture=function(t){return!1},i.prototype.clone=function(t){return null},i.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var e=new Array;for(var r in this.meshMap){var n=this.meshMap[r];n&&e.push(n)}return e}else{var o=this._scene.meshes;return o.filter(function(s){return s.material===t})}},i.prototype.forceCompilation=function(t,e,r,n){var o=this,s=Fe({clipPlane:!1,useInstances:!1},r),a=this.getScene(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var h=function(){if(!(!o._scene||!o._scene.getEngine())){var f=a.clipPlane;if(s.clipPlane&&(a.clipPlane=new we(0,0,0,1)),o._storeEffectOnSubMeshes){var l=!0,c=null;if(t.subMeshes){var p=new dr(0,0,0,0,0,t,void 0,!1,!1);p._materialDefines&&(p._materialDefines._renderId=-1),o.isReadyForSubMesh(t,p,s.useInstances)||(p.effect&&p.effect.getCompilationError()&&p.effect.allFallbacksProcessed()?c=p.effect.getCompilationError():(l=!1,setTimeout(h,16)))}l&&(o.allowShaderHotSwapping=u,c&&n&&n(c),e&&e(o))}else o.isReady()?(o.allowShaderHotSwapping=u,e&&e(o)):setTimeout(h,16);s.clipPlane&&(a.clipPlane=f)}};h()},i.prototype.forceCompilationAsync=function(t,e){var r=this;return new Promise(function(n,o){r.forceCompilation(t,function(){n()},e,function(s){o(s)})})},i.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(i._DirtyCallbackArray.length=0,t&i.TextureDirtyFlag&&i._DirtyCallbackArray.push(i._TextureDirtyCallBack),t&i.LightDirtyFlag&&i._DirtyCallbackArray.push(i._LightsDirtyCallBack),t&i.FresnelDirtyFlag&&i._DirtyCallbackArray.push(i._FresnelDirtyCallBack),t&i.AttributesDirtyFlag&&i._DirtyCallbackArray.push(i._AttributeDirtyCallBack),t&i.MiscDirtyFlag&&i._DirtyCallbackArray.push(i._MiscDirtyCallBack),t&i.PrePassDirtyFlag&&i._DirtyCallbackArray.push(i._PrePassDirtyCallBack),i._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(i._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},i.prototype._markAllSubMeshesAsDirty=function(t){if(!this.getScene().blockMaterialDirtyMechanism)for(var e=this.getScene().meshes,r=0,n=e;r<n.length;r++){var o=n[r];if(!!o.subMeshes)for(var s=0,a=o.subMeshes;s<a.length;s++){var u=a[s];u.getMaterial()===this&&(!u._materialDefines||t(u._materialDefines))}}},i.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}},i.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(i._AllDirtyCallBack)},i.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(i._ImageProcessingDirtyCallBack)},i.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(i._TextureDirtyCallBack)},i.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(i._FresnelDirtyCallBack)},i.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(i._FresnelAndMiscDirtyCallBack)},i.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(i._LightsDirtyCallBack)},i.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(i._AttributeDirtyCallBack)},i.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(i._MiscDirtyCallBack)},i.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(i._MiscDirtyCallBack)},i.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(i._TextureAndMiscDirtyCallBack)},i.prototype.setPrePassRenderer=function(t){return!1},i.prototype.dispose=function(t,e,r){var n=this.getScene();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),r!==!0)if(this.meshMap)for(var o in this.meshMap){var s=this.meshMap[o];s&&(s.material=null,this.releaseVertexArrayObject(s,t))}else for(var a=n.meshes,u=0,h=a;u<h.length;u++){var s=h[u];s.material===this&&!s.sourceMesh&&(s.material=null,this.releaseVertexArrayObject(s,t))}this._uniformBuffer.dispose(),t&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},i.prototype.releaseVertexArrayObject=function(t,e){if(t.geometry){var r=t.geometry;if(this._storeEffectOnSubMeshes)for(var n=0,o=t.subMeshes;n<o.length;n++){var s=o[n];r._releaseVertexArrayObject(s._materialEffect),e&&s._materialEffect&&s._materialEffect.dispose()}else r._releaseVertexArrayObject(this._effect)}},i.prototype.serialize=function(){return k.Serialize(this)},i.Parse=function(t,e,r){if(!t.customType)t.customType="BABYLON.StandardMaterial";else if(t.customType==="BABYLON.PBRMaterial"&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return K.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;var n=q.Instantiate(t.customType);return n.Parse(t,e,r)},i.TriangleFillMode=0,i.WireFrameFillMode=1,i.PointFillMode=2,i.PointListDrawMode=3,i.LineListDrawMode=4,i.LineLoopDrawMode=5,i.LineStripDrawMode=6,i.TriangleStripDrawMode=7,i.TriangleFanDrawMode=8,i.ClockWiseSideOrientation=0,i.CounterClockWiseSideOrientation=1,i.TextureDirtyFlag=1,i.LightDirtyFlag=2,i.FresnelDirtyFlag=4,i.AttributesDirtyFlag=8,i.MiscDirtyFlag=16,i.PrePassDirtyFlag=32,i.AllDirtyFlag=63,i.MATERIAL_OPAQUE=0,i.MATERIAL_ALPHATEST=1,i.MATERIAL_ALPHABLEND=2,i.MATERIAL_ALPHATESTANDBLEND=3,i.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,i.MATERIAL_NORMALBLENDMETHOD_RNM=1,i._AllDirtyCallBack=function(t){return t.markAllAsDirty()},i._ImageProcessingDirtyCallBack=function(t){return t.markAsImageProcessingDirty()},i._TextureDirtyCallBack=function(t){return t.markAsTexturesDirty()},i._FresnelDirtyCallBack=function(t){return t.markAsFresnelDirty()},i._MiscDirtyCallBack=function(t){return t.markAsMiscDirty()},i._PrePassDirtyCallBack=function(t){return t.markAsPrePassDirty()},i._LightsDirtyCallBack=function(t){return t.markAsLightDirty()},i._AttributeDirtyCallBack=function(t){return t.markAsAttributesDirty()},i._FresnelAndMiscDirtyCallBack=function(t){i._FresnelDirtyCallBack(t),i._MiscDirtyCallBack(t)},i._TextureAndMiscDirtyCallBack=function(t){i._TextureDirtyCallBack(t),i._MiscDirtyCallBack(t)},i._DirtyCallbackArray=[],i._RunDirtyCallBacks=function(t){for(var e=0,r=i._DirtyCallbackArray;e<r.length;e++){var n=r[e];n(t)}},m([M()],i.prototype,"id",void 0),m([M()],i.prototype,"uniqueId",void 0),m([M()],i.prototype,"name",void 0),m([M()],i.prototype,"checkReadyOnEveryCall",void 0),m([M()],i.prototype,"checkReadyOnlyOnce",void 0),m([M()],i.prototype,"state",void 0),m([M("alpha")],i.prototype,"_alpha",void 0),m([M("backFaceCulling")],i.prototype,"_backFaceCulling",void 0),m([M()],i.prototype,"sideOrientation",void 0),m([M("alphaMode")],i.prototype,"_alphaMode",void 0),m([M()],i.prototype,"_needDepthPrePass",void 0),m([M()],i.prototype,"disableDepthWrite",void 0),m([M()],i.prototype,"disableColorWrite",void 0),m([M()],i.prototype,"forceDepthWrite",void 0),m([M()],i.prototype,"depthFunction",void 0),m([M()],i.prototype,"separateCullingPass",void 0),m([M("fogEnabled")],i.prototype,"_fogEnabled",void 0),m([M()],i.prototype,"pointSize",void 0),m([M()],i.prototype,"zOffset",void 0),m([M()],i.prototype,"pointsCloud",null),m([M()],i.prototype,"fillMode",null),m([M()],i.prototype,"transparencyMode",null),i}(),Ee=function(){function i(t){this._vertexBuffers={},this._scene=t}return i.prototype._prepareBuffers=function(){if(!this._vertexBuffers[y.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[y.PositionKind]=new y(this._scene.getEngine(),t,y.PositionKind,!1,!1,2),this._buildIndexBuffer()}},i.prototype._buildIndexBuffer=function(){var t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)},i.prototype._rebuild=function(){var t=this._vertexBuffers[y.PositionKind];!t||(t._rebuild(),this._buildIndexBuffer())},i.prototype._prepareFrame=function(t,e){t===void 0&&(t=null),e===void 0&&(e=null);var r=this._scene.activeCamera;return!r||(e=e||r._postProcesses.filter(function(n){return n!=null}),!e||e.length===0||!this._scene.postProcessesEnabled)?!1:(e[0].activate(r,t,e!=null),!0)},i.prototype.directRender=function(t,e,r,n,o,s){e===void 0&&(e=null),r===void 0&&(r=!1),n===void 0&&(n=0),o===void 0&&(o=0),s===void 0&&(s=!1);for(var a=this._scene.getEngine(),u=0;u<t.length;u++){u<t.length-1?t[u+1].activate(this._scene.activeCamera,e):e?a.bindFramebuffer(e,n,void 0,void 0,r,o):s||a.restoreDefaultFramebuffer();var h=t[u],f=h.apply();f&&(h.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,f),a.drawElementsType(Ae.TriangleFillMode,0,6),h.onAfterRenderObservable.notifyObservers(f))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},i.prototype._finalizeFrame=function(t,e,r,n,o){o===void 0&&(o=!1);var s=this._scene.activeCamera;if(!!s&&(n=n||s._postProcesses.filter(function(c){return c!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var a=this._scene.getEngine(),u=0,h=n.length;u<h;u++){var f=n[u];if(u<h-1?f._outputTexture=n[u+1].activate(s,e):e?(a.bindFramebuffer(e,r,void 0,void 0,o),f._outputTexture=e):(a.restoreDefaultFramebuffer(),f._outputTexture=null),t)break;var l=f.apply();l&&(f.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,l),a.drawElementsType(Ae.TriangleFillMode,0,6),f.onAfterRenderObservable.notifyObservers(l))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},i.prototype.dispose=function(){var t=this._vertexBuffers[y.PositionKind];t&&(t.dispose(),this._vertexBuffers[y.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},i}(),_r=function(){function i(t,e,r,n,o){r===void 0&&(r=null),n===void 0&&(n=null),o===void 0&&(o=null),this.index=t,this._opaqueSubMeshes=new nt(256),this._transparentSubMeshes=new nt(256),this._alphaTestSubMeshes=new nt(256),this._depthOnlySubMeshes=new nt(256),this._particleSystems=new nt(256),this._spriteManagers=new nt(256),this._edgesRenderers=new Dt(16),this._scene=e,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=o}return Object.defineProperty(i.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t,t?this._renderOpaque=this.renderOpaqueSorted:this._renderOpaque=i.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t,t?this._renderAlphaTest=this.renderAlphaTestSorted:this._renderAlphaTest=i.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"transparentSortCompareFn",{set:function(t){t?this._transparentSortCompareFn=t:this._transparentSortCompareFn=i.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),i.prototype.render=function(t,e,r,n){if(t){t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var o=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var s=o.getStencilBuffer();if(o.setStencilBuffer(!1),e&&this._renderSprites(),r&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(o.setStencilBuffer(s),this._renderTransparent(this._transparentSubMeshes),o.setAlphaMode(0)),o.setStencilBuffer(!1),this._edgesRenderers.length){for(var a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();o.setAlphaMode(0)}o.setStencilBuffer(s)},i.prototype.renderOpaqueSorted=function(t){return i.renderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},i.prototype.renderAlphaTestSorted=function(t){return i.renderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},i.prototype.renderTransparentSorted=function(t){return i.renderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},i.renderSorted=function(t,e,r,n){for(var o=0,s,a=r?r.globalPosition:i._zeroVector;o<t.length;o++)s=t.data[o],s._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=_.Distance(s.getBoundingInfo().boundingSphere.centerWorld,a);var u=t.data.slice(0,t.length);for(e&&u.sort(e),o=0;o<u.length;o++){if(s=u[o],n){var h=s.getMaterial();if(h&&h.needDepthPrePass){var f=h.getScene().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),s.render(!1),f.setColorWrite(!0)}}s.render(n)}},i.renderUnsorted=function(t){for(var e=0;e<t.length;e++){var r=t.data[e];r.render(!1)}},i.defaultTransparentSortCompare=function(t,e){return t._alphaIndex>e._alphaIndex?1:t._alphaIndex<e._alphaIndex?-1:i.backToFrontSortCompare(t,e)},i.backToFrontSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?1:t._distanceToCamera>e._distanceToCamera?-1:0},i.frontToBackSortCompare=function(t,e){return t._distanceToCamera<e._distanceToCamera?-1:t._distanceToCamera>e._distanceToCamera?1:0},i.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},i.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},i.prototype.dispatch=function(t,e,r){e===void 0&&(e=t.getMesh()),r===void 0&&(r=t.getMaterial()),r!=null&&(r.needAlphaBlendingForMesh(e)?this._transparentSubMeshes.push(t):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),e._renderingGroup=this,e._edgesRenderer&&e._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(e._edgesRenderer))},i.prototype.dispatchSprites=function(t){this._spriteManagers.push(t)},i.prototype.dispatchParticles=function(t){this._particleSystems.push(t)},i.prototype._renderParticles=function(t){if(this._particleSystems.length!==0){var e=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var n=this._particleSystems.data[r];if((e&&e.layerMask&n.layerMask)!==0){var o=n.emitter;(!o.position||!t||t.indexOf(o)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},i.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var e=0;e<this._spriteManagers.length;e++){var r=this._spriteManagers.data[e];(t&&t.layerMask&r.layerMask)!==0&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},i._zeroVector=_.Zero(),i}(),gr=function(){function i(){}return i}(),vr=function(){function i(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new gr,this._scene=t;for(var e=i.MIN_RENDERINGGROUPS;e<i.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={autoClear:!0,depth:!0,stencil:!0}}return i.prototype._clearDepthStencilBuffer=function(t,e){t===void 0&&(t=!0),e===void 0&&(e=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,t,e),this._depthStencilBufferAlreadyCleaned=!0)},i.prototype.render=function(t,e,r,n){var o=this._renderingGroupInfo;if(o.scene=this._scene,o.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var s=0;s<this._scene.spriteManagers.length;s++){var a=this._scene.spriteManagers[s];this.dispatchSprites(a)}for(var s=i.MIN_RENDERINGGROUPS;s<i.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===i.MIN_RENDERINGGROUPS;var u=this._renderingGroups[s];if(!!u){var h=Math.pow(2,s);if(o.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,h),i.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(var l=0,c=this._scene._beforeRenderingGroupDrawStage;l<c.length;l++){var p=c[l];p.action(s)}u.render(t,n,r,e);for(var d=0,g=this._scene._afterRenderingGroupDrawStage;d<g.length;d++){var p=g[d];p.action(s)}this._scene.onAfterRenderingGroupObservable.notifyObservers(o,h)}}},i.prototype.reset=function(){for(var t=i.MIN_RENDERINGGROUPS;t<i.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.prepare()}},i.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},i.prototype.freeRenderingGroups=function(){for(var t=i.MIN_RENDERINGGROUPS;t<i.MAX_RENDERINGGROUPS;t++){var e=this._renderingGroups[t];e&&e.dispose()}},i.prototype._prepareRenderingGroup=function(t){this._renderingGroups[t]===void 0&&(this._renderingGroups[t]=new _r(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))},i.prototype.dispatchSprites=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchSprites(t)},i.prototype.dispatchParticles=function(t){var e=t.renderingGroupId||0;this._prepareRenderingGroup(e),this._renderingGroups[e].dispatchParticles(t)},i.prototype.dispatch=function(t,e,r){e===void 0&&(e=t.getMesh());var n=e.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(t,e,r)},i.prototype.setRenderingOrder=function(t,e,r,n){if(e===void 0&&(e=null),r===void 0&&(r=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[t]=e,this._customAlphaTestSortCompareFn[t]=r,this._customTransparentSortCompareFn[t]=n,this._renderingGroups[t]){var o=this._renderingGroups[t];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],o.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}},i.prototype.setRenderingAutoClearDepthStencil=function(t,e,r,n){r===void 0&&(r=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[t]={autoClear:e,depth:r,stencil:n}},i.prototype.getAutoClearDepthStencilSetup=function(t){return this._autoClearDepthStencil[t]},i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0,i}(),Cr=function(){function i(){}return i.NAME_EFFECTLAYER="EffectLayer",i.NAME_LAYER="Layer",i.NAME_LENSFLARESYSTEM="LensFlareSystem",i.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",i.NAME_PARTICLESYSTEM="ParticleSystem",i.NAME_GAMEPAD="Gamepad",i.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",i.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",i.NAME_PREPASSRENDERER="PrePassRenderer",i.NAME_DEPTHRENDERER="DepthRenderer",i.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",i.NAME_SPRITE="Sprite",i.NAME_SUBSURFACE="SubSurface",i.NAME_OUTLINERENDERER="Outline",i.NAME_PROCEDURALTEXTURE="ProceduralTexture",i.NAME_SHADOWGENERATOR="ShadowGenerator",i.NAME_OCTREE="Octree",i.NAME_PHYSICSENGINE="PhysicsEngine",i.NAME_AUDIO="Audio",i.STEP_ISREADYFORMESH_EFFECTLAYER=0,i.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,i.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,i.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,i.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,i.STEP_BEFORECAMERADRAW_LAYER=1,i.STEP_BEFORECAMERADRAW_PREPASS=2,i.STEP_BEFORERENDERTARGETDRAW_LAYER=0,i.STEP_BEFORERENDERINGMESH_PREPASS=0,i.STEP_BEFORERENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGMESH_PREPASS=0,i.STEP_AFTERRENDERINGMESH_OUTLINE=1,i.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,i.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,i.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,i.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,i.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,i.STEP_AFTERRENDERTARGETDRAW_LAYER=0,i.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,i.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,i.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,i.STEP_AFTERCAMERADRAW_LAYER=3,i.STEP_AFTERCAMERADRAW_PREPASS=4,i.STEP_AFTERRENDER_AUDIO=0,i.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,i.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,i.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,i.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,i.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,i.STEP_BEFORECLEARSTAGE_PREPASS=0,i.STEP_POINTERMOVE_SPRITE=0,i.STEP_POINTERDOWN_SPRITE=0,i.STEP_POINTERUP_SPRITE=0,i}(),z=function(i){Y(t,i);function t(e){return i.apply(this,e)||this}return t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,r,n){for(var o=0,s=Number.MAX_VALUE;o<this.length;o++){var a=this[o];if(s=a.index,e<s)break}this.splice(o,0,{index:e,component:r,action:n.bind(r)})},t.prototype.clear=function(){this.length=0},t}(Array),N=function(){function i(){}return i.POINTERDOWN=1,i.POINTERUP=2,i.POINTERMOVE=4,i.POINTERWHEEL=8,i.POINTERPICK=16,i.POINTERTAP=32,i.POINTERDOUBLETAP=64,i}(),Be=function(){function i(t,e){this.type=t,this.event=e}return i}(),yr=function(i){Y(t,i);function t(e,r,n,o){var s=i.call(this,e,r)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new at(n,o),s}return t}(Be),Lt=function(i){Y(t,i);function t(e,r,n){var o=i.call(this,e,r)||this;return o.pickInfo=n,o}return t}(Be),Ut=function(){function i(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(i,"HasTriggers",{get:function(){for(var t in i.Triggers)if(i.Triggers.hasOwnProperty(t))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(i,"HasPickTriggers",{get:function(){for(var t in i.Triggers)if(i.Triggers.hasOwnProperty(t)){var e=parseInt(t);if(e>=1&&e<=7)return!0}return!1},enumerable:!1,configurable:!0}),i.HasSpecificTrigger=function(t){for(var e in i.Triggers)if(i.Triggers.hasOwnProperty(e)){var r=parseInt(e);if(r===t)return!0}return!1},i.Triggers={},i}(),De=function(){function i(){}return i.KEYDOWN=1,i.KEYUP=2,i}(),fe=function(){function i(t,e){this.type=t,this.event=e}return i}(),Ce=function(i){Y(t,i);function t(e,r){var n=i.call(this,e,r)||this;return n.type=e,n.event=r,n.skipOnPointerObservable=!1,n}return t}(fe),Oe=function(){function i(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(i.prototype,"singleClick",{get:function(){return this._singleClick},set:function(t){this._singleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(t){this._doubleClick=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(t){this._hasSwiped=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"ignore",{get:function(){return this._ignore},set:function(t){this._ignore=t},enumerable:!1,configurable:!0}),i}(),vt=function(){function i(t){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new at(0,0),this._previousStartingPointerPosition=new at(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=t}return Object.defineProperty(i.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),i.prototype.getMeshUnderPointerByPointerId=function(t){return this._meshUnderPointerId[t]},Object.defineProperty(i.prototype,"unTranslatedPointer",{get:function(){return new at(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerX",{get:function(){return this._pointerX},set:function(t){this._pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"pointerY",{get:function(){return this._pointerY},set:function(t){this._pointerY=t},enumerable:!1,configurable:!0}),i.prototype._updatePointerPosition=function(t){var e=this._scene.getEngine().getInputElementClientRect();!e||(this._pointerX=t.clientX-e.left,this._pointerY=t.clientY-e.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},i.prototype._processPointerMove=function(t,e){var r=this._scene,n=r.getEngine(),o=n.getInputElement();if(!!o){o.tabIndex=n.canvasTabIndex,r.doNotHandleCursors||(o.style.cursor=r.defaultCursor);var s=!!(t&&t.hit&&t.pickedMesh);s?(r.setPointerOverMesh(t.pickedMesh,e.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(r.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?o.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:o.style.cursor=r.hoverCursor))):r.setPointerOverMesh(null,e.pointerId);for(var a=0,u=r._pointerMoveStage;a<u.length;a++){var h=u[a];t=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,s,o)}if(t){var f=e.type===this._wheelEventName?N.POINTERWHEEL:N.POINTERMOVE;if(r.onPointerMove&&r.onPointerMove(e,t,f),r.onPointerObservable.hasObservers()){var l=new Lt(f,e,t);this._setRayOnPointerInfo(l),r.onPointerObservable.notifyObservers(l,f)}}}},i.prototype._setRayOnPointerInfo=function(t){var e=this._scene;t.pickInfo&&!t.pickInfo._pickingUnavailable&&(t.pickInfo.ray||(t.pickInfo.ray=e.createPickingRay(t.event.offsetX,t.event.offsetY,D.Identity(),e.activeCamera)))},i.prototype._checkPrePointerObservable=function(t,e,r){var n=this._scene,o=new yr(r,e,this._unTranslatedPointerX,this._unTranslatedPointerY);return t&&(o.ray=t.ray),n.onPrePointerObservable.notifyObservers(o,r),!!o.skipOnPointerObservable},i.prototype.simulatePointerMove=function(t,e){var r=new PointerEvent("pointermove",e);this._checkPrePointerObservable(t,r,N.POINTERMOVE)||this._processPointerMove(t,r)},i.prototype.simulatePointerDown=function(t,e){var r=new PointerEvent("pointerdown",e);this._checkPrePointerObservable(t,r,N.POINTERDOWN)||this._processPointerDown(t,r)},i.prototype._processPointerDown=function(t,e){var r=this,n=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var o=t.pickedMesh._getActionManagerForTrigger();if(o){if(o.hasPickTriggers)switch(o.processTrigger(5,j.CreateNew(t.pickedMesh,e)),e.button){case 0:o.processTrigger(2,j.CreateNew(t.pickedMesh,e));break;case 1:o.processTrigger(4,j.CreateNew(t.pickedMesh,e));break;case 2:o.processTrigger(3,j.CreateNew(t.pickedMesh,e));break}o.hasSpecificTrigger(8)&&window.setTimeout(function(){var l=n.pick(r._unTranslatedPointerX,r._unTranslatedPointerY,function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(8)&&c==r._pickedDownMesh},!1,n.cameraToUseForPointers);l&&l.hit&&l.pickedMesh&&o&&r._totalPointersPressed!==0&&Date.now()-r._startingPointerTime>i.LongPressDelay&&!r._isPointerSwiping()&&(r._startingPointerTime=0,o.processTrigger(8,j.CreateNew(l.pickedMesh,e)))},i.LongPressDelay)}}else for(var s=0,a=n._pointerDownStage;s<a.length;s++){var u=a[s];t=u.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(t){var h=N.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(e,t,h),n.onPointerObservable.hasObservers()){var f=new Lt(h,e,t);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,h)}}},i.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>i.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>i.DragMovementThreshold},i.prototype.simulatePointerUp=function(t,e,r){var n=new PointerEvent("pointerup",e),o=new Oe;r?o.doubleClick=!0:o.singleClick=!0,!this._checkPrePointerObservable(t,n,N.POINTERUP)&&this._processPointerUp(t,n,o)},i.prototype._processPointerUp=function(t,e,r){var n=this._scene;if(t&&t&&t.pickedMesh){if(this._pickedUpMesh=t.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(e,t),r.singleClick&&!r.ignore&&n.onPointerObservable.hasObservers())){var o=N.POINTERPICK,s=new Lt(o,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,o)}var a=t.pickedMesh._getActionManagerForTrigger();if(a&&!r.ignore){a.processTrigger(7,j.CreateNew(t.pickedMesh,e)),!r.hasSwiped&&r.singleClick&&a.processTrigger(1,j.CreateNew(t.pickedMesh,e));var u=t.pickedMesh._getActionManagerForTrigger(6);r.doubleClick&&u&&u.processTrigger(6,j.CreateNew(t.pickedMesh,e))}}else if(!r.ignore)for(var h=0,f=n._pointerUpStage;h<f.length;h++){var l=f[h];t=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,e)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,j.CreateNew(this._pickedDownMesh,e))}var p=0;if(n.onPointerObservable.hasObservers()){if(!r.ignore&&!r.hasSwiped&&(r.singleClick&&n.onPointerObservable.hasSpecificMask(N.POINTERTAP)?p=N.POINTERTAP:r.doubleClick&&n.onPointerObservable.hasSpecificMask(N.POINTERDOUBLETAP)&&(p=N.POINTERDOUBLETAP),p)){var s=new Lt(p,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}if(!r.ignore){p=N.POINTERUP;var s=new Lt(p,e,t);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}}n.onPointerUp&&!r.ignore&&n.onPointerUp(e,t,p)},i.prototype.isPointerCaptured=function(t){return t===void 0&&(t=0),this._pointerCaptures[t]},i.prototype.attachControl=function(t,e,r,n){var o=this;t===void 0&&(t=!0),e===void 0&&(e=!0),r===void 0&&(r=!0),n===void 0&&(n=null);var s=this._scene;if(n||(n=s.getEngine().getInputElement()),!!n){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=n;var a=s.getEngine();this._initActionManager=function(l,c){if(!o._meshPickProceed){var p=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);o._currentPickResult=p,p&&(l=p.hit&&p.pickedMesh?p.pickedMesh._getActionManagerForTrigger():null),o._meshPickProceed=!0}return l},this._delayedSimpleClick=function(l,c,p){(Date.now()-o._previousStartingPointerTime>i.DoubleClickDelay&&!o._doubleClickOccured||l!==o._previousButtonPressed)&&(o._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,p(c,o._currentPickResult))},this._initClickEvent=function(l,c,p,d){var g=new Oe;o._currentPickResult=null;var v=null,P=l.hasSpecificMask(N.POINTERPICK)||c.hasSpecificMask(N.POINTERPICK)||l.hasSpecificMask(N.POINTERTAP)||c.hasSpecificMask(N.POINTERTAP)||l.hasSpecificMask(N.POINTERDOUBLETAP)||c.hasSpecificMask(N.POINTERDOUBLETAP);!P&&Ut&&(v=o._initActionManager(v,g),v&&(P=v.hasPickTriggers));var b=!1;if(P){var E=p.button;if(g.hasSwiped=o._isPointerSwiping(),!g.hasSwiped){var A=!i.ExclusiveDoubleClickMode;A||(A=!l.hasSpecificMask(N.POINTERDOUBLETAP)&&!c.hasSpecificMask(N.POINTERDOUBLETAP),A&&!Ut.HasSpecificTrigger(6)&&(v=o._initActionManager(v,g),v&&(A=!v.hasSpecificTrigger(6)))),A?(Date.now()-o._previousStartingPointerTime>i.DoubleClickDelay||E!==o._previousButtonPressed)&&(g.singleClick=!0,d(g,o._currentPickResult),b=!0):(o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,o._delayedSimpleClickTimeout=window.setTimeout(o._delayedSimpleClick.bind(o,E,g,d),i.DoubleClickDelay));var I=l.hasSpecificMask(N.POINTERDOUBLETAP)||c.hasSpecificMask(N.POINTERDOUBLETAP);!I&&Ut.HasSpecificTrigger(6)&&(v=o._initActionManager(v,g),v&&(I=v.hasSpecificTrigger(6))),I&&(E===o._previousButtonPressed&&Date.now()-o._previousStartingPointerTime<i.DoubleClickDelay&&!o._doubleClickOccured?(!g.hasSwiped&&!o._isPointerSwiping()?(o._previousStartingPointerTime=0,o._doubleClickOccured=!0,g.doubleClick=!0,g.ignore=!1,i.ExclusiveDoubleClickMode&&o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,d(g,o._currentPickResult)):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=E,i.ExclusiveDoubleClickMode?(o._previousDelayedSimpleClickTimeout&&clearTimeout(o._previousDelayedSimpleClickTimeout),o._previousDelayedSimpleClickTimeout=o._delayedSimpleClickTimeout,d(g,o._previousPickResult)):d(g,o._currentPickResult)),b=!0):(o._doubleClickOccured=!1,o._previousStartingPointerTime=o._startingPointerTime,o._previousStartingPointerPosition.x=o._startingPointerPosition.x,o._previousStartingPointerPosition.y=o._startingPointerPosition.y,o._previousButtonPressed=E))}}b||d(g,o._currentPickResult)},this._onPointerMove=function(l){if(l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),!o._checkPrePointerObservable(null,l,l.type===o._wheelEventName?N.POINTERWHEEL:N.POINTERMOVE)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){s.pointerMovePredicate||(s.pointerMovePredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(p.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||p._getActionManagerForTrigger()!=null)&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)});var c=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerMovePredicate,!1,s.cameraToUseForPointers);o._processPointerMove(c,l)}},this._onPointerDown=function(l){if(o._totalPointersPressed++,o._pickedDownMesh=null,o._meshPickProceed=!1,l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),s.preventDefaultOnPointerDown&&n&&(l.preventDefault(),n.focus()),o._startingPointerPosition.x=o._pointerX,o._startingPointerPosition.y=o._pointerY,o._startingPointerTime=Date.now(),!o._checkPrePointerObservable(null,l,N.POINTERDOWN)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){o._pointerCaptures[l.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)}),o._pickedDownMesh=null;var c=s.pick(o._unTranslatedPointerX,o._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);o._processPointerDown(c,l)}},this._onPointerUp=function(l){o._totalPointersPressed!==0&&(o._totalPointersPressed--,o._pickedUpMesh=null,o._meshPickProceed=!1,l.pointerId===void 0&&(l.pointerId=0),o._updatePointerPosition(l),s.preventDefaultOnPointerUp&&n&&(l.preventDefault(),n.focus()),o._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,l,function(c,p){s.onPrePointerObservable.hasObservers()&&!c.ignore&&(!c.hasSwiped&&(c.singleClick&&s.onPrePointerObservable.hasSpecificMask(N.POINTERTAP)&&o._checkPrePointerObservable(null,l,N.POINTERTAP)||c.doubleClick&&s.onPrePointerObservable.hasSpecificMask(N.POINTERDOUBLETAP)&&o._checkPrePointerObservable(null,l,N.POINTERDOUBLETAP))||o._checkPrePointerObservable(null,l,N.POINTERUP))||!o._pointerCaptures[l.pointerId]||(o._pointerCaptures[l.pointerId]=!1,!(!s.cameraToUseForPointers&&!s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=function(d){return d.isPickable&&d.isVisible&&d.isReady()&&d.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&d.layerMask)!==0)}),!o._meshPickProceed&&(Ut&&Ut.HasTriggers||s.onPointerObservable.hasObservers())&&o._initActionManager(null,c),p||(p=o._currentPickResult),o._processPointerUp(p,l,c),o._previousPickResult=o._currentPickResult))}))},this._onKeyDown=function(l){var c=De.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){var p=new Ce(c,l);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new fe(c,l);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(14,j.CreateNewFromScene(s,l))},this._onKeyUp=function(l){var c=De.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){var p=new Ce(c,l);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new fe(c,l);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(15,j.CreateNewFromScene(s,l))};var u=function(){!n||o._keyboardIsAttached||(n.addEventListener("keydown",o._onKeyDown,!1),n.addEventListener("keyup",o._onKeyUp,!1),o._keyboardIsAttached=!0)};this._onCanvasFocusObserver=a.onCanvasFocusObservable.add(function(){return document.activeElement===n&&u(),u}()),this._onCanvasBlurObserver=a.onCanvasBlurObservable.add(function(){!n||(n.removeEventListener("keydown",o._onKeyDown),n.removeEventListener("keyup",o._onKeyUp),o._keyboardIsAttached=!1)}),u();var h=q.GetPointerPrefix(a);if(r&&(n.addEventListener(h+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",n.addEventListener(this._wheelEventName,this._onPointerMove,!1)),e&&n.addEventListener(h+"down",this._onPointerDown,!1),t){var f=s.getEngine().getHostWindow();f&&f.addEventListener(h+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},i.prototype.detachControl=function(){var t=this._scene.getEngine(),e=q.GetPointerPrefix(t);!this._alreadyAttachedTo||!this._alreadyAttached||(this._alreadyAttachedTo.removeEventListener(e+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(e+"down",this._onPointerDown),window.removeEventListener(e+"up",this._onPointerUp),this._onCanvasBlurObserver&&t.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&t.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},i.prototype.setPointerOverMesh=function(t,e){if(e===void 0&&(e=0),e<0&&(e=0),this._meshUnderPointerId[e]!==t){var r=this._meshUnderPointerId[e],n;r&&(n=r._getActionManagerForTrigger(10),n&&n.processTrigger(10,j.CreateNew(r,void 0,{pointerId:e}))),this._meshUnderPointerId[e]=t,this._pointerOverMesh=t,r=this._meshUnderPointerId[e],r&&(n=r._getActionManagerForTrigger(9),n&&n.processTrigger(9,j.CreateNew(r,void 0,{pointerId:e})))}},i.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},i.DragMovementThreshold=10,i.LongPressDelay=500,i.DoubleClickDelay=300,i.ExclusiveDoubleClickMode=!1,i}(),mr=function(){function i(){}return Object.defineProperty(i,"UniqueId",{get:function(){var t=this._UniqueIdCounter;return this._UniqueIdCounter++,t},enumerable:!1,configurable:!0}),i._UniqueIdCounter=0,i}(),br=function(i){Y(t,i);function t(e,r){var n=i.call(this)||this;n._inputManager=new vt(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new H(.2,.2,.3,1),n.ambientColor=new Mt(0,0,0),n._environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new T,n._onDisposeObserver=null,n.onBeforeRenderObservable=new T,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new T,n.onAfterRenderCameraObservable=new T,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new T,n.onAfterAnimationsObservable=new T,n.onBeforeDrawPhaseObservable=new T,n.onAfterDrawPhaseObservable=new T,n.onReadyObservable=new T,n.onBeforeCameraRenderObservable=new T,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new T,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new T,n.onAfterActiveMeshesEvaluationObservable=new T,n.onBeforeParticlesRenderingObservable=new T,n.onAfterParticlesRenderingObservable=new T,n.onDataLoadedObservable=new T,n.onNewCameraAddedObservable=new T,n.onCameraRemovedObservable=new T,n.onNewLightAddedObservable=new T,n.onLightRemovedObservable=new T,n.onNewGeometryAddedObservable=new T,n.onGeometryRemovedObservable=new T,n.onNewTransformNodeAddedObservable=new T,n.onTransformNodeRemovedObservable=new T,n.onNewMeshAddedObservable=new T,n.onMeshRemovedObservable=new T,n.onNewSkeletonAddedObservable=new T,n.onSkeletonRemovedObservable=new T,n.onNewMaterialAddedObservable=new T,n.onNewMultiMaterialAddedObservable=new T,n.onMaterialRemovedObservable=new T,n.onMultiMaterialRemovedObservable=new T,n.onNewTextureAddedObservable=new T,n.onTextureRemovedObservable=new T,n.onBeforeRenderTargetsRenderObservable=new T,n.onAfterRenderTargetsRenderObservable=new T,n.onBeforeStepObservable=new T,n.onAfterStepObservable=new T,n.onActiveCameraChanged=new T,n.onBeforeRenderingGroupObservable=new T,n.onAfterRenderingGroupObservable=new T,n.onMeshImportedObservable=new T,n.onAnimationFileImportedObservable=new T,n._registeredForLateAnimationBindings=new Dt(256),n.onPrePointerObservable=new T,n.onPointerObservable=new T,n.onPreKeyboardObservable=new T,n.onKeyboardObservable=new T,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=t.FOGMODE_NONE,n.fogColor=new Mt(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.prePass=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new _(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new Dt(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new Ht,n._activeIndices=new Ht,n._activeParticles=new Ht,n._activeBones=new Ht,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=-1,n._intermediateRendering=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new nt(256),n._processedMaterials=new nt(256),n._renderTargets=new Dt(256),n._activeParticleSystems=new nt(256),n._activeSkeletons=new Dt(32),n._softwareSkinnedMeshes=new Dt(32),n._activeAnimatables=new Array,n._transformMatrix=D.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=z.Create(),n._beforeClearStage=z.Create(),n._gatherRenderTargetsStage=z.Create(),n._gatherActiveCameraRenderTargetsStage=z.Create(),n._isReadyForMeshStage=z.Create(),n._beforeEvaluateActiveMeshStage=z.Create(),n._evaluateSubMeshStage=z.Create(),n._preActiveMeshStage=z.Create(),n._cameraDrawRenderTargetStage=z.Create(),n._beforeCameraDrawStage=z.Create(),n._beforeRenderTargetDrawStage=z.Create(),n._beforeRenderingGroupDrawStage=z.Create(),n._beforeRenderingMeshStage=z.Create(),n._afterRenderingMeshStage=z.Create(),n._afterRenderingGroupDrawStage=z.Create(),n._afterCameraDrawStage=z.Create(),n._afterRenderTargetDrawStage=z.Create(),n._afterRenderStage=z.Create(),n._pointerMoveStage=z.Create(),n._pointerDownStage=z.Create(),n._pointerUpStage=z.Create(),n.geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1;var o=Fe({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},r);return n._engine=e||st.LastCreatedEngine,o.virtual||(st._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new vr(n),Ee&&(n.postProcessManager=new Ee(n)),mt.IsWindowObjectExist()&&n.attachControl(),n._createUbo(),he&&(n._imageProcessingConfiguration=new he),n.setDefaultCandidateProviders(),o.useGeometryUniqueIdsMap&&(n.geometriesByUniqueId={}),n.useMaterialMeshMap=o.useMaterialMeshMap,n.useClonedMeshMap=o.useClonedMeshMap,(!r||!r.virtual)&&n._engine.onNewSceneAddedObservable.notifyObservers(n),n}return t.DefaultMaterialFactory=function(e){throw S.WarnImport("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw S.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(e){this._environmentIntensity!==e&&(this._environmentIntensity=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return vt.DragMovementThreshold},set:function(e){vt.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return vt.LongPressDelay},set:function(e){vt.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return vt.DoubleClickDelay},set:function(e){vt.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return vt.ExclusiveDoubleClickMode},set:function(e){vt.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,r=this._transientComponents;e<r.length;e++){var n=r[e];n.register()}this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var r=e;r.addFromContainer&&r.serialize&&this._serializableComponents.push(r)},t.prototype._getComponent=function(e){for(var r=0,n=this._components;r<n.length;r++){var o=n[r];if(o.name===e)return o}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,r,n){return n===void 0&&(n=1),this._cachedEffect!==r||this._cachedMaterial!==e||this._cachedVisibility!==n},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this._sceneUbo=new le(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},t.prototype.simulatePointerMove=function(e,r){return this._inputManager.simulatePointerMove(e,r),this},t.prototype.simulatePointerDown=function(e,r){return this._inputManager.simulatePointerDown(e,r),this},t.prototype.simulatePointerUp=function(e,r,n){return this._inputManager.simulatePointerUp(e,r,n),this},t.prototype.isPointerCaptured=function(e){return e===void 0&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,r,n){e===void 0&&(e=!0),r===void 0&&(r=!0),n===void 0&&(n=!0),this._inputManager.attachControl(e,r,n)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(){if(this._isDisposed)return!1;var e,r=this.getEngine();if(!r.areAllEffectsReady()||this._pendingData.length>0)return!1;for(e=0;e<this.meshes.length;e++){var n=this.meshes[e];if(!!n.isEnabled()&&!(!n.subMeshes||n.subMeshes.length===0)){if(!n.isReady(!0))return!1;for(var o=n.hasThinInstances||n.getClassName()==="InstancedMesh"||n.getClassName()==="InstancedLinesMesh"||r.getCaps().instancedArrays&&n.instances.length>0,s=0,a=this._isReadyForMeshStage;s<a.length;s++){var u=a[s];if(!u.action(n,o))return!1}}}for(e=0;e<this.geometries.length;e++){var h=this.geometries[e];if(h.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var f=0,l=this.activeCameras;f<l.length;f++){var c=l[f];if(!c.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var p=0,d=this.particleSystems;p<d.length;p++){var g=d[p];if(!g.isReady())return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var r=this,n=function(){e(),setTimeout(function(){r.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},t.prototype.executeOnceBeforeRender=function(e,r){var n=this;r!==void 0?setTimeout(function(){n._executeOnceBeforeRender(e)},r):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var r=this.isLoading,n=this._pendingData.indexOf(e);n!==-1&&this._pendingData.splice(n,1),r&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e){var r=this;this.onReadyObservable.add(e),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){r._checkIsReady()},150))},t.prototype.whenReadyAsync=function(){var e=this;return new Promise(function(r){e.executeWhenReady(function(){r()})})},t.prototype._checkIsReady=function(){var e=this;if(this._registerTransientComponents(),this.isReady()){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150)},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=Ie.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,r,n,o){this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===r.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=r.updateFlag,this._viewMatrix=e,this._projectionMatrix=r,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?ee.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ee.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,o):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.getUniqueId=function(){return mr.UniqueId},t.prototype.addMesh=function(e,r){var n=this;r===void 0&&(r=!1),!this._blockEntityCollection&&(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach(function(o){n.addMesh(o)}))},t.prototype.removeMesh=function(e,r){var n=this;r===void 0&&(r=!1);var o=this.meshes.indexOf(e);return o!==-1&&(this.meshes[o]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(e),r&&e.getChildMeshes().forEach(function(s){n.removeMesh(s)}),o},t.prototype.addTransformNode=function(e){this._blockEntityCollection||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var r=e._indexInSceneTransformNodesArray;if(r!==-1){if(r!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[r]=n,n._indexInSceneTransformNodesArray=r}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),r},t.prototype.removeSkeleton=function(e){var r=this.skeletons.indexOf(e);return r!==-1&&(this.skeletons.splice(r,1),this.onSkeletonRemovedObservable.notifyObservers(e)),r},t.prototype.removeMorphTargetManager=function(e){var r=this.morphTargetManagers.indexOf(e);return r!==-1&&this.morphTargetManagers.splice(r,1),r},t.prototype.removeLight=function(e){var r=this.lights.indexOf(e);if(r!==-1){for(var n=0,o=this.meshes;n<o.length;n++){var s=o[n];s._removeLightSource(e,!1)}this.lights.splice(r,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),r},t.prototype.removeCamera=function(e){var r=this.cameras.indexOf(e);if(r!==-1&&(this.cameras.splice(r,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var n=this.activeCameras.indexOf(e);n!==-1&&this.activeCameras.splice(n,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),r},t.prototype.removeParticleSystem=function(e){var r=this.particleSystems.indexOf(e);return r!==-1&&this.particleSystems.splice(r,1),r},t.prototype.removeAnimation=function(e){var r=this.animations.indexOf(e);return r!==-1&&this.animations.splice(r,1),r},t.prototype.stopAnimation=function(e,r,n){},t.prototype.removeAnimationGroup=function(e){var r=this.animationGroups.indexOf(e);return r!==-1&&this.animationGroups.splice(r,1),r},t.prototype.removeMultiMaterial=function(e){var r=this.multiMaterials.indexOf(e);return r!==-1&&this.multiMaterials.splice(r,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),r},t.prototype.removeMaterial=function(e){var r=e._indexInSceneMaterialArray;if(r!==-1&&r<this.materials.length){if(r!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[r]=n,n._indexInSceneMaterialArray=r}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),r},t.prototype.removeActionManager=function(e){var r=this.actionManagers.indexOf(e);return r!==-1&&this.actionManagers.splice(r,1),r},t.prototype.removeTexture=function(e){var r=this.textures.indexOf(e);return r!==-1&&this.textures.splice(r,1),this.onTextureRemovedObservable.notifyObservers(e),r},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var r=0,n=this.meshes;r<n.length;r++){var o=n[r];o.lightSources.indexOf(e)===-1&&(o.lightSources.push(e),o._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(pr.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,r){r===void 0&&(r=!0);var n=this._engine.getInputElement();!n||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,r&&e.attachControl())},t.prototype.setActiveCameraByID=function(e){var r=this.getCameraByID(e);return r?(this.activeCamera=r,r):null},t.prototype.setActiveCameraByName=function(e){var r=this.getCameraByName(e);return r?(this.activeCamera=r,r):null},t.prototype.getAnimationGroupByName=function(e){for(var r=0;r<this.animationGroups.length;r++)if(this.animationGroups[r].name===e)return this.animationGroups[r];return null},t.prototype.getMaterialByUniqueID=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].uniqueId===e)return this.materials[r];return null},t.prototype.getMaterialByID=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].id===e)return this.materials[r];return null},t.prototype.getLastMaterialByID=function(e){for(var r=this.materials.length-1;r>=0;r--)if(this.materials[r].id===e)return this.materials[r];return null},t.prototype.getMaterialByName=function(e){for(var r=0;r<this.materials.length;r++)if(this.materials[r].name===e)return this.materials[r];return null},t.prototype.getTextureByUniqueID=function(e){for(var r=0;r<this.textures.length;r++)if(this.textures[r].uniqueId===e)return this.textures[r];return null},t.prototype.getCameraByID=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].id===e)return this.cameras[r];return null},t.prototype.getCameraByUniqueID=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].uniqueId===e)return this.cameras[r];return null},t.prototype.getCameraByName=function(e){for(var r=0;r<this.cameras.length;r++)if(this.cameras[r].name===e)return this.cameras[r];return null},t.prototype.getBoneByID=function(e){for(var r=0;r<this.skeletons.length;r++)for(var n=this.skeletons[r],o=0;o<n.bones.length;o++)if(n.bones[o].id===e)return n.bones[o];return null},t.prototype.getBoneByName=function(e){for(var r=0;r<this.skeletons.length;r++)for(var n=this.skeletons[r],o=0;o<n.bones.length;o++)if(n.bones[o].name===e)return n.bones[o];return null},t.prototype.getLightByName=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].name===e)return this.lights[r];return null},t.prototype.getLightByID=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].id===e)return this.lights[r];return null},t.prototype.getLightByUniqueID=function(e){for(var r=0;r<this.lights.length;r++)if(this.lights[r].uniqueId===e)return this.lights[r];return null},t.prototype.getParticleSystemByID=function(e){for(var r=0;r<this.particleSystems.length;r++)if(this.particleSystems[r].id===e)return this.particleSystems[r];return null},t.prototype.getGeometryByID=function(e){for(var r=0;r<this.geometries.length;r++)if(this.geometries[r].id===e)return this.geometries[r];return null},t.prototype._getGeometryByUniqueID=function(e){if(this.geometriesByUniqueId){var r=this.geometriesByUniqueId[e];if(r!==void 0)return this.geometries[r]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===e)return this.geometries[n];return null},t.prototype.pushGeometry=function(e,r){return!r&&this._getGeometryByUniqueID(e.uniqueId)?!1:(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var r;if(this.geometriesByUniqueId){if(r=this.geometriesByUniqueId[e.uniqueId],r===void 0)return!1}else if(r=this.geometries.indexOf(e),r<0)return!1;if(r!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];n&&(this.geometries[r]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=r,this.geometriesByUniqueId[e.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshByID=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].id===e)return this.meshes[r];return null},t.prototype.getMeshesByID=function(e){return this.meshes.filter(function(r){return r.id===e})},t.prototype.getTransformNodeByID=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].id===e)return this.transformNodes[r];return null},t.prototype.getTransformNodeByUniqueID=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].uniqueId===e)return this.transformNodes[r];return null},t.prototype.getTransformNodesByID=function(e){return this.transformNodes.filter(function(r){return r.id===e})},t.prototype.getMeshByUniqueID=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].uniqueId===e)return this.meshes[r];return null},t.prototype.getLastMeshByID=function(e){for(var r=this.meshes.length-1;r>=0;r--)if(this.meshes[r].id===e)return this.meshes[r];return null},t.prototype.getLastEntryByID=function(e){var r;for(r=this.meshes.length-1;r>=0;r--)if(this.meshes[r].id===e)return this.meshes[r];for(r=this.transformNodes.length-1;r>=0;r--)if(this.transformNodes[r].id===e)return this.transformNodes[r];for(r=this.cameras.length-1;r>=0;r--)if(this.cameras[r].id===e)return this.cameras[r];for(r=this.lights.length-1;r>=0;r--)if(this.lights[r].id===e)return this.lights[r];return null},t.prototype.getNodeByID=function(e){var r=this.getMeshByID(e);if(r)return r;var n=this.getTransformNodeByID(e);if(n)return n;var o=this.getLightByID(e);if(o)return o;var s=this.getCameraByID(e);if(s)return s;var a=this.getBoneByID(e);return a||null},t.prototype.getNodeByName=function(e){var r=this.getMeshByName(e);if(r)return r;var n=this.getTransformNodeByName(e);if(n)return n;var o=this.getLightByName(e);if(o)return o;var s=this.getCameraByName(e);if(s)return s;var a=this.getBoneByName(e);return a||null},t.prototype.getMeshByName=function(e){for(var r=0;r<this.meshes.length;r++)if(this.meshes[r].name===e)return this.meshes[r];return null},t.prototype.getTransformNodeByName=function(e){for(var r=0;r<this.transformNodes.length;r++)if(this.transformNodes[r].name===e)return this.transformNodes[r];return null},t.prototype.getLastSkeletonByID=function(e){for(var r=this.skeletons.length-1;r>=0;r--)if(this.skeletons[r].id===e)return this.skeletons[r];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].uniqueId===e)return this.skeletons[r];return null},t.prototype.getSkeletonById=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].id===e)return this.skeletons[r];return null},t.prototype.getSkeletonByName=function(e){for(var r=0;r<this.skeletons.length;r++)if(this.skeletons[r].name===e)return this.skeletons[r];return null},t.prototype.getMorphTargetManagerById=function(e){for(var r=0;r<this.morphTargetManagers.length;r++)if(this.morphTargetManagers[r].uniqueId===e)return this.morphTargetManagers[r];return null},t.prototype.getMorphTargetById=function(e){for(var r=0;r<this.morphTargetManagers.length;++r)for(var n=this.morphTargetManagers[r],o=0;o<n.numTargets;++o){var s=n.getTarget(o);if(s.id===e)return s}return null},t.prototype.getMorphTargetByName=function(e){for(var r=0;r<this.morphTargetManagers.length;++r)for(var n=this.morphTargetManagers[r],o=0;o<n.numTargets;++o){var s=n.getTarget(o);if(s.name===e)return s}return null},t.prototype.getPostProcessByName=function(e){for(var r=0;r<this.postProcesses.length;++r){var n=this.postProcesses[r];if(n.name===e)return n}return null},t.prototype.isActiveMesh=function(e){return this._activeMeshes.indexOf(e)!==-1},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=q.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,r){return this._externalData||(this._externalData=new _e),this._externalData.add(e,r)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,r){return this._externalData||(this._externalData=new _e),this._externalData.getOrAddWithFactory(e,r)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,r,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||r.alwaysSelectAsActiveMesh||r.subMeshes.length===1||e.isInFrustum(this._frustumPlanes)){for(var o=0,s=this._evaluateSubMeshStage;o<s.length;o++){var a=s[o];a.action(r,e)}var u=e.getMaterial();u!=null&&(u.hasRenderTargetTextures&&u.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(u)===-1&&(this._processedMaterials.push(u),this._renderTargets.concatWithNoDuplicate(u.getRenderTargetTextures())),this._renderingManager.dispatch(e,r,u))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var r=this.activeCameras[e];r&&r._activeMeshes&&r._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var r=this.textures[e];r&&r.renderList&&r.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,r,n){var o=this;return e===void 0&&(e=!1),this.executeWhenReady(function(){if(!o.activeCamera){n&&n("No active camera found");return}o._frustumPlanes||o.setTransformMatrix(o.activeCamera.getViewMatrix(),o.activeCamera.getProjectionMatrix()),o._evaluateActiveMeshes(),o._activeMeshesFrozen=!0,o._skipEvaluateActiveMeshesCompletely=e;for(var s=0;s<o._activeMeshes.length;s++)o._activeMeshes.data[s]._freeze();r&&r()}),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var r=this.meshes[e];r._internalAbstractMeshDataInfo&&(r._internalAbstractMeshDataInfo._isActive=!1)}for(var e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var e=this._activeMeshes.length,r=0;r<e;r++){var n=this._activeMeshes.data[r];n.computeWorldMatrix()}if(this._activeParticleSystems)for(var o=this._activeParticleSystems.length,r=0;r<o;r++)this._activeParticleSystems.data[r].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var s=0,a=this._beforeEvaluateActiveMeshStage;s<a.length;s++){var u=a[s];u.action()}for(var h=this.getActiveMeshCandidates(),f=h.length,r=0;r<f;r++){var n=h.data[r];if(n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!n.isBlocked&&(this._totalVertices.addCount(n.getTotalVertices(),!1),!(!n.isReady()||!n.isEnabled()||n.scaling.lengthSquared()===0))){n.computeWorldMatrix(),n.actionManager&&n.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(n);var l=this.customLODSelector?this.customLODSelector(n,this.activeCamera):n.getLOD(this.activeCamera);if(n._internalAbstractMeshDataInfo._currentLOD=l,n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,l!=null&&(l!==n&&l.billboardMode!==pt.BILLBOARDMODE_NONE&&l.computeWorldMatrix(),n._preActivate(),n.isVisible&&n.visibility>0&&(n.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||n.alwaysSelectAsActiveMesh||n.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(n),this.activeCamera._activeMeshes.push(n),l!==n&&l._activate(this._renderId,!1);for(var c=0,p=this._preActiveMeshStage;c<p.length;c++){var u=p[c];u.action(n)}n._activate(this._renderId,!1)&&(n.isAnInstance?n._internalAbstractMeshDataInfo._actAsRegularMesh&&(l=n):l._internalAbstractMeshDataInfo._onlyForInstances=!1,l._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(n,l)),n._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var d=0;d<this.particleSystems.length;d++){var g=this.particleSystems[d];if(!(!g.isStarted()||!g.emitter)){var v=g.emitter;(!v.position||v.isEnabled())&&(this._activeParticleSystems.push(g),g.animate(),this._renderingManager.dispatchParticles(g))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,r){if(this._skeletonsEnabled&&r.skeleton!==null&&r.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(r.skeleton)&&r.skeleton.prepare(),r.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(r)),r!=null&&r.subMeshes!==void 0&&r.subMeshes!==null&&r.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(r),o=n.length,s=0;s<o;s++){var a=n.data[s];this._evaluateSubMesh(a,r,e)}},t.prototype.updateTransformMatrix=function(e){!this.activeCamera||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget){var e=this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1;if(e)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var r=this.activeCamera.outputRenderTarget.getInternalTexture();r?this.getEngine().bindFramebuffer(r):K.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},t.prototype._renderForCamera=function(e,r){if(!(e&&e._skipRendering)){var n=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++;var o=this.getEngine().getCaps().multiview&&e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1;o?this.setTransformMatrix(e._rigCameras[0].getViewMatrix(),e._rigCameras[0].getProjectionMatrix(),e._rigCameras[1].getViewMatrix(),e._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var s=0;s<this._softwareSkinnedMeshes.length;s++){var a=this._softwareSkinnedMeshes.data[s];a.applySkeleton(a.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),r&&r.customRenderTargets&&r.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(r.customRenderTargets);for(var u=0,h=this._gatherActiveCameraRenderTargetsStage;u<h.length;u++){var f=h[u];f.action(this._renderTargets)}var l=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){q.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var c=0;c<this._renderTargets.length;c++){var p=this._renderTargets.data[c];if(p._shouldRender()){this._renderId++;var d=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(d,this.dumpNextRenderTargets),l=!0}}q.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var g=0,v=this._cameraDrawRenderTargetStage;g<v.length;g++){var f=v[g];l=f.action(this.activeCamera)||l}this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(l=!0)}l&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!e._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var P=0,b=this._beforeCameraDrawStage;P<b.length;P++){var f=b[P];f.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var E=0,A=this._afterCameraDrawStage;E<A.length;E++){var f=A[E];f.action(this.activeCamera)}if(this.postProcessManager&&!e._multiviewTexture){var I=e.outputRenderTarget?e.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,I)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e){if(e.cameraRigMode===Zt.RIG_MODE_NONE||e.outputRenderTarget&&e.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview){this._renderForCamera(e),this.onAfterRenderCameraObservable.notifyObservers(e);return}if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else for(var r=0;r<e._rigCameras.length;r++)this._renderForCamera(e._rigCameras[r],e);this._activeCamera=e,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var r=this._meshesForIntersections.data[e];if(!!r.actionManager)for(var n=0;r.actionManager&&n<r.actionManager.actions.length;n++){var o=r.actionManager.actions[n];if(o.trigger===12||o.trigger===13){var s=o.getTriggerParameter(),a=s instanceof ue?s:s.mesh,u=a.intersectsMesh(r,s.usePreciseIntersection),h=r._intersectionsInProgress.indexOf(a);u&&h===-1?o.trigger===12?(o._executeCurrent(j.CreateNew(r,void 0,a)),r._intersectionsInProgress.push(a)):o.trigger===13&&r._intersectionsInProgress.push(a):!u&&h>-1&&(o.trigger===13&&o._executeCurrent(j.CreateNew(r,void 0,a)),(!r.actionManager.hasSpecificTrigger(13,function(f){var l=f instanceof ue?f:f.mesh;return a===l})||o.trigger===13)&&r._intersectionsInProgress.splice(h,1))}}}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,r=this._engine.getTimeStep(),n=1e3/r/1e3,o=0,s=this._engine.getLockstepMaxSteps(),a=Math.floor(e/r);for(a=Math.min(a,s);e>0&&o<a;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=r*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(r),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,o++,e-=r;this._timeAccumulator=e<0?0:e}else{var e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=e*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}},t.prototype.render=function(e,r){if(e===void 0&&(e=!0),r===void 0&&(r=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),r||this.animate();for(var n=0,o=this._beforeCameraUpdateStage;n<o.length;n++){var s=o[n];s.action()}if(e){if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++){var u=this.activeCameras[a];if(u.update(),u.cameraRigMode!==Zt.RIG_MODE_NONE)for(var h=0;h<u._rigCameras.length;h++)u._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==Zt.RIG_MODE_NONE))for(var h=0;h<this.activeCamera._rigCameras.length;h++)this.activeCamera._rigCameras[h].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var f=this.getEngine(),l=this.activeCamera;if(this.renderTargetsEnabled){q.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var p=this.customRenderTargets[c];if(p._shouldRender()){if(this._renderId++,this.activeCamera=p.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");f.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),p.render(l!==this.activeCamera,this.dumpNextRenderTargets)}}q.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=l,this._activeCamera&&this._activeCamera.cameraRigMode!==Zt.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,g=this._beforeClearStage;d<g.length;d++){var s=g[d];s.action()}(this.autoClearDepthAndStencil||this.autoClear)&&!this.prePass&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var v=0,P=this._gatherRenderTargetsStage;v<P.length;v++){var s=P[v];s.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++)a>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[a]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var b=0,E=this._afterRenderStage;b<E.length;b++){var s=E[b];s.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var h=0;h<this._toBeDisposed.length;h++){var A=this._toBeDisposed[h];A&&A.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,st._LastCreatedScene===this&&(st._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var e=0,r=this._components;e<r.length;e++){var n=r[e];n.dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var o=0,s=this._activeRequests;o<s.length;o++){var a=s[o];a.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var u=this._engine.getInputElement();if(u){var h;for(h=0;h<this.cameras.length;h++)this.cameras[h].detachControl()}for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),h=this._engine.scenes.indexOf(this),h>-1&&this._engine.scenes.splice(h,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var r=this.meshes[e],n=r.geometry;if(n){n._indices=[];for(var o in n._vertexBuffers)!n._vertexBuffers.hasOwnProperty(o)||(n._vertexBuffers[o]._buffer._data=null)}}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,r=this.textures;e<r.length;e++){var n=r[e],o=n._buffer;o&&(n._buffer=null)}},t.prototype.getWorldExtends=function(e){var r=new _(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new _(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach(function(o){if(o.computeWorldMatrix(!0),!(!o.subMeshes||o.subMeshes.length===0||o.infiniteDistance)){var s=o.getBoundingInfo(),a=s.boundingBox.minimumWorld,u=s.boundingBox.maximumWorld;_.CheckExtends(a,r,n),_.CheckExtends(u,r,n)}}),{min:r,max:n}},t.prototype.createPickingRay=function(e,r,n,o,s){throw S.WarnImport("Ray")},t.prototype.createPickingRayToRef=function(e,r,n,o,s,a){throw S.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,r,n){throw S.WarnImport("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,r,n,o){throw S.WarnImport("Ray")},t.prototype.pick=function(e,r,n,o,s,a){var u=new ae;return u._pickingUnavailable=!0,u},t.prototype.pickWithBoundingInfo=function(e,r,n,o,s){var a=new ae;return a._pickingUnavailable=!0,a},t.prototype.pickWithRay=function(e,r,n,o){throw S.WarnImport("Ray")},t.prototype.multiPick=function(e,r,n,o,s){throw S.WarnImport("Ray")},t.prototype.multiPickWithRay=function(e,r,n){throw S.WarnImport("Ray")},t.prototype.setPointerOverMesh=function(e,r){this._inputManager.setPointerOverMesh(e,r)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,r=this.geometries;e<r.length;e++){var n=r[e];n._rebuild()}for(var o=0,s=this.meshes;o<s.length;o++){var a=s[o];a._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var u=0,h=this._components;u<h.length;u++){var f=h[u];f.rebuild()}for(var l=0,c=this.particleSystems;l<c.length;l++){var p=c[l];p.rebuild()}},t.prototype._rebuildTextures=function(){for(var e=0,r=this.textures;e<r.length;e++){var n=r[e];n._rebuild()}this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,r,n){if(r===void 0)return e;var o=[];n=n||function(u){};for(var s in e){var a=e[s];Rt&&Rt.MatchesQuery(a,r)&&(o.push(a),n(a))}return o},t.prototype.getMeshesByTags=function(e,r){return this._getByTags(this.meshes,e,r)},t.prototype.getCamerasByTags=function(e,r){return this._getByTags(this.cameras,e,r)},t.prototype.getLightsByTags=function(e,r){return this._getByTags(this.lights,e,r)},t.prototype.getMaterialByTags=function(e,r){return this._getByTags(this.materials,e,r).concat(this._getByTags(this.multiMaterials,e,r))},t.prototype.getTransformNodesByTags=function(e,r){return this._getByTags(this.transformNodes,e,r)},t.prototype.setRenderingOrder=function(e,r,n,o){r===void 0&&(r=null),n===void 0&&(n=null),o===void 0&&(o=null),this._renderingManager.setRenderingOrder(e,r,n,o)},t.prototype.setRenderingAutoClearDepthStencil=function(e,r,n,o){n===void 0&&(n=!0),o===void 0&&(o=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,r,n,o)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,r){if(!this._blockMaterialDirtyMechanism)for(var n=0,o=this.materials;n<o.length;n++){var s=o[n];r&&!r(s)||s.markAsDirty(e)}},t.prototype._loadFile=function(e,r,n,o,s,a){var u=this,h=U.LoadFile(e,r,n,o?this.offlineProvider:void 0,s,a);return this._activeRequests.push(h),h.onCompleteObservable.add(function(f){u._activeRequests.splice(u._activeRequests.indexOf(f),1)}),h},t.prototype._loadFileAsync=function(e,r,n,o){var s=this;return new Promise(function(a,u){s._loadFile(e,function(h){a(h)},r,n,o,function(h,f){u(f)})})},t.prototype._requestFile=function(e,r,n,o,s,a,u){var h=this,f=U.RequestFile(e,r,n,o?this.offlineProvider:void 0,s,a,u);return this._activeRequests.push(f),f.onCompleteObservable.add(function(l){h._activeRequests.splice(h._activeRequests.indexOf(l),1)}),f},t.prototype._requestFileAsync=function(e,r,n,o,s){var a=this;return new Promise(function(u,h){a._requestFile(e,function(f){u(f)},r,n,o,function(f){h(f)},s)})},t.prototype._readFile=function(e,r,n,o,s){var a=this,u=U.ReadFile(e,r,n,o,s);return this._activeRequests.push(u),u.onCompleteObservable.add(function(h){a._activeRequests.splice(a._activeRequests.indexOf(h),1)}),u},t.prototype._readFileAsync=function(e,r,n){var o=this;return new Promise(function(s,a){o._readFile(e,function(u){s(u)},r,n,function(u){a(u)})})},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(lr);const Mr=i=>{const t=new br(i);return t.clearColor.set(.1,.1,.1,1),t.ambientColor.set(1,1,1),t},Pr=Ne(()=>import("./geometry.4abfdef5.js"),["geometry.4abfdef5.js","vendor.db607760.js","index.792b56aa.js"]).then(({createCamera:i,createGeometry:t})=>[i,t]);var Or=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createScene:Mr,init:Pr});export{Ar as A,te as B,H as C,ke as D,ot as E,Zt as F,Xe as G,zt as H,ie as I,Dr as J,De as K,pr as L,Ae as M,At as N,pt as O,we as P,L as Q,yt as R,dr as S,q as T,G as U,y as V,$t as W,Or as X,_t as _,_ as a,Rt as b,be as c,me as d,ar as e,at as f,Cr as g,k as h,D as i,Mt as j,ue as k,bt as l,br as m,tr as n,qe as o,R as p,$e as q,cr as r,M as s,nt as t,he as u,ve as v,Er as w,w as x,N as y,nr as z};
//# sourceMappingURL=scene.7b99a820.js.map
