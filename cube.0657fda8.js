import{_ as si}from"./index.5c7c8a35.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ht=function(r,e){return Ht=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},Ht(r,e)};function N(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ht(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ft=function(){return Ft=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},Ft.apply(this,arguments)};function b(r,e,t,i){var n=arguments.length,a=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(r,e,t,i);else for(var o=r.length-1;o>=0;o--)(s=r[o])&&(a=(n<3?s(a):n>3?s(e,t,a):s(e,t))||a);return n>3&&a&&Object.defineProperty(e,t,a),a}var wi=function(){function r(e,t,i,n){t===void 0&&(t=!1),this.initalize(e,t,i,n)}return r.prototype.initalize=function(e,t,i,n){return t===void 0&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=i,this.currentTarget=n,this},r}(),Li=function(){function r(e,t,i){i===void 0&&(i=null),this.callback=e,this.mask=t,this.scope=i,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}return r}(),D=function(){function r(e){this._observers=new Array,this._eventState=new wi(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(r.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),r.prototype.add=function(e,t,i,n,a){if(t===void 0&&(t=-1),i===void 0&&(i=!1),n===void 0&&(n=null),a===void 0&&(a=!1),!e)return null;var s=new Li(e,t,n);return s.unregisterOnNextCall=a,i?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),s},r.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},r.prototype.remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._deferUnregister(e),!0):!1},r.prototype.removeCallback=function(e,t){for(var i=0;i<this._observers.length;i++){var n=this._observers[i];if(!n._willBeUnregistered&&n.callback===e&&(!t||t===n.scope))return this._deferUnregister(n),!0}return!1},r.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout(function(){t._remove(e)},0)},r.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return t!==-1?(this._observers.splice(t,1),!0):!1},r.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},r.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},r.prototype.notifyObservers=function(e,t,i,n,a){if(t===void 0&&(t=-1),!this._observers.length)return!0;var s=this._eventState;s.mask=t,s.target=i,s.currentTarget=n,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=a;for(var o=0,u=this._observers;o<u.length;o++){var l=u[o];if(!l._willBeUnregistered&&(l.mask&t&&(l.scope?s.lastReturnValue=l.callback.apply(l.scope,[e,s]):s.lastReturnValue=l.callback(e,s),l.unregisterOnNextCall&&this._deferUnregister(l)),s.skipNextObservers))return!1}return!0},r.prototype.notifyObserversWithPromise=function(e,t,i,n,a){var s=this;t===void 0&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var u=this._eventState;return u.mask=t,u.target=i,u.currentTarget=n,u.skipNextObservers=!1,u.userInfo=a,this._observers.forEach(function(l){u.skipNextObservers||l._willBeUnregistered||l.mask&t&&(l.scope?o=o.then(function(f){return u.lastReturnValue=f,l.callback.apply(l.scope,[e,u])}):o=o.then(function(f){return u.lastReturnValue=f,l.callback(e,u)}),l.unregisterOnNextCall&&s._deferUnregister(l))}),o.then(function(){return e})},r.prototype.notifyObserver=function(e,t,i){i===void 0&&(i=-1);var n=this._eventState;n.mask=i,n.skipNextObservers=!1,e.callback(t,n)},r.prototype.hasObservers=function(){return this._observers.length>0},r.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},r.prototype.clone=function(){var e=new r;return e._observers=this._observers.slice(0),e},r.prototype.hasSpecificMask=function(e){e===void 0&&(e=-1);for(var t=0,i=this._observers;t<i.length;t++){var n=i[t];if(n.mask&e||n.mask===e)return!0}return!1},r}(),oe=function(){function r(){}return r.IsWindowObjectExist=function(){return typeof window!="undefined"},r.IsNavigatorAvailable=function(){return typeof navigator!="undefined"},r.IsDocumentAvailable=function(){return typeof document!="undefined"},r.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)i.nodeType===3&&(t+=i.textContent),i=i.nextSibling;return t},r}(),L=function(){function r(){}return r._AddLogEntry=function(e){r._LogCache=e+r._LogCache,r.OnNewCacheEntry&&r.OnNewCacheEntry(e)},r._FormatMessage=function(e){var t=function(n){return n<10?"0"+n:""+n},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},r._LogDisabled=function(e){},r._LogEnabled=function(e){var t=r._FormatMessage(e);console.log("BJS - "+t);var i="<div style='color:white'>"+t+"</div><br>";r._AddLogEntry(i)},r._WarnDisabled=function(e){},r._WarnEnabled=function(e){var t=r._FormatMessage(e);console.warn("BJS - "+t);var i="<div style='color:orange'>"+t+"</div><br>";r._AddLogEntry(i)},r._ErrorDisabled=function(e){},r._ErrorEnabled=function(e){r.errorsCount++;var t=r._FormatMessage(e);console.error("BJS - "+t);var i="<div style='color:red'>"+t+"</div><br>";r._AddLogEntry(i)},Object.defineProperty(r,"LogCache",{get:function(){return r._LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){r._LogCache="",r.errorsCount=0},Object.defineProperty(r,"LogLevels",{set:function(e){(e&r.MessageLogLevel)===r.MessageLogLevel?r.Log=r._LogEnabled:r.Log=r._LogDisabled,(e&r.WarningLogLevel)===r.WarningLogLevel?r.Warn=r._WarnEnabled:r.Warn=r._WarnDisabled,(e&r.ErrorLogLevel)===r.ErrorLogLevel?r.Error=r._ErrorEnabled:r.Error=r._ErrorDisabled},enumerable:!1,configurable:!0}),r.NoneLogLevel=0,r.MessageLogLevel=1,r.WarningLogLevel=2,r.ErrorLogLevel=4,r.AllLogLevel=7,r._LogCache="",r.errorsCount=0,r.Log=r._LogEnabled,r.Warn=r._WarnEnabled,r.Error=r._ErrorEnabled,r}(),De=function(){function r(){}return r.EndsWith=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},r.StartsWith=function(e,t){return e?e.indexOf(t)===0:!1},r.Decode=function(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);for(var t="",i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return t},r.EncodeArrayBufferToBase64=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",n,a,s,o,u,l,f,h=0,c=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);h<c.length;)n=c[h++],a=h<c.length?c[h++]:Number.NaN,s=h<c.length?c[h++]:Number.NaN,o=n>>2,u=(n&3)<<4|a>>4,l=(a&15)<<2|s>>6,f=s&63,isNaN(a)?l=f=64:isNaN(s)&&(f=64),i+=t.charAt(o)+t.charAt(u)+t.charAt(l)+t.charAt(f);return i},r.PadNumber=function(e,t){for(var i=String(e);i.length<t;)i="0"+i;return i},r}(),oi=function(r,e){return!r||r.getClassName&&r.getClassName()==="Mesh"?null:r.getClassName&&r.getClassName()==="SubMesh"?r.clone(e):r.clone?r.clone():null};function Ni(r){var e=[];do Object.getOwnPropertyNames(r).forEach(function(t){e.indexOf(t)===-1&&e.push(t)});while(r=Object.getPrototypeOf(r));return e}var ii=function(){function r(){}return r.DeepCopy=function(e,t,i,n){for(var a=Ni(e),s=0,o=a;s<o.length;s++){var u=o[s];if(!(u[0]==="_"&&(!n||n.indexOf(u)===-1))&&!De.EndsWith(u,"Observable")&&!(i&&i.indexOf(u)!==-1)){var l=e[u],f=typeof l;if(f!=="function")try{if(f==="object")if(l instanceof Array){if(t[u]=[],l.length>0)if(typeof l[0]=="object")for(var h=0;h<l.length;h++){var c=oi(l[h],t);t[u].indexOf(c)===-1&&t[u].push(c)}else t[u]=l.slice(0)}else t[u]=oi(l,t);else t[u]=l}catch(p){L.Warn(p.message)}}}},r}(),Ve=function(){function r(){}return Object.defineProperty(r,"Now",{get:function(){return oe.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),r}(),O=function(){function r(){}return r.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},r}();function Bi(){return typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var it=function(){function r(){this._xhr=Bi()}return r.prototype._injectCustomRequestHeaders=function(){for(var e in r.CustomRequestHeaders){var t=r.CustomRequestHeaders[e];t&&this._xhr.setRequestHeader(e,t)}},Object.defineProperty(r.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!1,configurable:!0}),r.prototype.addEventListener=function(e,t,i){this._xhr.addEventListener(e,t,i)},r.prototype.removeEventListener=function(e,t,i){this._xhr.removeEventListener(e,t,i)},r.prototype.abort=function(){this._xhr.abort()},r.prototype.send=function(e){r.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(e)},r.prototype.open=function(e,t){for(var i=0,n=r.CustomRequestModifiers;i<n.length;i++){var a=n[i];a(this._xhr,t)}return t=t.replace("file:http:","http:"),t=t.replace("file:https:","https:"),this._xhr.open(e,t,!0)},r.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},r.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},r.CustomRequestHeaders={},r.CustomRequestModifiers=new Array,r}(),de=function(){function r(){}return Object.defineProperty(r,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),r.Instances=new Array,r._LastCreatedScene=null,r.UseFallbackTexture=!0,r.FallbackTexture="",r}(),St=function(){function r(){}return r.FilesToLoad={},r}(),Ui=function(){function r(){}return r.ExponentialBackoff=function(e,t){return e===void 0&&(e=3),t===void 0&&(t=500),function(i,n,a){return n.status!==0||a>=e||i.indexOf("file:")!==-1?-1:Math.pow(2,a)*t}},r}(),rt=function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e._setPrototypeOf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},e}(Error),ct=function(){function r(){this.children=[]}return r.prototype.isValid=function(e){return!0},r.prototype.process=function(e,t){var i="";if(this.line){var n=this.line,a=t.processor;if(a){if(a.lineProcessor&&(n=a.lineProcessor(n,t.isFragment)),a.attributeProcessor&&De.StartsWith(this.line,"attribute"))n=a.attributeProcessor(this.line);else if(a.varyingProcessor&&De.StartsWith(this.line,"varying"))n=a.varyingProcessor(this.line,t.isFragment);else if((a.uniformProcessor||a.uniformBufferProcessor)&&De.StartsWith(this.line,"uniform")){var s=/uniform (.+) (.+)/;s.test(this.line)?a.uniformProcessor&&(n=a.uniformProcessor(this.line,t.isFragment)):a.uniformBufferProcessor&&(n=a.uniformBufferProcessor(this.line,t.isFragment),t.lookForClosingBracketForUniformBuffer=!0)}a.endOfUniformBufferProcessor&&t.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(t.lookForClosingBracketForUniformBuffer=!1,n=a.endOfUniformBufferProcessor(this.line,t.isFragment))}i+=n+`\r
`}return this.children.forEach(function(o){i+=o.process(e,t)}),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),i},r}(),Vi=function(){function r(){}return Object.defineProperty(r.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,i=e;t<i.length;t++){var n=i[t];if(n[0]==="#"){this._lines.push(n);continue}for(var a=n.split(";"),s=0;s<a.length;s++){var o=a[s];o=o.trim(),!!o&&this._lines.push(o+(s!==a.length-1?";":""))}}},enumerable:!1,configurable:!0}),r}(),Ut=function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.process=function(t,i){for(var n=0;n<this.children.length;n++){var a=this.children[n];if(a.isValid(t))return a.process(t,i)}return""},e}(ct),ki=function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isValid=function(t){return this.testExpression.isTrue(t)},e}(ct),vt=function(){function r(){}return r.prototype.isTrue=function(e){return!0},r.postfixToInfix=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var a=n[i];if(r._OperatorPriority[a]===void 0)t.push(a);else{var s=t[t.length-1],o=t[t.length-2];t.length-=2,t.push("("+o+a+s+")")}}return t[t.length-1]},r.infixToPostfix=function(e){for(var t=[],i=-1,n=function(){l=l.trim(),l!==""&&(t.push(l),l="")},a=function(c){i<r._Stack.length-1&&(r._Stack[++i]=c)},s=function(){return r._Stack[i]},o=function(){return i===-1?"!!INVALID EXPRESSION!!":r._Stack[i--]},u=0,l="";u<e.length;){var f=e.charAt(u),h=u<e.length-1?e.substr(u,2):"";if(f==="(")l="",a(f);else if(f===")"){for(n();i!==-1&&s()!=="(";)t.push(o());o()}else if(r._OperatorPriority[h]>1){for(n();i!==-1&&r._OperatorPriority[s()]>=r._OperatorPriority[h];)t.push(o());a(h),u++}else l+=f;u++}for(n();i!==-1;)s()==="("?o():t.push(o());return t},r._OperatorPriority={")":0,"(":1,"||":2,"&&":3},r._Stack=["","","","","","","","","","","","","","","","","","","",""],r}(),Mt=function(r){N(e,r);function e(t,i){i===void 0&&(i=!1);var n=r.call(this)||this;return n.define=t,n.not=i,n}return e.prototype.isTrue=function(t){var i=t[this.define]!==void 0;return this.not&&(i=!i),i},e}(vt),Wi=function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)||this.rightOperand.isTrue(t)},e}(vt),zi=function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.isTrue=function(t){return this.leftOperand.isTrue(t)&&this.rightOperand.isTrue(t)},e}(vt),Xi=function(r){N(e,r);function e(t,i,n){var a=r.call(this)||this;return a.define=t,a.operand=i,a.testValue=n,a}return e.prototype.isTrue=function(t){var i=t[this.define];i===void 0&&(i=this.define);var n=!1,a=parseInt(i),s=parseInt(this.testValue);switch(this.operand){case">":n=a>s;break;case"<":n=a<s;break;case"<=":n=a<=s;break;case">=":n=a>=s;break;case"==":n=a===s;break}return n},e}(vt),Gi=/defined\s*?\((.+?)\)/g,Vt=/defined\s*?\[(.+?)\]/g,Kt=function(){function r(){}return r.Process=function(e,t,i,n){var a=this;this._ProcessIncludes(e,t,function(s){var o=a._ProcessShaderConversion(s,t,n);i(o)})},r._ProcessPrecision=function(e,t){var i=t.shouldUseHighPrecisionShader;return e.indexOf("precision highp float")===-1?i?e=`precision highp float;
`+e:e=`precision mediump float;
`+e:i||(e=e.replace("precision highp float","precision mediump float")),e},r._ExtractOperation=function(e){var t=/defined\((.+)\)/,i=t.exec(e);if(i&&i.length)return new Mt(i[1].trim(),e[0]==="!");for(var n=["==",">=","<=","<",">"],a="",s=0,o=0,u=n;o<u.length&&(a=u[o],s=e.indexOf(a),!(s>-1));o++);if(s===-1)return new Mt(e);var l=e.substring(0,s).trim(),f=e.substring(s+a.length).trim();return new Xi(l,a,f)},r._BuildSubExpression=function(e){e=e.replace(Gi,"defined[$1]");for(var t=vt.infixToPostfix(e),i=[],n=0,a=t;n<a.length;n++){var s=a[n];if(s!=="||"&&s!=="&&")i.push(s);else if(i.length>=2){var o=i[i.length-1],u=i[i.length-2];i.length-=2;var l=s=="&&"?new zi:new Wi;typeof o=="string"&&(o=o.replace(Vt,"defined($1)")),typeof u=="string"&&(u=u.replace(Vt,"defined($1)")),l.leftOperand=typeof u=="string"?this._ExtractOperation(u):u,l.rightOperand=typeof o=="string"?this._ExtractOperation(o):o,i.push(l)}}var f=i[i.length-1];return typeof f=="string"&&(f=f.replace(Vt,"defined($1)")),typeof f=="string"?this._ExtractOperation(f):f},r._BuildExpression=function(e,t){var i=new ki,n=e.substring(0,t),a=e.substring(t);return a=a.substring(0,(a.indexOf("//")+1||a.length+1)-1).trim(),n==="#ifdef"?i.testExpression=new Mt(a):n==="#ifndef"?i.testExpression=new Mt(a,!0):i.testExpression=this._BuildSubExpression(a),i},r._MoveCursorWithinIf=function(e,t,i){for(var n=e.currentLine;this._MoveCursor(e,i);){n=e.currentLine;var a=n.substring(0,5).toLowerCase();if(a==="#else"){var s=new ct;t.children.push(s),this._MoveCursor(e,s);return}else if(a==="#elif"){var o=this._BuildExpression(n,5);t.children.push(o),i=o}}},r._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var i=e.currentLine,n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/,a=n.exec(i);if(a&&a.length){var s=a[0];switch(s){case"#ifdef":{var o=new Ut;t.children.push(o);var u=this._BuildExpression(i,6);o.children.push(u),this._MoveCursorWithinIf(e,o,u);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{var o=new Ut;t.children.push(o);var u=this._BuildExpression(i,7);o.children.push(u),this._MoveCursorWithinIf(e,o,u);break}case"#if":{var o=new Ut,u=this._BuildExpression(i,3);t.children.push(o),o.children.push(u),this._MoveCursorWithinIf(e,o,u);break}}}else{var l=new ct;if(l.line=i,t.children.push(l),i[0]==="#"&&i[1]==="d"){var f=i.replace(";","").split(" ");l.additionalDefineKey=f[1],f.length===3&&(l.additionalDefineValue=f[2])}}}return!1},r._EvaluatePreProcessors=function(e,t,i){var n=new ct,a=new Vi;return a.lineIndex=-1,a.lines=e.split(`
`),this._MoveCursor(a,n),n.process(t,i)},r._PreparePreProcessors=function(e){for(var t=e.defines,i={},n=0,a=t;n<a.length;n++){var s=a[n],o=s.replace("#define","").replace(";","").trim(),u=o.split(" ");i[u[0]]=u.length>1?u[1]:""}return i.GL_ES="true",i.__VERSION__=e.version,i[e.platformName]="true",i},r._ProcessShaderConversion=function(e,t,i){var n=this._ProcessPrecision(e,t);if(!t.processor)return n;if(n.indexOf("#version 3")!==-1)return n.replace("#version 300 es","");var a=t.defines,s=this._PreparePreProcessors(t);return t.processor.preProcessor&&(n=t.processor.preProcessor(n,a,t.isFragment)),n=this._EvaluatePreProcessors(n,s,t),t.processor.postProcessor&&(n=t.processor.postProcessor(n,a,t.isFragment,i)),n},r._ProcessIncludes=function(e,t,i){for(var n=this,a=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=a.exec(e),o=new String(e),u=!1;s!=null;){var l=s[1];if(l.indexOf("__decl__")!==-1&&(l=l.replace(/__decl__/,""),t.supportsUniformBuffers&&(l=l.replace(/Vertex/,"Ubo"),l=l.replace(/Fragment/,"Ubo")),l=l+"Declaration"),t.includesShadersStore[l]){var f=t.includesShadersStore[l];if(s[2])for(var h=s[3].split(","),c=0;c<h.length;c+=2){var p=new RegExp(h[c],"g"),d=h[c+1];f=f.replace(p,d)}if(s[4]){var g=s[5];if(g.indexOf("..")!==-1){var m=g.split(".."),E=parseInt(m[0]),v=parseInt(m[1]),A=f.slice(0);f="",isNaN(v)&&(v=t.indexParameters[m[1]]);for(var M=E;M<v;M++)t.supportsUniformBuffers||(A=A.replace(/light\{X\}.(\w*)/g,function(P,S){return S+"{X}"})),f+=A.replace(/\{X\}/g,M.toString())+`
`}else t.supportsUniformBuffers||(f=f.replace(/light\{X\}.(\w*)/g,function(P,S){return S+"{X}"})),f=f.replace(/\{X\}/g,g)}o=o.replace(s[0],f),u=u||f.indexOf("#include<")>=0}else{var C=t.shadersRepository+"ShadersInclude/"+l+".fx";r._FileToolsLoadFile(C,function(P){t.includesShadersStore[l]=P,n._ProcessIncludes(o,t,i)});return}s=a.exec(e)}u?this._ProcessIncludes(o.toString(),t,i):i(o)},r._FileToolsLoadFile=function(e,t,i,n,a,s){throw O.WarnImport("FileTools")},r}(),w=function(){function r(e,t,i,n,a,s,o,u,l,f){var h=this;n===void 0&&(n=null),s===void 0&&(s=null),o===void 0&&(o=null),u===void 0&&(u=null),l===void 0&&(l=null);var c;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new D,this.onErrorObservable=new D,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._multiTarget=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._pipelineContext=null,this._valueCache={},this.name=e;var p=null;if(t.attributes){var d=t;if(this._engine=i,this._attributesNames=d.attributes,this._uniformsNames=d.uniformsNames.concat(d.samplers),this._samplerList=d.samplers.slice(),this.defines=d.defines,this.onError=d.onError,this.onCompiled=d.onCompiled,this._fallbacks=d.fallbacks,this._indexParameters=d.indexParameters,this._transformFeedbackVaryings=d.transformFeedbackVaryings||null,this._multiTarget=!!d.multiTarget,d.uniformBuffersNames){this._uniformBuffersNamesList=d.uniformBuffersNames.slice();for(var g=0;g<d.uniformBuffersNames.length;g++)this._uniformBuffersNames[d.uniformBuffersNames[g]]=g}p=(c=d.processFinalCode)!==null&&c!==void 0?c:null}else this._engine=a,this.defines=s==null?"":s,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this.onError=l,this.onCompiled=u,this._indexParameters=f,this._fallbacks=o;this._attributeLocationByName={},this.uniqueId=r._uniqueIdSeed++;var m,E,v=oe.IsWindowObjectExist()?this._engine.getHostDocument():null;e.vertexSource?m="source:"+e.vertexSource:e.vertexElement?(m=v?v.getElementById(e.vertexElement):null,m||(m=e.vertexElement)):m=e.vertex||e,e.fragmentSource?E="source:"+e.fragmentSource:e.fragmentElement?(E=v?v.getElementById(e.fragmentElement):null,E||(E=e.fragmentElement)):E=e.fragment||e;var A={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:r.ShadersRepository,includesShadersStore:r.IncludesShadersStore,version:(this._engine.webGLVersion*100).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(m,"Vertex","",function(M){h._rawVertexSourceCode=M,h._loadShader(E,"Fragment","Pixel",function(C){h._rawFragmentSourceCode=C,Kt.Process(M,A,function(P){p&&(P=p("vertex",P)),A.isFragment=!0,Kt.Process(C,A,function(S){p&&(S=p("fragment",S)),h._useFinalCode(P,S,e)},h._engine)},h._engine)})})}return Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new D),this._onBindObservable},enumerable:!1,configurable:!0}),r.prototype._useFinalCode=function(e,t,i){if(i){var n=i.vertexElement||i.vertex||i.spectorName||i,a=i.fragmentElement||i.fragment||i.spectorName||i;this._vertexSourceCode="#define SHADER_NAME vertex:"+n+`
`+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+a+`
`+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(r.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),r.prototype.isReady=function(){try{return this._isReadyInternal()}catch{return!1}},r.prototype._isReadyInternal=function(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1},r.prototype.getEngine=function(){return this._engine},r.prototype.getPipelineContext=function(){return this._pipelineContext},r.prototype.getAttributesNames=function(){return this._attributesNames},r.prototype.getAttributeLocation=function(e){return this._attributes[e]},r.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},r.prototype.getAttributesCount=function(){return this._attributes.length},r.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},r.prototype.getUniform=function(e){return this._uniforms[e]},r.prototype.getSamplers=function(){return this._samplerList},r.prototype.getUniformNames=function(){return this._uniformsNames},r.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},r.prototype.getIndexParameters=function(){return this._indexParameters},r.prototype.getCompilationError=function(){return this._compilationError},r.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},r.prototype.executeWhenCompiled=function(e){var t=this;if(this.isReady()){e(this);return}this.onCompileObservable.add(function(i){e(i)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(function(){t._checkIsReady(null)},16)},r.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(i){this._processCompilationErrors(i,e);return}setTimeout(function(){t._checkIsReady(e)},16)},r.prototype._loadShader=function(e,t,i,n){if(typeof HTMLElement!="undefined"&&e instanceof HTMLElement){var a=oe.GetDOMTextContent(e);n(a);return}if(e.substr(0,7)==="source:"){n(e.substr(7));return}if(e.substr(0,7)==="base64:"){var s=window.atob(e.substr(7));n(s);return}if(r.ShadersStore[e+t+"Shader"]){n(r.ShadersStore[e+t+"Shader"]);return}if(i&&r.ShadersStore[e+i+"Shader"]){n(r.ShadersStore[e+i+"Shader"]);return}var o;e[0]==="."||e[0]==="/"||e.indexOf("http")>-1?o=e:o=r.ShadersRepository+e,this._engine._loadFile(o+"."+t.toLowerCase()+".fx",n)},Object.defineProperty(r.prototype,"vertexSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fragmentSourceCode",{get:function(){return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),r.prototype._rebuildProgram=function(e,t,i,n){var a=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(s,o){n&&n(o)},this.onCompiled=function(){var s=a.getEngine().scenes;if(s)for(var o=0;o<s.length;o++)s[o].markAllMaterialsAsDirty(63);a._pipelineContext._handlesSpectorRebuildCallback(i)},this._fallbacks=null,this._prepareEffect()},r.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,i=this.defines;this._valueCache={};var n=this._pipelineContext;try{var a=this._engine;this._pipelineContext=a.createPipelineContext();var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?a._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,s,null,this._transformFeedbackVaryings):a._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,s,i,this._transformFeedbackVaryings),a._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(a.supportsUniformBuffers)for(var o in e._uniformBuffersNames)e.bindUniformBlock(o,e._uniformBuffersNames[o]);var u=a.getUniforms(e._pipelineContext,e._uniformsNames);if(u.forEach(function(p,d){e._uniforms[e._uniformsNames[d]]=p}),e._attributes=a.getAttributes(e._pipelineContext,t),t)for(var l=0;l<t.length;l++){var f=t[l];e._attributeLocationByName[f]=e._attributes[l]}var h;for(h=0;h<e._samplerList.length;h++){var c=e.getUniform(e._samplerList[h]);c==null&&(e._samplerList.splice(h,1),h--)}e._samplerList.forEach(function(p,d){e._samplers[p]=d}),a.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),n&&e.getEngine()._deletePipelineContext(n)}),this._pipelineContext.isAsync&&this._checkIsReady(n)}catch(o){this._processCompilationErrors(o,n)}},r.prototype._getShaderCodeAndErrorLine=function(e,t,i){var n=i?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,a=null;if(t&&e){var s=t.match(n);if(s&&s.length===2){var o=parseInt(s[1]),u=e.split(`
`,-1);u.length>=o&&(a="Offending line ["+o+"] in "+(i?"fragment":"vertex")+" code: "+u[o-1])}}return[e,a]},r.prototype._processCompilationErrors=function(e,t){var i,n,a,s,o;t===void 0&&(t=null),this._compilationError=e.message;var u=this._attributesNames,l=this._fallbacks;if(L.Error("Unable to compile effect:"),L.Error("Uniforms: "+this._uniformsNames.map(function(p){return" "+p})),L.Error("Attributes: "+u.map(function(p){return" "+p})),L.Error(`Defines:\r
`+this.defines),r.LogShaderCodeOnCompilationError){var f=null,h=null,c=null;((a=this._pipelineContext)===null||a===void 0?void 0:a._getVertexShaderCode())&&(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),c=i[0],f=i[1],c&&(L.Error("Vertex code:"),L.Error(c))),((s=this._pipelineContext)===null||s===void 0?void 0:s._getFragmentShaderCode())&&(n=this._getShaderCodeAndErrorLine((o=this._pipelineContext)===null||o===void 0?void 0:o._getFragmentShaderCode(),this._compilationError,!0),c=n[0],h=n[1],c&&(L.Error("Fragment code:"),L.Error(c))),f&&L.Error(f),h&&L.Error(h)}L.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),l?(this._pipelineContext=null,l.hasMoreFallbacks?(this._allFallbacksProcessed=!1,L.Error("Trying next fallback."),this.defines=l.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(r.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),r.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},r.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},r.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},r.prototype.setTextureArray=function(e,t){var i=e+"Ex";if(this._samplerList.indexOf(i+"0")===-1){for(var n=this._samplerList.indexOf(e),a=1;a<t.length;a++){var s=i+(a-1).toString();this._samplerList.splice(n+a,0,s)}for(var o=0,u=0,l=this._samplerList;u<l.length;u++){var f=l[u];this._samplers[f]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},r.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},r.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},r.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],n=t.updateFlag;return i!==void 0&&i===n?!1:(this._valueCache[e]=n,!0)},r.prototype._cacheFloat2=function(e,t,i){var n=this._valueCache[e];if(!n||n.length!==2)return n=[t,i],this._valueCache[e]=n,!0;var a=!1;return n[0]!==t&&(n[0]=t,a=!0),n[1]!==i&&(n[1]=i,a=!0),a},r.prototype._cacheFloat3=function(e,t,i,n){var a=this._valueCache[e];if(!a||a.length!==3)return a=[t,i,n],this._valueCache[e]=a,!0;var s=!1;return a[0]!==t&&(a[0]=t,s=!0),a[1]!==i&&(a[1]=i,s=!0),a[2]!==n&&(a[2]=n,s=!0),s},r.prototype._cacheFloat4=function(e,t,i,n,a){var s=this._valueCache[e];if(!s||s.length!==4)return s=[t,i,n,a],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==i&&(s[1]=i,o=!0),s[2]!==n&&(s[2]=n,o=!0),s[3]!==a&&(s[3]=a,o=!0),o},r.prototype.bindUniformBuffer=function(e,t){var i=this._uniformBuffersNames[t];i===void 0||r._baseCache[i]===e||(r._baseCache[i]=e,this._engine.bindUniformBufferBase(e,i))},r.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},r.prototype.setInt=function(e,t){var i=this._valueCache[e];return i!==void 0&&i===t?this:(this._engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t),this)},r.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},r.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},r.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},r.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},r.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},r.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},r.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},r.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},r.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},r.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},r.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},r.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},r.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},r.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&(this._engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null)),this},r.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},r.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},r.prototype.setFloat=function(e,t){var i=this._valueCache[e];return i!==void 0&&i===t?this:(this._engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t),this)},r.prototype.setBool=function(e,t){var i=this._valueCache[e];return i!==void 0&&i===t?this:(this._engine.setInt(this._uniforms[e],t?1:0)&&(this._valueCache[e]=t),this)},r.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&(this._engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null)),this},r.prototype.setFloat2=function(e,t,i){return this._cacheFloat2(e,t,i)&&(this._engine.setFloat2(this._uniforms[e],t,i)||(this._valueCache[e]=null)),this},r.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&(this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null)),this},r.prototype.setFloat3=function(e,t,i,n){return this._cacheFloat3(e,t,i,n)&&(this._engine.setFloat3(this._uniforms[e],t,i,n)||(this._valueCache[e]=null)),this},r.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null)),this},r.prototype.setFloat4=function(e,t,i,n,a){return this._cacheFloat4(e,t,i,n,a)&&(this._engine.setFloat4(this._uniforms[e],t,i,n,a)||(this._valueCache[e]=null)),this},r.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&(this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null)),this},r.prototype.setColor4=function(e,t,i){return this._cacheFloat4(e,t.r,t.g,t.b,i)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,i)||(this._valueCache[e]=null)),this},r.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null)),this},r.prototype.dispose=function(){this._engine._releaseEffect(this)},r.RegisterShader=function(e,t,i){t&&(r.ShadersStore[e+"PixelShader"]=t),i&&(r.ShadersStore[e+"VertexShader"]=i)},r.ResetCache=function(){r._baseCache={}},r.ShadersRepository="src/Shaders/",r.LogShaderCodeOnCompilationError=!0,r._uniqueIdSeed=0,r._baseCache={},r.ShadersStore={},r.IncludesShadersStore={},r}(),Hi=function(){function r(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},r}(),Ki=function(){function r(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=r.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=r.KEEP,this._stencilOpDepthFail=r.KEEP,this._stencilOpStencilDepthPass=r.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},r.prototype.apply=function(e){!this.isDirty||(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r}(),ji=function(){function r(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),r.prototype.setAlphaBlendConstants=function(e,t,i,n){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===i&&this._blendConstants[3]===n||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=i,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)},r.prototype.setAlphaBlendFunctionParameters=function(e,t,i,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},r.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},r.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},r.prototype.apply=function(e){!this.isDirty||(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},r}(),Yi=function(){function r(){}return r}(),me;(function(r){r[r.Unknown=0]="Unknown",r[r.Url=1]="Url",r[r.Temp=2]="Temp",r[r.Raw=3]="Raw",r[r.Dynamic=4]="Dynamic",r[r.RenderTarget=5]="RenderTarget",r[r.MultiRenderTarget=6]="MultiRenderTarget",r[r.Cube=7]="Cube",r[r.CubeRaw=8]="CubeRaw",r[r.CubePrefiltered=9]="CubePrefiltered",r[r.Raw3D=10]="Raw3D",r[r.Raw2DArray=11]="Raw2DArray",r[r.Depth=12]="Depth",r[r.CubeRawRGBD=13]="CubeRawRGBD"})(me||(me={}));var ui=function(){function r(e,t,i){i===void 0&&(i=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new D,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=me.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._gammaSpace=null,this._engine=e,this._source=t,i||(this._webGLTexture=e._createTexture())}return r.prototype.getEngine=function(){return this._engine},Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),r.prototype.incrementReferences=function(){this._references++},r.prototype.updateSize=function(e,t,i){i===void 0&&(i=1),this.width=e,this.height=t,this.depth=i,this.baseWidth=e,this.baseHeight=t,this.baseDepth=i,this._size=e*t*i},r.prototype._rebuild=function(){var e=this,t,i;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case me.Temp:return;case me.Url:i=this._engine.createTexture((t=this._originalUrl)!==null&&t!==void 0?t:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){i._swapAndDie(e),e.isReady=!0},null,this._buffer,void 0,this.format);return;case me.Raw:i=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case me.Raw3D:i=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case me.Raw2DArray:i=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case me.Dynamic:i=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),i._swapAndDie(this),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);return;case me.RenderTarget:var n=new Yi;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)i=this._engine.createRenderTargetCubeTexture(this.width,n);else{var a={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};i=this._engine.createRenderTargetTexture(a,n)}i._swapAndDie(this),this.isReady=!0;return;case me.Depth:var s={bilinearFiltering:this.samplingMode!==2,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},o={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};i=this._engine.createDepthStencilTexture(o,s),i._swapAndDie(this),this.isReady=!0;return;case me.Cube:i=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){i._swapAndDie(e),e.isReady=!0},null,this.format,this._extension);return;case me.CubeRaw:i=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),i._swapAndDie(this),this.isReady=!0;return;case me.CubeRawRGBD:i=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),r._UpdateRGBDAsync(i,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){i._swapAndDie(e),e.isReady=!0});return;case me.CubePrefiltered:i=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(u){u&&u._swapAndDie(e),e.isReady=!0},null,this.format,this._extension),i._sphericalPolynomial=this._sphericalPolynomial;return}},r.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t=this._engine.getLoadedTexturesCache(),i=t.indexOf(this);i!==-1&&t.splice(i,1);var i=t.indexOf(e);i===-1&&t.push(e)},r.prototype.dispose=function(){!this._webGLTexture||(this._references--,this._references===0&&(this._engine._releaseTexture(this),this._webGLTexture=null))},r._UpdateRGBDAsync=function(e,t,i,n,a){throw O.WarnImport("environmentTextureTools")},r}(),qi=function(){function r(){}return r.prototype.postProcessor=function(e,t,i,n){if(!n.getCaps().drawBuffersExtension){var a=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;e=e.replace(a,"")}return e},r}(),Qi=function(){function r(){}return r.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},r.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},r.prototype.postProcessor=function(e,t,i){var n=e.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,a=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(e=e.replace(a,""),e=e.replace(/texture2D\s*\(/g,"texture("),i)e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),e=e.replace(/textureCube\s*\(/g,"texture("),e=e.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),e=e.replace(/gl_FragColor/g,"glFragColor"),e=e.replace(/gl_FragData/g,"glFragData"),e=e.replace(/void\s+?main\s*\(/g,(n?"":`out vec4 glFragColor;
`)+"void main(");else{var s=t.indexOf("#define MULTIVIEW")!==-1;if(s)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+e}return e},r}(),Zi=function(){function r(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(r.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),r}(),dt=function(r){N(e,r);function e(t){var i=r.call(this)||this;return i._buffer=t,i}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),e}(Zi),$i=function(){function r(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(r.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isReady",{get:function(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1},enumerable:!1,configurable:!0}),r.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},r.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},r.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},r}(),It=function(){function r(){}return r.CreateCanvas=function(e,t){if(typeof document=="undefined")return new OffscreenCanvas(e,t);var i=document.createElement("canvas");return i.width=e,i.height=t,i},r}(),qe=function(){function r(){}return r.SetMatrixPrecision=function(e){if(r.MatrixTrackPrecisionChange=!1,e&&!r.MatrixUse64Bits&&r.MatrixTrackedMatrices)for(var t=0;t<r.MatrixTrackedMatrices.length;++t){var i=r.MatrixTrackedMatrices[t],n=i._m;i._m=new Array(16);for(var a=0;a<16;++a)i._m[a]=n[a]}r.MatrixUse64Bits=e,r.MatrixCurrentType=r.MatrixUse64Bits?Array:Float32Array,r.MatrixTrackedMatrices=null},r.MatrixUse64Bits=!1,r.MatrixTrackPrecisionChange=!0,r.MatrixCurrentType=Float32Array,r.MatrixTrackedMatrices=[],r}(),Ji=function(){function r(){}return r}(),pe=function(){function r(e,t,i,n){var a=this;n===void 0&&(n=!1),this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new D,this.onContextRestoredObservable=new D,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new Hi,this._stencilState=new Ki,this._alphaState=new ji,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new D,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(X,V,re,j,F,B){var K=a._gl,ie=K.createRenderbuffer();return K.bindRenderbuffer(K.RENDERBUFFER,ie),re>1&&K.renderbufferStorageMultisample?K.renderbufferStorageMultisample(K.RENDERBUFFER,re,F,X,V):K.renderbufferStorage(K.RENDERBUFFER,j,X,V),K.framebufferRenderbuffer(K.FRAMEBUFFER,B,K.RENDERBUFFER,ie),K.bindRenderbuffer(K.RENDERBUFFER,null),ie},this._boundUniforms={};var s=null;if(!!e){if(i=i||{},qe.SetMatrixPrecision(!!i.useHighPrecisionMatrix),e.getContext){if(s=e,this._renderingCanvas=s,t!=null&&(i.antialias=t),i.deterministicLockstep===void 0&&(i.deterministicLockstep=!1),i.lockstepMaxSteps===void 0&&(i.lockstepMaxSteps=4),i.timeStep===void 0&&(i.timeStep=1/60),i.preserveDrawingBuffer===void 0&&(i.preserveDrawingBuffer=!1),i.audioEngine===void 0&&(i.audioEngine=!0),i.stencil===void 0&&(i.stencil=!0),i.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),i.xrCompatible===void 0&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){var o=navigator.userAgent;this.hostInformation.isMobile=o.indexOf("Mobile")!==-1;for(var u=0,l=r.ExceptionList;u<l.length;u++){var f=l[u],h=f.key,c=f.targets,p=new RegExp(h);if(p.test(o)){if(f.capture&&f.captureConstraint){var d=f.capture,g=f.captureConstraint,m=new RegExp(d),E=m.exec(o);if(E&&E.length>0){var v=parseInt(E[E.length-1]);if(v>=g)continue}}for(var A=0,M=c;A<M.length;A++){var C=M[A];switch(C){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(X){X.preventDefault(),a._contextWasLost=!0,L.Warn("WebGL context lost."),a.onContextLostObservable.notifyObservers(a)},this._onContextRestored=function(){setTimeout(function(){a._initGLContext(),a._rebuildEffects(),a._rebuildInternalTextures(),a._rebuildBuffers(),a.wipeCaches(!0),L.Warn("WebGL context successfully restored."),a.onContextRestoredObservable.notifyObservers(a),a._contextWasLost=!1},0)},s.addEventListener("webglcontextlost",this._onContextLost,!1),s.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=s.getContext("webgl2",i)||s.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch{}if(!this._gl){if(!s)throw new Error("The provided canvas is null or undefined.");try{this._gl=s.getContext("webgl",i)||s.getContext("experimental-webgl",i)}catch{throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=e,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var P=this._gl.getContextAttributes();P&&(i.stencil=P.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),i.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var S=oe.IsWindowObjectExist()&&window.devicePixelRatio||1,x=i.limitDeviceRatio||S;this._hardwareScalingLevel=n?1/Math.min(x,S):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext();for(var z=0;z<this._caps.maxVertexAttribs;z++)this._currentBufferPointers[z]=new Ji;this.webGLVersion>1?this._shaderProcessor=new Qi:this._shaderProcessor=new qi,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+r.Version+" - "+this.description)}}return Object.defineProperty(r,"NpmPackage",{get:function(){return"babylonjs@4.2.1"},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Version",{get:function(){return"4.2.1"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ShadersRepository",{get:function(){return w.ShadersRepository},set:function(e){w.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),r.prototype._rebuildInternalTextures=function(){for(var e=this._internalTexturesCache.slice(),t=0,i=e;t<i.length;t++){var n=i[t];n._rebuild()}},r.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._prepareEffect()}w.ResetCache()},r.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];if(!t.isReady())return!1}return!0},r.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){var i=t[e];i._rebuild()}},r.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(e!=null&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(t!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++)this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=t["COLOR_ATTACHMENT"+i+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");n!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var a=this._gl.getExtension("OES_vertex_array_object");a!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=a.createVertexArrayOES.bind(a),this._gl.bindVertexArray=a.bindVertexArrayOES.bind(a),this._gl.deleteVertexArray=a.deleteVertexArrayOES.bind(a))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");s!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),u=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&u&&(this._caps.highPrecisionShaderSupported=o.precision!==0&&u.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var l=this._gl.getExtension("EXT_blend_minmax");l!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=l.MAX_EXT,this._gl.MIN=l.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var f=0;f<this._maxSimultaneousTextures;f++)this._nextFreeTextureSlots.push(f)},Object.defineProperty(r.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(r.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),r.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=It.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},r.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)!this._boundTexturesCache.hasOwnProperty(e)||(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},r.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},r.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},r.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},r.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},r.prototype.getCaps=function(){return this._caps},r.prototype.stopRenderLoop=function(e){if(!e){this._activeRenderLoops=[];return}var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},r.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){var i=this._activeRenderLoops[t];i()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},r.prototype.getRenderingCanvas=function(){return this._renderingCanvas},r.prototype.getHostWindow=function(){return oe.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},r.prototype.getRenderWidth=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},r.prototype.getRenderHeight=function(e){return e===void 0&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},r.prototype._queueNewFrame=function(e,t){return r.QueueNewFrame(e,t)},r.prototype.runRenderLoop=function(e){this._activeRenderLoops.indexOf(e)===-1&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},r.prototype.clear=function(e,t,i,n){n===void 0&&(n=!1),this.applyStates();var a=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,e.a!==void 0?e.a:1),a|=this._gl.COLOR_BUFFER_BIT),i&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),a|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),a|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(a)},r.prototype._viewport=function(e,t,i,n){(e!==this._viewportCached.x||t!==this._viewportCached.y||i!==this._viewportCached.z||n!==this._viewportCached.w)&&(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=i,this._viewportCached.w=n,this._gl.viewport(e,t,i,n))},r.prototype.setViewport=function(e,t,i){var n=t||this.getRenderWidth(),a=i||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*n,o*a,n*e.width,a*e.height)},r.prototype.beginFrame=function(){},r.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},r.prototype.resize=function(){var e,t;oe.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},r.prototype.setSize=function(e,t){return!this._renderingCanvas||(e=e|0,t=t|0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t)?!1:(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0)},r.prototype.bindFramebuffer=function(e,t,i,n,a,s,o){t===void 0&&(t=0),s===void 0&&(s=0),o===void 0&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var u=this._gl;e.is2DArray?u.framebufferTextureLayer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,e._webGLTexture,s,o):e.isCube&&u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,s);var l=e._depthStencilTexture;if(l){var f=l._generateStencilBuffer?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT;e.is2DArray?u.framebufferTextureLayer(u.FRAMEBUFFER,f,l._webGLTexture,s,o):e.isCube?u.framebufferTexture2D(u.FRAMEBUFFER,f,u.TEXTURE_CUBE_MAP_POSITIVE_X+t,l._webGLTexture,s):u.framebufferTexture2D(u.FRAMEBUFFER,f,u.TEXTURE_2D,l._webGLTexture,s)}this._cachedViewport&&!a?this.setViewport(this._cachedViewport,i,n):(i||(i=e.width,s&&(i=i/Math.pow(2,s))),n||(n=e.height,s&&(n=n/Math.pow(2,s))),this._viewport(0,0,i,n)),this.wipeCaches()},r.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},r.prototype.unBindFramebuffer=function(e,t,i){t===void 0&&(t=!1),this._currentRenderTarget=null;var n=this._gl;if(e._MSAAFramebuffer){if(e._textureArray){this.unBindMultiColorAttachmentFramebuffer(e._textureArray,t,i);return}n.bindFramebuffer(n.READ_FRAMEBUFFER,e._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,e._framebuffer),n.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,n.COLOR_BUFFER_BIT,n.NEAREST)}e.generateMipMaps&&!t&&!e.isCube&&(this._bindTextureDirectly(n.TEXTURE_2D,e,!0),n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null)),i&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),i()),this._bindUnboundFramebuffer(null)},r.prototype.flushFramebuffer=function(){this._gl.flush()},r.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},r.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},r.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},r.prototype._createVertexBuffer=function(e,t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create vertex buffer");var n=new dt(i);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},r.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},r.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},r.prototype.createIndexBuffer=function(e,t){var i=this._gl.createBuffer(),n=new dt(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);var a=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,a,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=a.BYTES_PER_ELEMENT===4,n},r.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},r.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},r.prototype.bindUniformBlock=function(e,t,i){var n=e.program,a=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,a,i)},r.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},r.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},r.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},r.prototype._vertexAttribPointer=function(e,t,i,n,a,s,o){var u=this._currentBufferPointers[t];if(!!u){var l=!1;u.active?(u.buffer!==e&&(u.buffer=e,l=!0),u.size!==i&&(u.size=i,l=!0),u.type!==n&&(u.type=n,l=!0),u.normalized!==a&&(u.normalized=a,l=!0),u.stride!==s&&(u.stride=s,l=!0),u.offset!==o&&(u.offset=o,l=!0)):(l=!0,u.active=!0,u.index=t,u.size=i,u.type=n,u.normalized=a,u.stride=s,u.offset=o,u.buffer=e),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,i,n,a,s,o))}},r.prototype._bindIndexBufferWithCache=function(e){e!=null&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},r.prototype._bindVertexBuffersAttributes=function(e,t){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<i.length;n++){var a=t.getAttributeLocation(n);if(a>=0){var s=e[i[n]];if(!s)continue;this._gl.enableVertexAttribArray(a),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[a]=!0);var o=s.getBuffer();o&&(this._vertexAttribPointer(o,a,s.getSize(),s.type,s.normalized,s.byteStride,s.byteOffset),s.getIsInstanced()&&(this._gl.vertexAttribDivisor(a,s.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(o))))}}},r.prototype.recordVertexArrayObject=function(e,t,i){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},r.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=t!=null&&t.is32Bits,this._mustWipeVertexAttributes=!0)},r.prototype.bindBuffersDirectly=function(e,t,i,n,a){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==a){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=a;var s=a.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,u=0;u<s;u++)if(u<i.length){var l=a.getAttributeLocation(u);l>=0&&(this._gl.enableVertexAttribArray(l),this._vertexAttribArraysEnabled[l]=!0,this._vertexAttribPointer(e,l,i[u],this._gl.FLOAT,!1,n,o)),o+=i[u]*4}}this._bindIndexBufferWithCache(t)},r.prototype._unbindVertexArrayObject=function(){!this._cachedVertexArrayObject||(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},r.prototype.bindBuffers=function(e,t,i){(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i)&&(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i,this._bindVertexBuffersAttributes(e,i)),this._bindIndexBufferWithCache(t)},r.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;t<i;t++){var n=this._currentInstanceBuffers[t];e!=n&&n.references&&(e=n,this.bindArrayBuffer(n));var a=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(a,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},r.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},r.prototype._releaseBuffer=function(e){return e.references--,e.references===0?(this._deleteBuffer(e),!0):!1},r.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},r.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),i[0].index!==void 0)this.bindInstancesBuffer(e,i,!0);else for(var n=0;n<4;n++){var a=i[n];this._vertexAttribArraysEnabled[a]||(this._gl.enableVertexAttribArray(a),this._vertexAttribArraysEnabled[a]=!0),this._vertexAttribPointer(e,a,4,this._gl.FLOAT,!1,64,n*16),this._gl.vertexAttribDivisor(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}},r.prototype.bindInstancesBuffer=function(e,t,i){i===void 0&&(i=!0),this.bindArrayBuffer(e);var n=0;if(i)for(var a=0;a<t.length;a++){var s=t[a];n+=s.attributeSize*4}for(var a=0;a<t.length;a++){var s=t[a];s.index===void 0&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),!(s.index<0)&&(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,n,s.offset),this._gl.vertexAttribDivisor(s.index,s.divisor===void 0?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}},r.prototype.disableInstanceAttributeByName=function(e){if(!!this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},r.prototype.disableInstanceAttribute=function(e){for(var t=!1,i;(i=this._currentInstanceLocations.indexOf(e))!==-1;)this._currentInstanceLocations.splice(i,1),this._currentInstanceBuffers.splice(i,1),t=!0,i=this._currentInstanceLocations.indexOf(e);t&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},r.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},r.prototype.draw=function(e,t,i,n){this.drawElementsType(e?0:1,t,i,n)},r.prototype.drawPointClouds=function(e,t,i){this.drawArraysType(2,e,t,i)},r.prototype.drawUnIndexed=function(e,t,i,n){this.drawArraysType(e?0:1,t,i,n)},r.prototype.drawElementsType=function(e,t,i,n){this.applyStates(),this._reportDrawCall();var a=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(a,i,s,t*o,n):this._gl.drawElements(a,i,s,t*o)},r.prototype.drawArraysType=function(e,t,i,n){this.applyStates(),this._reportDrawCall();var a=this._drawMode(e);n?this._gl.drawArraysInstanced(a,t,i,n):this._gl.drawArrays(a,t,i)},r.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},r.prototype._reportDrawCall=function(){},r.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},r.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},r.prototype.createEffect=function(e,t,i,n,a,s,o,u,l){var f=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,h=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,c=f+"+"+h+"@"+(a||t.defines);if(this._compiledEffects[c]){var p=this._compiledEffects[c];return o&&p.isReady()&&o(p),p}var d=new w(e,t,i,n,this,a,s,o,u,l);return d._key=c,this._compiledEffects[c]=d,d},r._ConcatenateShader=function(e,t,i){return i===void 0&&(i=""),i+(t?t+`
`:"")+e},r.prototype._compileShader=function(e,t,i,n){return this._compileRawShader(r._ConcatenateShader(e,i,n),t)},r.prototype._compileRawShader=function(e,t){var i=this._gl,n=i.createShader(t==="vertex"?i.VERTEX_SHADER:i.FRAGMENT_SHADER);if(!n)throw new Error("Something went wrong while compile the shader.");return i.shaderSource(n,e),i.compileShader(n),n},r.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},r.prototype.createRawShaderProgram=function(e,t,i,n,a){a===void 0&&(a=null),n=n||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(i,"fragment");return this._createShaderProgram(e,s,o,n,a)},r.prototype.createShaderProgram=function(e,t,i,n,a,s){s===void 0&&(s=null),a=a||this._gl;var o=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",u=this._compileShader(t,"vertex",n,o),l=this._compileShader(i,"fragment",n,o);return this._createShaderProgram(e,u,l,a,s)},r.prototype.createPipelineContext=function(){var e=new $i;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},r.prototype._createShaderProgram=function(e,t,i,n,a){var s=n.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return n.attachShader(s,t),n.attachShader(s,i),n.linkProgram(s),e.context=n,e.vertexShader=t,e.fragmentShader=i,e.isParallelCompiled||this._finalizePipelineContext(e),s},r.prototype._finalizePipelineContext=function(e){var t=e.context,i=e.vertexShader,n=e.fragmentShader,a=e.program,s=t.getProgramParameter(a,t.LINK_STATUS);if(!s){if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)){var o=this._gl.getShaderInfoLog(i);if(o)throw e.vertexCompilationError=o,new Error("VERTEX SHADER "+o)}if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)){var o=this._gl.getShaderInfoLog(n);if(o)throw e.fragmentCompilationError=o,new Error("FRAGMENT SHADER "+o)}var u=t.getProgramInfoLog(a);if(u)throw e.programLinkError=u,new Error(u)}if(this.validateShaderPrograms){t.validateProgram(a);var l=t.getProgramParameter(a,t.VALIDATE_STATUS);if(!l){var u=t.getProgramInfoLog(a);if(u)throw e.programValidationError=u,new Error(u)}}t.deleteShader(i),t.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},r.prototype._preparePipelineContext=function(e,t,i,n,a,s,o){var u=e;n?u.program=this.createRawShaderProgram(u,t,i,void 0,o):u.program=this.createShaderProgram(u,t,i,s,void 0,o),u.program.__SPECTOR_rebuildProgram=a},r.prototype._isRenderingStateCompiled=function(e){var t=e;return this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)?(this._finalizePipelineContext(t),!0):!1},r.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var i=e;if(!i.isParallelCompiled){t();return}var n=i.onCompiled;n?i.onCompiled=function(){n(),t()}:i.onCompiled=t},r.prototype.getUniforms=function(e,t){for(var i=new Array,n=e,a=0;a<t.length;a++)i.push(this._gl.getUniformLocation(n.program,t[a]));return i},r.prototype.getAttributes=function(e,t){for(var i=[],n=e,a=0;a<t.length;a++)try{i.push(this._gl.getAttribLocation(n.program,t[a]))}catch{i.push(-1)}return i},r.prototype.enableEffect=function(e){!e||e===this._currentEffect||(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},r.prototype.setInt=function(e,t){return e?(this._gl.uniform1i(e,t),!0):!1},r.prototype.setIntArray=function(e,t){return e?(this._gl.uniform1iv(e,t),!0):!1},r.prototype.setIntArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2iv(e,t),!0)},r.prototype.setIntArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3iv(e,t),!0)},r.prototype.setIntArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4iv(e,t),!0)},r.prototype.setArray=function(e,t){return e?(this._gl.uniform1fv(e,t),!0):!1},r.prototype.setArray2=function(e,t){return!e||t.length%2!==0?!1:(this._gl.uniform2fv(e,t),!0)},r.prototype.setArray3=function(e,t){return!e||t.length%3!==0?!1:(this._gl.uniform3fv(e,t),!0)},r.prototype.setArray4=function(e,t){return!e||t.length%4!==0?!1:(this._gl.uniform4fv(e,t),!0)},r.prototype.setMatrices=function(e,t){return e?(this._gl.uniformMatrix4fv(e,!1,t),!0):!1},r.prototype.setMatrix3x3=function(e,t){return e?(this._gl.uniformMatrix3fv(e,!1,t),!0):!1},r.prototype.setMatrix2x2=function(e,t){return e?(this._gl.uniformMatrix2fv(e,!1,t),!0):!1},r.prototype.setFloat=function(e,t){return e?(this._gl.uniform1f(e,t),!0):!1},r.prototype.setFloat2=function(e,t,i){return e?(this._gl.uniform2f(e,t,i),!0):!1},r.prototype.setFloat3=function(e,t,i,n){return e?(this._gl.uniform3f(e,t,i,n),!0):!1},r.prototype.setFloat4=function(e,t,i,n,a){return e?(this._gl.uniform4f(e,t,i,n,a),!0):!1},r.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},r.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},r.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(r.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),r.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},r.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},r.prototype._getSamplingParameters=function(e,t){var i=this._gl,n=i.NEAREST,a=i.NEAREST;switch(e){case 11:n=i.LINEAR,t?a=i.LINEAR_MIPMAP_NEAREST:a=i.LINEAR;break;case 3:n=i.LINEAR,t?a=i.LINEAR_MIPMAP_LINEAR:a=i.LINEAR;break;case 8:n=i.NEAREST,t?a=i.NEAREST_MIPMAP_LINEAR:a=i.NEAREST;break;case 4:n=i.NEAREST,t?a=i.NEAREST_MIPMAP_NEAREST:a=i.NEAREST;break;case 5:n=i.NEAREST,t?a=i.LINEAR_MIPMAP_NEAREST:a=i.LINEAR;break;case 6:n=i.NEAREST,t?a=i.LINEAR_MIPMAP_LINEAR:a=i.LINEAR;break;case 7:n=i.NEAREST,a=i.LINEAR;break;case 1:n=i.NEAREST,a=i.NEAREST;break;case 9:n=i.LINEAR,t?a=i.NEAREST_MIPMAP_NEAREST:a=i.NEAREST;break;case 10:n=i.LINEAR,t?a=i.NEAREST_MIPMAP_LINEAR:a=i.NEAREST;break;case 2:n=i.LINEAR,a=i.LINEAR;break;case 12:n=i.LINEAR,a=i.NEAREST;break}return{min:a,mag:n}},r.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},r.prototype.createTexture=function(e,t,i,n,a,s,o,u,l,f,h,c,p){var d=this;a===void 0&&(a=3),s===void 0&&(s=null),o===void 0&&(o=null),u===void 0&&(u=null),l===void 0&&(l=null),f===void 0&&(f=null),h===void 0&&(h=null),e=e||"";var g=e.substr(0,5)==="data:",m=e.substr(0,5)==="blob:",E=g&&e.indexOf(";base64,")!==-1,v=l||new ui(this,me.Url),A=e;this._transformTextureUrl&&!E&&!l&&!u&&(e=this._transformTextureUrl(e)),A!==e&&(v._originalUrl=A);var M=e.lastIndexOf("."),C=h||(M>-1?e.substring(M).toLowerCase():""),P=null,S=C.indexOf("?");S>-1&&(C=C.split("?")[0]);for(var x=0,z=r._TextureLoaders;x<z.length;x++){var X=z[x];if(X.canLoad(C,c)){P=X;break}}n&&n._addPendingData(v),v.url=e,v.generateMipMaps=!t,v.samplingMode=a,v.invertY=i,this._doNotHandleContextLost||(v._buffer=u);var V=null;s&&!l&&(V=v.onLoadedObservable.add(s)),l||this._internalTexturesCache.push(v);var re=function(B,K){n&&n._removePendingData(v),e===A?(V&&v.onLoadedObservable.remove(V),de.UseFallbackTexture&&d.createTexture(de.FallbackTexture,t,v.invertY,n,a,null,o,u,v),o&&o((B||"Unknown error")+(de.UseFallbackTexture?" - Fallback texture was used":""),K)):(L.Warn("Failed to load "+e+", falling back to "+A),d.createTexture(A,t,v.invertY,n,a,s,o,u,v,f,h,c,p))};if(P){var j=function(B){P.loadData(B,v,function(K,ie,ge,Q,ve,he){he?re("TextureLoader failed to load data"):d._prepareWebGLTexture(v,n,K,ie,v.invertY,!ge,Q,function(){return ve(),!1},a)},p)};u?u instanceof ArrayBuffer?j(new Uint8Array(u)):ArrayBuffer.isView(u)?j(u):o&&o("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(e,function(B){return j(new Uint8Array(B))},void 0,n?n.offlineProvider:void 0,!0,function(B,K){re("Unable to load "+(B&&B.responseURL,K))})}else{var F=function(B){m&&!d._doNotHandleContextLost&&(v._buffer=B),d._prepareWebGLTexture(v,n,B.width,B.height,v.invertY,t,!1,function(K,ie,ge){var Q=d._gl,ve=B.width===K&&B.height===ie,he=f?d._getInternalFormat(f):C===".jpg"?Q.RGB:Q.RGBA;if(ve)return Q.texImage2D(Q.TEXTURE_2D,0,he,he,Q.UNSIGNED_BYTE,B),!1;var Ge=d._caps.maxTextureSize;if(B.width>Ge||B.height>Ge||!d._supportsHardwareTextureRescaling)return d._prepareWorkingCanvas(),!d._workingCanvas||!d._workingContext||(d._workingCanvas.width=K,d._workingCanvas.height=ie,d._workingContext.drawImage(B,0,0,B.width,B.height,0,0,K,ie),Q.texImage2D(Q.TEXTURE_2D,0,he,he,Q.UNSIGNED_BYTE,d._workingCanvas),v.width=K,v.height=ie),!1;var ke=new ui(d,me.Temp);return d._bindTextureDirectly(Q.TEXTURE_2D,ke,!0),Q.texImage2D(Q.TEXTURE_2D,0,he,he,Q.UNSIGNED_BYTE,B),d._rescaleTexture(ke,v,n,he,function(){d._releaseTexture(ke),d._bindTextureDirectly(Q.TEXTURE_2D,v,!0),ge()}),!0},a)};!g||E?u&&(u.decoding||u.close)?F(u):r._FileToolsLoadImage(e,F,re,n?n.offlineProvider:null,c):typeof u=="string"||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?r._FileToolsLoadImage(u,F,re,n?n.offlineProvider:null,c):u&&F(u)}return v},r._FileToolsLoadImage=function(e,t,i,n,a){throw O.WarnImport("FileTools")},r.prototype._rescaleTexture=function(e,t,i,n,a){},r.prototype.createRawTexture=function(e,t,i,n,a,s,o,u,l){throw O.WarnImport("Engine.RawTexture")},r.prototype.createRawCubeTexture=function(e,t,i,n,a,s,o,u){throw O.WarnImport("Engine.RawTexture")},r.prototype.createRawTexture3D=function(e,t,i,n,a,s,o,u,l,f){throw O.WarnImport("Engine.RawTexture")},r.prototype.createRawTexture2DArray=function(e,t,i,n,a,s,o,u,l,f){throw O.WarnImport("Engine.RawTexture")},r.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},r.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},r.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},r.prototype.updateTextureSamplingMode=function(e,t,i){i===void 0&&(i=!1);var n=this._getTextureTarget(t),a=this._getSamplingParameters(e,t.generateMipMaps||i);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,a.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,a.min),i&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e},r.prototype.updateTextureWrappingMode=function(e,t,i,n){i===void 0&&(i=null),n===void 0&&(n=null);var a=this._getTextureTarget(e);t!==null&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),i!==null&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(i),e),e._cachedWrapV=i),(e.is2DArray||e.is3D)&&n!==null&&(this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(a,null)},r.prototype._setupDepthStencilTexture=function(e,t,i,n,a){var s=t.width||t,o=t.height||t,u=t.layers||0;e.baseWidth=s,e.baseHeight=o,e.width=s,e.height=o,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=i,e.samplingMode=n?2:1,e.type=0,e._comparisonFunction=a;var l=this._gl,f=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);l.texParameteri(f,l.TEXTURE_MAG_FILTER,h.mag),l.texParameteri(f,l.TEXTURE_MIN_FILTER,h.min),l.texParameteri(f,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(f,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),a===0?(l.texParameteri(f,l.TEXTURE_COMPARE_FUNC,515),l.texParameteri(f,l.TEXTURE_COMPARE_MODE,l.NONE)):(l.texParameteri(f,l.TEXTURE_COMPARE_FUNC,a),l.texParameteri(f,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE))},r.prototype._uploadCompressedDataToTextureDirectly=function(e,t,i,n,a,s,o){s===void 0&&(s=0),o===void 0&&(o=0);var u=this._gl,l=u.TEXTURE_2D;e.isCube&&(l=u.TEXTURE_CUBE_MAP_POSITIVE_X+s),this._gl.compressedTexImage2D(l,o,t,i,n,0,a)},r.prototype._uploadDataToTextureDirectly=function(e,t,i,n,a,s){i===void 0&&(i=0),n===void 0&&(n=0),s===void 0&&(s=!1);var o=this._gl,u=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format),f=a===void 0?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(a);this._unpackFlipY(e.invertY);var h=o.TEXTURE_2D;e.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+i);var c=Math.round(Math.log(e.width)*Math.LOG2E),p=Math.round(Math.log(e.height)*Math.LOG2E),d=s?e.width:Math.pow(2,Math.max(c-n,0)),g=s?e.height:Math.pow(2,Math.max(p-n,0));o.texImage2D(h,n,f,d,g,0,l,u,t)},r.prototype.updateTextureData=function(e,t,i,n,a,s,o,u){o===void 0&&(o=0),u===void 0&&(u=0);var l=this._gl,f=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var c=l.TEXTURE_2D;e.isCube&&(c=l.TEXTURE_CUBE_MAP_POSITIVE_X+o),l.texSubImage2D(c,u,i,n,a,s,h,f,t)},r.prototype._uploadArrayBufferViewToTexture=function(e,t,i,n){i===void 0&&(i=0),n===void 0&&(n=0);var a=this._gl,s=e.isCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,i,n),this._bindTextureDirectly(s,null,!0)},r.prototype._prepareWebGLTextureContinuation=function(e,t,i,n,a){var s=this._gl;if(!!s){var o=this._getSamplingParameters(a,!i);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),!i&&!n&&s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},r.prototype._prepareWebGLTexture=function(e,t,i,n,a,s,o,u,l){var f=this;l===void 0&&(l=3);var h=this.getCaps().maxTextureSize,c=Math.min(h,this.needPOTTextures?r.GetExponentOfTwo(i,h):i),p=Math.min(h,this.needPOTTextures?r.GetExponentOfTwo(n,h):n),d=this._gl;if(!!d){if(!e._webGLTexture){t&&t._removePendingData(e);return}this._bindTextureDirectly(d.TEXTURE_2D,e,!0),this._unpackFlipY(a===void 0?!0:!!a),e.baseWidth=i,e.baseHeight=n,e.width=c,e.height=p,e.isReady=!0,!u(c,p,function(){f._prepareWebGLTextureContinuation(e,t,s,o,l)})&&this._prepareWebGLTextureContinuation(e,t,s,o,l)}},r.prototype._setupFramebufferDepthAttachments=function(e,t,i,n,a){a===void 0&&(a=1);var s=this._gl;if(e&&t)return this._getDepthStencilBuffer(i,n,a,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var o=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=s.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(i,n,a,o,o,s.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(i,n,a,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},r.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},r.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);t!==-1&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},r.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},r.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},r.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var i=e.getSamplers(),n=0;n<i.length;n++){var a=e.getUniform(i[n]);a&&(this._boundUniforms[n]=a)}this._currentEffect=null},r.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},r.prototype._bindTextureDirectly=function(e,t,i,n){i===void 0&&(i=!1),n===void 0&&(n=!1);var a=!1,s=t&&t._associatedChannel>-1;i&&s&&(this._activeChannel=t._associatedChannel);var o=this._boundTexturesCache[this._activeChannel];return o!==t||n?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):i&&(a=!0,this._activateCurrentTexture()),s&&!i&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),a},r.prototype._bindTexture=function(e,t){if(e!==void 0){t&&(t._associatedChannel=e),this._activeChannel=e;var i=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(i,t)}},r.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},r.prototype.setTexture=function(e,t,i){e!==void 0&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,i))},r.prototype._bindSamplerUniformToChannel=function(e,t){var i=this._boundUniforms[e];!i||i._currentState===t||(this._gl.uniform1i(i,t),i._currentState=t)},r.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},r.prototype._setTexture=function(e,t,i,n){if(i===void 0&&(i=!1),n===void 0&&(n=!1),!t)return this._boundTexturesCache[e]!=null&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(t.delayLoadState===4)return t.delayLoad(),!1;var a;n?a=t.depthStencilTexture:t.isReady()?a=t.getInternalTexture():t.isCube?a=this.emptyCubeTexture:t.is3D?a=this.emptyTexture3D:t.is2DArray?a=this.emptyTexture2DArray:a=this.emptyTexture,!i&&a&&(a._associatedChannel=e);var s=!0;this._boundTexturesCache[e]===a&&(i||this._bindSamplerUniformToChannel(a._associatedChannel,e),s=!1),this._activeChannel=e;var o=this._getTextureTarget(a);if(s&&this._bindTextureDirectly(o,a,i),a&&!a.isMultiview){if(a.isCube&&a._cachedCoordinatesMode!==t.coordinatesMode){a._cachedCoordinatesMode=t.coordinatesMode;var u=t.coordinatesMode!==3&&t.coordinatesMode!==5?1:0;t.wrapU=u,t.wrapV=u}a._cachedWrapU!==t.wrapU&&(a._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),a)),a._cachedWrapV!==t.wrapV&&(a._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),a)),a.is3D&&a._cachedWrapR!==t.wrapR&&(a._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),a)),this._setAnisotropicLevel(o,a,t.anisotropicFilteringLevel)}return!0},r.prototype.setTextureArray=function(e,t,i){if(!(e===void 0||!t)){(!this._textureUnits||this._textureUnits.length!==i.length)&&(this._textureUnits=new Int32Array(i.length));for(var n=0;n<i.length;n++){var a=i[n].getInternalTexture();a?(this._textureUnits[n]=e+n,a._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var s=0;s<i.length;s++)this._setTexture(this._textureUnits[s],i[s],!0)}},r.prototype._setAnisotropicLevel=function(e,t,i){var n=this._caps.textureAnisotropicFilterExtension;t.samplingMode!==11&&t.samplingMode!==3&&t.samplingMode!==2&&(i=1),n&&t._cachedAnisotropicFilteringLevel!==i&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=i)},r.prototype._setTextureParameterFloat=function(e,t,i,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,i)},r.prototype._setTextureParameterInteger=function(e,t,i,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,i)},r.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e);return}for(var e=0,t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)},r.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},r.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],oe.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,w.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++){var i=t[e];i.abort()}},r.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},r.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},r.prototype.getError=function(){return this._gl.getError()},r.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},r.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},r.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var i=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var a=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,a),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if(i=i&&s===t.FRAMEBUFFER_COMPLETE,i=i&&t.getError()===t.NO_ERROR,i&&(t.clear(t.COLOR_BUFFER_BIT),i=i&&t.getError()===t.NO_ERROR),i){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,u=t.UNSIGNED_BYTE,l=new Uint8Array(4);t.readPixels(0,0,1,1,o,u,l),i=i&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(a),t.bindFramebuffer(t.FRAMEBUFFER,null);!i&&t.getError()!==t.NO_ERROR;);return i},r.prototype._getWebGLTextureType=function(e){if(this._webGLVersion===1){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},r.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA;break}if(this._webGLVersion>1)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER;break}return t},r.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(this._webGLVersion===1){if(t!==void 0)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},r.prototype._getRGBAMultiSampleBufferFormat=function(e){return e===1?this._gl.RGBA32F:e===2?this._gl.RGBA16F:this._gl.RGBA8},r.prototype._loadFile=function(e,t,i,n,a,s){var o=this,u=r._FileToolsLoadFile(e,t,i,n,a,s);return this._activeRequests.push(u),u.onCompleteObservable.add(function(l){o._activeRequests.splice(o._activeRequests.indexOf(l),1)}),u},r._FileToolsLoadFile=function(e,t,i,n,a,s){throw O.WarnImport("FileTools")},r.prototype.readPixels=function(e,t,i,n,a){a===void 0&&(a=!0);var s=a?4:3,o=a?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(n*i*s);return this._gl.readPixels(e,t,i,n,o,this._gl.UNSIGNED_BYTE,u),u},Object.defineProperty(r,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),r.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var e=It.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=t!=null&&!!window.WebGLRenderingContext}catch{this._IsSupported=!1}return this._IsSupported},Object.defineProperty(r,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var e=It.CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch{this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),r.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e},r.FloorPOT=function(e){return e=e|e>>1,e=e|e>>2,e=e|e>>4,e=e|e>>8,e=e|e>>16,e-(e>>1)},r.NearestPOT=function(e){var t=r.CeilingPOT(e),i=r.FloorPOT(e);return t-e>e-i?i:t},r.GetExponentOfTwo=function(e,t,i){i===void 0&&(i=2);var n;switch(i){case 1:n=r.FloorPOT(e);break;case 2:n=r.NearestPOT(e);break;case 3:default:n=r.CeilingPOT(e);break}return Math.min(n,t)},r.QueueNewFrame=function(e,t){return oe.IsWindowObjectExist()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(e):setTimeout(e,16)},r.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},r.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],r._TextureLoaders=[],r.CollisionsEpsilon=.001,r._IsSupported=null,r._HasMajorPerformanceCaveat=null,r}(),li=function(r){N(e,r);function e(t,i){var n=r.call(this,t)||this;return n.name="LoadFileError",rt._setPrototypeOf(n,e.prototype),i instanceof it?n.request=i:n.file=i,n}return e}(rt),er=function(r){N(e,r);function e(t,i){var n=r.call(this,t)||this;return n.request=i,n.name="RequestFileError",rt._setPrototypeOf(n,e.prototype),n}return e}(rt),tr=function(r){N(e,r);function e(t,i){var n=r.call(this,t)||this;return n.file=i,n.name="ReadFileError",rt._setPrototypeOf(n,e.prototype),n}return e}(rt),se=function(){function r(){}return r._CleanUrl=function(e){return e=e.replace(/#/mg,"%23"),e},r.SetCorsBehavior=function(e,t){if(!(e&&e.indexOf("data:")===0)&&r.CorsBehavior)if(typeof r.CorsBehavior=="string"||this.CorsBehavior instanceof String)t.crossOrigin=r.CorsBehavior;else{var i=r.CorsBehavior(e);i&&(t.crossOrigin=i)}},r.LoadImage=function(e,t,i,n,a){a===void 0&&(a="");var s,o=!1;if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)?typeof Blob!="undefined"?(s=URL.createObjectURL(new Blob([e],{type:a})),o=!0):s="data:"+a+";base64,"+De.EncodeArrayBufferToBase64(e):e instanceof Blob?(s=URL.createObjectURL(e),o=!0):(s=r._CleanUrl(e),s=r.PreprocessUrl(e)),typeof Image=="undefined")return r.LoadFile(s,function(g){createImageBitmap(new Blob([g],{type:a})).then(function(m){t(m),o&&URL.revokeObjectURL(s)}).catch(function(m){i&&i("Error while trying to load image: "+e,m)})},void 0,n||void 0,!0,function(g,m){i&&i("Error while trying to load image: "+e,m)}),null;var u=new Image;r.SetCorsBehavior(s,u);var l=function(){u.removeEventListener("load",l),u.removeEventListener("error",f),t(u),o&&u.src&&URL.revokeObjectURL(u.src)},f=function(g){if(u.removeEventListener("load",l),u.removeEventListener("error",f),i){var m=e.toString();i("Error while trying to load image: "+(m.length<32?m:m.slice(0,32)+"..."),g)}o&&u.src&&URL.revokeObjectURL(u.src)};u.addEventListener("load",l),u.addEventListener("error",f);var h=function(){u.src=s},c=function(){n&&n.loadImage(s,u)};if(s.substr(0,5)!=="data:"&&n&&n.enableTexturesOffline)n.open(c,h);else{if(s.indexOf("file:")!==-1){var p=decodeURIComponent(s.substring(5).toLowerCase());if(St.FilesToLoad[p]){try{var d;try{d=URL.createObjectURL(St.FilesToLoad[p])}catch{d=URL.createObjectURL(St.FilesToLoad[p])}u.src=d,o=!0}catch{u.src=""}return u}}h()}return u},r.ReadFile=function(e,t,i,n,a){var s=new FileReader,o={onCompleteObservable:new D,abort:function(){return s.abort()}};return s.onloadend=function(u){return o.onCompleteObservable.notifyObservers(o)},a&&(s.onerror=function(u){a(new tr("Unable to read "+e.name,e))}),s.onload=function(u){t(u.target.result)},i&&(s.onprogress=i),n?s.readAsArrayBuffer(e):s.readAsText(e),o},r.LoadFile=function(e,t,i,n,a,s){if(e.indexOf("file:")!==-1){var o=decodeURIComponent(e.substring(5).toLowerCase());o.indexOf("./")===0&&(o=o.substring(2));var u=St.FilesToLoad[o];if(u)return r.ReadFile(u,t,i,a,s?function(l){return s(void 0,new li(l.message,l.file))}:void 0)}return r.RequestFile(e,function(l,f){t(l,f?f.responseURL:void 0)},i,n,a,s?function(l){s(l.request,new li(l.message,l.request))}:void 0)},r.RequestFile=function(e,t,i,n,a,s,o){e=r._CleanUrl(e),e=r.PreprocessUrl(e);var u=r.BaseUrl+e,l=!1,f={onCompleteObservable:new D,abort:function(){return l=!0}},h=function(){var d=new it,g=null;f.abort=function(){l=!0,d.readyState!==(XMLHttpRequest.DONE||4)&&d.abort(),g!==null&&(clearTimeout(g),g=null)};var m=function(E){d.open("GET",u),o&&o(d),a&&(d.responseType="arraybuffer"),i&&d.addEventListener("progress",i);var v=function(){d.removeEventListener("loadend",v),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};d.addEventListener("loadend",v);var A=function(){if(!l&&d.readyState===(XMLHttpRequest.DONE||4)){if(d.removeEventListener("readystatechange",A),d.status>=200&&d.status<300||d.status===0&&(!oe.IsWindowObjectExist()||r.IsFileURL())){t(a?d.response:d.responseText,d);return}var M=r.DefaultRetryStrategy;if(M){var C=M(u,d,E);if(C!==-1){d.removeEventListener("loadend",v),d=new it,g=setTimeout(function(){return m(E+1)},C);return}}var P=new er("Error status: "+d.status+" "+d.statusText+" - Unable to load "+u,d);s&&s(P)}};d.addEventListener("readystatechange",A),d.send()};m(0)};if(n&&n.enableSceneOffline){var c=function(d){d&&d.status>400?s&&s(d):h()},p=function(){n&&n.loadFile(r.BaseUrl+e,function(d){l||t(d),f.onCompleteObservable.notifyObservers(f)},i?function(d){l||i(d)}:void 0,c,a)};n.open(p,c)}else h();return f},r.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},r.DefaultRetryStrategy=Ui.ExponentialBackoff(),r.BaseUrl="",r.CorsBehavior="anonymous",r.PreprocessUrl=function(e){return e},r}();pe._FileToolsLoadImage=se.LoadImage.bind(se);pe._FileToolsLoadFile=se.LoadFile.bind(se);Kt._FileToolsLoadFile=se.LoadFile.bind(se);var Be;(function(r){r[r.Pending=0]="Pending",r[r.Fulfilled=1]="Fulfilled",r[r.Rejected=2]="Rejected"})(Be||(Be={}));var ir=function(){function r(){this.count=0,this.target=0,this.results=[]}return r}(),rr=function(){function r(e){var t=this;if(this._state=Be.Pending,this._children=new Array,this._rejectWasConsumed=!1,!!e)try{e(function(i){t._resolve(i)},function(i){t._reject(i)})}catch(i){this._reject(i)}}return Object.defineProperty(r.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&this._parent._result===void 0&&(this._parent._result=e)},enumerable:!1,configurable:!0}),r.prototype.catch=function(e){return this.then(void 0,e)},r.prototype.then=function(e,t){var i=this,n=new r;return n._onFulfilled=e,n._onRejected=t,this._children.push(n),n._parent=this,this._state!==Be.Pending&&setTimeout(function(){if(i._state===Be.Fulfilled||i._rejectWasConsumed){var a=n._resolve(i._result);if(a!=null)if(a._state!==void 0){var s=a;n._children.push(s),s._parent=n,n=s}else n._result=a}else n._reject(i._reason)}),n},r.prototype._moveChildren=function(e){var t,i=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach(function(l){l._parent=i}),this._state===Be.Fulfilled)for(var n=0,a=this._children;n<a.length;n++){var s=a[n];s._resolve(this._result)}else if(this._state===Be.Rejected)for(var o=0,u=this._children;o<u.length;o++){var s=u[o];s._reject(this._reason)}},r.prototype._resolve=function(e){try{this._state=Be.Fulfilled;var t=null;if(this._onFulfilled&&(t=this._onFulfilled(e)),t!=null)if(t._state!==void 0){var i=t;i._parent=this,i._moveChildren(this._children),e=i._result}else e=t;this._result=e;for(var n=0,a=this._children;n<a.length;n++){var s=a[n];s._resolve(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(o){this._reject(o,!0)}},r.prototype._reject=function(e,t){if(t===void 0&&(t=!1),this._state=Be.Rejected,this._reason=e,this._onRejected&&!t)try{this._onRejected(e),this._rejectWasConsumed=!0}catch(s){e=s}for(var i=0,n=this._children;i<n.length;i++){var a=n[i];this._rejectWasConsumed?a._resolve(null):a._reject(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},r.resolve=function(e){var t=new r;return t._resolve(e),t},r._RegisterForFulfillment=function(e,t,i){e.then(function(n){return t.results[i]=n,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null},function(n){t.rootPromise._state!==Be.Rejected&&t.rootPromise._reject(n)})},r.all=function(e){var t=new r,i=new ir;if(i.target=e.length,i.rootPromise=t,e.length)for(var n=0;n<e.length;n++)r._RegisterForFulfillment(e[n],i,n);else t._resolve([]);return t},r.race=function(e){var t=new r;if(e.length)for(var i=0,n=e;i<n.length;i++){var a=n[i];a.then(function(s){return t&&(t._resolve(s),t=null),null},function(s){t&&(t._reject(s),t=null)})}return t},r}(),nr=function(){function r(){}return r.Apply=function(e){if(e===void 0&&(e=!1),e||typeof Promise=="undefined"){var t=window;t.Promise=rr}},r}(),jt=function(){function r(){}return r.SetImmediate=function(e){oe.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},r}(),_e=function(){function r(){}return r.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},r.RegisteredTypes={},r}(),Dt=function(){function r(){}return r.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=_e.GetClass(e);if(t)return t;L.Warn(e+" not found, you may have missed an import.");for(var i=e.split("."),n=window||this,a=0,s=i.length;a<s;a++)n=n[i[a]];return typeof n!="function"?null:n},r.RegisteredExternalClasses={},r}(),Ti=function(){function r(){}return r.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,i=e==="x"?t:t&3|8;return i.toString(16)})},r}(),te=function(){function r(){}return Object.defineProperty(r,"BaseUrl",{get:function(){return se.BaseUrl},set:function(e){se.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"DefaultRetryStrategy",{get:function(){return se.DefaultRetryStrategy},set:function(e){se.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"CorsBehavior",{get:function(){return se.CorsBehavior},set:function(e){se.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"UseFallbackTexture",{get:function(){return de.UseFallbackTexture},set:function(e){de.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RegisteredExternalClasses",{get:function(){return Dt.RegisteredExternalClasses},set:function(e){Dt.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"fallbackTexture",{get:function(){return de.FallbackTexture},set:function(e){de.FallbackTexture=e},enumerable:!1,configurable:!0}),r.FetchToRef=function(e,t,i,n,a,s){var o=Math.abs(e)*i%i|0,u=Math.abs(t)*n%n|0,l=(o+u*i)*4;s.r=a[l]/255,s.g=a[l+1]/255,s.b=a[l+2]/255,s.a=a[l+3]/255},r.Mix=function(e,t,i){return e*(1-i)+t*i},r.Instantiate=function(e){return Dt.Instantiate(e)},r.Slice=function(e,t,i){return e.slice?e.slice(t,i):Array.prototype.slice.call(e,t,i)},r.SliceToArray=function(e,t,i){return Array.isArray(e)?e.slice(t,i):Array.prototype.slice.call(e,t,i)},r.SetImmediate=function(e){jt.SetImmediate(e)},r.IsExponentOfTwo=function(e){var t=1;do t*=2;while(t<e);return t===e},r.FloatRound=function(e){return Math.fround?Math.fround(e):r._tmpFloatArray[0]=e},r.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},r.GetFolderPath=function(e,t){t===void 0&&(t=!1);var i=e.lastIndexOf("/");return i<0?t?e:"":e.substring(0,i+1)},r.ToDegrees=function(e){return e*180/Math.PI},r.ToRadians=function(e){return e*Math.PI/180},r.MakeArray=function(e,t){return t!==!0&&(e===void 0||e==null)?null:Array.isArray(e)?e:[e]},r.GetPointerPrefix=function(e){var t="pointer";return oe.IsWindowObjectExist()&&!window.PointerEvent&&oe.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(t="mouse"),e._badDesktopOS&&!e._badOS&&!(document&&"ontouchend"in document)&&(t="mouse"),t},r.SetCorsBehavior=function(e,t){se.SetCorsBehavior(e,t)},r.CleanUrl=function(e){return e=e.replace(/#/gm,"%23"),e},Object.defineProperty(r,"PreprocessUrl",{get:function(){return se.PreprocessUrl},set:function(e){se.PreprocessUrl=e},enumerable:!1,configurable:!0}),r.LoadImage=function(e,t,i,n,a){return se.LoadImage(e,t,i,n,a)},r.LoadFile=function(e,t,i,n,a,s){return se.LoadFile(e,t,i,n,a,s)},r.LoadFileAsync=function(e,t){return t===void 0&&(t=!0),new Promise(function(i,n){se.LoadFile(e,function(a){i(a)},void 0,void 0,t,function(a,s){n(s)})})},r.LoadScript=function(e,t,i,n){if(!!oe.IsWindowObjectExist()){var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),n&&(s.id=n),s.onload=function(){t&&t()},s.onerror=function(o){i&&i("Unable to load script '"+e+"'",o)},a.appendChild(s)}},r.LoadScriptAsync=function(e,t){var i=this;return new Promise(function(n,a){i.LoadScript(e,function(){n()},function(s,o){a(o)})})},r.ReadFileAsDataURL=function(e,t,i){var n=new FileReader,a={onCompleteObservable:new D,abort:function(){return n.abort()}};return n.onloadend=function(s){a.onCompleteObservable.notifyObservers(a)},n.onload=function(s){t(s.target.result)},n.onprogress=i,n.readAsDataURL(e),a},r.ReadFile=function(e,t,i,n,a){return se.ReadFile(e,t,i,n,a)},r.FileAsURL=function(e){var t=new Blob([e]),i=window.URL||window.webkitURL,n=i.createObjectURL(t);return n},r.Format=function(e,t){return t===void 0&&(t=2),e.toFixed(t)},r.DeepCopy=function(e,t,i,n){ii.DeepCopy(e,t,i,n)},r.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},r.RegisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];e.addEventListener(n.name,n.handler,!1);try{window.parent&&window.parent.addEventListener(n.name,n.handler,!1)}catch{}}},r.UnregisterTopRootEvents=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];e.removeEventListener(n.name,n.handler);try{e.parent&&e.parent.removeEventListener(n.name,n.handler)}catch{}}},r.DumpFramebuffer=function(e,t,i,n,a,s){a===void 0&&(a="image/png");for(var o=e*4,u=t/2,l=i.readPixels(0,0,e,t),f=0;f<u;f++)for(var h=0;h<o;h++){var c=h+f*o,p=t-f-1,d=h+p*o,g=l[c];l[c]=l[d],l[d]=g}r._ScreenshotCanvas||(r._ScreenshotCanvas=document.createElement("canvas")),r._ScreenshotCanvas.width=e,r._ScreenshotCanvas.height=t;var m=r._ScreenshotCanvas.getContext("2d");if(m){var E=m.createImageData(e,t),v=E.data;v.set(l),m.putImageData(E,0,0),r.EncodeScreenshotCanvasData(n,a,s)}},r.ToBlob=function(e,t,i){i===void 0&&(i="image/png"),e.toBlob||(e.toBlob=function(n,a,s){var o=this;setTimeout(function(){for(var u=atob(o.toDataURL(a,s).split(",")[1]),l=u.length,f=new Uint8Array(l),h=0;h<l;h++)f[h]=u.charCodeAt(h);n(new Blob([f]))})}),e.toBlob(function(n){t(n)},i)},r.EncodeScreenshotCanvasData=function(e,t,i){if(t===void 0&&(t="image/png"),e){var n=r._ScreenshotCanvas.toDataURL(t);e(n)}else this.ToBlob(r._ScreenshotCanvas,function(a){if("download"in document.createElement("a")){if(!i){var s=new Date,o=(s.getFullYear()+"-"+(s.getMonth()+1)).slice(2)+"-"+s.getDate()+"_"+s.getHours()+"-"+("0"+s.getMinutes()).slice(-2);i="screenshot_"+o+".png"}r.Download(a,i)}else{var u=URL.createObjectURL(a),l=window.open("");if(!l)return;var f=l.document.createElement("img");f.onload=function(){URL.revokeObjectURL(u)},f.src=u,l.document.body.appendChild(f)}},t)},r.Download=function(e,t){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(e,t);return}var i=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=i,n.download=t,n.addEventListener("click",function(){n.parentElement&&n.parentElement.removeChild(n)}),n.click(),window.URL.revokeObjectURL(i)},r.BackCompatCameraNoPreventDefault=function(e){return typeof e[0]=="boolean"?e[0]:typeof e[1]=="boolean"?e[1]:!1},r.CreateScreenshot=function(e,t,i,n,a){throw O.WarnImport("ScreenshotTools")},r.CreateScreenshotAsync=function(e,t,i,n){throw O.WarnImport("ScreenshotTools")},r.CreateScreenshotUsingRenderTarget=function(e,t,i,n,a,s,o,u){throw O.WarnImport("ScreenshotTools")},r.CreateScreenshotUsingRenderTargetAsync=function(e,t,i,n,a,s,o){throw O.WarnImport("ScreenshotTools")},r.RandomId=function(){return Ti.RandomId()},r.IsBase64=function(e){return e.length<5?!1:e.substr(0,5)==="data:"},r.DecodeBase64=function(e){for(var t=atob(e.split(",")[1]),i=t.length,n=new Uint8Array(new ArrayBuffer(i)),a=0;a<i;a++)n[a]=t.charCodeAt(a);return n.buffer},r.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(r,"errorsCount",{get:function(){return L.errorsCount},enumerable:!1,configurable:!0}),r.Log=function(e){L.Log(e)},r.Warn=function(e){L.Warn(e)},r.Error=function(e){L.Error(e)},Object.defineProperty(r,"LogCache",{get:function(){return L.LogCache},enumerable:!1,configurable:!0}),r.ClearLogCache=function(){L.ClearLogCache()},Object.defineProperty(r,"LogLevels",{set:function(e){L.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"PerformanceLogLevel",{set:function(e){if((e&r.PerformanceUserMarkLogLevel)===r.PerformanceUserMarkLogLevel){r.StartPerformanceCounter=r._StartUserMark,r.EndPerformanceCounter=r._EndUserMark;return}if((e&r.PerformanceConsoleLogLevel)===r.PerformanceConsoleLogLevel){r.StartPerformanceCounter=r._StartPerformanceConsole,r.EndPerformanceCounter=r._EndPerformanceConsole;return}r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled},enumerable:!1,configurable:!0}),r._StartPerformanceCounterDisabled=function(e,t){},r._EndPerformanceCounterDisabled=function(e,t){},r._StartUserMark=function(e,t){if(t===void 0&&(t=!0),!r._performance){if(!oe.IsWindowObjectExist())return;r._performance=window.performance}!t||!r._performance.mark||r._performance.mark(e+"-Begin")},r._EndUserMark=function(e,t){t===void 0&&(t=!0),!(!t||!r._performance.mark)&&(r._performance.mark(e+"-End"),r._performance.measure(e,e+"-Begin",e+"-End"))},r._StartPerformanceConsole=function(e,t){t===void 0&&(t=!0),!!t&&(r._StartUserMark(e,t),console.time&&console.time(e))},r._EndPerformanceConsole=function(e,t){t===void 0&&(t=!0),!!t&&(r._EndUserMark(e,t),console.timeEnd(e))},Object.defineProperty(r,"Now",{get:function(){return Ve.Now},enumerable:!1,configurable:!0}),r.GetClassName=function(e,t){t===void 0&&(t=!1);var i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__}i||(i=typeof e)}return i},r.First=function(e,t){for(var i=0,n=e;i<n.length;i++){var a=n[i];if(t(a))return a}return null},r.getFullClassName=function(e,t){t===void 0&&(t=!1);var i=null,n=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var a=t?e:Object.getPrototypeOf(e);i=a.constructor.__bjsclassName__,n=a.constructor.__bjsmoduleName__}i||(i=typeof e)}return i?(n!=null?n+".":"")+i:null},r.DelayAsync=function(e){return new Promise(function(t){setTimeout(function(){t()},e)})},r.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},r.UseCustomRequestHeaders=!1,r.CustomRequestHeaders=it.CustomRequestHeaders,r._tmpFloatArray=new Float32Array(1),r.GetDOMTextContent=oe.GetDOMTextContent,r.NoneLogLevel=L.NoneLogLevel,r.MessageLogLevel=L.MessageLogLevel,r.WarningLogLevel=L.WarningLogLevel,r.ErrorLogLevel=L.ErrorLogLevel,r.AllLogLevel=L.AllLogLevel,r.IsWindowObjectExist=oe.IsWindowObjectExist,r.PerformanceNoneLogLevel=0,r.PerformanceUserMarkLogLevel=1,r.PerformanceConsoleLogLevel=2,r.StartPerformanceCounter=r._StartPerformanceCounterDisabled,r.EndPerformanceCounter=r._EndPerformanceCounterDisabled,r}(),ar=function(){function r(e,t,i,n){n===void 0&&(n=0),this.iterations=e,this.index=n-1,this._done=!1,this._fn=t,this._successCallback=i}return r.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},r.prototype.breakLoop=function(){this._done=!0,this._successCallback()},r.Run=function(e,t,i,n){n===void 0&&(n=0);var a=new r(e,t,i,n);return a.executeNext(),a},r.SyncAsyncForLoop=function(e,t,i,n,a,s){return s===void 0&&(s=0),r.Run(Math.ceil(e/t),function(o){a&&a()?o.breakLoop():setTimeout(function(){for(var u=0;u<t;++u){var l=o.index*t+u;if(l>=e)break;if(i(l),a&&a()){o.breakLoop();break}}o.executeNext()},s)},n)},r}();de.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";nr.Apply();var Ie=function(){function r(e){this.length=0,this.data=new Array(e),this._id=r._GlobalId++}return r.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},r.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},r.prototype.sort=function(e){this.data.sort(e)},r.prototype.reset=function(){this.length=0},r.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},r.prototype.concat=function(e){if(e.length!==0){this.length+e.length>this.data.length&&(this.data.length=(this.length+e.length)*2);for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},r.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},r.prototype.contains=function(e){return this.indexOf(e)!==-1},r._GlobalId=0,r}(),Qe=function(r){N(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._duplicateId=0,t}return e.prototype.push=function(t){r.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(t){return t.__smartArrayFlags&&t.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(t),!0)},e.prototype.reset=function(){r.prototype.reset.call(this),this._duplicateId++},e.prototype.concatWithNoDuplicate=function(t){if(t.length!==0){this.length+t.length>this.data.length&&(this.data.length=(this.length+t.length)*2);for(var i=0;i<t.length;i++){var n=(t.data||t)[i];this.pushNoDuplicate(n)}}},e}(Ie),fi=function(){function r(){this._count=0,this._data={}}return r.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach(function(i,n){return t.add(i,n)})},r.prototype.get=function(e){var t=this._data[e];if(t!==void 0)return t},r.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return i!==void 0||(i=t(e),i&&this.add(e,i)),i},r.prototype.getOrAdd=function(e,t){var i=this.get(e);return i!==void 0?i:(this.add(e,t),t)},r.prototype.contains=function(e){return this._data[e]!==void 0},r.prototype.add=function(e,t){return this._data[e]!==void 0?!1:(this._data[e]=t,++this._count,!0)},r.prototype.set=function(e,t){return this._data[e]===void 0?!1:(this._data[e]=t,!0)},r.prototype.getAndRemove=function(e){var t=this.get(e);return t!==void 0?(delete this._data[e],--this._count,t):null},r.prototype.remove=function(e){return this.contains(e)?(delete this._data[e],--this._count,!0):!1},r.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(r.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),r.prototype.forEach=function(e){for(var t in this._data){var i=this._data[t];e(t,i)}},r.prototype.first=function(e){for(var t in this._data){var i=this._data[t],n=e(t,i);if(n)return n}return null},r}(),sr=function(){function r(){}return r.Eval=function(e,t){return e.match(/\([^\(\)]*\)/g)?e=e.replace(/\([^\(\)]*\)/g,function(i){return i=i.slice(1,i.length-1),r._HandleParenthesisContent(i,t)}):e=r._HandleParenthesisContent(e,t),e==="true"?!0:e==="false"?!1:r.Eval(e,t)},r._HandleParenthesisContent=function(e,t){t=t||function(f){return f==="true"};var i,n=e.split("||");for(var a in n)if(n.hasOwnProperty(a)){var s=r._SimplifyNegation(n[a].trim()),o=s.split("&&");if(o.length>1)for(var u=0;u<o.length;++u){var l=r._SimplifyNegation(o[u].trim());if(l!=="true"&&l!=="false"?l[0]==="!"?i=!t(l.substring(1)):i=t(l):i=l==="true",!i){s="false";break}}if(i||s==="true"){i=!0;break}s!=="true"&&s!=="false"?s[0]==="!"?i=!t(s.substring(1)):i=t(s):i=s==="true"}return i?"true":"false"},r._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(t){return t=t.replace(/[\s]/g,function(){return""}),t.length%2?"!":""}),e=e.trim(),e==="!true"?e="false":e==="!false"&&(e="true"),e},r}(),$=function(){function r(){}return r.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return r.HasTags(e)},e.addTags=function(t){return r.AddTagsTo(e,t)},e.removeTags=function(t){return r.RemoveTagsFrom(e,t)},e.matchesTagsQuery=function(t){return r.MatchesQuery(e,t)}},r.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},r.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var i in t)if(t.hasOwnProperty(i))return!0;return!1},r.GetTags=function(e,t){if(t===void 0&&(t=!0),!e._tags)return null;if(t){var i=[];for(var n in e._tags)e._tags.hasOwnProperty(n)&&e._tags[n]===!0&&i.push(n);return i.join(" ")}else return e._tags},r.AddTagsTo=function(e,t){if(!!t&&typeof t=="string"){var i=t.split(" ");i.forEach(function(n,a,s){r._AddTagTo(e,n)})}},r._AddTagTo=function(e,t){t=t.trim(),!(t===""||t==="true"||t==="false")&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(r.EnableFor(e),e._tags[t]=!0))},r.RemoveTagsFrom=function(e,t){if(!!r.HasTags(e)){var i=t.split(" ");for(var n in i)r._RemoveTagFrom(e,i[n])}},r._RemoveTagFrom=function(e,t){delete e._tags[t]},r.MatchesQuery=function(e,t){return t===void 0?!0:t===""?r.HasTags(e):sr.Eval(t,function(i){return r.HasTags(e)&&e._tags[i]})},r}(),G=function(){function r(){}return r.WithinEpsilon=function(e,t,i){i===void 0&&(i=1401298e-51);var n=e-t;return-i<=n&&n<=i},r.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},r.Sign=function(e){return e=+e,e===0||isNaN(e)?e:e>0?1:-1},r.Clamp=function(e,t,i){return t===void 0&&(t=0),i===void 0&&(i=1),Math.min(i,Math.max(t,e))},r.Log2=function(e){return Math.log(e)*Math.LOG2E},r.Repeat=function(e,t){return e-Math.floor(e/t)*t},r.Normalize=function(e,t,i){return(e-t)/(i-t)},r.Denormalize=function(e,t,i){return e*(i-t)+t},r.DeltaAngle=function(e,t){var i=r.Repeat(t-e,360);return i>180&&(i-=360),i},r.PingPong=function(e,t){var i=r.Repeat(e,t*2);return t-Math.abs(i-t)},r.SmoothStep=function(e,t,i){var n=r.Clamp(i);return n=-2*n*n*n+3*n*n,t*n+e*(1-n)},r.MoveTowards=function(e,t,i){var n=0;return Math.abs(t-e)<=i?n=t:n=e+r.Sign(t-e)*i,n},r.MoveTowardsAngle=function(e,t,i){var n=r.DeltaAngle(e,t),a=0;return-i<n&&n<i?a=t:(t=e+n,a=r.MoveTowards(e,t,i)),a},r.Lerp=function(e,t,i){return e+(t-e)*i},r.LerpAngle=function(e,t,i){var n=r.Repeat(t-e,360);return n>180&&(n-=360),e+n*r.Clamp(i)},r.InverseLerp=function(e,t,i){var n=0;return e!=t?n=r.Clamp((i-e)/(t-e)):n=0,n},r.Hermite=function(e,t,i,n,a){var s=a*a,o=a*s,u=2*o-3*s+1,l=-2*o+3*s,f=o-2*s+a,h=o-s;return e*u+i*l+t*f+n*h},r.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},r.RangeToPercent=function(e,t,i){return(e-t)/(i-t)},r.PercentToRange=function(e,t,i){return(i-t)*e+t},r.NormalizeRadians=function(e){return e-=r.TwoPi*Math.floor((e+Math.PI)/r.TwoPi),e},r.TwoPi=Math.PI*2,r}(),Je=1/2.2,et=2.2,ue=.001,be=function(){function r(){}return r.BuildArray=function(e,t){for(var i=[],n=0;n<e;++n)i.push(t());return i},r}(),ne=function(){function r(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=e,this.y=t}return r.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},r.prototype.getClassName=function(){return"Vector2"},r.prototype.getHashCode=function(){var e=this.x|0;return e=e*397^(this.y|0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},r.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},r.prototype.set=function(e,t){return this.copyFromFloats(e,t)},r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},r.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},r.prototype.addVector3=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.subtract=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},r.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},r.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},r.prototype.multiply=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},r.prototype.multiplyByFloats=function(e,t){return new r(this.x*e,this.y*t)},r.prototype.divide=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.negate=function(){return new r(-this.x,-this.y)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},r.prototype.scale=function(e){var t=new r(0,0);return this.scaleToRef(e,t),t},r.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},r.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=ue),e&&G.WithinEpsilon(this.x,e.x,t)&&G.WithinEpsilon(this.y,e.y,t)},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){var e=this.length();return e===0?this:(this.x/=e,this.y/=e,this)},r.prototype.clone=function(){return new r(this.x,this.y)},r.Zero=function(){return new r(0,0)},r.One=function(){return new r(1,1)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},r.CatmullRom=function(e,t,i,n,a){var s=a*a,o=a*s,u=.5*(2*t.x+(-e.x+i.x)*a+(2*e.x-5*t.x+4*i.x-n.x)*s+(-e.x+3*t.x-3*i.x+n.x)*o),l=.5*(2*t.y+(-e.y+i.y)*a+(2*e.y-5*t.y+4*i.y-n.y)*s+(-e.y+3*t.y-3*i.y+n.y)*o);return new r(u,l)},r.Clamp=function(e,t,i){var n=e.x;n=n>i.x?i.x:n,n=n<t.x?t.x:n;var a=e.y;return a=a>i.y?i.y:a,a=a<t.y?t.y:a,new r(n,a)},r.Hermite=function(e,t,i,n,a){var s=a*a,o=a*s,u=2*o-3*s+1,l=-2*o+3*s,f=o-2*s+a,h=o-s,c=e.x*u+i.x*l+t.x*f+n.x*h,p=e.y*u+i.y*l+t.y*f+n.y*h;return new r(c,p)},r.Lerp=function(e,t,i){var n=e.x+(t.x-e.x)*i,a=e.y+(t.y-e.y)*i;return new r(n,a)},r.Dot=function(e,t){return e.x*t.x+e.y*t.y},r.Normalize=function(e){var t=e.clone();return t.normalize(),t},r.Minimize=function(e,t){var i=e.x<t.x?e.x:t.x,n=e.y<t.y?e.y:t.y;return new r(i,n)},r.Maximize=function(e,t){var i=e.x>t.x?e.x:t.x,n=e.y>t.y?e.y:t.y;return new r(i,n)},r.Transform=function(e,t){var i=r.Zero();return r.TransformToRef(e,t,i),i},r.TransformToRef=function(e,t,i){var n=t.m,a=e.x*n[0]+e.y*n[4]+n[12],s=e.x*n[1]+e.y*n[5]+n[13];i.x=a,i.y=s},r.PointInTriangle=function(e,t,i,n){var a=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),s=a<0?-1:1,o=(t.y*n.x-t.x*n.y+(n.y-t.y)*e.x+(t.x-n.x)*e.y)*s,u=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*s;return o>0&&u>0&&o+u<2*a*s},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},r.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},r.DistanceOfPointFromSegment=function(e,t,i){var n=r.DistanceSquared(t,i);if(n===0)return r.Distance(e,t);var a=i.subtract(t),s=Math.max(0,Math.min(1,r.Dot(e.subtract(t),a)/n)),o=t.add(a.multiplyByFloats(s,s));return r.Distance(e,o)},r}(),y=function(){function r(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this._isDirty=!0,this._x=e,this._y=t,this._z=i}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},r.prototype.getClassName=function(){return"Vector3"},r.prototype.getHashCode=function(){var e=this._x|0;return e=e*397^(this._y|0),e=e*397^(this._z|0),e},r.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.toQuaternion=function(){return W.RotationYawPitchRoll(this._y,this._x,this._z)},r.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.addInPlaceFromFloats=function(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this},r.prototype.add=function(e){return new r(this._x+e._x,this._y+e._y,this._z+e._z)},r.prototype.addToRef=function(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},r.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},r.prototype.subtract=function(e){return new r(this._x-e._x,this._y-e._y,this._z-e._z)},r.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)},r.prototype.subtractFromFloats=function(e,t,i){return new r(this._x-e,this._y-t,this._z-i)},r.prototype.subtractFromFloatsToRef=function(e,t,i,n){return n.copyFromFloats(this._x-e,this._y-t,this._z-i)},r.prototype.negate=function(){return new r(-this._x,-this._y,-this._z)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},r.prototype.scale=function(e){return new r(this._x*e,this._y*e,this._z*e)},r.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)},r.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},r.prototype.projectOnPlane=function(e,t){var i=r.Zero();return this.projectOnPlaneToRef(e,t,i),i},r.prototype.projectOnPlaneToRef=function(e,t,i){var n=e.normal,a=e.d,s=k.Vector3[0];this.subtractToRef(t,s),s.normalize();var o=r.Dot(s,n),u=-(r.Dot(t,n)+a)/o,l=s.scaleInPlace(u);t.addToRef(l,i)},r.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=ue),e&&G.WithinEpsilon(this._x,e._x,t)&&G.WithinEpsilon(this._y,e._y,t)&&G.WithinEpsilon(this._z,e._z,t)},r.prototype.equalsToFloats=function(e,t,i){return this._x===e&&this._y===t&&this._z===i},r.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},r.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},r.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},r.prototype.multiplyByFloats=function(e,t,i){return new r(this._x*e,this._y*t,this._z*i)},r.prototype.divide=function(e){return new r(this._x/e._x,this._y/e._y,this._z/e._z)},r.prototype.divideToRef=function(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},r.prototype.minimizeInPlaceFromFloats=function(e,t,i){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),i<this._z&&(this.z=i),this},r.prototype.maximizeInPlaceFromFloats=function(e,t,i){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),i>this._z&&(this.z=i),this},r.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this._x),i=Math.abs(this._y);if(!G.WithinEpsilon(t,i,e))return!0;var n=Math.abs(this._z);return!G.WithinEpsilon(t,n,e)||!G.WithinEpsilon(i,n,e)},Object.defineProperty(r.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x),t=Math.abs(this._y);if(e!==t)return!0;var i=Math.abs(this._z);return e!==i},enumerable:!1,configurable:!0}),r.prototype.floor=function(){return new r(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},r.prototype.fract=function(){return new r(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},r.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},r.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},r.prototype.normalize=function(){return this.normalizeFromLength(this.length())},r.prototype.reorderInPlace=function(e){var t=this;return e=e.toLowerCase(),e==="xyz"?this:(k.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(i,n){t[i]=k.Vector3[0][e[n]]}),this)},r.prototype.rotateByQuaternionToRef=function(e,t){return e.toRotationMatrix(k.Matrix[0]),r.TransformCoordinatesToRef(this,k.Matrix[0],t),t},r.prototype.rotateByQuaternionAroundPointToRef=function(e,t,i){return this.subtractToRef(t,k.Vector3[0]),k.Vector3[0].rotateByQuaternionToRef(e,k.Vector3[0]),t.addToRef(k.Vector3[0],i),i},r.prototype.cross=function(e){return r.Cross(this,e)},r.prototype.normalizeFromLength=function(e){return e===0||e===1?this:this.scaleInPlace(1/e)},r.prototype.normalizeToNew=function(){var e=new r(0,0,0);return this.normalizeToRef(e),e},r.prototype.normalizeToRef=function(e){var t=this.length();return t===0||t===1?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/t,e)},r.prototype.clone=function(){return new r(this._x,this._y,this._z)},r.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},r.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},r.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},r.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},r.GetClipFactor=function(e,t,i,n){var a=r.Dot(e,i)-n,s=r.Dot(t,i)-n,o=a/(a-s);return o},r.GetAngleBetweenVectors=function(e,t,i){var n=e.normalizeToRef(k.Vector3[1]),a=t.normalizeToRef(k.Vector3[2]),s=r.Dot(n,a),o=k.Vector3[3];return r.CrossToRef(n,a,o),r.Dot(o,i)>0?Math.acos(s):-Math.acos(s)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2])},r.FromFloatArray=function(e,t){return r.FromArray(e,t)},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},r.FromFloatArrayToRef=function(e,t,i){return r.FromArrayToRef(e,t,i)},r.FromFloatsToRef=function(e,t,i,n){n.copyFromFloats(e,t,i)},r.Zero=function(){return new r(0,0,0)},r.One=function(){return new r(1,1,1)},r.Up=function(){return new r(0,1,0)},Object.defineProperty(r,"UpReadOnly",{get:function(){return r._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ZeroReadOnly",{get:function(){return r._ZeroReadOnly},enumerable:!1,configurable:!0}),r.Down=function(){return new r(0,-1,0)},r.Forward=function(e){return e===void 0&&(e=!1),new r(0,0,e?-1:1)},r.Backward=function(e){return e===void 0&&(e=!1),new r(0,0,e?1:-1)},r.Right=function(){return new r(1,0,0)},r.Left=function(){return new r(-1,0,0)},r.TransformCoordinates=function(e,t){var i=r.Zero();return r.TransformCoordinatesToRef(e,t,i),i},r.TransformCoordinatesToRef=function(e,t,i){r.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,t,i)},r.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,a){var s=n.m,o=e*s[0]+t*s[4]+i*s[8]+s[12],u=e*s[1]+t*s[5]+i*s[9]+s[13],l=e*s[2]+t*s[6]+i*s[10]+s[14],f=1/(e*s[3]+t*s[7]+i*s[11]+s[15]);a.x=o*f,a.y=u*f,a.z=l*f},r.TransformNormal=function(e,t){var i=r.Zero();return r.TransformNormalToRef(e,t,i),i},r.TransformNormalToRef=function(e,t,i){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,i)},r.TransformNormalFromFloatsToRef=function(e,t,i,n,a){var s=n.m;a.x=e*s[0]+t*s[4]+i*s[8],a.y=e*s[1]+t*s[5]+i*s[9],a.z=e*s[2]+t*s[6]+i*s[10]},r.CatmullRom=function(e,t,i,n,a){var s=a*a,o=a*s,u=.5*(2*t._x+(-e._x+i._x)*a+(2*e._x-5*t._x+4*i._x-n._x)*s+(-e._x+3*t._x-3*i._x+n._x)*o),l=.5*(2*t._y+(-e._y+i._y)*a+(2*e._y-5*t._y+4*i._y-n._y)*s+(-e._y+3*t._y-3*i._y+n._y)*o),f=.5*(2*t._z+(-e._z+i._z)*a+(2*e._z-5*t._z+4*i._z-n._z)*s+(-e._z+3*t._z-3*i._z+n._z)*o);return new r(u,l,f)},r.Clamp=function(e,t,i){var n=new r;return r.ClampToRef(e,t,i,n),n},r.ClampToRef=function(e,t,i,n){var a=e._x;a=a>i._x?i._x:a,a=a<t._x?t._x:a;var s=e._y;s=s>i._y?i._y:s,s=s<t._y?t._y:s;var o=e._z;o=o>i._z?i._z:o,o=o<t._z?t._z:o,n.copyFromFloats(a,s,o)},r.CheckExtends=function(e,t,i){t.minimizeInPlace(e),i.maximizeInPlace(e)},r.Hermite=function(e,t,i,n,a){var s=a*a,o=a*s,u=2*o-3*s+1,l=-2*o+3*s,f=o-2*s+a,h=o-s,c=e._x*u+i._x*l+t._x*f+n._x*h,p=e._y*u+i._y*l+t._y*f+n._y*h,d=e._z*u+i._z*l+t._z*f+n._z*h;return new r(c,p,d)},r.Lerp=function(e,t,i){var n=new r(0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.x=e._x+(t._x-e._x)*i,n.y=e._y+(t._y-e._y)*i,n.z=e._z+(t._z-e._z)*i},r.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z},r.Cross=function(e,t){var i=r.Zero();return r.CrossToRef(e,t,i),i},r.CrossToRef=function(e,t,i){var n=e._y*t._z-e._z*t._y,a=e._z*t._x-e._x*t._z,s=e._x*t._y-e._y*t._x;i.copyFromFloats(n,a,s)},r.Normalize=function(e){var t=r.Zero();return r.NormalizeToRef(e,t),t},r.NormalizeToRef=function(e,t){e.normalizeToRef(t)},r.Project=function(e,t,i,n){var a=new r;return r.ProjectToRef(e,t,i,n,a),a},r.ProjectToRef=function(e,t,i,n,a){var s=n.width,o=n.height,u=n.x,l=n.y,f=k.Matrix[1];R.FromValuesToRef(s/2,0,0,0,0,-o/2,0,0,0,0,.5,0,u+s/2,o/2+l,.5,1,f);var h=k.Matrix[0];return t.multiplyToRef(i,h),h.multiplyToRef(f,h),r.TransformCoordinatesToRef(e,h,a),a},r._UnprojectFromInvertedMatrixToRef=function(e,t,i){r.TransformCoordinatesToRef(e,t,i);var n=t.m,a=e._x*n[3]+e._y*n[7]+e._z*n[11]+n[15];G.WithinEpsilon(a,1)&&i.scaleInPlace(1/a)},r.UnprojectFromTransform=function(e,t,i,n,a){var s=k.Matrix[0];n.multiplyToRef(a,s),s.invert(),e.x=e._x/t*2-1,e.y=-(e._y/i*2-1);var o=new r;return r._UnprojectFromInvertedMatrixToRef(e,s,o),o},r.Unproject=function(e,t,i,n,a,s){var o=r.Zero();return r.UnprojectToRef(e,t,i,n,a,s,o),o},r.UnprojectToRef=function(e,t,i,n,a,s,o){r.UnprojectFloatsToRef(e._x,e._y,e._z,t,i,n,a,s,o)},r.UnprojectFloatsToRef=function(e,t,i,n,a,s,o,u,l){var f=k.Matrix[0];s.multiplyToRef(o,f),f.multiplyToRef(u,f),f.invert();var h=k.Vector3[0];h.x=e/n*2-1,h.y=-(t/a*2-1),h.z=2*i-1,r._UnprojectFromInvertedMatrixToRef(h,f,l)},r.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},r.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e._x-t._x,n=e._y-t._y,a=e._z-t._z;return i*i+n*n+a*a},r.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},r.RotationFromAxis=function(e,t,i){var n=r.Zero();return r.RotationFromAxisToRef(e,t,i,n),n},r.RotationFromAxisToRef=function(e,t,i,n){var a=k.Quaternion[0];W.RotationQuaternionFromAxisToRef(e,t,i,a),a.toEulerAnglesToRef(n)},r._UpReadOnly=r.Up(),r._ZeroReadOnly=r.Zero(),r}(),Ue=function(){function r(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}return r.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},r.prototype.getClassName=function(){return"Vector4"},r.prototype.getHashCode=function(){var e=this.x|0;return e=e*397^(this.y|0),e=e*397^(this.z|0),e=e*397^(this.w|0),e},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},r.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},r.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},r.prototype.subtract=function(e){return new r(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},r.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},r.prototype.subtractFromFloats=function(e,t,i,n){return new r(this.x-e,this.y-t,this.z-i,this.w-n)},r.prototype.subtractFromFloatsToRef=function(e,t,i,n,a){return a.x=this.x-e,a.y=this.y-t,a.z=this.z-i,a.w=this.w-n,this},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z,-this.w)},r.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},r.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},r.prototype.scale=function(e){return new r(this.x*e,this.y*e,this.z*e,this.w*e)},r.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},r.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=ue),e&&G.WithinEpsilon(this.x,e.x,t)&&G.WithinEpsilon(this.y,e.y,t)&&G.WithinEpsilon(this.z,e.z,t)&&G.WithinEpsilon(this.w,e.w,t)},r.prototype.equalsToFloats=function(e,t,i,n){return this.x===e&&this.y===t&&this.z===i&&this.w===n},r.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},r.prototype.multiply=function(e){return new r(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},r.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},r.prototype.multiplyByFloats=function(e,t,i,n){return new r(this.x*e,this.y*t,this.z*i,this.w*n)},r.prototype.divide=function(e){return new r(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},r.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},r.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},r.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},r.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},r.prototype.fract=function(){return new r(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},r.prototype.normalize=function(){var e=this.length();return e===0?this:this.scaleInPlace(1/e)},r.prototype.toVector3=function(){return new y(this.x,this.y,this.z)},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)},r.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},r.FromArray=function(e,t){return t||(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},r.FromFloatArrayToRef=function(e,t,i){r.FromArrayToRef(e,t,i)},r.FromFloatsToRef=function(e,t,i,n,a){a.x=e,a.y=t,a.z=i,a.w=n},r.Zero=function(){return new r(0,0,0,0)},r.One=function(){return new r(1,1,1,1)},r.Normalize=function(e){var t=r.Zero();return r.NormalizeToRef(e,t),t},r.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},r.Minimize=function(e,t){var i=e.clone();return i.minimizeInPlace(t),i},r.Maximize=function(e,t){var i=e.clone();return i.maximizeInPlace(t),i},r.Distance=function(e,t){return Math.sqrt(r.DistanceSquared(e,t))},r.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,a=e.z-t.z,s=e.w-t.w;return i*i+n*n+a*a+s*s},r.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},r.TransformNormal=function(e,t){var i=r.Zero();return r.TransformNormalToRef(e,t,i),i},r.TransformNormalToRef=function(e,t,i){var n=t.m,a=e.x*n[0]+e.y*n[4]+e.z*n[8],s=e.x*n[1]+e.y*n[5]+e.z*n[9],o=e.x*n[2]+e.y*n[6]+e.z*n[10];i.x=a,i.y=s,i.z=o,i.w=e.w},r.TransformNormalFromFloatsToRef=function(e,t,i,n,a,s){var o=a.m;s.x=e*o[0]+t*o[4]+i*o[8],s.y=e*o[1]+t*o[5]+i*o[9],s.z=e*o[2]+t*o[6]+i*o[10],s.w=n},r.FromVector3=function(e,t){return t===void 0&&(t=0),new r(e._x,e._y,e._z,t)},r}(),W=function(){function r(e,t,i,n){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),this._isDirty=!0,this._x=e,this._y=t,this._z=i,this._w=n}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},r.prototype.getClassName=function(){return"Quaternion"},r.prototype.getHashCode=function(){var e=this._x|0;return e=e*397^(this._y|0),e=e*397^(this._z|0),e=e*397^(this._w|0),e},r.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},r.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},r.prototype.equalsWithEpsilon=function(e,t){return t===void 0&&(t=ue),e&&G.WithinEpsilon(this._x,e._x,t)&&G.WithinEpsilon(this._y,e._y,t)&&G.WithinEpsilon(this._z,e._z,t)&&G.WithinEpsilon(this._w,e._w,t)},r.prototype.clone=function(){return new r(this._x,this._y,this._z,this._w)},r.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.add=function(e){return new r(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)},r.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},r.prototype.subtract=function(e){return new r(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)},r.prototype.scale=function(e){return new r(this._x*e,this._y*e,this._z*e,this._w*e)},r.prototype.scaleToRef=function(e,t){return t.x=this._x*e,t.y=this._y*e,t.z=this._z*e,t.w=this._w*e,this},r.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.x+=this._x*e,t.y+=this._y*e,t.z+=this._z*e,t.w+=this._w*e,this},r.prototype.multiply=function(e){var t=new r(0,0,0,1);return this.multiplyToRef(e,t),t},r.prototype.multiplyToRef=function(e,t){var i=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,n=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,a=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,s=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(i,n,a,s),this},r.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},r.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},r.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},r.prototype.conjugate=function(){var e=new r(-this._x,-this._y,-this._z,this._w);return e},r.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},r.prototype.normalize=function(){var e=this.length();if(e===0)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},r.prototype.toEulerAngles=function(e){var t=y.Zero();return this.toEulerAnglesToRef(t),t},r.prototype.toEulerAnglesToRef=function(e){var t=this._z,i=this._x,n=this._y,a=this._w,s=a*a,o=t*t,u=i*i,l=n*n,f=n*t-i*a,h=.4999999;return f<-h?(e.y=2*Math.atan2(n,a),e.x=Math.PI/2,e.z=0):f>h?(e.y=2*Math.atan2(n,a),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(i*n+t*a),-o-u+l+s),e.x=Math.asin(-2*(t*n-i*a)),e.y=Math.atan2(2*(t*i+n*a),o-u-l+s)),this},r.prototype.toRotationMatrix=function(e){return R.FromQuaternionToRef(this,e),this},r.prototype.fromRotationMatrix=function(e){return r.FromRotationMatrixToRef(e,this),this},r.FromRotationMatrix=function(e){var t=new r;return r.FromRotationMatrixToRef(e,t),t},r.FromRotationMatrixToRef=function(e,t){var i=e.m,n=i[0],a=i[4],s=i[8],o=i[1],u=i[5],l=i[9],f=i[2],h=i[6],c=i[10],p=n+u+c,d;p>0?(d=.5/Math.sqrt(p+1),t.w=.25/d,t.x=(h-l)*d,t.y=(s-f)*d,t.z=(o-a)*d):n>u&&n>c?(d=2*Math.sqrt(1+n-u-c),t.w=(h-l)/d,t.x=.25*d,t.y=(a+o)/d,t.z=(s+f)/d):u>c?(d=2*Math.sqrt(1+u-n-c),t.w=(s-f)/d,t.x=(a+o)/d,t.y=.25*d,t.z=(l+h)/d):(d=2*Math.sqrt(1+c-n-u),t.w=(o-a)/d,t.x=(s+f)/d,t.y=(l+h)/d,t.z=.25*d)},r.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w},r.AreClose=function(e,t){var i=r.Dot(e,t);return i>=0},r.Zero=function(){return new r(0,0,0,0)},r.Inverse=function(e){return new r(-e._x,-e._y,-e._z,e._w)},r.InverseToRef=function(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t},r.Identity=function(){return new r(0,0,0,1)},r.IsIdentity=function(e){return e&&e._x===0&&e._y===0&&e._z===0&&e._w===1},r.RotationAxis=function(e,t){return r.RotationAxisToRef(e,t,new r)},r.RotationAxisToRef=function(e,t,i){var n=Math.sin(t/2);return e.normalize(),i.w=Math.cos(t/2),i.x=e._x*n,i.y=e._y*n,i.z=e._z*n,i},r.FromArray=function(e,t){return t||(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},r.FromEulerAngles=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(t,e,i,n),n},r.FromEulerAnglesToRef=function(e,t,i,n){return r.RotationYawPitchRollToRef(t,e,i,n),n},r.FromEulerVector=function(e){var t=new r;return r.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t},r.FromEulerVectorToRef=function(e,t){return r.RotationYawPitchRollToRef(e._y,e._x,e._z,t),t},r.RotationYawPitchRoll=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(e,t,i,n),n},r.RotationYawPitchRollToRef=function(e,t,i,n){var a=i*.5,s=t*.5,o=e*.5,u=Math.sin(a),l=Math.cos(a),f=Math.sin(s),h=Math.cos(s),c=Math.sin(o),p=Math.cos(o);n.x=p*f*l+c*h*u,n.y=c*h*l-p*f*u,n.z=p*h*u-c*f*l,n.w=p*h*l+c*f*u},r.RotationAlphaBetaGamma=function(e,t,i){var n=new r;return r.RotationAlphaBetaGammaToRef(e,t,i,n),n},r.RotationAlphaBetaGammaToRef=function(e,t,i,n){var a=(i+e)*.5,s=(i-e)*.5,o=t*.5;n.x=Math.cos(s)*Math.sin(o),n.y=Math.sin(s)*Math.sin(o),n.z=Math.sin(a)*Math.cos(o),n.w=Math.cos(a)*Math.cos(o)},r.RotationQuaternionFromAxis=function(e,t,i){var n=new r(0,0,0,0);return r.RotationQuaternionFromAxisToRef(e,t,i,n),n},r.RotationQuaternionFromAxisToRef=function(e,t,i,n){var a=k.Matrix[0];R.FromXYZAxesToRef(e.normalize(),t.normalize(),i.normalize(),a),r.FromRotationMatrixToRef(a,n)},r.Slerp=function(e,t,i){var n=r.Identity();return r.SlerpToRef(e,t,i,n),n},r.SlerpToRef=function(e,t,i,n){var a,s,o=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,u=!1;if(o<0&&(u=!0,o=-o),o>.999999)s=1-i,a=u?-i:i;else{var l=Math.acos(o),f=1/Math.sin(l);s=Math.sin((1-i)*l)*f,a=u?-Math.sin(i*l)*f:Math.sin(i*l)*f}n.x=s*e._x+a*t._x,n.y=s*e._y+a*t._y,n.z=s*e._z+a*t._z,n.w=s*e._w+a*t._w},r.Hermite=function(e,t,i,n,a){var s=a*a,o=a*s,u=2*o-3*s+1,l=-2*o+3*s,f=o-2*s+a,h=o-s,c=e._x*u+i._x*l+t._x*f+n._x*h,p=e._y*u+i._y*l+t._y*f+n._y*h,d=e._z*u+i._z*l+t._z*f+n._z*h,g=e._w*u+i._w*l+t._w*f+n._w*h;return new r(c,p,d,g)},r}(),R=function(){function r(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,qe.MatrixTrackPrecisionChange&&qe.MatrixTrackedMatrices.push(this),this._m=new qe.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(r,"Use64Bits",{get:function(){return qe.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),r.prototype._markAsUpdated=function(){this.updateFlag=r._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},r.prototype._updateIdentityStatus=function(e,t,i,n){t===void 0&&(t=!1),i===void 0&&(i=!1),n===void 0&&(n=!0),this.updateFlag=r._updateFlagSeed++,this._isIdentity=e,this._isIdentity3x2=e||i,this._isIdentityDirty=this._isIdentity?!1:t,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:n},r.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}return this._isIdentity},r.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},r.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var e=this._m,t=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],u=e[6],l=e[7],f=e[8],h=e[9],c=e[10],p=e[11],d=e[12],g=e[13],m=e[14],E=e[15],v=c*E-m*p,A=h*E-g*p,M=h*m-g*c,C=f*E-d*p,P=f*m-c*d,S=f*g-d*h,x=+(o*v-u*A+l*M),z=-(s*v-u*C+l*P),X=+(s*A-o*C+l*S),V=-(s*M-o*P+u*S);return t*x+i*z+n*X+a*V},r.prototype.toArray=function(){return this._m},r.prototype.asArray=function(){return this._m},r.prototype.invert=function(){return this.invertToRef(this),this},r.prototype.reset=function(){return r.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},r.prototype.add=function(e){var t=new r;return this.addToRef(e,t),t},r.prototype.addToRef=function(e,t){for(var i=this._m,n=t._m,a=e.m,s=0;s<16;s++)n[s]=i[s]+a[s];return t._markAsUpdated(),this},r.prototype.addToSelf=function(e){for(var t=this._m,i=e.m,n=0;n<16;n++)t[n]+=i[n];return this._markAsUpdated(),this},r.prototype.invertToRef=function(e){if(this._isIdentity===!0)return r.IdentityToRef(e),this;var t=this._m,i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],u=t[5],l=t[6],f=t[7],h=t[8],c=t[9],p=t[10],d=t[11],g=t[12],m=t[13],E=t[14],v=t[15],A=p*v-E*d,M=c*v-m*d,C=c*E-m*p,P=h*v-g*d,S=h*E-p*g,x=h*m-g*c,z=+(u*A-l*M+f*C),X=-(o*A-l*P+f*S),V=+(o*M-u*P+f*x),re=-(o*C-u*S+l*x),j=i*z+n*X+a*V+s*re;if(j===0)return e.copyFrom(this),this;var F=1/j,B=l*v-E*f,K=u*v-m*f,ie=u*E-m*l,ge=o*v-g*f,Q=o*E-g*l,ve=o*m-g*u,he=l*d-p*f,Ge=u*d-c*f,ke=u*p-c*l,nt=o*d-h*f,at=o*p-h*l,st=o*c-h*u,mt=-(n*A-a*M+s*C),yt=+(i*A-a*P+s*S),bt=-(i*M-n*P+s*x),Et=+(i*C-n*S+a*x),Tt=+(n*B-a*K+s*ie),At=-(i*B-a*ge+s*Q),Fe=+(i*K-n*ge+s*ve),we=-(i*ie-n*Q+a*ve),Le=-(n*he-a*Ge+s*ke),Ne=+(i*he-a*nt+s*at),ot=-(i*Ge-n*nt+s*st),Bt=+(i*ke-n*at+a*st);return r.FromValuesToRef(z*F,mt*F,Tt*F,Le*F,X*F,yt*F,At*F,Ne*F,V*F,bt*F,Fe*F,ot*F,re*F,Et*F,we*F,Bt*F,e),this},r.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},r.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},r.prototype.setTranslationFromFloats=function(e,t,i){return this._m[12]=e,this._m[13]=t,this._m[14]=i,this._markAsUpdated(),this},r.prototype.addTranslationFromFloats=function(e,t,i){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=i,this._markAsUpdated(),this},r.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},r.prototype.getTranslation=function(){return new y(this._m[12],this._m[13],this._m[14])},r.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},r.prototype.removeRotationAndScaling=function(){var e=this.m;return r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1),this},r.prototype.multiply=function(e){var t=new r;return this.multiplyToRef(e,t),t},r.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},r.prototype.copyToArray=function(e,t){t===void 0&&(t=0);var i=this._m;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],this},r.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated(),this)},r.prototype.multiplyToArray=function(e,t,i){var n=this._m,a=e.m,s=n[0],o=n[1],u=n[2],l=n[3],f=n[4],h=n[5],c=n[6],p=n[7],d=n[8],g=n[9],m=n[10],E=n[11],v=n[12],A=n[13],M=n[14],C=n[15],P=a[0],S=a[1],x=a[2],z=a[3],X=a[4],V=a[5],re=a[6],j=a[7],F=a[8],B=a[9],K=a[10],ie=a[11],ge=a[12],Q=a[13],ve=a[14],he=a[15];return t[i]=s*P+o*X+u*F+l*ge,t[i+1]=s*S+o*V+u*B+l*Q,t[i+2]=s*x+o*re+u*K+l*ve,t[i+3]=s*z+o*j+u*ie+l*he,t[i+4]=f*P+h*X+c*F+p*ge,t[i+5]=f*S+h*V+c*B+p*Q,t[i+6]=f*x+h*re+c*K+p*ve,t[i+7]=f*z+h*j+c*ie+p*he,t[i+8]=d*P+g*X+m*F+E*ge,t[i+9]=d*S+g*V+m*B+E*Q,t[i+10]=d*x+g*re+m*K+E*ve,t[i+11]=d*z+g*j+m*ie+E*he,t[i+12]=v*P+A*X+M*F+C*ge,t[i+13]=v*S+A*V+M*B+C*Q,t[i+14]=v*x+A*re+M*K+C*ve,t[i+15]=v*z+A*j+M*ie+C*he,this},r.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var i=this.m,n=t.m;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},r.prototype.clone=function(){var e=new r;return e.copyFrom(this),e},r.prototype.getClassName=function(){return"Matrix"},r.prototype.getHashCode=function(){for(var e=this._m[0]|0,t=1;t<16;t++)e=e*397^(this._m[t]|0);return e},r.prototype.decompose=function(e,t,i){if(this._isIdentity)return i&&i.setAll(0),e&&e.setAll(1),t&&t.copyFromFloats(0,0,0,1),!0;var n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),e=e||k.Vector3[0],e.x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),e.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),e.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(e.y*=-1),e._x===0||e._y===0||e._z===0)return t&&t.copyFromFloats(0,0,0,1),!1;if(t){var a=1/e._x,s=1/e._y,o=1/e._z;r.FromValuesToRef(n[0]*a,n[1]*a,n[2]*a,0,n[4]*s,n[5]*s,n[6]*s,0,n[8]*o,n[9]*o,n[10]*o,0,0,0,0,1,k.Matrix[0]),W.FromRotationMatrixToRef(k.Matrix[0],t)}return!0},r.prototype.getRow=function(e){if(e<0||e>3)return null;var t=e*4;return new Ue(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},r.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},r.prototype.transpose=function(){return r.Transpose(this)},r.prototype.transposeToRef=function(e){return r.TransposeToRef(this,e),this},r.prototype.setRowFromFloats=function(e,t,i,n,a){if(e<0||e>3)return this;var s=e*4;return this._m[s+0]=t,this._m[s+1]=i,this._m[s+2]=n,this._m[s+3]=a,this._markAsUpdated(),this},r.prototype.scale=function(e){var t=new r;return this.scaleToRef(e,t),t},r.prototype.scaleToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]=this._m[i]*e;return t._markAsUpdated(),this},r.prototype.scaleAndAddToRef=function(e,t){for(var i=0;i<16;i++)t._m[i]+=this._m[i]*e;return t._markAsUpdated(),this},r.prototype.toNormalMatrix=function(e){var t=k.Matrix[0];this.invertToRef(t),t.transposeToRef(e);var i=e._m;r.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,e)},r.prototype.getRotationMatrix=function(){var e=new r;return this.getRotationMatrixToRef(e),e},r.prototype.getRotationMatrixToRef=function(e){var t=k.Vector3[0];if(!this.decompose(t))return r.IdentityToRef(e),this;var i=this._m,n=1/t._x,a=1/t._y,s=1/t._z;return r.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*a,i[5]*a,i[6]*a,0,i[8]*s,i[9]*s,i[10]*s,0,0,0,0,1,e),this},r.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},r.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},r.FromArray=function(e,t){t===void 0&&(t=0);var i=new r;return r.FromArrayToRef(e,t,i),i},r.FromArrayToRef=function(e,t,i){for(var n=0;n<16;n++)i._m[n]=e[n+t];i._markAsUpdated()},r.FromFloat32ArrayToRefScaled=function(e,t,i,n){for(var a=0;a<16;a++)n._m[a]=e[a+t]*i;n._markAsUpdated()},Object.defineProperty(r,"IdentityReadOnly",{get:function(){return r._identityReadOnly},enumerable:!1,configurable:!0}),r.FromValuesToRef=function(e,t,i,n,a,s,o,u,l,f,h,c,p,d,g,m,E){var v=E._m;v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=a,v[5]=s,v[6]=o,v[7]=u,v[8]=l,v[9]=f,v[10]=h,v[11]=c,v[12]=p,v[13]=d,v[14]=g,v[15]=m,E._markAsUpdated()},r.FromValues=function(e,t,i,n,a,s,o,u,l,f,h,c,p,d,g,m){var E=new r,v=E._m;return v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=a,v[5]=s,v[6]=o,v[7]=u,v[8]=l,v[9]=f,v[10]=h,v[11]=c,v[12]=p,v[13]=d,v[14]=g,v[15]=m,E._markAsUpdated(),E},r.Compose=function(e,t,i){var n=new r;return r.ComposeToRef(e,t,i,n),n},r.ComposeToRef=function(e,t,i,n){var a=n._m,s=t._x,o=t._y,u=t._z,l=t._w,f=s+s,h=o+o,c=u+u,p=s*f,d=s*h,g=s*c,m=o*h,E=o*c,v=u*c,A=l*f,M=l*h,C=l*c,P=e._x,S=e._y,x=e._z;a[0]=(1-(m+v))*P,a[1]=(d+C)*P,a[2]=(g-M)*P,a[3]=0,a[4]=(d-C)*S,a[5]=(1-(p+v))*S,a[6]=(E+A)*S,a[7]=0,a[8]=(g+M)*x,a[9]=(E-A)*x,a[10]=(1-(p+m))*x,a[11]=0,a[12]=i._x,a[13]=i._y,a[14]=i._z,a[15]=1,n._markAsUpdated()},r.Identity=function(){var e=r.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e},r.IdentityToRef=function(e){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0)},r.Zero=function(){var e=r.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e},r.RotationX=function(e){var t=new r;return r.RotationXToRef(e,t),t},r.Invert=function(e){var t=new r;return e.invertToRef(t),t},r.RotationXToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationY=function(e){var t=new r;return r.RotationYToRef(e,t),t},r.RotationYToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationZ=function(e){var t=new r;return r.RotationZToRef(e,t),t},r.RotationZToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);r.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(n===1&&i===0)},r.RotationAxis=function(e,t){var i=new r;return r.RotationAxisToRef(e,t,i),i},r.RotationAxisToRef=function(e,t,i){var n=Math.sin(-t),a=Math.cos(-t),s=1-a;e.normalize();var o=i._m;o[0]=e._x*e._x*s+a,o[1]=e._x*e._y*s-e._z*n,o[2]=e._x*e._z*s+e._y*n,o[3]=0,o[4]=e._y*e._x*s+e._z*n,o[5]=e._y*e._y*s+a,o[6]=e._y*e._z*s-e._x*n,o[7]=0,o[8]=e._z*e._x*s-e._y*n,o[9]=e._z*e._y*s+e._x*n,o[10]=e._z*e._z*s+a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i._markAsUpdated()},r.RotationAlignToRef=function(e,t,i){var n=y.Cross(t,e),a=y.Dot(t,e),s=1/(1+a),o=i._m;o[0]=n._x*n._x*s+a,o[1]=n._y*n._x*s-n._z,o[2]=n._z*n._x*s+n._y,o[3]=0,o[4]=n._x*n._y*s+n._z,o[5]=n._y*n._y*s+a,o[6]=n._z*n._y*s-n._x,o[7]=0,o[8]=n._x*n._z*s-n._y,o[9]=n._y*n._z*s+n._x,o[10]=n._z*n._z*s+a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,i._markAsUpdated()},r.RotationYawPitchRoll=function(e,t,i){var n=new r;return r.RotationYawPitchRollToRef(e,t,i,n),n},r.RotationYawPitchRollToRef=function(e,t,i,n){W.RotationYawPitchRollToRef(e,t,i,k.Quaternion[0]),k.Quaternion[0].toRotationMatrix(n)},r.Scaling=function(e,t,i){var n=new r;return r.ScalingToRef(e,t,i,n),n},r.ScalingToRef=function(e,t,i,n){r.FromValuesToRef(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(e===1&&t===1&&i===1)},r.Translation=function(e,t,i){var n=new r;return r.TranslationToRef(e,t,i,n),n},r.TranslationToRef=function(e,t,i,n){r.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1,n),n._updateIdentityStatus(e===0&&t===0&&i===0)},r.Lerp=function(e,t,i){var n=new r;return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){for(var a=n._m,s=e.m,o=t.m,u=0;u<16;u++)a[u]=s[u]*(1-i)+o[u]*i;n._markAsUpdated()},r.DecomposeLerp=function(e,t,i){var n=new r;return r.DecomposeLerpToRef(e,t,i,n),n},r.DecomposeLerpToRef=function(e,t,i,n){var a=k.Vector3[0],s=k.Quaternion[0],o=k.Vector3[1];e.decompose(a,s,o);var u=k.Vector3[2],l=k.Quaternion[1],f=k.Vector3[3];t.decompose(u,l,f);var h=k.Vector3[4];y.LerpToRef(a,u,i,h);var c=k.Quaternion[2];W.SlerpToRef(s,l,i,c);var p=k.Vector3[5];y.LerpToRef(o,f,i,p),r.ComposeToRef(h,c,p,n)},r.LookAtLH=function(e,t,i){var n=new r;return r.LookAtLHToRef(e,t,i,n),n},r.LookAtLHToRef=function(e,t,i,n){var a=k.Vector3[0],s=k.Vector3[1],o=k.Vector3[2];t.subtractToRef(e,o),o.normalize(),y.CrossToRef(i,o,a);var u=a.lengthSquared();u===0?a.x=1:a.normalizeFromLength(Math.sqrt(u)),y.CrossToRef(o,a,s),s.normalize();var l=-y.Dot(a,e),f=-y.Dot(s,e),h=-y.Dot(o,e);r.FromValuesToRef(a._x,s._x,o._x,0,a._y,s._y,o._y,0,a._z,s._z,o._z,0,l,f,h,1,n)},r.LookAtRH=function(e,t,i){var n=new r;return r.LookAtRHToRef(e,t,i,n),n},r.LookAtRHToRef=function(e,t,i,n){var a=k.Vector3[0],s=k.Vector3[1],o=k.Vector3[2];e.subtractToRef(t,o),o.normalize(),y.CrossToRef(i,o,a);var u=a.lengthSquared();u===0?a.x=1:a.normalizeFromLength(Math.sqrt(u)),y.CrossToRef(o,a,s),s.normalize();var l=-y.Dot(a,e),f=-y.Dot(s,e),h=-y.Dot(o,e);r.FromValuesToRef(a._x,s._x,o._x,0,a._y,s._y,o._y,0,a._z,s._z,o._z,0,l,f,h,1,n)},r.OrthoLH=function(e,t,i,n){var a=new r;return r.OrthoLHToRef(e,t,i,n,a),a},r.OrthoLHToRef=function(e,t,i,n,a){var s=i,o=n,u=2/e,l=2/t,f=2/(o-s),h=-(o+s)/(o-s);r.FromValuesToRef(u,0,0,0,0,l,0,0,0,0,f,0,0,0,h,1,a),a._updateIdentityStatus(u===1&&l===1&&f===1&&h===0)},r.OrthoOffCenterLH=function(e,t,i,n,a,s){var o=new r;return r.OrthoOffCenterLHToRef(e,t,i,n,a,s,o),o},r.OrthoOffCenterLHToRef=function(e,t,i,n,a,s,o){var u=a,l=s,f=2/(t-e),h=2/(n-i),c=2/(l-u),p=-(l+u)/(l-u),d=(e+t)/(e-t),g=(n+i)/(i-n);r.FromValuesToRef(f,0,0,0,0,h,0,0,0,0,c,0,d,g,p,1,o),o._markAsUpdated()},r.OrthoOffCenterRH=function(e,t,i,n,a,s){var o=new r;return r.OrthoOffCenterRHToRef(e,t,i,n,a,s,o),o},r.OrthoOffCenterRHToRef=function(e,t,i,n,a,s,o){r.OrthoOffCenterLHToRef(e,t,i,n,a,s,o),o._m[10]*=-1},r.PerspectiveLH=function(e,t,i,n){var a=new r,s=i,o=n,u=2*s/e,l=2*s/t,f=(o+s)/(o-s),h=-2*o*s/(o-s);return r.FromValuesToRef(u,0,0,0,0,l,0,0,0,0,f,1,0,0,h,0,a),a._updateIdentityStatus(!1),a},r.PerspectiveFovLH=function(e,t,i,n){var a=new r;return r.PerspectiveFovLHToRef(e,t,i,n,a),a},r.PerspectiveFovLHToRef=function(e,t,i,n,a,s){s===void 0&&(s=!0);var o=i,u=n,l=1/Math.tan(e*.5),f=s?l/t:l,h=s?l:l*t,c=(u+o)/(u-o),p=-2*u*o/(u-o);r.FromValuesToRef(f,0,0,0,0,h,0,0,0,0,c,1,0,0,p,0,a),a._updateIdentityStatus(!1)},r.PerspectiveFovReverseLHToRef=function(e,t,i,n,a,s){s===void 0&&(s=!0);var o=1/Math.tan(e*.5),u=s?o/t:o,l=s?o:o*t;r.FromValuesToRef(u,0,0,0,0,l,0,0,0,0,-i,1,0,0,1,0,a),a._updateIdentityStatus(!1)},r.PerspectiveFovRH=function(e,t,i,n){var a=new r;return r.PerspectiveFovRHToRef(e,t,i,n,a),a},r.PerspectiveFovRHToRef=function(e,t,i,n,a,s){s===void 0&&(s=!0);var o=i,u=n,l=1/Math.tan(e*.5),f=s?l/t:l,h=s?l:l*t,c=-(u+o)/(u-o),p=-2*u*o/(u-o);r.FromValuesToRef(f,0,0,0,0,h,0,0,0,0,c,-1,0,0,p,0,a),a._updateIdentityStatus(!1)},r.PerspectiveFovReverseRHToRef=function(e,t,i,n,a,s){s===void 0&&(s=!0);var o=1/Math.tan(e*.5),u=s?o/t:o,l=s?o:o*t;r.FromValuesToRef(u,0,0,0,0,l,0,0,0,0,-i,-1,0,0,-1,0,a),a._updateIdentityStatus(!1)},r.PerspectiveFovWebVRToRef=function(e,t,i,n,a){a===void 0&&(a=!1);var s=a?-1:1,o=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),h=2/(l+f),c=2/(o+u),p=n._m;p[0]=h,p[1]=p[2]=p[3]=p[4]=0,p[5]=c,p[6]=p[7]=0,p[8]=(l-f)*h*.5,p[9]=-((o-u)*c*.5),p[10]=-i/(t-i),p[11]=1*s,p[12]=p[13]=p[15]=0,p[14]=-(2*i*t)/(i-t),n._markAsUpdated()},r.GetFinalMatrix=function(e,t,i,n,a,s){var o=e.width,u=e.height,l=e.x,f=e.y,h=r.FromValues(o/2,0,0,0,0,-u/2,0,0,0,0,s-a,0,l+o/2,u/2+f,a,1),c=k.Matrix[0];return t.multiplyToRef(i,c),c.multiplyToRef(n,c),c.multiply(h)},r.GetAsMatrix2x2=function(e){var t=e.m,i=[t[0],t[1],t[4],t[5]];return qe.MatrixUse64Bits?i:new Float32Array(i)},r.GetAsMatrix3x3=function(e){var t=e.m,i=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return qe.MatrixUse64Bits?i:new Float32Array(i)},r.Transpose=function(e){var t=new r;return r.TransposeToRef(e,t),t},r.TransposeToRef=function(e,t){var i=t._m,n=e.m;i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},r.Reflection=function(e){var t=new r;return r.ReflectionToRef(e,t),t},r.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,n=e.normal.y,a=e.normal.z,s=-2*i,o=-2*n,u=-2*a;r.FromValuesToRef(s*i+1,o*i,u*i,0,s*n,o*n+1,u*n,0,s*a,o*a,u*a+1,0,s*e.d,o*e.d,u*e.d,1,t)},r.FromXYZAxesToRef=function(e,t,i,n){r.FromValuesToRef(e._x,e._y,e._z,0,t._x,t._y,t._z,0,i._x,i._y,i._z,0,0,0,0,1,n)},r.FromQuaternionToRef=function(e,t){var i=e._x*e._x,n=e._y*e._y,a=e._z*e._z,s=e._x*e._y,o=e._z*e._w,u=e._z*e._x,l=e._y*e._w,f=e._y*e._z,h=e._x*e._w;t._m[0]=1-2*(n+a),t._m[1]=2*(s+o),t._m[2]=2*(u-l),t._m[3]=0,t._m[4]=2*(s-o),t._m[5]=1-2*(a+i),t._m[6]=2*(f+h),t._m[7]=0,t._m[8]=2*(u+l),t._m[9]=2*(f-h),t._m[10]=1-2*(n+i),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},r._updateFlagSeed=0,r._identityReadOnly=r.Identity(),r}(),k=function(){function r(){}return r.Vector3=be.BuildArray(6,y.Zero),r.Matrix=be.BuildArray(2,R.Identity),r.Quaternion=be.BuildArray(3,W.Zero),r}(),I=function(){function r(){}return r.Vector2=be.BuildArray(3,ne.Zero),r.Vector3=be.BuildArray(13,y.Zero),r.Vector4=be.BuildArray(3,Ue.Zero),r.Quaternion=be.BuildArray(2,W.Zero),r.Matrix=be.BuildArray(8,R.Identity),r}();_e.RegisteredTypes["BABYLON.Vector2"]=ne;_e.RegisteredTypes["BABYLON.Vector3"]=y;_e.RegisteredTypes["BABYLON.Vector4"]=Ue;_e.RegisteredTypes["BABYLON.Matrix"]=R;var ae=function(){function r(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.r=e,this.g=t,this.b=i}return r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},r.prototype.getClassName=function(){return"Color3"},r.prototype.getHashCode=function(){var e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.toColor4=function(e){return e===void 0&&(e=1),new fe(this.r,this.g,this.b,e)},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},r.prototype.multiply=function(e){return new r(this.r*e.r,this.g*e.g,this.b*e.b)},r.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},r.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},r.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},r.prototype.scale=function(e){return new r(this.r*e,this.g*e,this.b*e)},r.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},r.prototype.clampToRef=function(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=1),i.r=G.Clamp(this.r,e,t),i.g=G.Clamp(this.g,e,t),i.b=G.Clamp(this.b,e,t),this},r.prototype.add=function(e){return new r(this.r+e.r,this.g+e.g,this.b+e.b)},r.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},r.prototype.subtract=function(e){return new r(this.r-e.r,this.g-e.g,this.b-e.b)},r.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},r.prototype.clone=function(){return new r(this.r,this.g,this.b)},r.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},r.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},r.prototype.set=function(e,t,i){return this.copyFromFloats(e,t,i)},r.prototype.toHexString=function(){var e=this.r*255|0,t=this.g*255|0,i=this.b*255|0;return"#"+G.ToHex(e)+G.ToHex(t)+G.ToHex(i)},r.prototype.toLinearSpace=function(){var e=new r;return this.toLinearSpaceToRef(e),e},r.prototype.toHSV=function(){var e=new r;return this.toHSVToRef(e),e},r.prototype.toHSVToRef=function(e){var t=this.r,i=this.g,n=this.b,a=Math.max(t,i,n),s=Math.min(t,i,n),o=0,u=0,l=a,f=a-s;a!==0&&(u=f/a),a!=s&&(a==t?(o=(i-n)/f,i<n&&(o+=6)):a==i?o=(n-t)/f+2:a==n&&(o=(t-i)/f+4),o*=60),e.r=o,e.g=u,e.b=l},r.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,et),e.g=Math.pow(this.g,et),e.b=Math.pow(this.b,et),this},r.prototype.toGammaSpace=function(){var e=new r;return this.toGammaSpaceToRef(e),e},r.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Je),e.g=Math.pow(this.g,Je),e.b=Math.pow(this.b,Je),this},r.HSVtoRGBToRef=function(e,t,i,n){var a=i*t,s=e/60,o=a*(1-Math.abs(s%2-1)),u=0,l=0,f=0;s>=0&&s<=1?(u=a,l=o):s>=1&&s<=2?(u=o,l=a):s>=2&&s<=3?(l=a,f=o):s>=3&&s<=4?(l=o,f=a):s>=4&&s<=5?(u=o,f=a):s>=5&&s<=6&&(u=a,f=o);var h=i-a;n.set(u+h,l+h,f+h)},r.FromHexString=function(e){if(e.substring(0,1)!=="#"||e.length!==7)return new r(0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16);return r.FromInts(t,i,n)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2])},r.FromArrayToRef=function(e,t,i){t===void 0&&(t=0),i.r=e[t],i.g=e[t+1],i.b=e[t+2]},r.FromInts=function(e,t,i){return new r(e/255,t/255,i/255)},r.Lerp=function(e,t,i){var n=new r(0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i},r.Red=function(){return new r(1,0,0)},r.Green=function(){return new r(0,1,0)},r.Blue=function(){return new r(0,0,1)},r.Black=function(){return new r(0,0,0)},Object.defineProperty(r,"BlackReadOnly",{get:function(){return r._BlackReadOnly},enumerable:!1,configurable:!0}),r.White=function(){return new r(1,1,1)},r.Purple=function(){return new r(.5,0,.5)},r.Magenta=function(){return new r(1,0,1)},r.Yellow=function(){return new r(1,1,0)},r.Gray=function(){return new r(.5,.5,.5)},r.Teal=function(){return new r(0,1,1)},r.Random=function(){return new r(Math.random(),Math.random(),Math.random())},r._BlackReadOnly=r.Black(),r}(),fe=function(){function r(e,t,i,n){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),this.r=e,this.g=t,this.b=i,this.a=n}return r.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},r.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},r.prototype.toArray=function(e,t){return t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},r.prototype.fromArray=function(e,t){return t===void 0&&(t=0),r.FromArrayToRef(e,t,this),this},r.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},r.prototype.add=function(e){return new r(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)},r.prototype.subtract=function(e){return new r(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)},r.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},r.prototype.scale=function(e){return new r(this.r*e,this.g*e,this.b*e,this.a*e)},r.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},r.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},r.prototype.clampToRef=function(e,t,i){return e===void 0&&(e=0),t===void 0&&(t=1),i.r=G.Clamp(this.r,e,t),i.g=G.Clamp(this.g,e,t),i.b=G.Clamp(this.b,e,t),i.a=G.Clamp(this.a,e,t),this},r.prototype.multiply=function(e){return new r(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)},r.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},r.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},r.prototype.getClassName=function(){return"Color4"},r.prototype.getHashCode=function(){var e=this.r*255|0;return e=e*397^(this.g*255|0),e=e*397^(this.b*255|0),e=e*397^(this.a*255|0),e},r.prototype.clone=function(){return new r(this.r,this.g,this.b,this.a)},r.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},r.prototype.copyFromFloats=function(e,t,i,n){return this.r=e,this.g=t,this.b=i,this.a=n,this},r.prototype.set=function(e,t,i,n){return this.copyFromFloats(e,t,i,n)},r.prototype.toHexString=function(e){e===void 0&&(e=!1);var t=this.r*255|0,i=this.g*255|0,n=this.b*255|0;if(e)return"#"+G.ToHex(t)+G.ToHex(i)+G.ToHex(n);var a=this.a*255|0;return"#"+G.ToHex(t)+G.ToHex(i)+G.ToHex(n)+G.ToHex(a)},r.prototype.toLinearSpace=function(){var e=new r;return this.toLinearSpaceToRef(e),e},r.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,et),e.g=Math.pow(this.g,et),e.b=Math.pow(this.b,et),e.a=this.a,this},r.prototype.toGammaSpace=function(){var e=new r;return this.toGammaSpaceToRef(e),e},r.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Je),e.g=Math.pow(this.g,Je),e.b=Math.pow(this.b,Je),e.a=this.a,this},r.FromHexString=function(e){if(e.substring(0,1)!=="#"||e.length!==9)return new r(0,0,0,0);var t=parseInt(e.substring(1,3),16),i=parseInt(e.substring(3,5),16),n=parseInt(e.substring(5,7),16),a=parseInt(e.substring(7,9),16);return r.FromInts(t,i,n,a)},r.Lerp=function(e,t,i){var n=new r(0,0,0,0);return r.LerpToRef(e,t,i,n),n},r.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i},r.FromColor3=function(e,t){return t===void 0&&(t=1),new r(e.r,e.g,e.b,t)},r.FromArray=function(e,t){return t===void 0&&(t=0),new r(e[t],e[t+1],e[t+2],e[t+3])},r.FromArrayToRef=function(e,t,i){t===void 0&&(t=0),i.r=e[t],i.g=e[t+1],i.b=e[t+2],i.a=e[t+3]},r.FromInts=function(e,t,i,n){return new r(e/255,t/255,i/255,n/255)},r.CheckColors4=function(e,t){if(e.length===t*3){for(var i=[],n=0;n<e.length;n+=3){var a=n/3*4;i[a]=e[n],i[a+1]=e[n+1],i[a+2]=e[n+2],i[a+3]=1}return i}return e},r}(),Pt=function(){function r(){}return r.Color3=be.BuildArray(3,ae.Black),r.Color4=be.BuildArray(3,function(){return new fe(0,0,0,0)}),r}();_e.RegisteredTypes["BABYLON.Color3"]=ae;_e.RegisteredTypes["BABYLON.Color4"]=fe;var Ot={},Rt={},hi=function(r,e,t){var i=r();$&&$.AddTagsTo(i,e.tags);var n=Yt(i);for(var a in n){var s=n[a],o=e[a],u=s.type;if(o!=null&&a!=="uniqueId")switch(u){case 0:case 6:case 11:i[a]=o;break;case 1:i[a]=t||o.isRenderTarget?o:o.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[a]=t?o:o.clone();break}}return i};function or(r){var e=r.getClassName();return Ot[e]||(Ot[e]={}),Ot[e]}function Yt(r){var e=r.getClassName();if(Rt[e])return Rt[e];Rt[e]={};for(var t=Rt[e],i=r,n=e;n;){var a=Ot[n];for(var s in a)t[s]=a[s];var o=void 0,u=!1;do{if(o=Object.getPrototypeOf(i),!o.getClassName){u=!0;break}if(o.getClassName()!==n)break;i=o}while(o);if(u)break;n=o.getClassName(),i=o}return t}function Xe(r,e){return function(t,i){var n=or(t);n[i]||(n[i]={type:r,sourceName:e})}}function ur(r,e){return e===void 0&&(e=null),function(t,i){var n=e||"_"+i;Object.defineProperty(t,i,{get:function(){return this[n]},set:function(a){this[n]!==a&&(this[n]=a,t[r].apply(this))},enumerable:!0,configurable:!0})}}function Y(r,e){return e===void 0&&(e=null),ur(r,e)}function T(r){return Xe(0,r)}function Ce(r){return Xe(1,r)}function $e(r){return Xe(2,r)}function ut(r){return Xe(3,r)}function Ye(r){return Xe(5,r)}function lr(r){return Xe(6,r)}function fr(r){return Xe(7,r)}function hr(r){return Xe(8,r)}function cr(r){return Xe(10,r)}var H=function(){function r(){}return r.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var n=e.animations[i];t.animations.push(n.serialize())}}},r.Serialize=function(e,t){t||(t={}),$&&(t.tags=$.GetTags(e));var i=Yt(e);for(var n in i){var a=i[n],s=a.sourceName||n,o=a.type,u=e[n];if(u!=null&&n!=="uniqueId")switch(o){case 0:t[s]=u;break;case 1:t[s]=u.serialize();break;case 2:t[s]=u.asArray();break;case 3:t[s]=u.serialize();break;case 4:t[s]=u.asArray();break;case 5:t[s]=u.asArray();break;case 6:t[s]=u.id;break;case 7:t[s]=u.serialize();break;case 8:t[s]=u.asArray();break;case 9:t[s]=u.serialize();break;case 10:t[s]=u.asArray();break;case 11:t[s]=u.id;case 12:t[s]=u.asArray();break}}return t},r.Parse=function(e,t,i,n){n===void 0&&(n=null);var a=e();n||(n=""),$&&$.AddTagsTo(a,t.tags);var s=Yt(a);for(var o in s){var u=s[o],l=t[u.sourceName||o],f=u.type;if(l!=null&&o!=="uniqueId"){var h=a;switch(f){case 0:h[o]=l;break;case 1:i&&(h[o]=r._TextureParser(l,i,n));break;case 2:h[o]=ae.FromArray(l);break;case 3:h[o]=r._FresnelParametersParser(l);break;case 4:h[o]=ne.FromArray(l);break;case 5:h[o]=y.FromArray(l);break;case 6:i&&(h[o]=i.getLastMeshByID(l));break;case 7:h[o]=r._ColorCurvesParser(l);break;case 8:h[o]=fe.FromArray(l);break;case 9:h[o]=r._ImageProcessingConfigurationParser(l);break;case 10:h[o]=W.FromArray(l);break;case 11:i&&(h[o]=i.getCameraByID(l));case 12:h[o]=R.FromArray(l);break}}}return a},r.Clone=function(e,t){return hi(e,t,!1)},r.Instanciate=function(e,t){return hi(e,t,!0)},r._ImageProcessingConfigurationParser=function(e){throw O.WarnImport("ImageProcessingConfiguration")},r._FresnelParametersParser=function(e){throw O.WarnImport("FresnelParameters")},r._ColorCurvesParser=function(e){throw O.WarnImport("ColorCurves")},r._TextureParser=function(e,t,i){throw O.WarnImport("Texture")},r}(),xe=function(){function r(e,t){t===void 0&&(t=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=R.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new D,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||de.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return r.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},r.Construct=function(e,t,i,n){var a=this._NodeConstructors[e];return a?a(t,i,n):null},Object.defineProperty(r.prototype,"doNotSerialize",{get:function(){return this._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1},set:function(e){this._doNotSerialize=e},enumerable:!1,configurable:!0}),r.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(r.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var i=this._parentNode._children.indexOf(this);i!==-1&&this._parentNode._children.splice(i,1),!e&&!this._isDisposed&&this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),r.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},r.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var e=this._scene.rootNodes,t=e.length-1;e[this._sceneRootNodesIndex]=e[t],e[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(r.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"Node"},Object.defineProperty(r.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),r.prototype.getScene=function(){return this._scene},r.prototype.getEngine=function(){return this._scene.getEngine()},r.prototype.addBehavior=function(e,t){var i=this;t===void 0&&(t=!1);var n=this._behaviors.indexOf(e);return n!==-1?this:(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce(function(){e.attach(i)}):e.attach(this),this._behaviors.push(e),this)},r.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return t===-1?this:(this._behaviors[t].detach(),this._behaviors.splice(t,1),this)},Object.defineProperty(r.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),r.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},r.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},r.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(r.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),r.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},r.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},r.prototype._getActionManagerForTrigger=function(e,t){return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},r.prototype._updateCache=function(e){},r.prototype._isSynchronized=function(){return!0},r.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},r.prototype.isSynchronizedWithParent=function(){return this._parentNode?this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0},r.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()},r.prototype.isReady=function(e){return this._isReady},r.prototype.isEnabled=function(e){return e===void 0&&(e=!0),e===!1?this._isEnabled:this._isEnabled?this._isParentEnabled:!1},r.prototype._syncParentEnabledState=function(){this._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(function(e){e._syncParentEnabledState()})},r.prototype.setEnabled=function(e){this._isEnabled=e,this._syncParentEnabledState()},r.prototype.isDescendantOf=function(e){return this.parent?this.parent===e?!0:this.parent.isDescendantOf(e):!1},r.prototype._getDescendants=function(e,t,i){if(t===void 0&&(t=!1),!!this._children)for(var n=0;n<this._children.length;n++){var a=this._children[n];(!i||i(a))&&e.push(a),t||a._getDescendants(e,!1,i)}},r.prototype.getDescendants=function(e,t){var i=new Array;return this._getDescendants(i,e,t),i},r.prototype.getChildMeshes=function(e,t){var i=[];return this._getDescendants(i,e,function(n){return(!t||t(n))&&n.cullingStrategy!==void 0}),i},r.prototype.getChildren=function(e,t){return t===void 0&&(t=!0),this.getDescendants(t,e)},r.prototype._setReady=function(e){if(e!==this._isReady){if(!e){this._isReady=!1;return}this.onReady&&this.onReady(this),this._isReady=!0}},r.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},r.prototype.createAnimationRange=function(e,t,i){if(!this._ranges[e]){this._ranges[e]=r._AnimationRangeFactory(e,t,i);for(var n=0,a=this.animations.length;n<a;n++)this.animations[n]&&this.animations[n].createRange(e,t,i)}},r.prototype.deleteAnimationRange=function(e,t){t===void 0&&(t=!0);for(var i=0,n=this.animations.length;i<n;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=null},r.prototype.getAnimationRange=function(e){return this._ranges[e]||null},r.prototype.getAnimationRanges=function(){var e=[],t;for(t in this._ranges)e.push(this._ranges[t]);return e},r.prototype.beginAnimation=function(e,t,i,n){var a=this.getAnimationRange(e);return a?this._scene.beginAnimation(this,a.from,a.to,t,i,n):null},r.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i=this._ranges[t];if(!!i){var n={};n.name=t,n.from=i.from,n.to=i.to,e.push(n)}}return e},r.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=R.Identity()),this._worldMatrix},r.prototype.dispose=function(e,t){if(t===void 0&&(t=!1),this._isDisposed=!0,!e)for(var i=this.getDescendants(!0),n=0,a=i;n<a.length;n++){var s=a[n];s.dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var o=0,u=this._behaviors;o<u.length;o++){var l=u[o];l.detach()}this._behaviors=[]},r.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var n=0;n<t.ranges.length;n++){var a=t.ranges[n];e.createAnimationRange(a.name,a.from,a.to)}},r.prototype.getHierarchyBoundingVectors=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var i,n,a=this;if(a.getBoundingInfo&&a.subMeshes){var s=a.getBoundingInfo();i=s.boundingBox.minimumWorld.clone(),n=s.boundingBox.maximumWorld.clone()}else i=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var o=this.getDescendants(!1),u=0,l=o;u<l.length;u++){var f=l[u],h=f;if(h.computeWorldMatrix(!0),!(t&&!t(h))&&!(!h.getBoundingInfo||h.getTotalVertices()===0)){var c=h.getBoundingInfo(),p=c.boundingBox,d=p.minimumWorld,g=p.maximumWorld;y.CheckExtends(d,i,n),y.CheckExtends(g,i,n)}}return{min:i,max:n}},r._AnimationRangeFactory=function(e,t,i){throw O.WarnImport("AnimationRange")},r._NodeConstructors={},b([T()],r.prototype,"name",void 0),b([T()],r.prototype,"id",void 0),b([T()],r.prototype,"uniqueId",void 0),b([T()],r.prototype,"state",void 0),b([T()],r.prototype,"metadata",void 0),r}(),ze;(function(r){r[r.LOCAL=0]="LOCAL",r[r.WORLD=1]="WORLD",r[r.BONE=2]="BONE"})(ze||(ze={}));var qt=function(){function r(){}return r.X=new y(1,0,0),r.Y=new y(0,1,0),r.Z=new y(0,0,1),r}(),ci;(function(r){r[r.X=0]="X",r[r.Y=1]="Y",r[r.Z=2]="Z"})(ci||(ci={}));var Re=function(r){N(e,r);function e(t,i,n){i===void 0&&(i=null),n===void 0&&(n=!0);var a=r.call(this,t,i)||this;return a._forward=new y(0,0,1),a._forwardInverted=new y(0,0,-1),a._up=new y(0,1,0),a._right=new y(1,0,0),a._rightInverted=new y(-1,0,0),a._position=y.Zero(),a._rotation=y.Zero(),a._rotationQuaternion=null,a._scaling=y.One(),a._isDirty=!1,a._transformToBoneReferal=null,a._isAbsoluteSynced=!1,a._billboardMode=e.BILLBOARDMODE_NONE,a._preserveParentRotationForBillboard=!1,a.scalingDeterminant=1,a._infiniteDistance=!1,a.ignoreNonUniformScaling=!1,a.reIntegrateRotationIntoRotationQuaternion=!1,a._poseMatrix=null,a._localMatrix=R.Zero(),a._usePivotMatrix=!1,a._absolutePosition=y.Zero(),a._absoluteScaling=y.Zero(),a._absoluteRotationQuaternion=W.Identity(),a._pivotMatrix=R.Identity(),a._postMultiplyPivotMatrix=!1,a._isWorldMatrixFrozen=!1,a._indexInSceneTransformNodesArray=-1,a.onAfterWorldMatrixUpdateObservable=new D,a._nonUniformScaling=!1,n&&a.getScene().addTransformNode(a),a}return Object.defineProperty(e.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(t){this._billboardMode!==t&&(this._billboardMode=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(t){t!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(t){this._infiniteDistance!==t&&(this._infiniteDistance=t)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation=t,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(t){this._rotationQuaternion=t,t&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return y.Normalize(y.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return y.Normalize(y.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return y.Normalize(y.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),e.prototype.updatePoseMatrix=function(t){return this._poseMatrix?(this._poseMatrix.copyFrom(t),this):(this._poseMatrix=t.clone(),this)},e.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=R.Identity()),this._poseMatrix},e.prototype._isSynchronized=function(){var t=this._cache;return!(this.billboardMode!==t.billboardMode||this.billboardMode!==e.BILLBOARDMODE_NONE||t.pivotMatrixUpdated||this.infiniteDistance||this.position._isDirty||this.scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},e.prototype._initCache=function(){r.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1},e.prototype.markAsDirty=function(t){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(e.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),e.prototype.setPreTransformMatrix=function(t){return this.setPivotMatrix(t,!1)},e.prototype.setPivotMatrix=function(t,i){return i===void 0&&(i=!0),this._pivotMatrix.copyFrom(t),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=i,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=R.Invert(this._pivotMatrix)),this},e.prototype.getPivotMatrix=function(){return this._pivotMatrix},e.prototype.instantiateHierarchy=function(t,i,n){t===void 0&&(t=null);var a=this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);a&&n&&n(this,a);for(var s=0,o=this.getChildTransformNodes(!0);s<o.length;s++){var u=o[s];u.instantiateHierarchy(a,i,n)}return a},e.prototype.freezeWorldMatrix=function(t){return t===void 0&&(t=null),t?this._worldMatrix=t:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},e.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(e.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),e.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},e.prototype.setAbsolutePosition=function(t){if(!t)return this;var i,n,a;if(t.x===void 0){if(arguments.length<3)return this;i=arguments[0],n=arguments[1],a=arguments[2]}else i=t.x,n=t.y,a=t.z;if(this.parent){var s=I.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),y.TransformCoordinatesFromFloatsToRef(i,n,a,s,this.position)}else this.position.x=i,this.position.y=n,this.position.z=a;return this._absolutePosition.copyFrom(t),this},e.prototype.setPositionWithLocalVector=function(t){return this.computeWorldMatrix(),this.position=y.TransformNormal(t,this._localMatrix),this},e.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=I.Matrix[0];return this._localMatrix.invertToRef(t),y.TransformNormal(this.position,t)},e.prototype.locallyTranslate=function(t){return this.computeWorldMatrix(!0),this.position=y.TransformCoordinates(t,this._localMatrix),this},e.prototype.lookAt=function(t,i,n,a,s){i===void 0&&(i=0),n===void 0&&(n=0),a===void 0&&(a=0),s===void 0&&(s=ze.LOCAL);var o=e._lookAtVectorCache,u=s===ze.LOCAL?this.position:this.getAbsolutePosition();if(t.subtractToRef(u,o),this.setDirection(o,i,n,a),s===ze.WORLD&&this.parent)if(this.rotationQuaternion){var l=I.Matrix[0];this.rotationQuaternion.toRotationMatrix(l);var f=I.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),l.multiplyToRef(f,l),this.rotationQuaternion.fromRotationMatrix(l)}else{var h=I.Quaternion[0];W.FromEulerVectorToRef(this.rotation,h);var l=I.Matrix[0];h.toRotationMatrix(l);var f=I.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(f),f.invert(),l.multiplyToRef(f,l),h.fromRotationMatrix(l),h.toEulerAnglesToRef(this.rotation)}return this},e.prototype.getDirection=function(t){var i=y.Zero();return this.getDirectionToRef(t,i),i},e.prototype.getDirectionToRef=function(t,i){return y.TransformNormalToRef(t,this.getWorldMatrix(),i),this},e.prototype.setDirection=function(t,i,n,a){i===void 0&&(i=0),n===void 0&&(n=0),a===void 0&&(a=0);var s=-Math.atan2(t.z,t.x)+Math.PI/2,o=Math.sqrt(t.x*t.x+t.z*t.z),u=-Math.atan2(t.y,o);return this.rotationQuaternion?W.RotationYawPitchRollToRef(s+i,u+n,a,this.rotationQuaternion):(this.rotation.x=u+n,this.rotation.y=s+i,this.rotation.z=a),this},e.prototype.setPivotPoint=function(t,i){i===void 0&&(i=ze.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var n=this.getWorldMatrix();if(i==ze.WORLD){var a=I.Matrix[0];n.invertToRef(a),t=y.TransformCoordinates(t,a)}return this.setPivotMatrix(R.Translation(-t.x,-t.y,-t.z),!0)},e.prototype.getPivotPoint=function(){var t=y.Zero();return this.getPivotPointToRef(t),t},e.prototype.getPivotPointToRef=function(t){return t.x=-this._pivotMatrix.m[12],t.y=-this._pivotMatrix.m[13],t.z=-this._pivotMatrix.m[14],this},e.prototype.getAbsolutePivotPoint=function(){var t=y.Zero();return this.getAbsolutePivotPointToRef(t),t},e.prototype.getAbsolutePivotPointToRef=function(t){return this.getPivotPointToRef(t),y.TransformCoordinatesToRef(t,this.getWorldMatrix(),t),this},e.prototype.setParent=function(t){if(!t&&!this.parent)return this;var i=I.Quaternion[0],n=I.Vector3[0],a=I.Vector3[1];if(!t)this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(a,i,n);else{var s=I.Matrix[0],o=I.Matrix[1];this.computeWorldMatrix(!0),t.computeWorldMatrix(!0),t.getWorldMatrix().invertToRef(o),this.getWorldMatrix().multiplyToRef(o,s),s.decompose(a,i,n)}return this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(a),this.position.copyFrom(n),this.parent=t,this},Object.defineProperty(e.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),e.prototype._updateNonUniformScalingState=function(t){return this._nonUniformScaling===t?!1:(this._nonUniformScaling=t,!0)},e.prototype.attachToBone=function(t,i){return this._transformToBoneReferal=i,this.parent=t,t.getSkeleton().prepare(),t.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},e.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},e.prototype.rotate=function(t,i,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));var a;if(!n||n===ze.LOCAL)a=W.RotationAxisToRef(t,i,e._rotationAxisCache),this.rotationQuaternion.multiplyToRef(a,this.rotationQuaternion);else{if(this.parent){var s=I.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),t=y.TransformNormal(t,s)}a=W.RotationAxisToRef(t,i,e._rotationAxisCache),a.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},e.prototype.rotateAround=function(t,i,n){i.normalize(),this.rotationQuaternion||(this.rotationQuaternion=W.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var a=I.Vector3[0],s=I.Vector3[1],o=I.Vector3[2],u=I.Quaternion[0],l=I.Matrix[0],f=I.Matrix[1],h=I.Matrix[2],c=I.Matrix[3];return t.subtractToRef(this.position,a),R.TranslationToRef(a.x,a.y,a.z,l),R.TranslationToRef(-a.x,-a.y,-a.z,f),R.RotationAxisToRef(i,n,h),f.multiplyToRef(h,c),c.multiplyToRef(l,c),c.decompose(s,u,o),this.position.addInPlace(o),u.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},e.prototype.translate=function(t,i,n){var a=t.scale(i);if(!n||n===ze.LOCAL){var s=this.getPositionExpressedInLocalSpace().add(a);this.setPositionWithLocalVector(s)}else this.setAbsolutePosition(this.getAbsolutePosition().add(a));return this},e.prototype.addRotation=function(t,i,n){var a;this.rotationQuaternion?a=this.rotationQuaternion:(a=I.Quaternion[1],W.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,a));var s=I.Quaternion[0];return W.RotationYawPitchRollToRef(i,t,n,s),a.multiplyInPlace(s),this.rotationQuaternion||a.toEulerAnglesToRef(this.rotation),this},e.prototype._getEffectiveParent=function(){return this.parent},e.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var i=this.getScene().getRenderId();if(!this._isDirty&&!t&&this.isSynchronized())return this._currentRenderId=i,this._worldMatrix;var n=this.getScene().activeCamera,a=(this._billboardMode&e.BILLBOARDMODE_USE_POSITION)!==0,s=this._billboardMode!==e.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;s&&n&&a&&(this.lookAt(n.position),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,this._currentRenderId=i,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var u=this._getEffectiveParent(),l=e._TmpScaling,f=this._position;if(this._infiniteDistance&&!this.parent&&n){var h=n.getWorldMatrix(),c=new y(h.m[12],h.m[13],h.m[14]);f=e._TmpTranslation,f.copyFromFloats(this._position.x+c.x,this._position.y+c.y,this._position.z+c.z)}l.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var p;if(this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,p=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){var d=this.rotation.lengthSquared();d&&(this._rotationQuaternion.multiplyInPlace(W.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else p=e._TmpRotation,W.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,p);if(this._usePivotMatrix){var g=I.Matrix[1];R.ScalingToRef(l.x,l.y,l.z,g);var m=I.Matrix[0];p.toRotationMatrix(m),this._pivotMatrix.multiplyToRef(g,I.Matrix[4]),I.Matrix[4].multiplyToRef(m,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(f.x,f.y,f.z)}else R.ComposeToRef(l,p,f,this._localMatrix);if(u&&u.getWorldMatrix){if(t&&u.computeWorldMatrix(),s){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),I.Matrix[7]):I.Matrix[7].copyFrom(u.getWorldMatrix());var E=I.Vector3[5],v=I.Vector3[6];I.Matrix[7].decompose(v,void 0,E),R.ScalingToRef(v.x,v.y,v.z,I.Matrix[7]),I.Matrix[7].setTranslation(E),this._localMatrix.multiplyToRef(I.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),I.Matrix[6]),I.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s&&n&&this.billboardMode&&!a){var A=I.Vector3[0];if(this._worldMatrix.getTranslationToRef(A),I.Matrix[1].copyFrom(n.getViewMatrix()),I.Matrix[1].setTranslationFromFloats(0,0,0),I.Matrix[1].invertToRef(I.Matrix[0]),(this.billboardMode&e.BILLBOARDMODE_ALL)!==e.BILLBOARDMODE_ALL){I.Matrix[0].decompose(void 0,I.Quaternion[0],void 0);var M=I.Vector3[1];I.Quaternion[0].toEulerAnglesToRef(M),(this.billboardMode&e.BILLBOARDMODE_X)!==e.BILLBOARDMODE_X&&(M.x=0),(this.billboardMode&e.BILLBOARDMODE_Y)!==e.BILLBOARDMODE_Y&&(M.y=0),(this.billboardMode&e.BILLBOARDMODE_Z)!==e.BILLBOARDMODE_Z&&(M.z=0),R.RotationYawPitchRollToRef(M.y,M.x,M.z,I.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(I.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(I.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=R.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},e.prototype.resetLocalMatrix=function(t){if(t===void 0&&(t=!0),this.computeWorldMatrix(),t)for(var i=this.getChildren(),n=0;n<i.length;++n){var a=i[n];if(a){a.computeWorldMatrix();var s=I.Matrix[0];a._localMatrix.multiplyToRef(this._localMatrix,s);var o=I.Quaternion[0];s.decompose(a.scaling,o,a.position),a.rotationQuaternion?a.rotationQuaternion=o:o.toEulerAnglesToRef(a.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=W.Identity()),this._worldMatrix=R.Identity()},e.prototype._afterComputeWorldMatrix=function(){},e.prototype.registerAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.add(t),this},e.prototype.unregisterAfterWorldMatrixUpdate=function(t){return this.onAfterWorldMatrixUpdateObservable.removeCallback(t),this},e.prototype.getPositionInCameraSpace=function(t){return t===void 0&&(t=null),t||(t=this.getScene().activeCamera),y.TransformCoordinates(this.getAbsolutePosition(),t.getViewMatrix())},e.prototype.getDistanceToCamera=function(t){return t===void 0&&(t=null),t||(t=this.getScene().activeCamera),this.getAbsolutePosition().subtract(t.globalPosition).length()},e.prototype.clone=function(t,i,n){var a=this,s=H.Clone(function(){return new e(t,a.getScene())},this);if(s.name=t,s.id=t,i&&(s.parent=i),!n)for(var o=this.getDescendants(!0),u=0;u<o.length;u++){var l=o[u];l.clone&&l.clone(t+"."+l.name,s)}return s},e.prototype.serialize=function(t){var i=H.Serialize(this,t);return i.type=this.getClassName(),this.parent&&(i.parentId=this.parent.id),i.localMatrix=this.getPivotMatrix().asArray(),i.isEnabled=this.isEnabled(),this.parent&&(i.parentId=this.parent.id),i},e.Parse=function(t,i,n){var a=H.Parse(function(){return new e(t.name,i)},t,i,n);return t.localMatrix?a.setPreTransformMatrix(R.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(R.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),t.parentId&&(a._waitingParentId=t.parentId),a},e.prototype.getChildTransformNodes=function(t,i){var n=[];return this._getDescendants(n,t,function(a){return(!i||i(a))&&a instanceof e}),n},e.prototype.dispose=function(t,i){if(i===void 0&&(i=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var n=this.getChildTransformNodes(!0),a=0,s=n;a<s.length;a++){var o=s[a];o.parent=null,o.computeWorldMatrix(!0)}r.prototype.dispose.call(this,t,i)},e.prototype.normalizeToUnitCube=function(t,i,n){t===void 0&&(t=!0),i===void 0&&(i=!1);var a=null,s=null;i&&(this.rotationQuaternion?(s=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(a=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var o=this.getHierarchyBoundingVectors(t,n),u=o.max.subtract(o.min),l=Math.max(u.x,u.y,u.z);if(l===0)return this;var f=1/l;return this.scaling.scaleInPlace(f),i&&(this.rotationQuaternion&&s?this.rotationQuaternion.copyFrom(s):this.rotation&&a&&this.rotation.copyFrom(a)),this},e.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},e.BILLBOARDMODE_NONE=0,e.BILLBOARDMODE_X=1,e.BILLBOARDMODE_Y=2,e.BILLBOARDMODE_Z=4,e.BILLBOARDMODE_ALL=7,e.BILLBOARDMODE_USE_POSITION=128,e._TmpRotation=W.Zero(),e._TmpScaling=y.Zero(),e._TmpTranslation=y.Zero(),e._lookAtVectorCache=new y(0,0,0),e._rotationAxisCache=new W,b([Ye("position")],e.prototype,"_position",void 0),b([Ye("rotation")],e.prototype,"_rotation",void 0),b([cr("rotationQuaternion")],e.prototype,"_rotationQuaternion",void 0),b([Ye("scaling")],e.prototype,"_scaling",void 0),b([T("billboardMode")],e.prototype,"_billboardMode",void 0),b([T()],e.prototype,"scalingDeterminant",void 0),b([T("infiniteDistance")],e.prototype,"_infiniteDistance",void 0),b([T()],e.prototype,"ignoreNonUniformScaling",void 0),b([T()],e.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),e}(xe),dr=function(){function r(e){e===void 0&&(e=30),this._enabled=!0,this._rollingFrameTime=new pr(e)}return r.prototype.sampleFrame=function(e){if(e===void 0&&(e=Ve.Now),!!this._enabled){if(this._lastFrameTimeMs!=null){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(r.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return e===0?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),r.prototype.enable=function(){this._enabled=!0},r.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},r}(),pr=function(){function r(e){this._samples=new Array(e),this.reset()}return r.prototype.add=function(e){var t;if(this.isSaturated()){var i=this._samples[this._pos];t=i-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(i-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},r.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},r.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},r.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},r.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},r}(),ht=function(){function r(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(r.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),r.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},r.prototype.addCount=function(e,t){!r.Enabled||(this._current+=e,t&&this._fetchResult())},r.prototype.beginMonitoring=function(){!r.Enabled||(this._startMonitoringTime=Ve.Now)},r.prototype.endMonitoring=function(e){if(e===void 0&&(e=!0),!!r.Enabled){e&&this.fetchNewFrame();var t=Ve.Now;this._current=t-this._startMonitoringTime,e&&this._fetchResult()}},r.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=Ve.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},r.Enabled=!0,r}();pe.prototype.setAlphaConstants=function(r,e,t,i){this._alphaState.setAlphaBlendConstants(r,e,t,i)};pe.prototype.setAlphaMode=function(r,e){if(e===void 0&&(e=!1),this._alphaMode!==r){switch(r){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break}e||(this.depthCullingState.depthMask=r===0),this._alphaMode=r}};pe.prototype.getAlphaMode=function(){return this._alphaMode};pe.prototype.setAlphaEquation=function(r){if(this._alphaEquation!==r){switch(r){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD);break}this._alphaEquation=r}};pe.prototype.getAlphaEquation=function(){return this._alphaEquation};pe.prototype._readTexturePixels=function(r,e,t,i,n,a){i===void 0&&(i=-1),n===void 0&&(n=0),a===void 0&&(a=null);var s=this._gl;if(!s)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var o=s.createFramebuffer();if(!o)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=o}s.bindFramebuffer(s.FRAMEBUFFER,this._dummyFramebuffer),i>-1?s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+i,r._webGLTexture,n):s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r._webGLTexture,n);var u=r.type!==void 0?this._getWebGLTextureType(r.type):s.UNSIGNED_BYTE;switch(u){case s.UNSIGNED_BYTE:a||(a=new Uint8Array(4*e*t)),u=s.UNSIGNED_BYTE;break;default:a||(a=new Float32Array(4*e*t)),u=s.FLOAT;break}return s.readPixels(0,0,e,t,s.RGBA,u,a),s.bindFramebuffer(s.FRAMEBUFFER,this._currentFramebuffer),a};pe.prototype.updateDynamicIndexBuffer=function(r,e,t){this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(r);var i;e instanceof Uint16Array||e instanceof Uint32Array?i=e:i=r.is32Bits?new Uint32Array(e):new Uint16Array(e),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()};pe.prototype.updateDynamicVertexBuffer=function(r,e,t,i){this.bindArrayBuffer(r),t===void 0&&(t=0);var n=e.length||e.byteLength;i===void 0||i>=n&&t===0?e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,new Float32Array(e)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,t,e):e instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(e).subarray(t,t+i)):(e instanceof ArrayBuffer?e=new Uint8Array(e,t,i):e=new Uint8Array(e.buffer,e.byteOffset+t,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)),this._resetVertexBufferBinding()};var ce=function(r){N(e,r);function e(t,i,n,a){a===void 0&&(a=!1);var s=r.call(this,t,i,n,a)||this;if(s.enableOfflineSupport=!1,s.disableManifestCheck=!1,s.scenes=new Array,s.onNewSceneAddedObservable=new D,s.postProcesses=new Array,s.isPointerLock=!1,s.onResizeObservable=new D,s.onCanvasBlurObservable=new D,s.onCanvasFocusObservable=new D,s.onCanvasPointerOutObservable=new D,s.onBeginFrameObservable=new D,s.customAnimationFrameRequester=null,s.onEndFrameObservable=new D,s.onBeforeShaderCompilationObservable=new D,s.onAfterShaderCompilationObservable=new D,s._deterministicLockstep=!1,s._lockstepMaxSteps=4,s._timeStep=1/60,s._fps=60,s._deltaTime=0,s._drawCalls=new ht,s.canvasTabIndex=1,s.disablePerformanceMonitorInBackground=!1,s._performanceMonitor=new dr,e.Instances.push(s),!t)return s;if(n=s._creationOptions,t.getContext){var o=t;if(s._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},s._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},o.addEventListener("focus",s._onCanvasFocus),o.addEventListener("blur",s._onCanvasBlur),s._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},s._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},s._onCanvasPointerOut=function(f){s.onCanvasPointerOutObservable.notifyObservers(f)},o.addEventListener("pointerout",s._onCanvasPointerOut),oe.IsWindowObjectExist()){var u=s.getHostWindow();u.addEventListener("blur",s._onBlur),u.addEventListener("focus",s._onFocus);var l=document;s._onFullscreenChange=function(){l.fullscreen!==void 0?s.isFullscreen=l.fullscreen:l.mozFullScreen!==void 0?s.isFullscreen=l.mozFullScreen:l.webkitIsFullScreen!==void 0?s.isFullscreen=l.webkitIsFullScreen:l.msIsFullScreen!==void 0&&(s.isFullscreen=l.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&o&&e._RequestPointerlock(o)},document.addEventListener("fullscreenchange",s._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",s._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",s._onFullscreenChange,!1),s._onPointerLockChange=function(){s.isPointerLock=l.mozPointerLockElement===o||l.webkitPointerLockElement===o||l.msPointerLockElement===o||l.pointerLockElement===o},document.addEventListener("pointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",s._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",s._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",s._onPointerLockChange,!1),!e.audioEngine&&n.audioEngine&&e.AudioEngineFactory&&(e.audioEngine=e.AudioEngineFactory(s.getRenderingCanvas()))}s._connectVREvents(),s.enableOfflineSupport=e.OfflineProviderFactory!==void 0,n.doNotHandleTouchAction||s._disableTouchAction(),s._deterministicLockstep=!!n.deterministicLockstep,s._lockstepMaxSteps=n.lockstepMaxSteps||0,s._timeStep=n.timeStep||1/60}return s._prepareVRComponent(),n.autoEnableWebVR&&s.initWebVR(),s}return Object.defineProperty(e,"NpmPackage",{get:function(){return pe.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return pe.Version},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Instances",{get:function(){return de.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedEngine",{get:function(){return de.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return de.LastCreatedScene},enumerable:!1,configurable:!0}),e.MarkAllMaterialsAsDirty=function(t,i){for(var n=0;n<e.Instances.length;n++)for(var a=e.Instances[n],s=0;s<a.scenes.length;s++)a.scenes[s].markAllMaterialsAsDirty(t,i)},e.DefaultLoadingScreenFactory=function(t){throw O.WarnImport("LoadingScreen")},Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!e._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),e.prototype.getInputElement=function(){return this._renderingCanvas},e.prototype.getAspectRatio=function(t,i){i===void 0&&(i=!1);var n=t.viewport;return this.getRenderWidth(i)*n.width/(this.getRenderHeight(i)*n.height)},e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},e.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},e.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},e.prototype.getTimeStep=function(){return this._timeStep*1e3},e.prototype.generateMipMapsForCubemap=function(t,i){if(i===void 0&&(i=!0),t.generateMipMaps){var n=this._gl;this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,t,!0),n.generateMipmap(n.TEXTURE_CUBE_MAP),i&&this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null)}},e.prototype.setState=function(t,i,n,a){i===void 0&&(i=0),a===void 0&&(a=!1),(this._depthCullingState.cull!==t||n)&&(this._depthCullingState.cull=t);var s=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==s||n)&&(this._depthCullingState.cullFace=s),this.setZOffset(i);var o=a?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==o||n)&&(this._depthCullingState.frontFace=o)},e.prototype.setZOffset=function(t){this._depthCullingState.zOffset=t},e.prototype.getZOffset=function(){return this._depthCullingState.zOffset},e.prototype.setDepthBuffer=function(t){this._depthCullingState.depthTest=t},e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},e.prototype.setDepthWrite=function(t){this._depthCullingState.depthMask=t},e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},e.prototype.setStencilBuffer=function(t){this._stencilState.stencilTest=t},e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},e.prototype.setStencilMask=function(t){this._stencilState.stencilMask=t},e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},e.prototype.setStencilFunction=function(t){this._stencilState.stencilFunc=t},e.prototype.setStencilFunctionReference=function(t){this._stencilState.stencilFuncRef=t},e.prototype.setStencilFunctionMask=function(t){this._stencilState.stencilFuncMask=t},e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},e.prototype.setStencilOperationFail=function(t){this._stencilState.stencilOpStencilFail=t},e.prototype.setStencilOperationDepthFail=function(t){this._stencilState.stencilOpDepthFail=t},e.prototype.setStencilOperationPass=function(t){this._stencilState.stencilOpStencilDepthPass=t},e.prototype.setDitheringState=function(t){t?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},e.prototype.setRasterizerState=function(t){t?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},e.prototype.setDepthFunction=function(t){this._depthCullingState.depthFunc=t},e.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},e.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},e.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},e.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},e.prototype.setDirectViewport=function(t,i,n,a){var s=this._cachedViewport;return this._cachedViewport=null,this._viewport(t,i,n,a),s},e.prototype.scissorClear=function(t,i,n,a,s){this.enableScissor(t,i,n,a),this.clear(s,!0,!0,!0),this.disableScissor()},e.prototype.enableScissor=function(t,i,n,a){var s=this._gl;s.enable(s.SCISSOR_TEST),s.scissor(t,i,n,a)},e.prototype.disableScissor=function(){var t=this._gl;t.disable(t.SCISSOR_TEST)},e.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},e.prototype.initWebVR=function(){throw O.WarnImport("WebVRCamera")},e.prototype._prepareVRComponent=function(){},e.prototype._connectVREvents=function(t,i){},e.prototype._submitVRFrame=function(){},e.prototype.disableVR=function(){},e.prototype.isVRPresenting=function(){return!1},e.prototype._requestVRFrame=function(){},e.prototype._loadFileAsync=function(t,i,n){var a=this;return new Promise(function(s,o){a._loadFile(t,function(u){s(u)},void 0,i,n,function(u,l){o(l)})})},e.prototype.getVertexShaderSource=function(t){var i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[0]):null},e.prototype.getFragmentShaderSource=function(t){var i=this._gl.getAttachedShaders(t);return i?this._gl.getShaderSource(i[1]):null},e.prototype.setDepthStencilTexture=function(t,i,n){t!==void 0&&(i&&(this._boundUniforms[t]=i),!n||!n.depthStencilTexture?this._setTexture(t,null):this._setTexture(t,n,!1,!0))},e.prototype.setTextureFromPostProcess=function(t,i){this._bindTexture(t,i?i._textures.data[i._currentRenderTextureInd]:null)},e.prototype.setTextureFromPostProcessOutput=function(t,i){this._bindTexture(t,i?i._outputTexture:null)},e.prototype._rebuildBuffers=function(){for(var t=0,i=this.scenes;t<i.length;t++){var n=i[t];n.resetCachedMaterial(),n._rebuildGeometries(),n._rebuildTextures()}r.prototype._rebuildBuffers.call(this)},e.prototype._renderFrame=function(){for(var t=0;t<this._activeRenderLoops.length;t++){var i=this._activeRenderLoops[t];i()}},e.prototype._renderLoop=function(){if(!this._contextWasLost){var t=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1),t&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype._renderViews=function(){return!1},e.prototype.switchFullscreen=function(t){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(t)},e.prototype.enterFullscreen=function(t){this.isFullscreen||(this._pointerLockRequested=t,this._renderingCanvas&&e._RequestFullscreen(this._renderingCanvas))},e.prototype.exitFullscreen=function(){this.isFullscreen&&e._ExitFullscreen()},e.prototype.enterPointerlock=function(){this._renderingCanvas&&e._RequestPointerlock(this._renderingCanvas)},e.prototype.exitPointerlock=function(){e._ExitPointerlock()},e.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),r.prototype.beginFrame.call(this)},e.prototype.endFrame=function(){r.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},e.prototype.resize=function(){this.isVRPresenting()||r.prototype.resize.call(this)},e.prototype.setSize=function(t,i){if(!this._renderingCanvas||!r.prototype.setSize.call(this,t,i))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var a=this.scenes[n],s=0;s<a.cameras.length;s++){var o=a.cameras[s];o._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},e.prototype._deletePipelineContext=function(t){var i=t;i&&i.program&&i.transformFeedback&&(this.deleteTransformFeedback(i.transformFeedback),i.transformFeedback=null),r.prototype._deletePipelineContext.call(this,t)},e.prototype.createShaderProgram=function(t,i,n,a,s,o){o===void 0&&(o=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var u=r.prototype.createShaderProgram.call(this,t,i,n,a,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),u},e.prototype._createShaderProgram=function(t,i,n,a,s){s===void 0&&(s=null);var o=a.createProgram();if(t.program=o,!o)throw new Error("Unable to create program");if(a.attachShader(o,i),a.attachShader(o,n),this.webGLVersion>1&&s){var u=this.createTransformFeedback();this.bindTransformFeedback(u),this.setTranformFeedbackVaryings(o,s),t.transformFeedback=u}return a.linkProgram(o),this.webGLVersion>1&&s&&this.bindTransformFeedback(null),t.context=a,t.vertexShader=i,t.fragmentShader=n,t.isParallelCompiled||this._finalizePipelineContext(t),o},e.prototype._releaseTexture=function(t){r.prototype._releaseTexture.call(this,t),this.scenes.forEach(function(i){i.postProcesses.forEach(function(n){n._outputTexture==t&&(n._outputTexture=null)}),i.cameras.forEach(function(n){n._postProcesses.forEach(function(a){a&&a._outputTexture==t&&(a._outputTexture=null)})})})},e.prototype._rescaleTexture=function(t,i,n,a,s){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var u=this.createRenderTargetTexture({width:i.width,height:i.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&e._RescalePostProcessFactory&&(this._rescalePostProcess=e._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){o._rescalePostProcess.onApply=function(f){f._bindTexture("textureSampler",t)};var l=n;l||(l=o.scenes[o.scenes.length-1]),l.postProcessManager.directRender([o._rescalePostProcess],u,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,i,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,a,0,0,i.width,i.height,0),o.unBindFramebuffer(u),o._releaseTexture(u),s&&s()})},e.prototype.getFps=function(){return this._fps},e.prototype.getDeltaTime=function(){return this._deltaTime},e.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},e.prototype._uploadImageToTexture=function(t,i,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var s=this._gl,o=this._getWebGLTextureType(t.type),u=this._getInternalFormat(t.format),l=this._getRGBABufferInternalSizedFormat(t.type,u),f=t.isCube?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D;this._bindTextureDirectly(f,t,!0),this._unpackFlipY(t.invertY);var h=s.TEXTURE_2D;t.isCube&&(h=s.TEXTURE_CUBE_MAP_POSITIVE_X+n),s.texImage2D(h,a,l,u,o,i),this._bindTextureDirectly(f,null,!0)},e.prototype.updateRenderTargetTextureSampleCount=function(t,i){if(this.webGLVersion<2||!t)return 1;if(t.samples===i)return i;var n=this._gl;if(i=Math.min(i,this.getCaps().maxMSAASamples),t._depthStencilBuffer&&(n.deleteRenderbuffer(t._depthStencilBuffer),t._depthStencilBuffer=null),t._MSAAFramebuffer&&(n.deleteFramebuffer(t._MSAAFramebuffer),t._MSAAFramebuffer=null),t._MSAARenderBuffer&&(n.deleteRenderbuffer(t._MSAARenderBuffer),t._MSAARenderBuffer=null),i>1&&n.renderbufferStorageMultisample){var a=n.createFramebuffer();if(!a)throw new Error("Unable to create multi sampled framebuffer");t._MSAAFramebuffer=a,this._bindUnboundFramebuffer(t._MSAAFramebuffer);var s=n.createRenderbuffer();if(!s)throw new Error("Unable to create multi sampled framebuffer");n.bindRenderbuffer(n.RENDERBUFFER,s),n.renderbufferStorageMultisample(n.RENDERBUFFER,i,this._getRGBAMultiSampleBufferFormat(t.type),t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,s),t._MSAARenderBuffer=s}else this._bindUnboundFramebuffer(t._framebuffer);return t.samples=i,t._depthStencilBuffer=this._setupFramebufferDepthAttachments(t._generateStencilBuffer,t._generateDepthBuffer,t.width,t.height,i),this._bindUnboundFramebuffer(null),i},e.prototype.updateTextureComparisonFunction=function(t,i){if(this.webGLVersion===1){L.Error("WebGL 1 does not support texture comparison.");return}var n=this._gl;t.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,t,!0),i===0?(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),i===0?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,515),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.NONE)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_FUNC,i),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),t._comparisonFunction=i},e.prototype.createInstancesBuffer=function(t){var i=this._gl.createBuffer();if(!i)throw new Error("Unable to create instance buffer");var n=new dt(i);return n.capacity=t,this.bindArrayBuffer(n),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.DYNAMIC_DRAW),n},e.prototype.deleteInstancesBuffer=function(t){this._gl.deleteBuffer(t)},e.prototype._clientWaitAsync=function(t,i,n){i===void 0&&(i=0),n===void 0&&(n=10);var a=this._gl;return new Promise(function(s,o){var u=function(){var l=a.clientWaitSync(t,i,0);if(l==a.WAIT_FAILED){o();return}if(l==a.TIMEOUT_EXPIRED){setTimeout(u,n);return}s()};u()})},e.prototype._readPixelsAsync=function(t,i,n,a,s,o,u){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var l=this._gl,f=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,f),l.bufferData(l.PIXEL_PACK_BUFFER,u.byteLength,l.STREAM_READ),l.readPixels(t,i,n,a,s,o,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null);var h=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);return h?(l.flush(),this._clientWaitAsync(h,0,10).then(function(){return l.deleteSync(h),l.bindBuffer(l.PIXEL_PACK_BUFFER,f),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteBuffer(f),u})):null},e.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();e.Instances.length===1&&e.audioEngine&&e.audioEngine.dispose(),this.disableVR(),oe.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),oe.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),r.prototype.dispose.call(this);var t=e.Instances.indexOf(this);t>=0&&e.Instances.splice(t,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},e.prototype._disableTouchAction=function(){!this._renderingCanvas||!this._renderingCanvas.setAttribute||(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},e.prototype.displayLoadingUI=function(){if(!!oe.IsWindowObjectExist()){var t=this.loadingScreen;t&&t.displayLoadingUI()}},e.prototype.hideLoadingUI=function(){if(!!oe.IsWindowObjectExist()){var t=this._loadingScreen;t&&t.hideLoadingUI()}},Object.defineProperty(e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(t){this._loadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIText",{set:function(t){this.loadingScreen.loadingUIText=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{set:function(t){this.loadingScreen.loadingUIBackgroundColor=t},enumerable:!1,configurable:!0}),e._RequestPointerlock=function(t){t.requestPointerLock=t.requestPointerLock||t.msRequestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock&&t.requestPointerLock()},e._ExitPointerlock=function(){var t=document;document.exitPointerLock=document.exitPointerLock||t.msExitPointerLock||t.mozExitPointerLock||t.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},e._RequestFullscreen=function(t){var i=t.requestFullscreen||t.msRequestFullscreen||t.webkitRequestFullscreen||t.mozRequestFullScreen;!i||i.call(t)},e._ExitFullscreen=function(){var t=document;document.exitFullscreen?document.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msCancelFullScreen&&t.msCancelFullScreen()},e.ALPHA_DISABLE=0,e.ALPHA_ADD=1,e.ALPHA_COMBINE=2,e.ALPHA_SUBTRACT=3,e.ALPHA_MULTIPLY=4,e.ALPHA_MAXIMIZED=5,e.ALPHA_ONEONE=6,e.ALPHA_PREMULTIPLIED=7,e.ALPHA_PREMULTIPLIED_PORTERDUFF=8,e.ALPHA_INTERPOLATE=9,e.ALPHA_SCREENMODE=10,e.DELAYLOADSTATE_NONE=0,e.DELAYLOADSTATE_LOADED=1,e.DELAYLOADSTATE_LOADING=2,e.DELAYLOADSTATE_NOTLOADED=4,e.NEVER=512,e.ALWAYS=519,e.LESS=513,e.EQUAL=514,e.LEQUAL=515,e.GREATER=516,e.GEQUAL=518,e.NOTEQUAL=517,e.KEEP=7680,e.REPLACE=7681,e.INCR=7682,e.DECR=7683,e.INVERT=5386,e.INCR_WRAP=34055,e.DECR_WRAP=34056,e.TEXTURE_CLAMP_ADDRESSMODE=0,e.TEXTURE_WRAP_ADDRESSMODE=1,e.TEXTURE_MIRROR_ADDRESSMODE=2,e.TEXTUREFORMAT_ALPHA=0,e.TEXTUREFORMAT_LUMINANCE=1,e.TEXTUREFORMAT_LUMINANCE_ALPHA=2,e.TEXTUREFORMAT_RGB=4,e.TEXTUREFORMAT_RGBA=5,e.TEXTUREFORMAT_RED=6,e.TEXTUREFORMAT_R=6,e.TEXTUREFORMAT_RG=7,e.TEXTUREFORMAT_RED_INTEGER=8,e.TEXTUREFORMAT_R_INTEGER=8,e.TEXTUREFORMAT_RG_INTEGER=9,e.TEXTUREFORMAT_RGB_INTEGER=10,e.TEXTUREFORMAT_RGBA_INTEGER=11,e.TEXTURETYPE_UNSIGNED_BYTE=0,e.TEXTURETYPE_UNSIGNED_INT=0,e.TEXTURETYPE_FLOAT=1,e.TEXTURETYPE_HALF_FLOAT=2,e.TEXTURETYPE_BYTE=3,e.TEXTURETYPE_SHORT=4,e.TEXTURETYPE_UNSIGNED_SHORT=5,e.TEXTURETYPE_INT=6,e.TEXTURETYPE_UNSIGNED_INTEGER=7,e.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,e.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,e.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,e.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,e.TEXTURETYPE_UNSIGNED_INT_24_8=12,e.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,e.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,e.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,e.TEXTURE_NEAREST_SAMPLINGMODE=1,e.TEXTURE_BILINEAR_SAMPLINGMODE=2,e.TEXTURE_TRILINEAR_SAMPLINGMODE=3,e.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,e.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,e.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,e.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,e.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,e.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,e.TEXTURE_NEAREST_LINEAR=7,e.TEXTURE_NEAREST_NEAREST=1,e.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,e.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,e.TEXTURE_LINEAR_LINEAR=2,e.TEXTURE_LINEAR_NEAREST=12,e.TEXTURE_EXPLICIT_MODE=0,e.TEXTURE_SPHERICAL_MODE=1,e.TEXTURE_PLANAR_MODE=2,e.TEXTURE_CUBIC_MODE=3,e.TEXTURE_PROJECTION_MODE=4,e.TEXTURE_SKYBOX_MODE=5,e.TEXTURE_INVCUBIC_MODE=6,e.TEXTURE_EQUIRECTANGULAR_MODE=7,e.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,e.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.SCALEMODE_FLOOR=1,e.SCALEMODE_NEAREST=2,e.SCALEMODE_CEILING=3,e._RescalePostProcessFactory=null,e}(pe),Qt=function(){function r(e,t,i,n,a,s,o,u){n===void 0&&(n=0),a===void 0&&(a=!1),s===void 0&&(s=!1),o===void 0&&(o=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=i,this._instanced=s,this._divisor=u||1,this._data=t,this.byteStride=o?n:n*Float32Array.BYTES_PER_ELEMENT,a||this.create()}return r.prototype.createVertexBuffer=function(e,t,i,n,a,s,o){s===void 0&&(s=!1);var u=s?t:t*Float32Array.BYTES_PER_ELEMENT,l=n?s?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new _(this._engine,this,e,this._updatable,!0,l,a===void 0?this._instanced:a,u,i,void 0,void 0,!0,this._divisor||o)},r.prototype.isUpdatable=function(){return this._updatable},r.prototype.getData=function(){return this._data},r.prototype.getBuffer=function(){return this._buffer},r.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},r.prototype.create=function(e){e===void 0&&(e=null),!(!e&&this._buffer)&&(e=e||this._data,!!e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e)))},r.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},r.prototype.update=function(e){this.create(e)},r.prototype.updateDirectly=function(e,t,i,n){n===void 0&&(n=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,n?t:t*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=null)},r.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},r.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},r}(),_=function(){function r(e,t,i,n,a,s,o,u,l,f,h,c,p,d){if(h===void 0&&(h=!1),c===void 0&&(c=!1),p===void 0&&(p=1),d===void 0&&(d=!1),t instanceof Qt?(this._buffer=t,this._ownsBuffer=d,d&&this._buffer._increaseReferences()):(this._buffer=new Qt(e,t,n,s,a,o,c),this._ownsBuffer=!0),this._kind=i,f==null){var g=this.getData();this.type=r.FLOAT,g instanceof Int8Array?this.type=r.BYTE:g instanceof Uint8Array?this.type=r.UNSIGNED_BYTE:g instanceof Int16Array?this.type=r.SHORT:g instanceof Uint16Array?this.type=r.UNSIGNED_SHORT:g instanceof Int32Array?this.type=r.INT:g instanceof Uint32Array&&(this.type=r.UNSIGNED_INT)}else this.type=f;var m=r.GetTypeByteLength(this.type);c?(this._size=l||(s?s/m:r.DeduceStride(i)),this.byteStride=s||this._buffer.byteStride||this._size*m,this.byteOffset=u||0):(this._size=l||s||r.DeduceStride(i),this.byteStride=s?s*m:this._buffer.byteStride||this._size*m,this.byteOffset=(u||0)*m),this.normalized=h,this._instanced=o!==void 0?o:!1,this._instanceDivisor=o?p:0}return Object.defineProperty(r.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,e==0?this._instanced=!1:this._instanced=!0},enumerable:!1,configurable:!0}),r.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},r.prototype.getKind=function(){return this._kind},r.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},r.prototype.getData=function(){return this._buffer.getData()},r.prototype.getBuffer=function(){return this._buffer.getBuffer()},r.prototype.getStrideSize=function(){return this.byteStride/r.GetTypeByteLength(this.type)},r.prototype.getOffset=function(){return this.byteOffset/r.GetTypeByteLength(this.type)},r.prototype.getSize=function(){return this._size},r.prototype.getIsInstanced=function(){return this._instanced},r.prototype.getInstanceDivisor=function(){return this._instanceDivisor},r.prototype.create=function(e){this._buffer.create(e)},r.prototype.update=function(e){this._buffer.update(e)},r.prototype.updateDirectly=function(e,t,i){i===void 0&&(i=!1),this._buffer.updateDirectly(e,t,void 0,i)},r.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},r.prototype.forEach=function(e,t){r.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,t)},r.DeduceStride=function(e){switch(e){case r.UVKind:case r.UV2Kind:case r.UV3Kind:case r.UV4Kind:case r.UV5Kind:case r.UV6Kind:return 2;case r.NormalKind:case r.PositionKind:return 3;case r.ColorKind:case r.MatricesIndicesKind:case r.MatricesIndicesExtraKind:case r.MatricesWeightsKind:case r.MatricesWeightsExtraKind:case r.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}},r.GetTypeByteLength=function(e){switch(e){case r.BYTE:case r.UNSIGNED_BYTE:return 1;case r.SHORT:case r.UNSIGNED_SHORT:return 2;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:return 4;default:throw new Error("Invalid type '"+e+"'")}},r.ForEach=function(e,t,i,n,a,s,o,u){if(e instanceof Array)for(var l=t/4,f=i/4,h=0;h<s;h+=n){for(var c=0;c<n;c++)u(e[l+c],h+c);l+=f}else for(var p=e instanceof ArrayBuffer?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),d=r.GetTypeByteLength(a),h=0;h<s;h+=n){for(var g=t,c=0;c<n;c++){var m=r._GetFloatValue(p,a,g,o);u(m,h+c),g+=d}t+=i}},r._GetFloatValue=function(e,t,i,n){switch(t){case r.BYTE:{var a=e.getInt8(i);return n&&(a=Math.max(a/127,-1)),a}case r.UNSIGNED_BYTE:{var a=e.getUint8(i);return n&&(a=a/255),a}case r.SHORT:{var a=e.getInt16(i,!0);return n&&(a=Math.max(a/32767,-1)),a}case r.UNSIGNED_SHORT:{var a=e.getUint16(i,!0);return n&&(a=a/65535),a}case r.INT:return e.getInt32(i,!0);case r.UNSIGNED_INT:return e.getUint32(i,!0);case r.FLOAT:return e.getFloat32(i,!0);default:throw new Error("Invalid component type "+t)}},r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="normal",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra",r}(),Z=function(){function r(){}return r.prototype.set=function(e,t){switch(e.length||L.Warn("Setting vertex data kind '"+t+"' with an empty array"),t){case _.PositionKind:this.positions=e;break;case _.NormalKind:this.normals=e;break;case _.TangentKind:this.tangents=e;break;case _.UVKind:this.uvs=e;break;case _.UV2Kind:this.uvs2=e;break;case _.UV3Kind:this.uvs3=e;break;case _.UV4Kind:this.uvs4=e;break;case _.UV5Kind:this.uvs5=e;break;case _.UV6Kind:this.uvs6=e;break;case _.ColorKind:this.colors=e;break;case _.MatricesIndicesKind:this.matricesIndices=e;break;case _.MatricesWeightsKind:this.matricesWeights=e;break;case _.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case _.MatricesWeightsExtraKind:this.matricesWeightsExtra=e;break}},r.prototype.applyToMesh=function(e,t){return this._applyTo(e,t),this},r.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t),this},r.prototype.updateMesh=function(e){return this._update(e),this},r.prototype.updateGeometry=function(e){return this._update(e),this},r.prototype._applyTo=function(e,t){return t===void 0&&(t=!1),this.positions&&e.setVerticesData(_.PositionKind,this.positions,t),this.normals&&e.setVerticesData(_.NormalKind,this.normals,t),this.tangents&&e.setVerticesData(_.TangentKind,this.tangents,t),this.uvs&&e.setVerticesData(_.UVKind,this.uvs,t),this.uvs2&&e.setVerticesData(_.UV2Kind,this.uvs2,t),this.uvs3&&e.setVerticesData(_.UV3Kind,this.uvs3,t),this.uvs4&&e.setVerticesData(_.UV4Kind,this.uvs4,t),this.uvs5&&e.setVerticesData(_.UV5Kind,this.uvs5,t),this.uvs6&&e.setVerticesData(_.UV6Kind,this.uvs6,t),this.colors&&e.setVerticesData(_.ColorKind,this.colors,t),this.matricesIndices&&e.setVerticesData(_.MatricesIndicesKind,this.matricesIndices,t),this.matricesWeights&&e.setVerticesData(_.MatricesWeightsKind,this.matricesWeights,t),this.matricesIndicesExtra&&e.setVerticesData(_.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),this.matricesWeightsExtra&&e.setVerticesData(_.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),this.indices?e.setIndices(this.indices,null,t):e.setIndices([],null),this},r.prototype._update=function(e,t,i){return this.positions&&e.updateVerticesData(_.PositionKind,this.positions,t,i),this.normals&&e.updateVerticesData(_.NormalKind,this.normals,t,i),this.tangents&&e.updateVerticesData(_.TangentKind,this.tangents,t,i),this.uvs&&e.updateVerticesData(_.UVKind,this.uvs,t,i),this.uvs2&&e.updateVerticesData(_.UV2Kind,this.uvs2,t,i),this.uvs3&&e.updateVerticesData(_.UV3Kind,this.uvs3,t,i),this.uvs4&&e.updateVerticesData(_.UV4Kind,this.uvs4,t,i),this.uvs5&&e.updateVerticesData(_.UV5Kind,this.uvs5,t,i),this.uvs6&&e.updateVerticesData(_.UV6Kind,this.uvs6,t,i),this.colors&&e.updateVerticesData(_.ColorKind,this.colors,t,i),this.matricesIndices&&e.updateVerticesData(_.MatricesIndicesKind,this.matricesIndices,t,i),this.matricesWeights&&e.updateVerticesData(_.MatricesWeightsKind,this.matricesWeights,t,i),this.matricesIndicesExtra&&e.updateVerticesData(_.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,i),this.matricesWeightsExtra&&e.updateVerticesData(_.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,i),this.indices&&e.setIndices(this.indices,null),this},r.prototype.transform=function(e){var t=e.determinant()<0,i=y.Zero(),n;if(this.positions){var a=y.Zero();for(n=0;n<this.positions.length;n+=3)y.FromArrayToRef(this.positions,n,a),y.TransformCoordinatesToRef(a,e,i),this.positions[n]=i.x,this.positions[n+1]=i.y,this.positions[n+2]=i.z}if(this.normals){var s=y.Zero();for(n=0;n<this.normals.length;n+=3)y.FromArrayToRef(this.normals,n,s),y.TransformNormalToRef(s,e,i),this.normals[n]=i.x,this.normals[n+1]=i.y,this.normals[n+2]=i.z}if(this.tangents){var o=Ue.Zero(),u=Ue.Zero();for(n=0;n<this.tangents.length;n+=4)Ue.FromArrayToRef(this.tangents,n,o),Ue.TransformNormalToRef(o,e,u),this.tangents[n]=u.x,this.tangents[n+1]=u.y,this.tangents[n+2]=u.z,this.tangents[n+3]=u.w}if(t&&this.indices)for(n=0;n<this.indices.length;n+=3){var l=this.indices[n+1];this.indices[n+1]=this.indices[n+2],this.indices[n+2]=l}return this},r.prototype.merge=function(e,t){if(t===void 0&&(t=!1),this._validate(),e._validate(),!this.normals!=!e.normals||!this.tangents!=!e.tangents||!this.uvs!=!e.uvs||!this.uvs2!=!e.uvs2||!this.uvs3!=!e.uvs3||!this.uvs4!=!e.uvs4||!this.uvs5!=!e.uvs5||!this.uvs6!=!e.uvs6||!this.colors!=!e.colors||!this.matricesIndices!=!e.matricesIndices||!this.matricesWeights!=!e.matricesWeights||!this.matricesIndicesExtra!=!e.matricesIndicesExtra||!this.matricesWeightsExtra!=!e.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(e.indices){this.indices||(this.indices=[]);var i=this.positions?this.positions.length/3:0,n=this.indices.BYTES_PER_ELEMENT!==void 0;if(n){var a=this.indices.length+e.indices.length,s=t||this.indices instanceof Uint32Array?new Uint32Array(a):new Uint16Array(a);s.set(this.indices);for(var o=this.indices.length,u=0;u<e.indices.length;u++)s[o+u]=e.indices[u]+i;this.indices=s}else for(var u=0;u<e.indices.length;u++)this.indices.push(e.indices[u]+i)}return this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.tangents=this._mergeElement(this.tangents,e.tangents),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra),this},r.prototype._mergeElement=function(e,t){if(!e)return t;if(!t)return e;var i=t.length+e.length,n=e instanceof Float32Array,a=t instanceof Float32Array;if(n){var s=new Float32Array(i);return s.set(e),s.set(t,e.length),s}else if(a){for(var o=e.slice(0),u=0,i=t.length;u<i;u++)o.push(t[u]);return o}else return e.concat(t)},r.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var e=function(n,a){var s=_.DeduceStride(n);if(a.length%s!==0)throw new Error("The "+n+"s array count must be a multiple of "+s);return a.length/s},t=e(_.PositionKind,this.positions),i=function(n,a){var s=e(n,a);if(s!==t)throw new Error("The "+n+"s element count ("+s+") does not match the positions count ("+t+")")};this.normals&&i(_.NormalKind,this.normals),this.tangents&&i(_.TangentKind,this.tangents),this.uvs&&i(_.UVKind,this.uvs),this.uvs2&&i(_.UV2Kind,this.uvs2),this.uvs3&&i(_.UV3Kind,this.uvs3),this.uvs4&&i(_.UV4Kind,this.uvs4),this.uvs5&&i(_.UV5Kind,this.uvs5),this.uvs6&&i(_.UV6Kind,this.uvs6),this.colors&&i(_.ColorKind,this.colors),this.matricesIndices&&i(_.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&i(_.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&i(_.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&i(_.MatricesWeightsExtraKind,this.matricesWeightsExtra)},r.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},r.ExtractFromMesh=function(e,t,i){return r._ExtractFrom(e,t,i)},r.ExtractFromGeometry=function(e,t,i){return r._ExtractFrom(e,t,i)},r._ExtractFrom=function(e,t,i){var n=new r;return e.isVerticesDataPresent(_.PositionKind)&&(n.positions=e.getVerticesData(_.PositionKind,t,i)),e.isVerticesDataPresent(_.NormalKind)&&(n.normals=e.getVerticesData(_.NormalKind,t,i)),e.isVerticesDataPresent(_.TangentKind)&&(n.tangents=e.getVerticesData(_.TangentKind,t,i)),e.isVerticesDataPresent(_.UVKind)&&(n.uvs=e.getVerticesData(_.UVKind,t,i)),e.isVerticesDataPresent(_.UV2Kind)&&(n.uvs2=e.getVerticesData(_.UV2Kind,t,i)),e.isVerticesDataPresent(_.UV3Kind)&&(n.uvs3=e.getVerticesData(_.UV3Kind,t,i)),e.isVerticesDataPresent(_.UV4Kind)&&(n.uvs4=e.getVerticesData(_.UV4Kind,t,i)),e.isVerticesDataPresent(_.UV5Kind)&&(n.uvs5=e.getVerticesData(_.UV5Kind,t,i)),e.isVerticesDataPresent(_.UV6Kind)&&(n.uvs6=e.getVerticesData(_.UV6Kind,t,i)),e.isVerticesDataPresent(_.ColorKind)&&(n.colors=e.getVerticesData(_.ColorKind,t,i)),e.isVerticesDataPresent(_.MatricesIndicesKind)&&(n.matricesIndices=e.getVerticesData(_.MatricesIndicesKind,t,i)),e.isVerticesDataPresent(_.MatricesWeightsKind)&&(n.matricesWeights=e.getVerticesData(_.MatricesWeightsKind,t,i)),e.isVerticesDataPresent(_.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=e.getVerticesData(_.MatricesIndicesExtraKind,t,i)),e.isVerticesDataPresent(_.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=e.getVerticesData(_.MatricesWeightsExtraKind,t,i)),n.indices=e.getIndices(t,i),n},r.CreateRibbon=function(e){throw O.WarnImport("ribbonBuilder")},r.CreateBox=function(e){throw O.WarnImport("boxBuilder")},r.CreateTiledBox=function(e){throw O.WarnImport("tiledBoxBuilder")},r.CreateTiledPlane=function(e){throw O.WarnImport("tiledPlaneBuilder")},r.CreateSphere=function(e){throw O.WarnImport("sphereBuilder")},r.CreateCylinder=function(e){throw O.WarnImport("cylinderBuilder")},r.CreateTorus=function(e){throw O.WarnImport("torusBuilder")},r.CreateLineSystem=function(e){throw O.WarnImport("linesBuilder")},r.CreateDashedLines=function(e){throw O.WarnImport("linesBuilder")},r.CreateGround=function(e){throw O.WarnImport("groundBuilder")},r.CreateTiledGround=function(e){throw O.WarnImport("groundBuilder")},r.CreateGroundFromHeightMap=function(e){throw O.WarnImport("groundBuilder")},r.CreatePlane=function(e){throw O.WarnImport("planeBuilder")},r.CreateDisc=function(e){throw O.WarnImport("discBuilder")},r.CreatePolygon=function(e,t,i,n,a,s,o){throw O.WarnImport("polygonBuilder")},r.CreateIcoSphere=function(e){throw O.WarnImport("icoSphereBuilder")},r.CreatePolyhedron=function(e){throw O.WarnImport("polyhedronBuilder")},r.CreateCapsule=function(e){throw e===void 0&&(e={orientation:y.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),O.WarnImport("capsuleBuilder")},r.CreateTorusKnot=function(e){throw O.WarnImport("torusKnotBuilder")},r.ComputeNormals=function(e,t,i,n){var a=0,s=0,o=0,u=0,l=0,f=0,h=0,c=0,p=0,d=0,g=0,m=0,E=0,v=0,A=0,M=0,C=0,P=0,S=0,x=0,z=!1,X=!1,V=!1,re=!1,j=1,F=0,B=null;if(n&&(z=!!n.facetNormals,X=!!n.facetPositions,V=!!n.facetPartitioning,j=n.useRightHandedSystem===!0?-1:1,F=n.ratio||0,re=!!n.depthSort,B=n.distanceTo,re)){B===void 0&&(B=y.Zero());var K=n.depthSortedFacets}var ie=0,ge=0,Q=0,ve=0;if(V&&n&&n.bbSize){var he=0,Ge=0,ke=0,nt=0,at=0,st=0,mt=0,yt=0,bt=0,Et=0,Tt=0,At=0,Fe=0,we=0,Le=0,Ne=0,ot=n.bbSize.x>n.bbSize.y?n.bbSize.x:n.bbSize.y;ot=ot>n.bbSize.z?ot:n.bbSize.z,ie=n.subDiv.X*F/n.bbSize.x,ge=n.subDiv.Y*F/n.bbSize.y,Q=n.subDiv.Z*F/n.bbSize.z,ve=n.subDiv.max*n.subDiv.max,n.facetPartitioning.length=0}for(a=0;a<e.length;a++)i[a]=0;var Bt=t.length/3|0;for(a=0;a<Bt;a++){if(m=t[a*3]*3,E=m+1,v=m+2,A=t[a*3+1]*3,M=A+1,C=A+2,P=t[a*3+2]*3,S=P+1,x=P+2,s=e[m]-e[A],o=e[E]-e[M],u=e[v]-e[C],l=e[P]-e[A],f=e[S]-e[M],h=e[x]-e[C],c=j*(o*h-u*f),p=j*(u*l-s*h),d=j*(s*f-o*l),g=Math.sqrt(c*c+p*p+d*d),g=g===0?1:g,c/=g,p/=g,d/=g,z&&n&&(n.facetNormals[a].x=c,n.facetNormals[a].y=p,n.facetNormals[a].z=d),X&&n&&(n.facetPositions[a].x=(e[m]+e[A]+e[P])/3,n.facetPositions[a].y=(e[E]+e[M]+e[S])/3,n.facetPositions[a].z=(e[v]+e[C]+e[x])/3),V&&n&&(he=Math.floor((n.facetPositions[a].x-n.bInfo.minimum.x*F)*ie),Ge=Math.floor((n.facetPositions[a].y-n.bInfo.minimum.y*F)*ge),ke=Math.floor((n.facetPositions[a].z-n.bInfo.minimum.z*F)*Q),nt=Math.floor((e[m]-n.bInfo.minimum.x*F)*ie),at=Math.floor((e[E]-n.bInfo.minimum.y*F)*ge),st=Math.floor((e[v]-n.bInfo.minimum.z*F)*Q),mt=Math.floor((e[A]-n.bInfo.minimum.x*F)*ie),yt=Math.floor((e[M]-n.bInfo.minimum.y*F)*ge),bt=Math.floor((e[C]-n.bInfo.minimum.z*F)*Q),Et=Math.floor((e[P]-n.bInfo.minimum.x*F)*ie),Tt=Math.floor((e[S]-n.bInfo.minimum.y*F)*ge),At=Math.floor((e[x]-n.bInfo.minimum.z*F)*Q),we=nt+n.subDiv.max*at+ve*st,Le=mt+n.subDiv.max*yt+ve*bt,Ne=Et+n.subDiv.max*Tt+ve*At,Fe=he+n.subDiv.max*Ge+ve*ke,n.facetPartitioning[Fe]=n.facetPartitioning[Fe]?n.facetPartitioning[Fe]:new Array,n.facetPartitioning[we]=n.facetPartitioning[we]?n.facetPartitioning[we]:new Array,n.facetPartitioning[Le]=n.facetPartitioning[Le]?n.facetPartitioning[Le]:new Array,n.facetPartitioning[Ne]=n.facetPartitioning[Ne]?n.facetPartitioning[Ne]:new Array,n.facetPartitioning[we].push(a),Le!=we&&n.facetPartitioning[Le].push(a),Ne==Le||Ne==we||n.facetPartitioning[Ne].push(a),Fe==we||Fe==Le||Fe==Ne||n.facetPartitioning[Fe].push(a)),re&&n&&n.facetPositions){var ai=K[a];ai.ind=a*3,ai.sqDistance=y.DistanceSquared(n.facetPositions[a],B)}i[m]+=c,i[E]+=p,i[v]+=d,i[A]+=c,i[M]+=p,i[C]+=d,i[P]+=c,i[S]+=p,i[x]+=d}for(a=0;a<i.length/3;a++)c=i[a*3],p=i[a*3+1],d=i[a*3+2],g=Math.sqrt(c*c+p*p+d*d),g=g===0?1:g,c/=g,p/=g,d/=g,i[a*3]=c,i[a*3+1]=p,i[a*3+2]=d},r._ComputeSides=function(e,t,i,n,a,s,o){var u=i.length,l=n.length,f,h;switch(e=e||r.DEFAULTSIDE,e){case r.FRONTSIDE:break;case r.BACKSIDE:var c;for(f=0;f<u;f+=3)c=i[f],i[f]=i[f+2],i[f+2]=c;for(h=0;h<l;h++)n[h]=-n[h];break;case r.DOUBLESIDE:for(var p=t.length,d=p/3,g=0;g<p;g++)t[p+g]=t[g];for(f=0;f<u;f+=3)i[f+u]=i[f+2]+d,i[f+1+u]=i[f+1]+d,i[f+2+u]=i[f]+d;for(h=0;h<l;h++)n[l+h]=-n[h];var m=a.length,E=0;for(E=0;E<m;E++)a[E+m]=a[E];for(s=s||new Ue(0,0,1,1),o=o||new Ue(0,0,1,1),E=0,f=0;f<m/2;f++)a[E]=s.x+(s.z-s.x)*a[E],a[E+1]=s.y+(s.w-s.y)*a[E+1],a[E+m]=o.x+(o.z-o.x)*a[E+m],a[E+m+1]=o.y+(o.w-o.y)*a[E+m+1],E+=2;break}},r.ImportVertexData=function(e,t){var i=new r,n=e.positions;n&&i.set(n,_.PositionKind);var a=e.normals;a&&i.set(a,_.NormalKind);var s=e.tangents;s&&i.set(s,_.TangentKind);var o=e.uvs;o&&i.set(o,_.UVKind);var u=e.uv2s;u&&i.set(u,_.UV2Kind);var l=e.uv3s;l&&i.set(l,_.UV3Kind);var f=e.uv4s;f&&i.set(f,_.UV4Kind);var h=e.uv5s;h&&i.set(h,_.UV5Kind);var c=e.uv6s;c&&i.set(c,_.UV6Kind);var p=e.colors;p&&i.set(fe.CheckColors4(p,n.length/3),_.ColorKind);var d=e.matricesIndices;d&&i.set(d,_.MatricesIndicesKind);var g=e.matricesWeights;g&&i.set(g,_.MatricesWeightsKind);var m=e.indices;m&&(i.indices=m),t.setAllVerticesData(i,e.updatable)},r.FRONTSIDE=0,r.BACKSIDE=1,r.DOUBLESIDE=2,r.DEFAULTSIDE=0,r}(),Zt=function(){function r(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return r.prototype.getNormal=function(e,t){if(e===void 0&&(e=!1),t===void 0&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(_.NormalKind))return null;var i=this.pickedMesh.getIndices();if(!i)return null;var n;if(t){var a=this.pickedMesh.getVerticesData(_.NormalKind),s=y.FromArray(a,i[this.faceId*3]*3),o=y.FromArray(a,i[this.faceId*3+1]*3),u=y.FromArray(a,i[this.faceId*3+2]*3);s=s.scale(this.bu),o=o.scale(this.bv),u=u.scale(1-this.bu-this.bv),n=new y(s.x+o.x+u.x,s.y+o.y+u.y,s.z+o.z+u.z)}else{var l=this.pickedMesh.getVerticesData(_.PositionKind),f=y.FromArray(l,i[this.faceId*3]*3),h=y.FromArray(l,i[this.faceId*3+1]*3),c=y.FromArray(l,i[this.faceId*3+2]*3),p=f.subtract(h),d=c.subtract(h);n=y.Cross(p,d)}if(e){var g=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(I.Matrix[0].copyFrom(g),g=I.Matrix[0],g.setTranslationFromFloats(0,0,0),g.invert(),g.transposeToRef(I.Matrix[1]),g=I.Matrix[1]),n=y.TransformNormal(n,g)}return n.normalize(),n},r.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(_.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(_.UVKind);if(!t)return null;var i=ne.FromArray(t,e[this.faceId*3]*2),n=ne.FromArray(t,e[this.faceId*3+1]*2),a=ne.FromArray(t,e[this.faceId*3+2]*2);return i=i.scale(this.bu),n=n.scale(this.bv),a=a.scale(1-this.bu-this.bv),new ne(i.x+n.x+a.x,i.y+n.y+a.y)},r}(),di=function(){function r(e,t,i){this.vectors=be.BuildArray(8,y.Zero),this.center=y.Zero(),this.centerWorld=y.Zero(),this.extendSize=y.Zero(),this.extendSizeWorld=y.Zero(),this.directions=be.BuildArray(3,y.Zero),this.vectorsWorld=be.BuildArray(8,y.Zero),this.minimumWorld=y.Zero(),this.maximumWorld=y.Zero(),this.minimum=y.Zero(),this.maximum=y.Zero(),this.reConstruct(e,t,i)}return r.prototype.reConstruct=function(e,t,i){var n=e.x,a=e.y,s=e.z,o=t.x,u=t.y,l=t.z,f=this.vectors;this.minimum.copyFromFloats(n,a,s),this.maximum.copyFromFloats(o,u,l),f[0].copyFromFloats(n,a,s),f[1].copyFromFloats(o,u,l),f[2].copyFromFloats(o,a,s),f[3].copyFromFloats(n,u,s),f[4].copyFromFloats(n,a,l),f[5].copyFromFloats(o,u,s),f[6].copyFromFloats(n,u,l),f[7].copyFromFloats(o,a,l),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=i||R.IdentityReadOnly,this._update(this._worldMatrix)},r.prototype.scale=function(e){var t=r.TmpVector3,i=this.maximum.subtractToRef(this.minimum,t[0]),n=i.length();i.normalizeFromLength(n);var a=n*e,s=i.scaleInPlace(a*.5),o=this.center.subtractToRef(s,t[1]),u=this.center.addToRef(s,t[2]);return this.reConstruct(o,u,this._worldMatrix),this},r.prototype.getWorldMatrix=function(){return this._worldMatrix},r.prototype._update=function(e){var t=this.minimumWorld,i=this.maximumWorld,n=this.directions,a=this.vectorsWorld,s=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),i.copyFrom(this.maximum);for(var o=0;o<8;++o)a[o].copyFrom(s[o]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),i.setAll(-Number.MAX_VALUE);for(var o=0;o<8;++o){var u=a[o];y.TransformCoordinatesToRef(s[o],e,u),t.minimizeInPlace(u),i.maximizeInPlace(u)}i.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),i.addToRef(t,this.centerWorld).scaleInPlace(.5)}y.FromArrayToRef(e.m,0,n[0]),y.FromArrayToRef(e.m,4,n[1]),y.FromArrayToRef(e.m,8,n[2]),this._worldMatrix=e},r.prototype.isInFrustum=function(e){return r.IsInFrustum(this.vectorsWorld,e)},r.prototype.isCompletelyInFrustum=function(e){return r.IsCompletelyInFrustum(this.vectorsWorld,e)},r.prototype.intersectsPoint=function(e){var t=this.minimumWorld,i=this.maximumWorld,n=t.x,a=t.y,s=t.z,o=i.x,u=i.y,l=i.z,f=e.x,h=e.y,c=e.z,p=-ue;return!(o-f<p||p>f-n||u-h<p||p>h-a||l-c<p||p>c-s)},r.prototype.intersectsSphere=function(e){return r.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},r.prototype.intersectsMinMax=function(e,t){var i=this.minimumWorld,n=this.maximumWorld,a=i.x,s=i.y,o=i.z,u=n.x,l=n.y,f=n.z,h=e.x,c=e.y,p=e.z,d=t.x,g=t.y,m=t.z;return!(u<h||a>d||l<c||s>g||f<p||o>m)},r.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},r.IntersectsSphere=function(e,t,i,n){var a=r.TmpVector3[0];y.ClampToRef(i,e,t,a);var s=y.DistanceSquared(i,a);return s<=n*n},r.IsCompletelyInFrustum=function(e,t){for(var i=0;i<6;++i)for(var n=t[i],a=0;a<8;++a)if(n.dotCoordinate(e[a])<0)return!1;return!0},r.IsInFrustum=function(e,t){for(var i=0;i<6;++i){for(var n=!0,a=t[i],s=0;s<8;++s)if(a.dotCoordinate(e[s])>=0){n=!1;break}if(n)return!1}return!0},r.TmpVector3=be.BuildArray(3,y.Zero),r}(),pi=function(){function r(e,t,i){this.center=y.Zero(),this.centerWorld=y.Zero(),this.minimum=y.Zero(),this.maximum=y.Zero(),this.reConstruct(e,t,i)}return r.prototype.reConstruct=function(e,t,i){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var n=y.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=n*.5,this._update(i||R.IdentityReadOnly)},r.prototype.scale=function(e){var t=this.radius*e,i=r.TmpVector3,n=i[0].setAll(t),a=this.center.subtractToRef(n,i[1]),s=this.center.addToRef(n,i[2]);return this.reConstruct(a,s,this._worldMatrix),this},r.prototype.getWorldMatrix=function(){return this._worldMatrix},r.prototype._update=function(e){if(e.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{y.TransformCoordinatesToRef(this.center,e,this.centerWorld);var t=r.TmpVector3[0];y.TransformNormalFromFloatsToRef(1,1,1,e,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.radius}},r.prototype.isInFrustum=function(e){for(var t=this.centerWorld,i=this.radiusWorld,n=0;n<6;n++)if(e[n].dotCoordinate(t)<=-i)return!1;return!0},r.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<0)return!1;return!0},r.prototype.intersectsPoint=function(e){var t=y.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},r.Intersects=function(e,t){var i=y.DistanceSquared(e.centerWorld,t.centerWorld),n=e.radiusWorld+t.radiusWorld;return!(n*n<i)},r.TmpVector3=be.BuildArray(3,y.Zero),r}(),kt={min:0,max:0},Wt={min:0,max:0},_i=function(r,e,t){var i=y.Dot(e.centerWorld,r),n=Math.abs(y.Dot(e.directions[0],r))*e.extendSize.x,a=Math.abs(y.Dot(e.directions[1],r))*e.extendSize.y,s=Math.abs(y.Dot(e.directions[2],r))*e.extendSize.z,o=n+a+s;t.min=i-o,t.max=i+o},Ee=function(r,e,t){return _i(r,e,kt),_i(r,t,Wt),!(kt.min>Wt.max||Wt.min>kt.max)},Oe=function(){function r(e,t,i){this._isLocked=!1,this.boundingBox=new di(e,t,i),this.boundingSphere=new pi(e,t,i)}return r.prototype.reConstruct=function(e,t,i){this.boundingBox.reConstruct(e,t,i),this.boundingSphere.reConstruct(e,t,i)},Object.defineProperty(r.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!1,configurable:!0}),r.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},r.prototype.centerOn=function(e,t){var i=r.TmpVector3[0].copyFrom(e).subtractInPlace(t),n=r.TmpVector3[1].copyFrom(e).addInPlace(t);return this.boundingBox.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this},r.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},r.prototype.isInFrustum=function(e,t){t===void 0&&(t=0);var i=t===2||t===3;if(i&&this.boundingSphere.isCenterInFrustum(e))return!0;if(!this.boundingSphere.isInFrustum(e))return!1;var n=t===1||t===3;return n?!0:this.boundingBox.isInFrustum(e)},Object.defineProperty(r.prototype,"diagonalLength",{get:function(){var e=this.boundingBox,t=e.maximumWorld.subtractToRef(e.minimumWorld,r.TmpVector3[0]);return t.length()},enumerable:!1,configurable:!0}),r.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},r.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},r.prototype.intersectsPoint=function(e){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(e)||!this.boundingBox.intersectsPoint(e))},r.prototype.intersects=function(e,t){if(!pi.Intersects(this.boundingSphere,e.boundingSphere)||!di.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var i=this.boundingBox,n=e.boundingBox;return!(!Ee(i.directions[0],i,n)||!Ee(i.directions[1],i,n)||!Ee(i.directions[2],i,n)||!Ee(n.directions[0],i,n)||!Ee(n.directions[1],i,n)||!Ee(n.directions[2],i,n)||!Ee(y.Cross(i.directions[0],n.directions[0]),i,n)||!Ee(y.Cross(i.directions[0],n.directions[1]),i,n)||!Ee(y.Cross(i.directions[0],n.directions[2]),i,n)||!Ee(y.Cross(i.directions[1],n.directions[0]),i,n)||!Ee(y.Cross(i.directions[1],n.directions[1]),i,n)||!Ee(y.Cross(i.directions[1],n.directions[2]),i,n)||!Ee(y.Cross(i.directions[2],n.directions[0]),i,n)||!Ee(y.Cross(i.directions[2],n.directions[1]),i,n)||!Ee(y.Cross(i.directions[2],n.directions[2]),i,n))},r.TmpVector3=be.BuildArray(2,y.Zero),r}(),_r=function(){function r(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new y(0,0,0),this._diffPositionForCollisions=new y(0,0,0),this._collisionResponse=!0}return r}();function gr(r,e,t,i,n){n===void 0&&(n=null);for(var a=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=t;o<t+i;o++){var u=e[o]*3,l=r[u],f=r[u+1],h=r[u+2];a.minimizeInPlaceFromFloats(l,f,h),s.maximizeInPlaceFromFloats(l,f,h)}return n&&(a.x-=a.x*n.x+n.y,a.y-=a.y*n.x+n.y,a.z-=a.z*n.x+n.y,s.x+=s.x*n.x+n.y,s.y+=s.y*n.x+n.y,s.z+=s.z*n.x+n.y),{minimum:a,maximum:s}}function Ai(r,e,t,i,n){i===void 0&&(i=null);var a=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);n||(n=3);for(var o=e,u=e*n;o<e+t;o++,u+=n){var l=r[u],f=r[u+1],h=r[u+2];a.minimizeInPlaceFromFloats(l,f,h),s.maximizeInPlaceFromFloats(l,f,h)}return i&&(a.x-=a.x*i.x+i.y,a.y-=a.y*i.x+i.y,a.z-=a.z*i.x+i.y,s.x+=s.x*i.x+i.y,s.y+=s.y*i.x+i.y,s.z+=s.z*i.x+i.y),{minimum:a,maximum:s}}var vr=function(){function r(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=y.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return r}(),mr=function(){function r(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new vr,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1}return r}(),pt=function(r){N(e,r);function e(t,i){i===void 0&&(i=null);var n=r.call(this,t,i,!1)||this;return n._internalAbstractMeshDataInfo=new mr,n.cullingStrategy=e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,n.onCollideObservable=new D,n.onCollisionPositionChangeObservable=new D,n.onMaterialChangedObservable=new D,n.definedFacingForward=!0,n._occlusionQuery=null,n._renderingGroup=null,n.alphaIndex=Number.MAX_VALUE,n.isVisible=!0,n.isPickable=!0,n.showSubMeshesBoundingBox=!1,n.isBlocker=!1,n.enablePointerMoveEvents=!1,n._renderingGroupId=0,n._material=null,n.outlineColor=ae.Red(),n.outlineWidth=.02,n.overlayColor=ae.Red(),n.overlayAlpha=.5,n.useOctreeForRenderingSelection=!0,n.useOctreeForPicking=!0,n.useOctreeForCollisions=!0,n.alwaysSelectAsActiveMesh=!1,n.doNotSyncBoundingInfo=!1,n.actionManager=null,n._meshCollisionData=new _r,n.ellipsoid=new y(.5,1,.5),n.ellipsoidOffset=new y(0,0,0),n.edgesWidth=1,n.edgesColor=new fe(1,0,0,1),n._edgesRenderer=null,n._masterMesh=null,n._boundingInfo=null,n._renderId=0,n._intersectionsInProgress=new Array,n._unIndexed=!1,n._lightSources=new Array,n._waitingData={lods:null,actions:null,freezeWorldMatrix:null},n._bonesTransformMatrices=null,n._transformMatrixTexture=null,n.onRebuildObservable=new D,n._onCollisionPositionChange=function(a,s,o){o===void 0&&(o=null),s.subtractToRef(n._meshCollisionData._oldPositionForCollisions,n._meshCollisionData._diffPositionForCollisions),n._meshCollisionData._diffPositionForCollisions.length()>ce.CollisionsEpsilon&&n.position.addInPlace(n._meshCollisionData._diffPositionForCollisions),o&&n.onCollideObservable.notifyObservers(o),n.onCollisionPositionChangeObservable.notifyObservers(n.position)},n.getScene().addMesh(n),n._resyncLightSources(),n}return Object.defineProperty(e,"BILLBOARDMODE_NONE",{get:function(){return Re.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_X",{get:function(){return Re.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_Y",{get:function(){return Re.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_Z",{get:function(){return Re.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_ALL",{get:function(){return Re.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BILLBOARDMODE_USE_POSITION",{get:function(){return Re.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(t){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(t){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),e.prototype._updateNonUniformScalingState=function(t){return r.prototype._updateNonUniformScalingState.call(this,t)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(e.prototype,"onCollide",{set:function(t){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCollisionPositionChange",{set:function(t){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(t){this._internalAbstractMeshDataInfo._visibility!==t&&(this._internalAbstractMeshDataInfo._visibility=t,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(t){this._renderingGroupId=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(t){this._material!==t&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=t,t&&t.meshMap&&(t.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),!!this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(t){this._internalAbstractMeshDataInfo._receiveShadows!==t&&(this._internalAbstractMeshDataInfo._receiveShadows=t,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(t){this._internalAbstractMeshDataInfo._hasVertexAlpha!==t&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=t,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(t){this._internalAbstractMeshDataInfo._useVertexColors!==t&&(this._internalAbstractMeshDataInfo._useVertexColors=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(t){this._internalAbstractMeshDataInfo._numBoneInfluencers!==t&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(t){this._internalAbstractMeshDataInfo._applyFog!==t&&(this._internalAbstractMeshDataInfo._applyFog=t,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(t){t!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=t,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(t){this._meshCollisionData._collisionMask=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(t){this._meshCollisionData._collisionResponse=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(t){this._meshCollisionData._collisionGroup=isNaN(t)?-1:t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(t){this._meshCollisionData._surroundingMeshes=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(t){var i=this._internalAbstractMeshDataInfo._skeleton;i&&i.needInitialSkinMatrix&&i._unregisterMeshWithPoseMatrix(this),t&&t.needInitialSkinMatrix&&t._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=t,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"AbstractMesh"},e.prototype.toString=function(t){var i="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var n=this._internalAbstractMeshDataInfo._skeleton;return n&&(i+=", skeleton: "+n.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),i},e.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==Re.BILLBOARDMODE_NONE?this._masterMesh:r.prototype._getEffectiveParent.call(this)},e.prototype._getActionManagerForTrigger=function(t,i){if(i===void 0&&(i=!0),this.actionManager&&(i||this.actionManager.isRecursive))if(t){if(this.actionManager.hasSpecificTrigger(t))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(t,!1):null},e.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),!!this.subMeshes)for(var t=0,i=this.subMeshes;t<i.length;t++){var n=i[t];n._rebuild()}},e.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var t=0,i=this.getScene().lights;t<i.length;t++){var n=i[t];!n.isEnabled()||n.canAffectMesh(this)&&this._lightSources.push(n)}this._markSubMeshesAsLightDirty()},e.prototype._resyncLightSource=function(t){var i=t.isEnabled()&&t.canAffectMesh(this),n=this._lightSources.indexOf(t),a=!1;if(n===-1){if(!i)return;this._lightSources.push(t)}else{if(i)return;a=!0,this._lightSources.splice(n,1)}this._markSubMeshesAsLightDirty(a)},e.prototype._unBindEffect=function(){for(var t=0,i=this.subMeshes;t<i.length;t++){var n=i[t];n.setEffect(null)}},e.prototype._removeLightSource=function(t,i){var n=this._lightSources.indexOf(t);n!==-1&&(this._lightSources.splice(n,1),this._markSubMeshesAsLightDirty(i))},e.prototype._markSubMeshesAsDirty=function(t){if(!!this.subMeshes)for(var i=0,n=this.subMeshes;i<n.length;i++){var a=n[i];a._materialDefines&&t(a._materialDefines)}},e.prototype._markSubMeshesAsLightDirty=function(t){t===void 0&&(t=!1),this._markSubMeshesAsDirty(function(i){return i.markAsLightDirty(t)})},e.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsAttributesDirty()})},e.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(t){return t.markAsMiscDirty()})},Object.defineProperty(e.prototype,"scaling",{get:function(){return this._scaling},set:function(t){this._scaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getLOD=function(t){return this},e.prototype.getTotalVertices=function(){return 0},e.prototype.getTotalIndices=function(){return 0},e.prototype.getIndices=function(){return null},e.prototype.getVerticesData=function(t){return null},e.prototype.setVerticesData=function(t,i,n,a){return this},e.prototype.updateVerticesData=function(t,i,n,a){return this},e.prototype.setIndices=function(t,i){return this},e.prototype.isVerticesDataPresent=function(t){return!1},e.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},e.prototype.normalizeToUnitCube=function(t,i,n){return t===void 0&&(t=!0),i===void 0&&(i=!1),r.prototype.normalizeToUnitCube.call(this,t,i,n)},e.prototype.setBoundingInfo=function(t){return this._boundingInfo=t,this},Object.defineProperty(e.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(_.MatricesIndicesKind)&&this.isVerticesDataPresent(_.MatricesWeightsKind)},enumerable:!1,configurable:!0}),e.prototype._preActivate=function(){},e.prototype._preActivateForIntermediateRendering=function(t){},e.prototype._activate=function(t,i){return this._renderId=t,!0},e.prototype._postActivate=function(){},e.prototype._freeze=function(){},e.prototype._unFreeze=function(){},e.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===Re.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():r.prototype.getWorldMatrix.call(this)},e.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():r.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(e.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.movePOV=function(t,i,n){return this.position.addInPlace(this.calcMovePOV(t,i,n)),this},e.prototype.calcMovePOV=function(t,i,n){var a=new R,s=this.rotationQuaternion?this.rotationQuaternion:W.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);s.toRotationMatrix(a);var o=y.Zero(),u=this.definedFacingForward?-1:1;return y.TransformCoordinatesFromFloatsToRef(t*u,i,n*u,a,o),o},e.prototype.rotatePOV=function(t,i,n){return this.rotation.addInPlace(this.calcRotatePOV(t,i,n)),this},e.prototype.calcRotatePOV=function(t,i,n){var a=this.definedFacingForward?1:-1;return new y(t*a,i,n*a)},e.prototype.refreshBoundingInfo=function(t){return t===void 0&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(t),null),this)},e.prototype._refreshBoundingInfo=function(t,i){if(t){var n=Ai(t,0,this.getTotalVertices(),i);this._boundingInfo?this._boundingInfo.reConstruct(n.minimum,n.maximum):this._boundingInfo=new Oe(n.minimum,n.maximum)}if(this.subMeshes)for(var a=0;a<this.subMeshes.length;a++)this.subMeshes[a].refreshBoundingInfo(t);this._updateBoundingInfo()},e.prototype._getPositionData=function(t){var i=this.getVerticesData(_.PositionKind);if(i&&t&&this.skeleton){i=te.Slice(i),this._generatePointsArray();var n=this.getVerticesData(_.MatricesIndicesKind),a=this.getVerticesData(_.MatricesWeightsKind);if(a&&n){var s=this.numBoneInfluencers>4,o=s?this.getVerticesData(_.MatricesIndicesExtraKind):null,u=s?this.getVerticesData(_.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var l=this.skeleton.getTransformMatrices(this),f=I.Vector3[0],h=I.Matrix[0],c=I.Matrix[1],p=0,d=0;d<i.length;d+=3,p+=4){h.reset();var g,m;for(g=0;g<4;g++)m=a[p+g],m>0&&(R.FromFloat32ArrayToRefScaled(l,Math.floor(n[p+g]*16),m,c),h.addToSelf(c));if(s)for(g=0;g<4;g++)m=u[p+g],m>0&&(R.FromFloat32ArrayToRefScaled(l,Math.floor(o[p+g]*16),m,c),h.addToSelf(c));y.TransformCoordinatesFromFloatsToRef(i[d],i[d+1],i[d+2],h,f),f.toArray(i,d),this._positions&&this._positions[d/3].copyFrom(f)}}}return i},e.prototype._updateBoundingInfo=function(){var t=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(t.worldMatrixFromCache):this._boundingInfo=new Oe(this.absolutePosition,this.absolutePosition,t.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(t.worldMatrixFromCache),this},e.prototype._updateSubMeshesBoundingInfo=function(t){if(!this.subMeshes)return this;for(var i=this.subMeshes.length,n=0;n<i;n++){var a=this.subMeshes[n];(i>1||!a.IsGlobal)&&a.updateBoundingInfo(t)}return this},e.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(e.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),e.prototype.isInFrustum=function(t){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(t,this.cullingStrategy)},e.prototype.isCompletelyInFrustum=function(t){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(t)},e.prototype.intersectsMesh=function(t,i,n){if(i===void 0&&(i=!1),!this._boundingInfo||!t._boundingInfo)return!1;if(this._boundingInfo.intersects(t._boundingInfo,i))return!0;if(n)for(var a=0,s=this.getChildMeshes();a<s.length;a++){var o=s[a];if(o.intersectsMesh(t,i,!0))return!0}return!1},e.prototype.intersectsPoint=function(t){return this._boundingInfo?this._boundingInfo.intersectsPoint(t):!1},Object.defineProperty(e.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(t){this._meshCollisionData._checkCollisions=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),e.prototype.moveWithCollisions=function(t){var i=this.getAbsolutePosition();i.addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var n=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=n.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,n.getNewPosition(this._meshCollisionData._oldPositionForCollisions,t,this._meshCollisionData._collider,3,this,this._onCollisionPositionChange,this.uniqueId),this},e.prototype._collideForSubMesh=function(t,i,n){if(this._generatePointsArray(),!this._positions)return this;if(!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var a=t.verticesStart,s=t.verticesStart+t.verticesCount,o=a;o<s;o++)t._lastColliderWorldVertices.push(y.TransformCoordinates(this._positions[o],i))}return n._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial(),this),this},e.prototype._processCollisionsForSubMeshes=function(t,i){for(var n=this._scene.getCollidingSubMeshCandidates(this,t),a=n.length,s=0;s<a;s++){var o=n.data[s];a>1&&!o._checkCollision(t)||this._collideForSubMesh(o,i,t)}return this},e.prototype._checkCollision=function(t){if(!this._boundingInfo||!this._boundingInfo._checkCollision(t))return this;var i=I.Matrix[0],n=I.Matrix[1];return R.ScalingToRef(1/t._radius.x,1/t._radius.y,1/t._radius.z,i),this.worldMatrixFromCache.multiplyToRef(i,n),this._processCollisionsForSubMeshes(t,n),this},e.prototype._generatePointsArray=function(){return!1},e.prototype.intersects=function(t,i,n,a,s,o){var u;a===void 0&&(a=!1),o===void 0&&(o=!1);var l=new Zt,f=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,h=this._boundingInfo;if(!this.subMeshes||!h||!o&&(!t.intersectsSphere(h.boundingSphere,f)||!t.intersectsBox(h.boundingBox,f)))return l;if(a)return l.hit=!o,l.pickedMesh=o?null:this,l.distance=o?0:y.Distance(t.origin,h.boundingSphere.center),l.subMeshId=0,l;if(!this._generatePointsArray())return l;for(var c=null,p=this._scene.getIntersectingSubMeshCandidates(this,t),d=p.length,g=!1,m=0;m<d;m++){var E=p.data[m],v=E.getMaterial();if(!!v&&((u=this.getIndices())===null||u===void 0?void 0:u.length)&&(v.fillMode==7||v.fillMode==0||v.fillMode==1||v.fillMode==2)){g=!0;break}}if(!g)return l.hit=!0,l.pickedMesh=this,l.distance=y.Distance(t.origin,h.boundingSphere.center),l.subMeshId=-1,l;for(var m=0;m<d;m++){var E=p.data[m];if(!(d>1&&!E.canIntersects(t))){var A=E.intersects(t,this._positions,this.getIndices(),i,n);if(A&&(i||!c||A.distance<c.distance)&&(c=A,c.subMeshId=m,i))break}}if(c){var M=s!=null?s:this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix(),C=I.Vector3[0],P=I.Vector3[1];y.TransformCoordinatesToRef(t.origin,M,C),t.direction.scaleToRef(c.distance,P);var S=y.TransformNormal(P,M),x=S.addInPlace(C);return l.hit=!0,l.distance=y.Distance(C,x),l.pickedPoint=x,l.pickedMesh=this,l.bu=c.bu||0,l.bv=c.bv||0,l.subMeshFaceId=c.faceId,l.faceId=c.faceId+p.data[c.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),l.subMeshId=c.subMeshId,l}return l},e.prototype.clone=function(t,i,n){return null},e.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},e.prototype.dispose=function(t,i){var n=this;i===void 0&&(i=!1);var a;for(this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),a=0;a<this._intersectionsInProgress.length;a++){var s=this._intersectionsInProgress[a],o=s._intersectionsInProgress.indexOf(this);s._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[];var u=this.getScene().lights;u.forEach(function(f){var h=f.includedOnlyMeshes.indexOf(n);h!==-1&&f.includedOnlyMeshes.splice(h,1),h=f.excludedMeshes.indexOf(n),h!==-1&&f.excludedMeshes.splice(h,1);var c=f.getShadowGenerator();if(c){var p=c.getShadowMap();p&&p.renderList&&(h=p.renderList.indexOf(n),h!==-1&&p.renderList.splice(h,1))}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();var l=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,l.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),l.wipeCaches(),this.getScene().removeMesh(this),i&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(a=0;a<this.getScene().particleSystems.length;a++)this.getScene().particleSystems[a].emitter===this&&(this.getScene().particleSystems[a].dispose(),a--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),r.prototype.dispose.call(this,t,i)},e.prototype.addChild=function(t){return t.setParent(this),this},e.prototype.removeChild=function(t){return t.setParent(null),this},e.prototype._initFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetNormals||(t.facetNormals=new Array),t.facetPositions||(t.facetPositions=new Array),t.facetPartitioning||(t.facetPartitioning=new Array),t.facetNb=this.getIndices().length/3|0,t.partitioningSubdivisions=t.partitioningSubdivisions?t.partitioningSubdivisions:10,t.partitioningBBoxRatio=t.partitioningBBoxRatio?t.partitioningBBoxRatio:1.01;for(var i=0;i<t.facetNb;i++)t.facetNormals[i]=y.Zero(),t.facetPositions[i]=y.Zero();return t.facetDataEnabled=!0,this},e.prototype.updateFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;t.facetDataEnabled||this._initFacetData();var i=this.getVerticesData(_.PositionKind),n=this.getIndices(),a=this.getVerticesData(_.NormalKind),s=this.getBoundingInfo();if(t.facetDepthSort&&!t.facetDepthSortEnabled){if(t.facetDepthSortEnabled=!0,n instanceof Uint16Array)t.depthSortedIndices=new Uint16Array(n);else if(n instanceof Uint32Array)t.depthSortedIndices=new Uint32Array(n);else{for(var o=!1,u=0;u<n.length;u++)if(n[u]>65535){o=!0;break}o?t.depthSortedIndices=new Uint32Array(n):t.depthSortedIndices=new Uint16Array(n)}if(t.facetDepthSortFunction=function(g,m){return m.sqDistance-g.sqDistance},!t.facetDepthSortFrom){var l=this.getScene().activeCamera;t.facetDepthSortFrom=l?l.position:y.Zero()}t.depthSortedFacets=[];for(var f=0;f<t.facetNb;f++){var h={ind:f*3,sqDistance:0};t.depthSortedFacets.push(h)}t.invertedMatrix=R.Identity(),t.facetDepthSortOrigin=y.Zero()}t.bbSize.x=s.maximum.x-s.minimum.x>ue?s.maximum.x-s.minimum.x:ue,t.bbSize.y=s.maximum.y-s.minimum.y>ue?s.maximum.y-s.minimum.y:ue,t.bbSize.z=s.maximum.z-s.minimum.z>ue?s.maximum.z-s.minimum.z:ue;var c=t.bbSize.x>t.bbSize.y?t.bbSize.x:t.bbSize.y;if(c=c>t.bbSize.z?c:t.bbSize.z,t.subDiv.max=t.partitioningSubdivisions,t.subDiv.X=Math.floor(t.subDiv.max*t.bbSize.x/c),t.subDiv.Y=Math.floor(t.subDiv.max*t.bbSize.y/c),t.subDiv.Z=Math.floor(t.subDiv.max*t.bbSize.z/c),t.subDiv.X=t.subDiv.X<1?1:t.subDiv.X,t.subDiv.Y=t.subDiv.Y<1?1:t.subDiv.Y,t.subDiv.Z=t.subDiv.Z<1?1:t.subDiv.Z,t.facetParameters.facetNormals=this.getFacetLocalNormals(),t.facetParameters.facetPositions=this.getFacetLocalPositions(),t.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),t.facetParameters.bInfo=s,t.facetParameters.bbSize=t.bbSize,t.facetParameters.subDiv=t.subDiv,t.facetParameters.ratio=this.partitioningBBoxRatio,t.facetParameters.depthSort=t.facetDepthSort,t.facetDepthSort&&t.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(t.invertedMatrix),y.TransformCoordinatesToRef(t.facetDepthSortFrom,t.invertedMatrix,t.facetDepthSortOrigin),t.facetParameters.distanceTo=t.facetDepthSortOrigin),t.facetParameters.depthSortedFacets=t.depthSortedFacets,Z.ComputeNormals(i,n,a,t.facetParameters),t.facetDepthSort&&t.facetDepthSortEnabled){t.depthSortedFacets.sort(t.facetDepthSortFunction);for(var p=t.depthSortedIndices.length/3|0,f=0;f<p;f++){var d=t.depthSortedFacets[f].ind;t.depthSortedIndices[f*3]=n[d],t.depthSortedIndices[f*3+1]=n[d+1],t.depthSortedIndices[f*3+2]=n[d+2]}this.updateIndices(t.depthSortedIndices,void 0,!0)}return this},e.prototype.getFacetLocalNormals=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetNormals||this.updateFacetData(),t.facetNormals},e.prototype.getFacetLocalPositions=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPositions||this.updateFacetData(),t.facetPositions},e.prototype.getFacetLocalPartitioning=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetPartitioning||this.updateFacetData(),t.facetPartitioning},e.prototype.getFacetPosition=function(t){var i=y.Zero();return this.getFacetPositionToRef(t,i),i},e.prototype.getFacetPositionToRef=function(t,i){var n=this.getFacetLocalPositions()[t],a=this.getWorldMatrix();return y.TransformCoordinatesToRef(n,a,i),this},e.prototype.getFacetNormal=function(t){var i=y.Zero();return this.getFacetNormalToRef(t,i),i},e.prototype.getFacetNormalToRef=function(t,i){var n=this.getFacetLocalNormals()[t];return y.TransformNormalToRef(n,this.getWorldMatrix(),i),this},e.prototype.getFacetsAtLocalCoordinates=function(t,i,n){var a=this.getBoundingInfo(),s=this._internalAbstractMeshDataInfo._facetData,o=Math.floor((t-a.minimum.x*s.partitioningBBoxRatio)*s.subDiv.X*s.partitioningBBoxRatio/s.bbSize.x),u=Math.floor((i-a.minimum.y*s.partitioningBBoxRatio)*s.subDiv.Y*s.partitioningBBoxRatio/s.bbSize.y),l=Math.floor((n-a.minimum.z*s.partitioningBBoxRatio)*s.subDiv.Z*s.partitioningBBoxRatio/s.bbSize.z);return o<0||o>s.subDiv.max||u<0||u>s.subDiv.max||l<0||l>s.subDiv.max?null:s.facetPartitioning[o+s.subDiv.max*u+s.subDiv.max*s.subDiv.max*l]},e.prototype.getClosestFacetAtCoordinates=function(t,i,n,a,s,o){s===void 0&&(s=!1),o===void 0&&(o=!0);var u=this.getWorldMatrix(),l=I.Matrix[5];u.invertToRef(l);var f=I.Vector3[8];y.TransformCoordinatesFromFloatsToRef(t,i,n,l,f);var h=this.getClosestFacetAtLocalCoordinates(f.x,f.y,f.z,a,s,o);return a&&y.TransformCoordinatesFromFloatsToRef(a.x,a.y,a.z,u,a),h},e.prototype.getClosestFacetAtLocalCoordinates=function(t,i,n,a,s,o){s===void 0&&(s=!1),o===void 0&&(o=!0);var u=null,l=0,f=0,h=0,c=0,p=0,d=0,g=0,m=0,E=this.getFacetLocalPositions(),v=this.getFacetLocalNormals(),A=this.getFacetsAtLocalCoordinates(t,i,n);if(!A)return null;for(var M=Number.MAX_VALUE,C=M,P,S,x,z=0;z<A.length;z++)P=A[z],S=v[P],x=E[P],c=(t-x.x)*S.x+(i-x.y)*S.y+(n-x.z)*S.z,(!s||s&&o&&c>=0||s&&!o&&c<=0)&&(c=S.x*x.x+S.y*x.y+S.z*x.z,p=-(S.x*t+S.y*i+S.z*n-c)/(S.x*S.x+S.y*S.y+S.z*S.z),d=t+S.x*p,g=i+S.y*p,m=n+S.z*p,l=d-t,f=g-i,h=m-n,C=l*l+f*f+h*h,C<M&&(M=C,u=P,a&&(a.x=d,a.y=g,a.z=m)));return u},e.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},e.prototype.disableFacetData=function(){var t=this._internalAbstractMeshDataInfo._facetData;return t.facetDataEnabled&&(t.facetDataEnabled=!1,t.facetPositions=new Array,t.facetNormals=new Array,t.facetPartitioning=new Array,t.facetParameters=null,t.depthSortedIndices=new Uint32Array(0)),this},e.prototype.updateIndices=function(t,i,n){return this},e.prototype.createNormals=function(t){var i=this.getVerticesData(_.PositionKind),n=this.getIndices(),a;return this.isVerticesDataPresent(_.NormalKind)?a=this.getVerticesData(_.NormalKind):a=[],Z.ComputeNormals(i,n,a,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(_.NormalKind,a,t),this},e.prototype.alignWithNormal=function(t,i){i||(i=qt.Y);var n=I.Vector3[0],a=I.Vector3[1];return y.CrossToRef(i,t,a),y.CrossToRef(t,a,n),this.rotationQuaternion?W.RotationQuaternionFromAxisToRef(n,t,a,this.rotationQuaternion):y.RotationFromAxisToRef(n,t,a,this.rotation),this},e.prototype._checkOcclusionQuery=function(){return!1},e.prototype.disableEdgesRendering=function(){throw O.WarnImport("EdgesRenderer")},e.prototype.enableEdgesRendering=function(t,i,n){throw O.WarnImport("EdgesRenderer")},e.prototype.getConnectedParticleSystems=function(){var t=this;return this._scene.particleSystems.filter(function(i){return i.emitter===t})},e.OCCLUSION_TYPE_NONE=0,e.OCCLUSION_TYPE_OPTIMISTIC=1,e.OCCLUSION_TYPE_STRICT=2,e.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,e.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,e.CULLINGSTRATEGY_STANDARD=0,e.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,e.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,e}(Re);_e.RegisteredTypes["BABYLON.AbstractMesh"]=pt;var yr=function(){function r(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}return r.prototype.toGlobal=function(e,t){return new r(this.x*e,this.y*t,this.width*e,this.height*t)},r.prototype.toGlobalToRef=function(e,t,i){return i.x=this.x*e,i.y=this.y*t,i.width=this.width*e,i.height=this.height*t,this},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r}(),ri=function(){function r(e,t,i,n){this.normal=new y(e,t,i),this.d=n}return r.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},r.prototype.clone=function(){return new r(this.normal.x,this.normal.y,this.normal.z,this.d)},r.prototype.getClassName=function(){return"Plane"},r.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=e*397^(this.d|0),e},r.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return e!==0&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},r.prototype.transform=function(e){var t=r._TmpMatrix;e.invertToRef(t);var i=t.m,n=this.normal.x,a=this.normal.y,s=this.normal.z,o=this.d,u=n*i[0]+a*i[1]+s*i[2]+o*i[3],l=n*i[4]+a*i[5]+s*i[6]+o*i[7],f=n*i[8]+a*i[9]+s*i[10]+o*i[11],h=n*i[12]+a*i[13]+s*i[14]+o*i[15];return new r(u,l,f,h)},r.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},r.prototype.copyFromPoints=function(e,t,i){var n=t.x-e.x,a=t.y-e.y,s=t.z-e.z,o=i.x-e.x,u=i.y-e.y,l=i.z-e.z,f=a*l-s*u,h=s*o-n*l,c=n*u-a*o,p=Math.sqrt(f*f+h*h+c*c),d;return p!==0?d=1/p:d=0,this.normal.x=f*d,this.normal.y=h*d,this.normal.z=c*d,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},r.prototype.isFrontFacingTo=function(e,t){var i=y.Dot(this.normal,e);return i<=t},r.prototype.signedDistanceTo=function(e){return y.Dot(e,this.normal)+this.d},r.FromArray=function(e){return new r(e[0],e[1],e[2],e[3])},r.FromPoints=function(e,t,i){var n=new r(0,0,0,0);return n.copyFromPoints(e,t,i),n},r.FromPositionAndNormal=function(e,t){var i=new r(0,0,0,0);return t.normalize(),i.normal=t,i.d=-(t.x*e.x+t.y*e.y+t.z*e.z),i},r.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return y.Dot(i,t)+n},r._TmpMatrix=R.Identity(),r}(),wt=function(){function r(){}return r.GetPlanes=function(e){for(var t=[],i=0;i<6;i++)t.push(new ri(0,0,0,0));return r.GetPlanesToRef(e,t),t},r.GetNearPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[2],t.normal.y=i[7]+i[6],t.normal.z=i[11]+i[10],t.d=i[15]+i[14],t.normalize()},r.GetFarPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[2],t.normal.y=i[7]-i[6],t.normal.z=i[11]-i[10],t.d=i[15]-i[14],t.normalize()},r.GetLeftPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[0],t.normal.y=i[7]+i[4],t.normal.z=i[11]+i[8],t.d=i[15]+i[12],t.normalize()},r.GetRightPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[0],t.normal.y=i[7]-i[4],t.normal.z=i[11]-i[8],t.d=i[15]-i[12],t.normalize()},r.GetTopPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]-i[1],t.normal.y=i[7]-i[5],t.normal.z=i[11]-i[9],t.d=i[15]-i[13],t.normalize()},r.GetBottomPlaneToRef=function(e,t){var i=e.m;t.normal.x=i[3]+i[1],t.normal.y=i[7]+i[5],t.normal.z=i[11]+i[9],t.d=i[15]+i[13],t.normalize()},r.GetPlanesToRef=function(e,t){r.GetNearPlaneToRef(e,t[0]),r.GetFarPlaneToRef(e,t[1]),r.GetLeftPlaneToRef(e,t[2]),r.GetRightPlaneToRef(e,t[3]),r.GetTopPlaneToRef(e,t[4]),r.GetBottomPlaneToRef(e,t[5])},r}(),J=function(r){N(e,r);function e(t,i,n,a){a===void 0&&(a=!0);var s=r.call(this,t,n)||this;return s._position=y.Zero(),s._upVector=y.Up(),s.orthoLeft=null,s.orthoRight=null,s.orthoBottom=null,s.orthoTop=null,s.fov=.8,s.minZ=1,s.maxZ=1e4,s.inertia=.9,s.mode=e.PERSPECTIVE_CAMERA,s.isIntermediate=!1,s.viewport=new yr(0,0,1,1),s.layerMask=268435455,s.fovMode=e.FOVMODE_VERTICAL_FIXED,s.cameraRigMode=e.RIG_MODE_NONE,s.customRenderTargets=new Array,s.outputRenderTarget=null,s.onViewMatrixChangedObservable=new D,s.onProjectionMatrixChangedObservable=new D,s.onAfterCheckInputsObservable=new D,s.onRestoreStateObservable=new D,s.isRigCamera=!1,s._rigCameras=new Array,s._webvrViewMatrix=R.Identity(),s._skipRendering=!1,s._projectionMatrix=new R,s._postProcesses=new Array,s._activeMeshes=new Ie(256),s._globalPosition=y.Zero(),s._computedViewMatrix=R.Identity(),s._doNotComputeProjectionMatrix=!1,s._transformMatrix=R.Zero(),s._refreshFrustumPlanes=!0,s._isCamera=!0,s._isLeftCamera=!1,s._isRightCamera=!1,s.getScene().addCamera(s),a&&!s.getScene().activeCamera&&(s.getScene().activeCamera=s),s.position=i,s}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upVector",{get:function(){return this._upVector},set:function(t){this._upVector=t},enumerable:!1,configurable:!0}),e.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},e.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},e.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},e.prototype.getClassName=function(){return"Camera"},e.prototype.toString=function(t){var i="Name: "+this.name;if(i+=", type: "+this.getClassName(),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(t);return i},Object.defineProperty(e.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),e.prototype.getActiveMeshes=function(){return this._activeMeshes},e.prototype.isActiveMesh=function(t){return this._activeMeshes.indexOf(t)!==-1},e.prototype.isReady=function(t){if(t===void 0&&(t=!1),t)for(var i=0,n=this._postProcesses;i<n.length;i++){var a=n[i];if(a&&!a.isReady())return!1}return r.prototype.isReady.call(this,t)},e.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.position=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},e.prototype._updateCache=function(t){t||r.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},e.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},e.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},e.prototype._isSynchronizedProjectionMatrix=function(){var t=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!t)return!1;var i=this.getEngine();return this.mode===e.PERSPECTIVE_CAMERA?t=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===i.getAspectRatio(this):t=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===i.getRenderWidth()&&this._cache.renderHeight===i.getRenderHeight(),t},e.prototype.attachControl=function(t,i){},e.prototype.detachControl=function(t){},e.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==e.RIG_MODE_NONE&&this._updateRigCameras()},e.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(e.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),e.prototype._getFirstPostProcess=function(){for(var t=0;t<this._postProcesses.length;t++)if(this._postProcesses[t]!==null)return this._postProcesses[t];return null},e.prototype._cascadePostProcessesToRigCams=function(){var t=this._getFirstPostProcess();t&&t.markTextureDirty();for(var i=0,n=this._rigCameras.length;i<n;i++){var a=this._rigCameras[i],s=a._rigPostProcess;if(s){var o=s.getEffectName()==="pass";o&&(a.isIntermediate=this._postProcesses.length===0),a._postProcesses=this._postProcesses.slice(0).concat(s),s.markTextureDirty()}else a._postProcesses=this._postProcesses.slice(0)}},e.prototype.attachPostProcess=function(t,i){return i===void 0&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(L.Error("You're trying to reuse a post process not defined as reusable."),0):(i==null||i<0?this._postProcesses.push(t):this._postProcesses[i]===null?this._postProcesses[i]=t:this._postProcesses.splice(i,0,t),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(t))},e.prototype.detachPostProcess=function(t){var i=this._postProcesses.indexOf(t);i!==-1&&(this._postProcesses[i]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},e.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},e.prototype._getViewMatrix=function(){return R.Identity()},e.prototype.getViewMatrix=function(t){return!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},e.prototype.freezeProjectionMatrix=function(t){this._doNotComputeProjectionMatrix=!0,t!==void 0&&(this._projectionMatrix=t)},e.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},e.prototype.getProjectionMatrix=function(t){var i,n,a,s,o,u,l,f;if(this._doNotComputeProjectionMatrix||!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var h=this.getEngine(),c=this.getScene();if(this.mode===e.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=h.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var p=h.useReverseDepthBuffer,d=void 0;c.useRightHandedSystem?d=p?R.PerspectiveFovReverseRHToRef:R.PerspectiveFovRHToRef:d=p?R.PerspectiveFovReverseLHToRef:R.PerspectiveFovLHToRef,d(this.fov,h.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===e.FOVMODE_VERTICAL_FIXED)}else{var g=h.getRenderWidth()/2,m=h.getRenderHeight()/2;c.useRightHandedSystem?R.OrthoOffCenterRHToRef((i=this.orthoLeft)!==null&&i!==void 0?i:-g,(n=this.orthoRight)!==null&&n!==void 0?n:g,(a=this.orthoBottom)!==null&&a!==void 0?a:-m,(s=this.orthoTop)!==null&&s!==void 0?s:m,this.minZ,this.maxZ,this._projectionMatrix):R.OrthoOffCenterLHToRef((o=this.orthoLeft)!==null&&o!==void 0?o:-g,(u=this.orthoRight)!==null&&u!==void 0?u:g,(l=this.orthoBottom)!==null&&l!==void 0?l:-m,(f=this.orthoTop)!==null&&f!==void 0?f:m,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=h.getRenderWidth(),this._cache.renderHeight=h.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},e.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},e.prototype._updateFrustumPlanes=function(){!this._refreshFrustumPlanes||(this.getTransformationMatrix(),this._frustumPlanes?wt.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=wt.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},e.prototype.isInFrustum=function(t,i){if(i===void 0&&(i=!1),this._updateFrustumPlanes(),i&&this.rigCameras.length>0){var n=!1;return this.rigCameras.forEach(function(a){a._updateFrustumPlanes(),n=n||t.isInFrustum(a._frustumPlanes)}),n}else return t.isInFrustum(this._frustumPlanes)},e.prototype.isCompletelyInFrustum=function(t){return this._updateFrustumPlanes(),t.isCompletelyInFrustum(this._frustumPlanes)},e.prototype.getForwardRay=function(t,i,n){throw O.WarnImport("Ray")},e.prototype.getForwardRayToRef=function(t,i,n,a){throw O.WarnImport("Ray")},e.prototype.dispose=function(t,i){for(i===void 0&&(i=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==e.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var s=this._postProcesses.length;--s>=0;){var a=this._postProcesses[s];a&&a.dispose(this)}for(var s=this.customRenderTargets.length;--s>=0;)this.customRenderTargets[s].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),r.prototype.dispose.call(this,t,i)},Object.defineProperty(e.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),e.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},e.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},e.prototype.setCameraRigMode=function(t,i){if(this.cameraRigMode!==t){for(;this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=i.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=te.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==e.RIG_MODE_NONE){var a=this.createRigCamera(this.name+"_L",0);a&&(a._isLeftCamera=!0);var s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),a&&s&&(this._rigCameras.push(a),this._rigCameras.push(s))}switch(this.cameraRigMode){case e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:e._setStereoscopicAnaglyphRigMode(this);break;case e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.RIG_MODE_STEREOSCOPIC_INTERLACED:e._setStereoscopicRigMode(this);break;case e.RIG_MODE_VR:e._setVRRigMode(this,i);break;case e.RIG_MODE_WEBVR:e._setWebVRRigMode(this,i);break}this._cascadePostProcessesToRigCams(),this.update()}},e._setStereoscopicRigMode=function(t){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},e._setStereoscopicAnaglyphRigMode=function(t){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},e._setVRRigMode=function(t,i){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},e._setWebVRRigMode=function(t,i){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},e.prototype._getVRProjectionMatrix=function(){return R.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},e.prototype._updateCameraRotationMatrix=function(){},e.prototype._updateWebVRCameraRotationMatrix=function(){},e.prototype._getWebVRProjectionMatrix=function(){return R.Identity()},e.prototype._getWebVRViewMatrix=function(){return R.Identity()},e.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=i,t==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=te.ToRadians(i/.0637))},e.prototype.createRigCamera=function(t,i){return null},e.prototype._updateRigCameras=function(){for(var t=0;t<this._rigCameras.length;t++)this._rigCameras[t].minZ=this.minZ,this._rigCameras[t].maxZ=this.maxZ,this._rigCameras[t].fov=this.fov,this._rigCameras[t].upVector.copyFrom(this.upVector);this.cameraRigMode===e.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},e.prototype._setupInputs=function(){},e.prototype.serialize=function(){var t=H.Serialize(this);return t.type=this.getClassName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),H.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},e.prototype.clone=function(t){return H.Clone(e.GetConstructorFromName(this.getClassName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},e.prototype.getDirection=function(t){var i=y.Zero();return this.getDirectionToRef(t,i),i},Object.defineProperty(e.prototype,"absoluteRotation",{get:function(){var t=W.Zero();return this.getWorldMatrix().decompose(void 0,t),t},enumerable:!1,configurable:!0}),e.prototype.getDirectionToRef=function(t,i){y.TransformNormalToRef(t,this.getWorldMatrix(),i)},e.GetConstructorFromName=function(t,i,n,a,s){a===void 0&&(a=0),s===void 0&&(s=!0);var o=xe.Construct(t,i,n,{interaxial_distance:a,isStereoscopicSideBySide:s});return o||function(){return e._createDefaultParsedCamera(i,n)}},e.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},e.Parse=function(t,i){var n=t.type,a=e.GetConstructorFromName(n,t.name,i,t.interaxial_distance,t.isStereoscopicSideBySide),s=H.Parse(a,t,i);if(t.parentId&&(s._waitingParentId=t.parentId),s.inputs&&(s.inputs.parse(t),s._setupInputs()),t.upVector&&(s.upVector=y.FromArray(t.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(y.FromArray(t.position))),t.target&&s.setTarget&&s.setTarget(y.FromArray(t.target)),t.cameraRigMode){var o=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,o)}if(t.animations){for(var u=0;u<t.animations.length;u++){var l=t.animations[u],f=_e.GetClass("BABYLON.Animation");f&&s.animations.push(f.Parse(l))}xe.ParseAnimationRanges(s,t,i)}return t.autoAnimate&&i.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s},e._createDefaultParsedCamera=function(t,i){throw O.WarnImport("UniversalCamera")},e.PERSPECTIVE_CAMERA=0,e.ORTHOGRAPHIC_CAMERA=1,e.FOVMODE_VERTICAL_FIXED=0,e.FOVMODE_HORIZONTAL_FIXED=1,e.RIG_MODE_NONE=0,e.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,e.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,e.RIG_MODE_STEREOSCOPIC_INTERLACED=14,e.RIG_MODE_VR=20,e.RIG_MODE_WEBVR=21,e.RIG_MODE_CUSTOM=22,e.ForceAttachControlToAlwaysPreventDefault=!1,b([Ye("position")],e.prototype,"_position",void 0),b([Ye("upVector")],e.prototype,"_upVector",void 0),b([T()],e.prototype,"orthoLeft",void 0),b([T()],e.prototype,"orthoRight",void 0),b([T()],e.prototype,"orthoBottom",void 0),b([T()],e.prototype,"orthoTop",void 0),b([T()],e.prototype,"fov",void 0),b([T()],e.prototype,"minZ",void 0),b([T()],e.prototype,"maxZ",void 0),b([T()],e.prototype,"inertia",void 0),b([T()],e.prototype,"mode",void 0),b([T()],e.prototype,"layerMask",void 0),b([T()],e.prototype,"fovMode",void 0),b([T()],e.prototype,"cameraRigMode",void 0),b([T()],e.prototype,"interaxialDistance",void 0),b([T()],e.prototype,"isStereoscopicSideBySide",void 0),e}(xe),br=function(){function r(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return r.AddParser=function(e,t){this._BabylonFileParsers[e]=t},r.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},r.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},r.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},r.Parse=function(e,t,i,n){for(var a in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(a)&&this._BabylonFileParsers[a](e,t,i,n)},Object.defineProperty(r.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e},enumerable:!1,configurable:!0}),r.prototype.getNodes=function(){var e=new Array;return e=e.concat(this.meshes),e=e.concat(this.lights),e=e.concat(this.cameras),e=e.concat(this.transformNodes),this.skeletons.forEach(function(t){return e=e.concat(t.bones)}),e},r._BabylonFileParsers={},r._IndividualBabylonFileParsers={},r}(),Si=function(){function r(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(r.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),r.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},r.prototype.markAsUnprocessed=function(){this._isDirty=!0},r.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},r.prototype.markAsLightDirty=function(e){e===void 0&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},r.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},r.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},r.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},r.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},r.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},r.prototype.rebuild=function(){this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var i=t[e];i[0]!=="_"&&this._keys.push(i)}},r.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},r.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},r.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e],i=typeof this[t];switch(i){case"number":this[t]=0;break;case"string":this[t]="";break;default:this[t]=!1;break}}},r.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t],n=this[i],a=typeof n;switch(a){case"number":case"string":e+="#define "+i+" "+n+`
`;break;default:n&&(e+="#define "+i+`
`);break}}return e},r}(),xt=function(){function r(){this._dirty=!0,this._tempColor=new fe(0,0,0,0),this._globalCurve=new fe(0,0,0,0),this._highlightsCurve=new fe(0,0,0,0),this._midtonesCurve=new fe(0,0,0,0),this._shadowsCurve=new fe(0,0,0,0),this._positiveCurve=new fe(0,0,0,0),this._negativeCurve=new fe(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(r.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ColorCurves"},r.Bind=function(e,t,i,n,a){i===void 0&&(i="vCameraColorCurvePositive"),n===void 0&&(n="vCameraColorCurveNeutral"),a===void 0&&(a="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(i,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(n,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(a,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},r.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},r.prototype.getColorGradingDataToRef=function(e,t,i,n,a){e!=null&&(e=r.clamp(e,0,360),t=r.clamp(t,-100,100),i=r.clamp(i,-100,100),n=r.clamp(n,-100,100),t=r.applyColorGradingSliderNonlinear(t),t*=.5,n=r.applyColorGradingSliderNonlinear(n),t<0&&(t*=-1,e=(e+180)%360),r.fromHSBToRef(e,t,50+.25*n,a),a.scaleToRef(2,a),a.a=1+.01*i)},r.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100,t},r.fromHSBToRef=function(e,t,i,n){var a=r.clamp(e,0,360),s=r.clamp(t/100,0,1),o=r.clamp(i/100,0,1);if(s===0)n.r=o,n.g=o,n.b=o;else{a/=60;var u=Math.floor(a),l=a-u,f=o*(1-s),h=o*(1-s*l),c=o*(1-s*(1-l));switch(u){case 0:n.r=o,n.g=c,n.b=f;break;case 1:n.r=h,n.g=o,n.b=f;break;case 2:n.r=f,n.g=o,n.b=c;break;case 3:n.r=f,n.g=h,n.b=o;break;case 4:n.r=c,n.g=f,n.b=o;break;default:n.r=o,n.g=f,n.b=h;break}}n.a=1},r.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},r.prototype.clone=function(){return H.Clone(function(){return new r},this)},r.prototype.serialize=function(){return H.Serialize(this)},r.Parse=function(e){return H.Parse(function(){return new r},e,null,null)},b([T()],r.prototype,"_globalHue",void 0),b([T()],r.prototype,"_globalDensity",void 0),b([T()],r.prototype,"_globalSaturation",void 0),b([T()],r.prototype,"_globalExposure",void 0),b([T()],r.prototype,"_highlightsHue",void 0),b([T()],r.prototype,"_highlightsDensity",void 0),b([T()],r.prototype,"_highlightsSaturation",void 0),b([T()],r.prototype,"_highlightsExposure",void 0),b([T()],r.prototype,"_midtonesHue",void 0),b([T()],r.prototype,"_midtonesDensity",void 0),b([T()],r.prototype,"_midtonesSaturation",void 0),b([T()],r.prototype,"_midtonesExposure",void 0),r}();H._ColorCurvesParser=xt.Parse;(function(r){N(e,r);function e(){var t=r.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.rebuild(),t}return e})(Si);var tt=function(){function r(){this.colorCurves=new xt,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=r.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new fe(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=r.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new D}return Object.defineProperty(r.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),r.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},r.prototype.getClassName=function(){return"ImageProcessingConfiguration"},r.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&xt.PrepareUniforms(e)},r.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},r.prototype.prepareDefines=function(e,t){if(t===void 0&&(t=!1),t!==this.applyByPostProcess||!this._isEnabled){e.VIGNETTE=!1,e.TONEMAPPING=!1,e.TONEMAPPING_ACES=!1,e.CONTRAST=!1,e.EXPOSURE=!1,e.COLORCURVES=!1,e.COLORGRADING=!1,e.COLORGRADING3D=!1,e.IMAGEPROCESSING=!1,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(e.VIGNETTE=this.vignetteEnabled,e.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===r._VIGNETTEMODE_MULTIPLY,e.VIGNETTEBLENDMODEOPAQUE=!e.VIGNETTEBLENDMODEMULTIPLY,e.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case r.TONEMAPPING_ACES:e.TONEMAPPING_ACES=!0;break;default:e.TONEMAPPING_ACES=!1;break}e.CONTRAST=this.contrast!==1,e.EXPOSURE=this.exposure!==1,e.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,e.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,e.COLORGRADING?e.COLORGRADING3D=this.colorGradingTexture.is3D:e.COLORGRADING3D=!1,e.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,e.SAMPLER3DBGRMAP=this.colorGradingBGR,e.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,e.IMAGEPROCESSING=e.VIGNETTE||e.TONEMAPPING||e.CONTRAST||e.EXPOSURE||e.COLORCURVES||e.COLORGRADING},r.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},r.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&xt.Bind(this.colorCurves,e),this._vignetteEnabled){var i=1/e.getEngine().getRenderWidth(),n=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",i,n);var a=t!=null?t:n/i,s=Math.tan(this.vignetteCameraFov*.5),o=s*a,u=Math.sqrt(o*s);o=te.Mix(o,u,this.vignetteStretch),s=te.Mix(s,u,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,s,-o*this.vignetteCentreX,-s*this.vignetteCentreY);var l=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var f=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(f-1)/f,.5/f,f,this.colorGradingTexture.level)}},r.prototype.clone=function(){return H.Clone(function(){return new r},this)},r.prototype.serialize=function(){return H.Serialize(this)},r.Parse=function(e){return H.Parse(function(){return new r},e,null,null)},Object.defineProperty(r,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(r,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),r.TONEMAPPING_STANDARD=0,r.TONEMAPPING_ACES=1,r._VIGNETTEMODE_MULTIPLY=0,r._VIGNETTEMODE_OPAQUE=1,b([fr()],r.prototype,"colorCurves",void 0),b([T()],r.prototype,"_colorCurvesEnabled",void 0),b([Ce("colorGradingTexture")],r.prototype,"_colorGradingTexture",void 0),b([T()],r.prototype,"_colorGradingEnabled",void 0),b([T()],r.prototype,"_colorGradingWithGreenDepth",void 0),b([T()],r.prototype,"_colorGradingBGR",void 0),b([T()],r.prototype,"_exposure",void 0),b([T()],r.prototype,"_toneMappingEnabled",void 0),b([T()],r.prototype,"_toneMappingType",void 0),b([T()],r.prototype,"_contrast",void 0),b([T()],r.prototype,"vignetteStretch",void 0),b([T()],r.prototype,"vignetteCentreX",void 0),b([T()],r.prototype,"vignetteCentreY",void 0),b([T()],r.prototype,"vignetteWeight",void 0),b([hr()],r.prototype,"vignetteColor",void 0),b([T()],r.prototype,"vignetteCameraFov",void 0),b([T()],r.prototype,"_vignetteBlendMode",void 0),b([T()],r.prototype,"_vignetteEnabled",void 0),b([T()],r.prototype,"_applyByPostProcess",void 0),b([T()],r.prototype,"_isEnabled",void 0),r}();H._ImageProcessingConfigurationParser=tt.Parse;pe.prototype.createUniformBuffer=function(r){var e=this._gl.createBuffer();if(!e)throw new Error("Unable to create uniform buffer");var t=new dt(e);return this.bindUniformBuffer(t),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),t.references=1,t};pe.prototype.createDynamicUniformBuffer=function(r){var e=this._gl.createBuffer();if(!e)throw new Error("Unable to create dynamic uniform buffer");var t=new dt(e);return this.bindUniformBuffer(t),r instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,r,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(r),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),t.references=1,t};pe.prototype.updateUniformBuffer=function(r,e,t,i){this.bindUniformBuffer(r),t===void 0&&(t=0),i===void 0?e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,e):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,t,new Float32Array(e)):e instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,e.subarray(t,t+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(e).subarray(t,t+i)),this.bindUniformBuffer(null)};pe.prototype.bindUniformBuffer=function(r){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,r?r.underlyingResource:null)};pe.prototype.bindUniformBufferBase=function(r,e){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,e,r?r.underlyingResource:null)};pe.prototype.bindUniformBlock=function(r,e,t){var i=r.program,n=this._gl.getUniformBlockIndex(i,e);this._gl.uniformBlockBinding(i,n,t)};var ni=function(){function r(e,t,i){this._alreadyBound=!1,this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=i,this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformLocationPointer=0,this._needSync=!1,this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform)}return Object.defineProperty(r.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),r.prototype.isDynamic=function(){return this._dynamic!==void 0},r.prototype.getData=function(){return this._bufferData},r.prototype.getBuffer=function(){return this._buffer},r.prototype._fillAlignment=function(e){var t;if(e<=2?t=e:t=4,this._uniformLocationPointer%t!==0){var i=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var n=this._uniformLocationPointer-i,a=0;a<n;a++)this._data.push(0)}},r.prototype.addUniform=function(e,t){if(!this._noUBO&&this._uniformLocations[e]===void 0){var i;if(t instanceof Array)i=t,t=i.length;else{t=t,i=[];for(var n=0;n<t;n++)i.push(0)}this._fillAlignment(t),this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(var n=0;n<t;n++)this._data.push(i[n]);this._needSync=!0}},r.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},r.prototype.addFloat2=function(e,t,i){var n=[t,i];this.addUniform(e,n)},r.prototype.addFloat3=function(e,t,i,n){var a=[t,i,n];this.addUniform(e,a)},r.prototype.addColor3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},r.prototype.addColor4=function(e,t,i){var n=new Array;t.toArray(n),n.push(i),this.addUniform(e,n)},r.prototype.addVector3=function(e,t){var i=new Array;t.toArray(i),this.addUniform(e,i)},r.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},r.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},r.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},r.prototype._rebuild=function(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData))},r.prototype.update=function(){if(!this._buffer){this.create();return}!this._dynamic&&!this._needSync||(this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._needSync=!1)},r.prototype.updateUniform=function(e,t,i){var n=this._uniformLocations[e];if(n===void 0){if(this._buffer){L.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(e,i),n=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(var s=0;s<i;s++)this._bufferData[n+s]=t[s];else{for(var a=!1,s=0;s<i;s++)(i===16||this._bufferData[n+s]!==t[s])&&(a=!0,this._bufferData[n+s]=t[s]);this._needSync=this._needSync||a}},r.prototype._cacheMatrix=function(e,t){var i=this._valueCache[e],n=t.updateFlag;return i!==void 0&&i===n?!1:(this._valueCache[e]=n,!0)},r.prototype._updateMatrix3x3ForUniform=function(e,t){for(var i=0;i<3;i++)r._tempBuffer[i*4]=t[i*3],r._tempBuffer[i*4+1]=t[i*3+1],r._tempBuffer[i*4+2]=t[i*3+2],r._tempBuffer[i*4+3]=0;this.updateUniform(e,r._tempBuffer,12)},r.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},r.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},r.prototype._updateMatrix2x2ForUniform=function(e,t){for(var i=0;i<2;i++)r._tempBuffer[i*4]=t[i*2],r._tempBuffer[i*4+1]=t[i*2+1],r._tempBuffer[i*4+2]=0,r._tempBuffer[i*4+3]=0;this.updateUniform(e,r._tempBuffer,8)},r.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},r.prototype._updateFloatForUniform=function(e,t){r._tempBuffer[0]=t,this.updateUniform(e,r._tempBuffer,1)},r.prototype._updateFloat2ForEffect=function(e,t,i,n){n===void 0&&(n=""),this._currentEffect.setFloat2(e+n,t,i)},r.prototype._updateFloat2ForUniform=function(e,t,i){r._tempBuffer[0]=t,r._tempBuffer[1]=i,this.updateUniform(e,r._tempBuffer,2)},r.prototype._updateFloat3ForEffect=function(e,t,i,n,a){a===void 0&&(a=""),this._currentEffect.setFloat3(e+a,t,i,n)},r.prototype._updateFloat3ForUniform=function(e,t,i,n){r._tempBuffer[0]=t,r._tempBuffer[1]=i,r._tempBuffer[2]=n,this.updateUniform(e,r._tempBuffer,3)},r.prototype._updateFloat4ForEffect=function(e,t,i,n,a,s){s===void 0&&(s=""),this._currentEffect.setFloat4(e+s,t,i,n,a)},r.prototype._updateFloat4ForUniform=function(e,t,i,n,a){r._tempBuffer[0]=t,r._tempBuffer[1]=i,r._tempBuffer[2]=n,r._tempBuffer[3]=a,this.updateUniform(e,r._tempBuffer,4)},r.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},r.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},r.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},r.prototype._updateVector3ForUniform=function(e,t){t.toArray(r._tempBuffer),this.updateUniform(e,r._tempBuffer,3)},r.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},r.prototype._updateVector4ForUniform=function(e,t){t.toArray(r._tempBuffer),this.updateUniform(e,r._tempBuffer,4)},r.prototype._updateColor3ForEffect=function(e,t,i){i===void 0&&(i=""),this._currentEffect.setColor3(e+i,t)},r.prototype._updateColor3ForUniform=function(e,t){t.toArray(r._tempBuffer),this.updateUniform(e,r._tempBuffer,3)},r.prototype._updateColor4ForEffect=function(e,t,i,n){n===void 0&&(n=""),this._currentEffect.setColor4(e+n,t,i)},r.prototype._updateColor4ForUniform=function(e,t,i){t.toArray(r._tempBuffer),r._tempBuffer[3]=i,this.updateUniform(e,r._tempBuffer,4)},r.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},r.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},r.prototype.bindToEffect=function(e,t){this._currentEffect=e,!(this._noUBO||!this._buffer)&&(this._alreadyBound=!0,e.bindUniformBuffer(this._buffer,t))},r.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);t!==-1&&(e[t]=e[e.length-1],e.pop()),!!this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},r._MAX_UNIFORM_SIZE=256,r._tempBuffer=new Float32Array(r._MAX_UNIFORM_SIZE),r}(),Ze=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.diffuse=new ae(1,1,1),n.specular=new ae(1,1,1),n.falloffType=e.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=e.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new ni(n.getScene().getEngine()),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return Object.defineProperty(e.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(t){this._intensityMode=t,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled!==t&&(this._shadowEnabled=t,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(t){this._includedOnlyMeshes=t,this._hookArrayForIncludedOnly(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(t){this._excludedMeshes=t,this._hookArrayForExcluded(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(t){this._excludeWithLayerMask=t,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(t){this._includeOnlyWithLayerMask=t,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(t){this._lightmapMode!==t&&(this._lightmapMode=t,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),e.prototype.transferTexturesToEffect=function(t,i){return this},e.prototype._bindLight=function(t,i,n,a,s){s===void 0&&(s=!1);var o=t.toString(),u=!1;if(!(s&&this._uniformBuffer._alreadyBound)){if(this._uniformBuffer.bindToEffect(n,"Light"+o),this._renderId!==i.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=i.getRenderId();var l=this.getScaledIntensity();this.transferToEffect(n,o),this.diffuse.scaleToRef(l,Pt.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",Pt.Color3[0],this.range,o),a&&(this.specular.scaleToRef(l,Pt.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",Pt.Color3[1],this.radius,o)),u=!0}if(this.transferTexturesToEffect(n,o),i.shadowsEnabled&&this.shadowEnabled){var f=this.getShadowGenerator();f&&(f.bindShadowLight(o,n),u=!0)}u&&this._uniformBuffer.update()}},e.prototype.getClassName=function(){return"Light"},e.prototype.toString=function(t){var i="Name: "+this.name;if(i+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(t);return i},e.prototype._syncParentEnabledState=function(){r.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},e.prototype.setEnabled=function(t){r.prototype.setEnabled.call(this,t),this._resyncMeshes()},e.prototype.getShadowGenerator=function(){return this._shadowGenerator},e.prototype.getAbsolutePosition=function(){return y.Zero()},e.prototype.canAffectMesh=function(t){return t?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(t)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(t)!==-1||this.includeOnlyWithLayerMask!==0&&(this.includeOnlyWithLayerMask&t.layerMask)===0||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&t.layerMask):!0},e.CompareLightsPriority=function(t,i){return t.shadowEnabled!==i.shadowEnabled?(i.shadowEnabled?1:0)-(t.shadowEnabled?1:0):i.renderPriority-t.renderPriority},e.prototype.dispose=function(t,i){i===void 0&&(i=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var n=0,a=this.getScene().meshes;n<a.length;n++){var s=a[n];s._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),r.prototype.dispose.call(this,t,i)},e.prototype.getTypeID=function(){return 0},e.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},e.prototype.clone=function(t,i){i===void 0&&(i=null);var n=e.GetConstructorFromName(this.getTypeID(),t,this.getScene());if(!n)return null;var a=H.Clone(n,this);return i&&(a.parent=i),a.setEnabled(this.isEnabled()),a},e.prototype.serialize=function(){var t=H.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(function(i){t.excludedMeshesIds.push(i.id)})),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(i){t.includedOnlyMeshesIds.push(i.id)})),H.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},e.GetConstructorFromName=function(t,i,n){var a=xe.Construct("Light_Type_"+t,i,n);return a||null},e.Parse=function(t,i){var n=e.GetConstructorFromName(t.type,t.name,i);if(!n)return null;var a=H.Parse(n,t,i);if(t.excludedMeshesIds&&(a._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(a._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.parentId&&(a._waitingParentId=t.parentId),t.falloffType!==void 0&&(a.falloffType=t.falloffType),t.lightmapMode!==void 0&&(a.lightmapMode=t.lightmapMode),t.animations){for(var s=0;s<t.animations.length;s++){var o=t.animations[s],u=_e.GetClass("BABYLON.Animation");u&&a.animations.push(u.Parse(o))}xe.ParseAnimationRanges(a,t,i)}return t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),a},e.prototype._hookArrayForExcluded=function(t){var i=this,n=t.push;t.push=function(){for(var l=[],f=0;f<arguments.length;f++)l[f]=arguments[f];for(var h=n.apply(t,l),c=0,p=l;c<p.length;c++){var d=p[c];d._resyncLightSource(i)}return h};var a=t.splice;t.splice=function(l,f){for(var h=a.apply(t,[l,f]),c=0,p=h;c<p.length;c++){var d=p[c];d._resyncLightSource(i)}return h};for(var s=0,o=t;s<o.length;s++){var u=o[s];u._resyncLightSource(this)}},e.prototype._hookArrayForIncludedOnly=function(t){var i=this,n=t.push;t.push=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var u=n.apply(t,s);return i._resyncMeshes(),u};var a=t.splice;t.splice=function(s,o){var u=a.apply(t,[s,o]);return i._resyncMeshes(),u},this._resyncMeshes()},e.prototype._resyncMeshes=function(){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var n=i[t];n._resyncLightSource(this)}},e.prototype._markMeshesAsLightDirty=function(){for(var t=0,i=this.getScene().meshes;t<i.length;t++){var n=i[t];n.lightSources.indexOf(this)!==-1&&n._markSubMeshesAsLightDirty()}},e.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},e.prototype._getPhotometricScale=function(){var t=0,i=this.getTypeID(),n=this.intensityMode;switch(n===e.INTENSITYMODE_AUTOMATIC&&(i===e.LIGHTTYPEID_DIRECTIONALLIGHT?n=e.INTENSITYMODE_ILLUMINANCE:n=e.INTENSITYMODE_LUMINOUSINTENSITY),i){case e.LIGHTTYPEID_POINTLIGHT:case e.LIGHTTYPEID_SPOTLIGHT:switch(n){case e.INTENSITYMODE_LUMINOUSPOWER:t=1/(4*Math.PI);break;case e.INTENSITYMODE_LUMINOUSINTENSITY:t=1;break;case e.INTENSITYMODE_LUMINANCE:t=this.radius*this.radius;break}break;case e.LIGHTTYPEID_DIRECTIONALLIGHT:switch(n){case e.INTENSITYMODE_ILLUMINANCE:t=1;break;case e.INTENSITYMODE_LUMINANCE:var a=this.radius;a=Math.max(a,.001);var s=2*Math.PI*(1-Math.cos(a));t=s;break}break;case e.LIGHTTYPEID_HEMISPHERICLIGHT:t=1;break}return t},e.prototype._reorderLightsInScene=function(){var t=this.getScene();this._renderPriority!=0&&(t.requireLightSorting=!0),this.getScene().sortLightsByPriority()},e.FALLOFF_DEFAULT=0,e.FALLOFF_PHYSICAL=1,e.FALLOFF_GLTF=2,e.FALLOFF_STANDARD=3,e.LIGHTMAP_DEFAULT=0,e.LIGHTMAP_SPECULAR=1,e.LIGHTMAP_SHADOWSONLY=2,e.INTENSITYMODE_AUTOMATIC=0,e.INTENSITYMODE_LUMINOUSPOWER=1,e.INTENSITYMODE_LUMINOUSINTENSITY=2,e.INTENSITYMODE_ILLUMINANCE=3,e.INTENSITYMODE_LUMINANCE=4,e.LIGHTTYPEID_POINTLIGHT=0,e.LIGHTTYPEID_DIRECTIONALLIGHT=1,e.LIGHTTYPEID_SPOTLIGHT=2,e.LIGHTTYPEID_HEMISPHERICLIGHT=3,b([$e()],e.prototype,"diffuse",void 0),b([$e()],e.prototype,"specular",void 0),b([T()],e.prototype,"falloffType",void 0),b([T()],e.prototype,"intensity",void 0),b([T()],e.prototype,"range",null),b([T()],e.prototype,"intensityMode",null),b([T()],e.prototype,"radius",null),b([T()],e.prototype,"_renderPriority",void 0),b([Y("_reorderLightsInScene")],e.prototype,"renderPriority",void 0),b([T("shadowEnabled")],e.prototype,"_shadowEnabled",void 0),b([T("excludeWithLayerMask")],e.prototype,"_excludeWithLayerMask",void 0),b([T("includeOnlyWithLayerMask")],e.prototype,"_includeOnlyWithLayerMask",void 0),b([T("lightmapMode")],e.prototype,"_lightmapMode",void 0),e}(xe),Te=function(){function r(e,t,i,n,a,s){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=a,this.additionalData=s}return r.CreateNew=function(e,t,i){var n=e.getScene();return new r(e,n.pointerX,n.pointerY,n.meshUnderPointer||e,t,i)},r.CreateNewFromSprite=function(e,t,i,n){return new r(e,t.pointerX,t.pointerY,t.meshUnderPointer,i,n)},r.CreateNewFromScene=function(e,t){return new r(null,e.pointerX,e.pointerY,e.meshUnderPointer,t)},r.CreateNewFromPrimitive=function(e,t,i,n){return new r(e,t.x,t.y,null,i,n)},r}(),gi=function(){function r(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return r}(),Ke=function(){function r(e,t,i,n,a,s,o,u,l){u===void 0&&(u=!0),l===void 0&&(l=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=n,this.indexCount=a,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=o||s,l&&s.subMeshes.push(this),this._trianglePlanes=[],this._id=s.subMeshes.length-1,u&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return Object.defineProperty(r.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(e){this._materialDefines=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"effect",{get:function(){var e;return(e=this._effectOverride)!==null&&e!==void 0?e:this._materialEffect},enumerable:!1,configurable:!0}),r.prototype.setEffect=function(e,t){if(t===void 0&&(t=null),this._materialEffect===e){e||(this._materialDefines=null);return}this._materialDefines=t,this._materialEffect=e},r.AddToMesh=function(e,t,i,n,a,s,o,u){return u===void 0&&(u=!0),new r(e,t,i,n,a,s,o,u)},Object.defineProperty(r.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),r.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},r.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},r.prototype.getMesh=function(){return this._mesh},r.prototype.getRenderingMesh=function(){return this._renderingMesh},r.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},r.prototype.getEffectiveMesh=function(){var e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh},r.prototype.getMaterial=function(){var e=this._renderingMesh.material;if(e==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(e)){var t=e.getSubMaterial(this.materialIndex);return this._currentMaterial!==t&&(this._currentMaterial=t,this._materialDefines=null),t}return e},r.prototype._IsMultiMaterial=function(e){return e.getSubMaterial!==void 0},r.prototype.refreshBoundingInfo=function(e){if(e===void 0&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(_.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t=this._renderingMesh.getIndices(),i;if(this.indexStart===0&&this.indexCount===t.length){var n=this._renderingMesh.getBoundingInfo();i={minimum:n.minimum.clone(),maximum:n.maximum.clone()}}else i=gr(e,t,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(i.minimum,i.maximum):this._boundingInfo=new Oe(i.minimum,i.maximum),this},r.prototype._checkCollision=function(e){var t=this.getBoundingInfo();return t._checkCollision(e)},r.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},r.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return t?t.isInFrustum(e,this._mesh.cullingStrategy):!1},r.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return t?t.isCompletelyInFrustum(e):!1},r.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},r.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)i.push(e[n],e[n+1],e[n+1],e[n+2],e[n+2],e[n]);this._linesIndexBuffer=t.createIndexBuffer(i),this._linesIndexCount=i.length}return this._linesIndexBuffer},r.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return t?e.intersectsBox(t.boundingBox):!1},r.prototype.intersects=function(e,t,i,n,a){var s=this.getMaterial();if(!s)return null;var o=3,u=!1;switch(s.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:o=1,u=!0;break}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?i.length?this._intersectLines(e,t,i,this._mesh.intersectionThreshold,n):this._intersectUnIndexedLines(e,t,i,this._mesh.intersectionThreshold,n):!i.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,i,n,a):this._intersectTriangles(e,t,i,o,u,n,a)},r.prototype._intersectLines=function(e,t,i,n,a){for(var s=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var u=t[i[o]],l=t[i[o+1]],f=e.intersectionSegment(u,l,n);if(!(f<0)&&(a||!s||f<s.distance)&&(s=new gi(null,null,f),s.faceId=o/2,a))break}return s},r.prototype._intersectUnIndexedLines=function(e,t,i,n,a){for(var s=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){var u=t[o],l=t[o+1],f=e.intersectionSegment(u,l,n);if(!(f<0)&&(a||!s||f<s.distance)&&(s=new gi(null,null,f),s.faceId=o/2,a))break}return s},r.prototype._intersectTriangles=function(e,t,i,n,a,s,o){for(var u=null,l=-1,f=this.indexStart;f<this.indexStart+this.indexCount;f+=n){l++;var h=i[f],c=i[f+1],p=i[f+2];if(a&&p===4294967295){f+=2;continue}var d=t[h],g=t[c],m=t[p];if(!(o&&!o(d,g,m,e))){var E=e.intersectsTriangle(d,g,m);if(E){if(E.distance<0)continue;if((s||!u||E.distance<u.distance)&&(u=E,u.faceId=l,s))break}}}return u},r.prototype._intersectUnIndexedTriangles=function(e,t,i,n,a){for(var s=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var u=t[o],l=t[o+1],f=t[o+2];if(!(a&&!a(u,l,f,e))){var h=e.intersectsTriangle(u,l,f);if(h){if(h.distance<0)continue;if((n||!s||h.distance<s.distance)&&(s=h,s.faceId=o/3,n))break}}}return s},r.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},r.prototype.clone=function(e,t){var i=new r(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,e,t,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new Oe(n.minimum,n.maximum)}return i},r.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},r.prototype.getClassName=function(){return"SubMesh"},r.CreateFromIndices=function(e,t,i,n,a){for(var s=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=a||n,l=u.getIndices(),f=t;f<t+i;f++){var h=l[f];h<s&&(s=h),h>o&&(o=h)}return new r(e,s,o-s+1,t,i,n,a)},r}(),ye=function(){function r(e,t,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new D,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=r.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=e;var n=1;for(this._scene=t||de.LastCreatedScene,this.id=e||te.RandomId();this._scene.getMaterialByID(this.id);)this.id=e+" "+n++;this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=r.ClockWiseSideOrientation:this.sideOrientation=r.CounterClockWiseSideOrientation,this._uniformBuffer=new ni(this._scene.getEngine()),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(r.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alpha=e,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(e){this._backFaceCulling!==e&&(this._backFaceCulling=e,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new D),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new D),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new D),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode!==e&&(this._alphaMode=e,this.markAsDirty(r.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wireframe",{get:function(){switch(this._fillMode){case r.WireFrameFillMode:case r.LineListDrawMode:case r.LineLoopDrawMode:case r.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(e){this.fillMode=e?r.WireFrameFillMode:r.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case r.PointFillMode:case r.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(e){this.fillMode=e?r.PointFillMode:r.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode!==e&&(this._fillMode=e,this.markAsDirty(r.MiscDirtyFlag))},enumerable:!1,configurable:!0}),r.prototype.toString=function(e){var t="Name: "+this.name;return t},r.prototype.getClassName=function(){return"Material"},Object.defineProperty(r.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),r.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},r.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},r.prototype.isReady=function(e,t){return!0},r.prototype.isReadyForSubMesh=function(e,t,i){return!1},r.prototype.getEffect=function(){return this._effect},r.prototype.getScene=function(){return this._scene},Object.defineProperty(r.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(e){this._transparencyMode!==e&&(this._transparencyMode=e,this._forceAlphaTest=e===r.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===r.MATERIAL_OPAQUE||this._transparencyMode===r.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),r.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1},r.prototype.needAlphaBlendingForMesh=function(e){return this._disableAlphaBlending&&e.visibility>=1?!1:this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha},r.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},r.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},r.prototype.getAlphaTestTexture=function(){return null},r.prototype.markDirty=function(){for(var e=this.getScene().meshes,t=0,i=e;t<i.length;t++){var n=i[t];if(!!n.subMeshes)for(var a=0,s=n.subMeshes;a<s.length;a++){var o=s[a];o.getMaterial()===this&&(!o.effect||(o.effect._wasPreviouslyReady=!1))}}},r.prototype._preBind=function(e,t){t===void 0&&(t=null);var i=this._scene.getEngine(),n=t==null?this.sideOrientation:t,a=n===r.ClockWiseSideOrientation;return i.enableEffect(e||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,a),a},r.prototype.bind=function(e,t){},r.prototype.bindForSubMesh=function(e,t,i){},r.prototype.bindOnlyWorldMatrix=function(e){},r.prototype.bindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},r.prototype.bindView=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("view",this.getScene().getViewMatrix())},r.prototype.bindViewProjection=function(e){this._useUBO?this.bindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer()):e.setMatrix("viewProjection",this.getScene().getTransformMatrix())},r.prototype._afterBind=function(e){if(this._scene._cachedMaterial=this,e?this._scene._cachedVisibility=e.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var t=this._scene.getEngine();this._cachedDepthWriteState=t.getDepthWrite(),t.setDepthWrite(!1)}if(this.disableColorWrite){var t=this._scene.getEngine();this._cachedColorWriteState=t.getColorWrite(),t.setColorWrite(!1)}if(this.depthFunction!==0){var t=this._scene.getEngine();this._cachedDepthFunctionState=t.getDepthFunction()||0,t.setDepthFunction(this.depthFunction)}},r.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0){var e=this._scene.getEngine();e.setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){var e=this._scene.getEngine();e.setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){var e=this._scene.getEngine();e.setColorWrite(this._cachedColorWriteState)}},r.prototype.getActiveTextures=function(){return[]},r.prototype.hasTexture=function(e){return!1},r.prototype.clone=function(e){return null},r.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var i in this.meshMap){var n=this.meshMap[i];n&&t.push(n)}return t}else{var a=this._scene.meshes;return a.filter(function(s){return s.material===e})}},r.prototype.forceCompilation=function(e,t,i,n){var a=this,s=Ft({clipPlane:!1,useInstances:!1},i),o=this.getScene(),u=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var l=function(){if(!(!a._scene||!a._scene.getEngine())){var f=o.clipPlane;if(s.clipPlane&&(o.clipPlane=new ri(0,0,0,1)),a._storeEffectOnSubMeshes){var h=!0,c=null;if(e.subMeshes){var p=new Ke(0,0,0,0,0,e,void 0,!1,!1);p._materialDefines&&(p._materialDefines._renderId=-1),a.isReadyForSubMesh(e,p,s.useInstances)||(p.effect&&p.effect.getCompilationError()&&p.effect.allFallbacksProcessed()?c=p.effect.getCompilationError():(h=!1,setTimeout(l,16)))}h&&(a.allowShaderHotSwapping=u,c&&n&&n(c),t&&t(a))}else a.isReady()?(a.allowShaderHotSwapping=u,t&&t(a)):setTimeout(l,16);s.clipPlane&&(o.clipPlane=f)}};l()},r.prototype.forceCompilationAsync=function(e,t){var i=this;return new Promise(function(n,a){i.forceCompilation(e,function(){n()},t,function(s){a(s)})})},r.prototype.markAsDirty=function(e){this.getScene().blockMaterialDirtyMechanism||(r._DirtyCallbackArray.length=0,e&r.TextureDirtyFlag&&r._DirtyCallbackArray.push(r._TextureDirtyCallBack),e&r.LightDirtyFlag&&r._DirtyCallbackArray.push(r._LightsDirtyCallBack),e&r.FresnelDirtyFlag&&r._DirtyCallbackArray.push(r._FresnelDirtyCallBack),e&r.AttributesDirtyFlag&&r._DirtyCallbackArray.push(r._AttributeDirtyCallBack),e&r.MiscDirtyFlag&&r._DirtyCallbackArray.push(r._MiscDirtyCallBack),e&r.PrePassDirtyFlag&&r._DirtyCallbackArray.push(r._PrePassDirtyCallBack),r._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(r._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},r.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=this.getScene().meshes,i=0,n=t;i<n.length;i++){var a=n[i];if(!!a.subMeshes)for(var s=0,o=a.subMeshes;s<o.length;s++){var u=o[s];u.getMaterial()===this&&(!u._materialDefines||e(u._materialDefines))}}},r.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}},r.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(r._AllDirtyCallBack)},r.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(r._ImageProcessingDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(r._TextureDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelDirtyCallBack)},r.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._FresnelAndMiscDirtyCallBack)},r.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(r._LightsDirtyCallBack)},r.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(r._AttributeDirtyCallBack)},r.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)},r.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(r._MiscDirtyCallBack)},r.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(r._TextureAndMiscDirtyCallBack)},r.prototype.setPrePassRenderer=function(e){return!1},r.prototype.dispose=function(e,t,i){var n=this.getScene();if(n.stopAnimation(this),n.freeProcessedMaterials(),n.removeMaterial(this),i!==!0)if(this.meshMap)for(var a in this.meshMap){var s=this.meshMap[a];s&&(s.material=null,this.releaseVertexArrayObject(s,e))}else for(var o=n.meshes,u=0,l=o;u<l.length;u++){var s=l[u];s.material===this&&!s.sourceMesh&&(s.material=null,this.releaseVertexArrayObject(s,e))}this._uniformBuffer.dispose(),e&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},r.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var i=e.geometry;if(this._storeEffectOnSubMeshes)for(var n=0,a=e.subMeshes;n<a.length;n++){var s=a[n];i._releaseVertexArrayObject(s._materialEffect),t&&s._materialEffect&&s._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},r.prototype.serialize=function(){return H.Serialize(this)},r.Parse=function(e,t,i){if(!e.customType)e.customType="BABYLON.StandardMaterial";else if(e.customType==="BABYLON.PBRMaterial"&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return L.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;var n=te.Instantiate(e.customType);return n.Parse(e,t,i)},r.TriangleFillMode=0,r.WireFrameFillMode=1,r.PointFillMode=2,r.PointListDrawMode=3,r.LineListDrawMode=4,r.LineLoopDrawMode=5,r.LineStripDrawMode=6,r.TriangleStripDrawMode=7,r.TriangleFanDrawMode=8,r.ClockWiseSideOrientation=0,r.CounterClockWiseSideOrientation=1,r.TextureDirtyFlag=1,r.LightDirtyFlag=2,r.FresnelDirtyFlag=4,r.AttributesDirtyFlag=8,r.MiscDirtyFlag=16,r.PrePassDirtyFlag=32,r.AllDirtyFlag=63,r.MATERIAL_OPAQUE=0,r.MATERIAL_ALPHATEST=1,r.MATERIAL_ALPHABLEND=2,r.MATERIAL_ALPHATESTANDBLEND=3,r.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,r.MATERIAL_NORMALBLENDMETHOD_RNM=1,r._AllDirtyCallBack=function(e){return e.markAllAsDirty()},r._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},r._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},r._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},r._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},r._PrePassDirtyCallBack=function(e){return e.markAsPrePassDirty()},r._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},r._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},r._FresnelAndMiscDirtyCallBack=function(e){r._FresnelDirtyCallBack(e),r._MiscDirtyCallBack(e)},r._TextureAndMiscDirtyCallBack=function(e){r._TextureDirtyCallBack(e),r._MiscDirtyCallBack(e)},r._DirtyCallbackArray=[],r._RunDirtyCallBacks=function(e){for(var t=0,i=r._DirtyCallbackArray;t<i.length;t++){var n=i[t];n(e)}},b([T()],r.prototype,"id",void 0),b([T()],r.prototype,"uniqueId",void 0),b([T()],r.prototype,"name",void 0),b([T()],r.prototype,"checkReadyOnEveryCall",void 0),b([T()],r.prototype,"checkReadyOnlyOnce",void 0),b([T()],r.prototype,"state",void 0),b([T("alpha")],r.prototype,"_alpha",void 0),b([T("backFaceCulling")],r.prototype,"_backFaceCulling",void 0),b([T()],r.prototype,"sideOrientation",void 0),b([T("alphaMode")],r.prototype,"_alphaMode",void 0),b([T()],r.prototype,"_needDepthPrePass",void 0),b([T()],r.prototype,"disableDepthWrite",void 0),b([T()],r.prototype,"disableColorWrite",void 0),b([T()],r.prototype,"forceDepthWrite",void 0),b([T()],r.prototype,"depthFunction",void 0),b([T()],r.prototype,"separateCullingPass",void 0),b([T("fogEnabled")],r.prototype,"_fogEnabled",void 0),b([T()],r.prototype,"pointSize",void 0),b([T()],r.prototype,"zOffset",void 0),b([T()],r.prototype,"pointsCloud",null),b([T()],r.prototype,"fillMode",null),b([T()],r.prototype,"transparencyMode",null),r}(),vi=function(){function r(e){this._vertexBuffers={},this._scene=e}return r.prototype._prepareBuffers=function(){if(!this._vertexBuffers[_.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[_.PositionKind]=new _(this._scene.getEngine(),e,_.PositionKind,!1,!1,2),this._buildIndexBuffer()}},r.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},r.prototype._rebuild=function(){var e=this._vertexBuffers[_.PositionKind];!e||(e._rebuild(),this._buildIndexBuffer())},r.prototype._prepareFrame=function(e,t){e===void 0&&(e=null),t===void 0&&(t=null);var i=this._scene.activeCamera;return!i||(t=t||i._postProcesses.filter(function(n){return n!=null}),!t||t.length===0||!this._scene.postProcessesEnabled)?!1:(t[0].activate(i,e,t!=null),!0)},r.prototype.directRender=function(e,t,i,n,a,s){t===void 0&&(t=null),i===void 0&&(i=!1),n===void 0&&(n=0),a===void 0&&(a=0),s===void 0&&(s=!1);for(var o=this._scene.getEngine(),u=0;u<e.length;u++){u<e.length-1?e[u+1].activate(this._scene.activeCamera,t):t?o.bindFramebuffer(t,n,void 0,void 0,i,a):s||o.restoreDefaultFramebuffer();var l=e[u],f=l.apply();f&&(l.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,f),o.drawElementsType(ye.TriangleFillMode,0,6),l.onAfterRenderObservable.notifyObservers(f))}o.setDepthBuffer(!0),o.setDepthWrite(!0)},r.prototype._finalizeFrame=function(e,t,i,n,a){a===void 0&&(a=!1);var s=this._scene.activeCamera;if(!!s&&(n=n||s._postProcesses.filter(function(c){return c!=null}),!(n.length===0||!this._scene.postProcessesEnabled))){for(var o=this._scene.getEngine(),u=0,l=n.length;u<l;u++){var f=n[u];if(u<l-1?f._outputTexture=n[u+1].activate(s,t):t?(o.bindFramebuffer(t,i,void 0,void 0,a),f._outputTexture=t):(o.restoreDefaultFramebuffer(),f._outputTexture=null),e)break;var h=f.apply();h&&(f.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,h),o.drawElementsType(ye.TriangleFillMode,0,6),f.onAfterRenderObservable.notifyObservers(h))}o.setDepthBuffer(!0),o.setDepthWrite(!0),o.setAlphaMode(0)}},r.prototype.dispose=function(){var e=this._vertexBuffers[_.PositionKind];e&&(e.dispose(),this._vertexBuffers[_.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},r}(),Er=function(){function r(e,t,i,n,a){i===void 0&&(i=null),n===void 0&&(n=null),a===void 0&&(a=null),this.index=e,this._opaqueSubMeshes=new Ie(256),this._transparentSubMeshes=new Ie(256),this._alphaTestSubMeshes=new Ie(256),this._depthOnlySubMeshes=new Ie(256),this._particleSystems=new Ie(256),this._spriteManagers=new Ie(256),this._edgesRenderers=new Qe(16),this._scene=t,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=a}return Object.defineProperty(r.prototype,"opaqueSortCompareFn",{set:function(e){this._opaqueSortCompareFn=e,e?this._renderOpaque=this.renderOpaqueSorted:this._renderOpaque=r.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"alphaTestSortCompareFn",{set:function(e){this._alphaTestSortCompareFn=e,e?this._renderAlphaTest=this.renderAlphaTestSorted:this._renderAlphaTest=r.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transparentSortCompareFn",{set:function(e){e?this._transparentSortCompareFn=e:this._transparentSortCompareFn=r.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),r.prototype.render=function(e,t,i,n){if(e){e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var a=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var s=a.getStencilBuffer();if(a.setStencilBuffer(!1),t&&this._renderSprites(),i&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(a.setStencilBuffer(s),this._renderTransparent(this._transparentSubMeshes),a.setAlphaMode(0)),a.setStencilBuffer(!1),this._edgesRenderers.length){for(var o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();a.setAlphaMode(0)}a.setStencilBuffer(s)},r.prototype.renderOpaqueSorted=function(e){return r.renderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderAlphaTestSorted=function(e){return r.renderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},r.prototype.renderTransparentSorted=function(e){return r.renderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)},r.renderSorted=function(e,t,i,n){for(var a=0,s,o=i?i.globalPosition:r._zeroVector;a<e.length;a++)s=e.data[a],s._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=y.Distance(s.getBoundingInfo().boundingSphere.centerWorld,o);var u=e.data.slice(0,e.length);for(t&&u.sort(t),a=0;a<u.length;a++){if(s=u[a],n){var l=s.getMaterial();if(l&&l.needDepthPrePass){var f=l.getScene().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),s.render(!1),f.setColorWrite(!0)}}s.render(n)}},r.renderUnsorted=function(e){for(var t=0;t<e.length;t++){var i=e.data[t];i.render(!1)}},r.defaultTransparentSortCompare=function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:r.backToFrontSortCompare(e,t)},r.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},r.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},r.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},r.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},r.prototype.dispatch=function(e,t,i){t===void 0&&(t=e.getMesh()),i===void 0&&(i=e.getMaterial()),i!=null&&(i.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):i.needAlphaTesting()?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer))},r.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},r.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},r.prototype._renderParticles=function(e){if(this._particleSystems.length!==0){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var i=0;i<this._particleSystems.length;i++){var n=this._particleSystems.data[i];if((t&&t.layerMask&n.layerMask)!==0){var a=n.emitter;(!a.position||!e||e.indexOf(a)!==-1)&&this._scene._activeParticles.addCount(n.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},r.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var i=this._spriteManagers.data[t];(e&&e.layerMask&i.layerMask)!==0&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},r._zeroVector=y.Zero(),r}(),Tr=function(){function r(){}return r}(),Ar=function(){function r(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Tr,this._scene=e;for(var t=r.MIN_RENDERINGGROUPS;t<r.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={autoClear:!0,depth:!0,stencil:!0}}return r.prototype._clearDepthStencilBuffer=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},r.prototype.render=function(e,t,i,n){var a=this._renderingGroupInfo;if(a.scene=this._scene,a.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var s=0;s<this._scene.spriteManagers.length;s++){var o=this._scene.spriteManagers[s];this.dispatchSprites(o)}for(var s=r.MIN_RENDERINGGROUPS;s<r.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===r.MIN_RENDERINGGROUPS;var u=this._renderingGroups[s];if(!!u){var l=Math.pow(2,s);if(a.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,l),r.AUTOCLEAR){var f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];f&&f.autoClear&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(var h=0,c=this._scene._beforeRenderingGroupDrawStage;h<c.length;h++){var p=c[h];p.action(s)}u.render(e,n,i,t);for(var d=0,g=this._scene._afterRenderingGroupDrawStage;d<g.length;d++){var p=g[d];p.action(s)}this._scene.onAfterRenderingGroupObservable.notifyObservers(a,l)}}},r.prototype.reset=function(){for(var e=r.MIN_RENDERINGGROUPS;e<r.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.prepare()}},r.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},r.prototype.freeRenderingGroups=function(){for(var e=r.MIN_RENDERINGGROUPS;e<r.MAX_RENDERINGGROUPS;e++){var t=this._renderingGroups[e];t&&t.dispose()}},r.prototype._prepareRenderingGroup=function(e){this._renderingGroups[e]===void 0&&(this._renderingGroups[e]=new Er(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},r.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},r.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},r.prototype.dispatch=function(e,t,i){t===void 0&&(t=e.getMesh());var n=t.renderingGroupId||0;this._prepareRenderingGroup(n),this._renderingGroups[n].dispatch(e,t,i)},r.prototype.setRenderingOrder=function(e,t,i,n){if(t===void 0&&(t=null),i===void 0&&(i=null),n===void 0&&(n=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=i,this._customTransparentSortCompareFn[e]=n,this._renderingGroups[e]){var a=this._renderingGroups[e];a.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],a.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],a.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},r.prototype.setRenderingAutoClearDepthStencil=function(e,t,i,n){i===void 0&&(i=!0),n===void 0&&(n=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:i,stencil:n}},r.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},r.MAX_RENDERINGGROUPS=4,r.MIN_RENDERINGGROUPS=0,r.AUTOCLEAR=!0,r}(),mi=function(){function r(){}return r.NAME_EFFECTLAYER="EffectLayer",r.NAME_LAYER="Layer",r.NAME_LENSFLARESYSTEM="LensFlareSystem",r.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",r.NAME_PARTICLESYSTEM="ParticleSystem",r.NAME_GAMEPAD="Gamepad",r.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",r.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",r.NAME_PREPASSRENDERER="PrePassRenderer",r.NAME_DEPTHRENDERER="DepthRenderer",r.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",r.NAME_SPRITE="Sprite",r.NAME_SUBSURFACE="SubSurface",r.NAME_OUTLINERENDERER="Outline",r.NAME_PROCEDURALTEXTURE="ProceduralTexture",r.NAME_SHADOWGENERATOR="ShadowGenerator",r.NAME_OCTREE="Octree",r.NAME_PHYSICSENGINE="PhysicsEngine",r.NAME_AUDIO="Audio",r.STEP_ISREADYFORMESH_EFFECTLAYER=0,r.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,r.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,r.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,r.STEP_BEFORECAMERADRAW_EFFECTLAYER=0,r.STEP_BEFORECAMERADRAW_LAYER=1,r.STEP_BEFORECAMERADRAW_PREPASS=2,r.STEP_BEFORERENDERTARGETDRAW_LAYER=0,r.STEP_BEFORERENDERINGMESH_PREPASS=0,r.STEP_BEFORERENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGMESH_PREPASS=0,r.STEP_AFTERRENDERINGMESH_OUTLINE=1,r.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,r.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,r.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,r.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,r.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,r.STEP_AFTERRENDERTARGETDRAW_LAYER=0,r.STEP_AFTERCAMERADRAW_EFFECTLAYER=0,r.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=1,r.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=2,r.STEP_AFTERCAMERADRAW_LAYER=3,r.STEP_AFTERCAMERADRAW_PREPASS=4,r.STEP_AFTERRENDER_AUDIO=0,r.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,r.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,r.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,r.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,r.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,r.STEP_BEFORECLEARSTAGE_PREPASS=0,r.STEP_POINTERMOVE_SPRITE=0,r.STEP_POINTERDOWN_SPRITE=0,r.STEP_POINTERUP_SPRITE=0,r}(),le=function(r){N(e,r);function e(t){return r.apply(this,t)||this}return e.Create=function(){return Object.create(e.prototype)},e.prototype.registerStep=function(t,i,n){for(var a=0,s=Number.MAX_VALUE;a<this.length;a++){var o=this[a];if(s=o.index,t<s)break}this.splice(a,0,{index:t,component:i,action:n.bind(i)})},e.prototype.clear=function(){this.length=0},e}(Array),U=function(){function r(){}return r.POINTERDOWN=1,r.POINTERUP=2,r.POINTERMOVE=4,r.POINTERWHEEL=8,r.POINTERPICK=16,r.POINTERTAP=32,r.POINTERDOUBLETAP=64,r}(),Mi=function(){function r(e,t){this.type=e,this.event=t}return r}(),Sr=function(r){N(e,r);function e(t,i,n,a){var s=r.call(this,t,i)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new ne(n,a),s}return e}(Mi),lt=function(r){N(e,r);function e(t,i,n){var a=r.call(this,t,i)||this;return a.pickInfo=n,a}return e}(Mi),ft=function(){function r(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(r,"HasTriggers",{get:function(){for(var e in r.Triggers)if(r.Triggers.hasOwnProperty(e))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r,"HasPickTriggers",{get:function(){for(var e in r.Triggers)if(r.Triggers.hasOwnProperty(e)){var t=parseInt(e);if(t>=1&&t<=7)return!0}return!1},enumerable:!1,configurable:!0}),r.HasSpecificTrigger=function(e){for(var t in r.Triggers)if(r.Triggers.hasOwnProperty(t)){var i=parseInt(t);if(i===e)return!0}return!1},r.Triggers={},r}(),$t=function(){function r(){}return r.KEYDOWN=1,r.KEYUP=2,r}(),Jt=function(){function r(e,t){this.type=e,this.event=t}return r}(),yi=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.type=t,n.event=i,n.skipOnPointerObservable=!1,n}return e}(Jt),bi=function(){function r(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(r.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!1,configurable:!0}),r}(),We=function(){function r(e){this._alreadyAttached=!1,this._wheelEventName="",this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new ne(0,0),this._previousStartingPointerPosition=new ne(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._keyboardIsAttached=!1,this._scene=e}return Object.defineProperty(r.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),r.prototype.getMeshUnderPointerByPointerId=function(e){return this._meshUnderPointerId[e]},Object.defineProperty(r.prototype,"unTranslatedPointer",{get:function(){return new ne(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!1,configurable:!0}),r.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();!t||(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},r.prototype._processPointerMove=function(e,t){var i=this._scene,n=i.getEngine(),a=n.getInputElement();if(!!a){a.tabIndex=n.canvasTabIndex,i.doNotHandleCursors||(a.style.cursor=i.defaultCursor);var s=!!(e&&e.hit&&e.pickedMesh);s?(i.setPointerOverMesh(e.pickedMesh,t.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(i.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?a.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:a.style.cursor=i.hoverCursor))):i.setPointerOverMesh(null,t.pointerId);for(var o=0,u=i._pointerMoveStage;o<u.length;o++){var l=u[o];e=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,a)}if(e){var f=t.type===this._wheelEventName?U.POINTERWHEEL:U.POINTERMOVE;if(i.onPointerMove&&i.onPointerMove(t,e,f),i.onPointerObservable.hasObservers()){var h=new lt(f,t,e);this._setRayOnPointerInfo(h),i.onPointerObservable.notifyObservers(h,f)}}}},r.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,R.Identity(),t.activeCamera)))},r.prototype._checkPrePointerObservable=function(e,t,i){var n=this._scene,a=new Sr(i,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(a.ray=e.ray),n.onPrePointerObservable.notifyObservers(a,i),!!a.skipOnPointerObservable},r.prototype.simulatePointerMove=function(e,t){var i=new PointerEvent("pointermove",t);this._checkPrePointerObservable(e,i,U.POINTERMOVE)||this._processPointerMove(e,i)},r.prototype.simulatePointerDown=function(e,t){var i=new PointerEvent("pointerdown",t);this._checkPrePointerObservable(e,i,U.POINTERDOWN)||this._processPointerDown(e,i)},r.prototype._processPointerDown=function(e,t){var i=this,n=this._scene;if(e&&e.hit&&e.pickedMesh){this._pickedDownMesh=e.pickedMesh;var a=e.pickedMesh._getActionManagerForTrigger();if(a){if(a.hasPickTriggers)switch(a.processTrigger(5,Te.CreateNew(e.pickedMesh,t)),t.button){case 0:a.processTrigger(2,Te.CreateNew(e.pickedMesh,t));break;case 1:a.processTrigger(4,Te.CreateNew(e.pickedMesh,t));break;case 2:a.processTrigger(3,Te.CreateNew(e.pickedMesh,t));break}a.hasSpecificTrigger(8)&&window.setTimeout(function(){var h=n.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,function(c){return c.isPickable&&c.isVisible&&c.isReady()&&c.actionManager&&c.actionManager.hasSpecificTrigger(8)&&c==i._pickedDownMesh},!1,n.cameraToUseForPointers);h&&h.hit&&h.pickedMesh&&a&&i._totalPointersPressed!==0&&Date.now()-i._startingPointerTime>r.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,a.processTrigger(8,Te.CreateNew(h.pickedMesh,t)))},r.LongPressDelay)}}else for(var s=0,o=n._pointerDownStage;s<o.length;s++){var u=o[s];e=u.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(e){var l=U.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(t,e,l),n.onPointerObservable.hasObservers()){var f=new lt(l,t,e);this._setRayOnPointerInfo(f),n.onPointerObservable.notifyObservers(f,l)}}},r.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>r.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>r.DragMovementThreshold},r.prototype.simulatePointerUp=function(e,t,i){var n=new PointerEvent("pointerup",t),a=new bi;i?a.doubleClick=!0:a.singleClick=!0,!this._checkPrePointerObservable(e,n,U.POINTERUP)&&this._processPointerUp(e,n,a)},r.prototype._processPointerUp=function(e,t,i){var n=this._scene;if(e&&e&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(n.onPointerPick&&n.onPointerPick(t,e),i.singleClick&&!i.ignore&&n.onPointerObservable.hasObservers())){var a=U.POINTERPICK,s=new lt(a,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,a)}var o=e.pickedMesh._getActionManagerForTrigger();if(o&&!i.ignore){o.processTrigger(7,Te.CreateNew(e.pickedMesh,t)),!i.hasSwiped&&i.singleClick&&o.processTrigger(1,Te.CreateNew(e.pickedMesh,t));var u=e.pickedMesh._getActionManagerForTrigger(6);i.doubleClick&&u&&u.processTrigger(6,Te.CreateNew(e.pickedMesh,t))}}else if(!i.ignore)for(var l=0,f=n._pointerUpStage;l<f.length;l++){var h=f[l];e=h.action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,Te.CreateNew(this._pickedDownMesh,t))}var p=0;if(n.onPointerObservable.hasObservers()){if(!i.ignore&&!i.hasSwiped&&(i.singleClick&&n.onPointerObservable.hasSpecificMask(U.POINTERTAP)?p=U.POINTERTAP:i.doubleClick&&n.onPointerObservable.hasSpecificMask(U.POINTERDOUBLETAP)&&(p=U.POINTERDOUBLETAP),p)){var s=new lt(p,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}if(!i.ignore){p=U.POINTERUP;var s=new lt(p,t,e);this._setRayOnPointerInfo(s),n.onPointerObservable.notifyObservers(s,p)}}n.onPointerUp&&!i.ignore&&n.onPointerUp(t,e,p)},r.prototype.isPointerCaptured=function(e){return e===void 0&&(e=0),this._pointerCaptures[e]},r.prototype.attachControl=function(e,t,i,n){var a=this;e===void 0&&(e=!0),t===void 0&&(t=!0),i===void 0&&(i=!0),n===void 0&&(n=null);var s=this._scene;if(n||(n=s.getEngine().getInputElement()),!!n){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=n;var o=s.getEngine();this._initActionManager=function(h,c){if(!a._meshPickProceed){var p=s.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);a._currentPickResult=p,p&&(h=p.hit&&p.pickedMesh?p.pickedMesh._getActionManagerForTrigger():null),a._meshPickProceed=!0}return h},this._delayedSimpleClick=function(h,c,p){(Date.now()-a._previousStartingPointerTime>r.DoubleClickDelay&&!a._doubleClickOccured||h!==a._previousButtonPressed)&&(a._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,p(c,a._currentPickResult))},this._initClickEvent=function(h,c,p,d){var g=new bi;a._currentPickResult=null;var m=null,E=h.hasSpecificMask(U.POINTERPICK)||c.hasSpecificMask(U.POINTERPICK)||h.hasSpecificMask(U.POINTERTAP)||c.hasSpecificMask(U.POINTERTAP)||h.hasSpecificMask(U.POINTERDOUBLETAP)||c.hasSpecificMask(U.POINTERDOUBLETAP);!E&&ft&&(m=a._initActionManager(m,g),m&&(E=m.hasPickTriggers));var v=!1;if(E){var A=p.button;if(g.hasSwiped=a._isPointerSwiping(),!g.hasSwiped){var M=!r.ExclusiveDoubleClickMode;M||(M=!h.hasSpecificMask(U.POINTERDOUBLETAP)&&!c.hasSpecificMask(U.POINTERDOUBLETAP),M&&!ft.HasSpecificTrigger(6)&&(m=a._initActionManager(m,g),m&&(M=!m.hasSpecificTrigger(6)))),M?(Date.now()-a._previousStartingPointerTime>r.DoubleClickDelay||A!==a._previousButtonPressed)&&(g.singleClick=!0,d(g,a._currentPickResult),v=!0):(a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,a._delayedSimpleClickTimeout=window.setTimeout(a._delayedSimpleClick.bind(a,A,g,d),r.DoubleClickDelay));var C=h.hasSpecificMask(U.POINTERDOUBLETAP)||c.hasSpecificMask(U.POINTERDOUBLETAP);!C&&ft.HasSpecificTrigger(6)&&(m=a._initActionManager(m,g),m&&(C=m.hasSpecificTrigger(6))),C&&(A===a._previousButtonPressed&&Date.now()-a._previousStartingPointerTime<r.DoubleClickDelay&&!a._doubleClickOccured?(!g.hasSwiped&&!a._isPointerSwiping()?(a._previousStartingPointerTime=0,a._doubleClickOccured=!0,g.doubleClick=!0,g.ignore=!1,r.ExclusiveDoubleClickMode&&a._previousDelayedSimpleClickTimeout&&clearTimeout(a._previousDelayedSimpleClickTimeout),a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,d(g,a._currentPickResult)):(a._doubleClickOccured=!1,a._previousStartingPointerTime=a._startingPointerTime,a._previousStartingPointerPosition.x=a._startingPointerPosition.x,a._previousStartingPointerPosition.y=a._startingPointerPosition.y,a._previousButtonPressed=A,r.ExclusiveDoubleClickMode?(a._previousDelayedSimpleClickTimeout&&clearTimeout(a._previousDelayedSimpleClickTimeout),a._previousDelayedSimpleClickTimeout=a._delayedSimpleClickTimeout,d(g,a._previousPickResult)):d(g,a._currentPickResult)),v=!0):(a._doubleClickOccured=!1,a._previousStartingPointerTime=a._startingPointerTime,a._previousStartingPointerPosition.x=a._startingPointerPosition.x,a._previousStartingPointerPosition.y=a._startingPointerPosition.y,a._previousButtonPressed=A))}}v||d(g,a._currentPickResult)},this._onPointerMove=function(h){if(h.pointerId===void 0&&(h.pointerId=0),a._updatePointerPosition(h),!a._checkPrePointerObservable(null,h,h.type===a._wheelEventName?U.POINTERWHEEL:U.POINTERMOVE)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){s.pointerMovePredicate||(s.pointerMovePredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(p.enablePointerMoveEvents||s.constantlyUpdateMeshUnderPointer||p._getActionManagerForTrigger()!=null)&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)});var c=s.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,s.pointerMovePredicate,!1,s.cameraToUseForPointers);a._processPointerMove(c,h)}},this._onPointerDown=function(h){if(a._totalPointersPressed++,a._pickedDownMesh=null,a._meshPickProceed=!1,h.pointerId===void 0&&(h.pointerId=0),a._updatePointerPosition(h),s.preventDefaultOnPointerDown&&n&&(h.preventDefault(),n.focus()),a._startingPointerPosition.x=a._pointerX,a._startingPointerPosition.y=a._pointerY,a._startingPointerTime=Date.now(),!a._checkPrePointerObservable(null,h,U.POINTERDOWN)&&!(!s.cameraToUseForPointers&&!s.activeCamera)){a._pointerCaptures[h.pointerId]=!0,s.pointerDownPredicate||(s.pointerDownPredicate=function(p){return p.isPickable&&p.isVisible&&p.isReady()&&p.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&p.layerMask)!==0)}),a._pickedDownMesh=null;var c=s.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,s.pointerDownPredicate,!1,s.cameraToUseForPointers);a._processPointerDown(c,h)}},this._onPointerUp=function(h){a._totalPointersPressed!==0&&(a._totalPointersPressed--,a._pickedUpMesh=null,a._meshPickProceed=!1,h.pointerId===void 0&&(h.pointerId=0),a._updatePointerPosition(h),s.preventDefaultOnPointerUp&&n&&(h.preventDefault(),n.focus()),a._initClickEvent(s.onPrePointerObservable,s.onPointerObservable,h,function(c,p){s.onPrePointerObservable.hasObservers()&&!c.ignore&&(!c.hasSwiped&&(c.singleClick&&s.onPrePointerObservable.hasSpecificMask(U.POINTERTAP)&&a._checkPrePointerObservable(null,h,U.POINTERTAP)||c.doubleClick&&s.onPrePointerObservable.hasSpecificMask(U.POINTERDOUBLETAP)&&a._checkPrePointerObservable(null,h,U.POINTERDOUBLETAP))||a._checkPrePointerObservable(null,h,U.POINTERUP))||!a._pointerCaptures[h.pointerId]||(a._pointerCaptures[h.pointerId]=!1,!(!s.cameraToUseForPointers&&!s.activeCamera)&&(s.pointerUpPredicate||(s.pointerUpPredicate=function(d){return d.isPickable&&d.isVisible&&d.isReady()&&d.isEnabled()&&(!s.cameraToUseForPointers||(s.cameraToUseForPointers.layerMask&d.layerMask)!==0)}),!a._meshPickProceed&&(ft&&ft.HasTriggers||s.onPointerObservable.hasObservers())&&a._initActionManager(null,c),p||(p=a._currentPickResult),a._processPointerUp(p,h,c),a._previousPickResult=a._currentPickResult))}))},this._onKeyDown=function(h){var c=$t.KEYDOWN;if(s.onPreKeyboardObservable.hasObservers()){var p=new yi(c,h);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new Jt(c,h);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(14,Te.CreateNewFromScene(s,h))},this._onKeyUp=function(h){var c=$t.KEYUP;if(s.onPreKeyboardObservable.hasObservers()){var p=new yi(c,h);if(s.onPreKeyboardObservable.notifyObservers(p,c),p.skipOnPointerObservable)return}if(s.onKeyboardObservable.hasObservers()){var p=new Jt(c,h);s.onKeyboardObservable.notifyObservers(p,c)}s.actionManager&&s.actionManager.processTrigger(15,Te.CreateNewFromScene(s,h))};var u=function(){!n||a._keyboardIsAttached||(n.addEventListener("keydown",a._onKeyDown,!1),n.addEventListener("keyup",a._onKeyUp,!1),a._keyboardIsAttached=!0)};this._onCanvasFocusObserver=o.onCanvasFocusObservable.add(function(){return document.activeElement===n&&u(),u}()),this._onCanvasBlurObserver=o.onCanvasBlurObservable.add(function(){!n||(n.removeEventListener("keydown",a._onKeyDown),n.removeEventListener("keyup",a._onKeyUp),a._keyboardIsAttached=!1)}),u();var l=te.GetPointerPrefix(o);if(i&&(n.addEventListener(l+"move",this._onPointerMove,!1),this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",n.addEventListener(this._wheelEventName,this._onPointerMove,!1)),t&&n.addEventListener(l+"down",this._onPointerDown,!1),e){var f=s.getEngine().getHostWindow();f&&f.addEventListener(l+"up",this._onPointerUp,!1)}this._alreadyAttached=!0}},r.prototype.detachControl=function(){var e=this._scene.getEngine(),t=te.GetPointerPrefix(e);!this._alreadyAttachedTo||!this._alreadyAttached||(this._alreadyAttachedTo.removeEventListener(t+"move",this._onPointerMove),this._alreadyAttachedTo.removeEventListener(this._wheelEventName,this._onPointerMove),this._alreadyAttachedTo.removeEventListener(t+"down",this._onPointerDown),window.removeEventListener(t+"up",this._onPointerUp),this._onCanvasBlurObserver&&e.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onCanvasFocusObserver&&e.onCanvasFocusObservable.remove(this._onCanvasFocusObserver),this._alreadyAttachedTo.removeEventListener("keydown",this._onKeyDown),this._alreadyAttachedTo.removeEventListener("keyup",this._onKeyUp),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},r.prototype.setPointerOverMesh=function(e,t){if(t===void 0&&(t=0),t<0&&(t=0),this._meshUnderPointerId[t]!==e){var i=this._meshUnderPointerId[t],n;i&&(n=i._getActionManagerForTrigger(10),n&&n.processTrigger(10,Te.CreateNew(i,void 0,{pointerId:t}))),this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,i=this._meshUnderPointerId[t],i&&(n=i._getActionManagerForTrigger(9),n&&n.processTrigger(9,Te.CreateNew(i,void 0,{pointerId:t})))}},r.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},r.DragMovementThreshold=10,r.LongPressDelay=500,r.DoubleClickDelay=300,r.ExclusiveDoubleClickMode=!1,r}(),Mr=function(){function r(){}return Object.defineProperty(r,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!1,configurable:!0}),r._UniqueIdCounter=0,r}(),_t=function(r){N(e,r);function e(t,i){var n=r.call(this)||this;n._inputManager=new We(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new fe(.2,.2,.3,1),n.ambientColor=new ae(0,0,0),n._environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new D,n._onDisposeObserver=null,n.onBeforeRenderObservable=new D,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new D,n.onAfterRenderCameraObservable=new D,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new D,n.onAfterAnimationsObservable=new D,n.onBeforeDrawPhaseObservable=new D,n.onAfterDrawPhaseObservable=new D,n.onReadyObservable=new D,n.onBeforeCameraRenderObservable=new D,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new D,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new D,n.onAfterActiveMeshesEvaluationObservable=new D,n.onBeforeParticlesRenderingObservable=new D,n.onAfterParticlesRenderingObservable=new D,n.onDataLoadedObservable=new D,n.onNewCameraAddedObservable=new D,n.onCameraRemovedObservable=new D,n.onNewLightAddedObservable=new D,n.onLightRemovedObservable=new D,n.onNewGeometryAddedObservable=new D,n.onGeometryRemovedObservable=new D,n.onNewTransformNodeAddedObservable=new D,n.onTransformNodeRemovedObservable=new D,n.onNewMeshAddedObservable=new D,n.onMeshRemovedObservable=new D,n.onNewSkeletonAddedObservable=new D,n.onSkeletonRemovedObservable=new D,n.onNewMaterialAddedObservable=new D,n.onNewMultiMaterialAddedObservable=new D,n.onMaterialRemovedObservable=new D,n.onMultiMaterialRemovedObservable=new D,n.onNewTextureAddedObservable=new D,n.onTextureRemovedObservable=new D,n.onBeforeRenderTargetsRenderObservable=new D,n.onAfterRenderTargetsRenderObservable=new D,n.onBeforeStepObservable=new D,n.onAfterStepObservable=new D,n.onActiveCameraChanged=new D,n.onBeforeRenderingGroupObservable=new D,n.onAfterRenderingGroupObservable=new D,n.onMeshImportedObservable=new D,n.onAnimationFileImportedObservable=new D,n._registeredForLateAnimationBindings=new Qe(256),n.onPrePointerObservable=new D,n.onPointerObservable=new D,n.onPreKeyboardObservable=new D,n.onKeyboardObservable=new D,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=e.FOGMODE_NONE,n.fogColor=new ae(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.prePass=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new y(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new Qe(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new ht,n._activeIndices=new ht,n._activeParticles=new ht,n._activeBones=new ht,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=-1,n._intermediateRendering=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new Ie(256),n._processedMaterials=new Ie(256),n._renderTargets=new Qe(256),n._activeParticleSystems=new Ie(256),n._activeSkeletons=new Qe(32),n._softwareSkinnedMeshes=new Qe(32),n._activeAnimatables=new Array,n._transformMatrix=R.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=le.Create(),n._beforeClearStage=le.Create(),n._gatherRenderTargetsStage=le.Create(),n._gatherActiveCameraRenderTargetsStage=le.Create(),n._isReadyForMeshStage=le.Create(),n._beforeEvaluateActiveMeshStage=le.Create(),n._evaluateSubMeshStage=le.Create(),n._preActiveMeshStage=le.Create(),n._cameraDrawRenderTargetStage=le.Create(),n._beforeCameraDrawStage=le.Create(),n._beforeRenderTargetDrawStage=le.Create(),n._beforeRenderingGroupDrawStage=le.Create(),n._beforeRenderingMeshStage=le.Create(),n._afterRenderingMeshStage=le.Create(),n._afterRenderingGroupDrawStage=le.Create(),n._afterCameraDrawStage=le.Create(),n._afterRenderTargetDrawStage=le.Create(),n._afterRenderStage=le.Create(),n._pointerMoveStage=le.Create(),n._pointerDownStage=le.Create(),n._pointerUpStage=le.Create(),n.geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1;var a=Ft({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},i);return n._engine=t||de.LastCreatedEngine,a.virtual||(de._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new Ar(n),vi&&(n.postProcessManager=new vi(n)),oe.IsWindowObjectExist()&&n.attachControl(),n._createUbo(),tt&&(n._imageProcessingConfiguration=new tt),n.setDefaultCandidateProviders(),a.useGeometryUniqueIdsMap&&(n.geometriesByUniqueId={}),n.useMaterialMeshMap=a.useMaterialMeshMap,n.useClonedMeshMap=a.useClonedMeshMap,(!i||!i.virtual)&&n._engine.onNewSceneAddedObservable.notifyObservers(n),n}return e.DefaultMaterialFactory=function(t){throw O.WarnImport("StandardMaterial")},e.CollisionCoordinatorFactory=function(){throw O.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(e.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(t){this._environmentTexture!==t&&(this._environmentTexture=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(t){this._environmentIntensity!==t&&(this._environmentIntensity=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(t){this._forceWireframe!==t&&(this._forceWireframe=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(t){this._skipFrustumClipping!==t&&(this._skipFrustumClipping=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(t){this._forcePointsCloud!==t&&(this._forcePointsCloud=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(t){this._animationPropertiesOverride=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),t&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"afterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),t&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beforeCameraRender",{set:function(t){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"afterCameraRender",{set:function(t){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DragMovementThreshold",{get:function(){return We.DragMovementThreshold},set:function(t){We.DragMovementThreshold=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LongPressDelay",{get:function(){return We.LongPressDelay},set:function(t){We.LongPressDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DoubleClickDelay",{get:function(){return We.DoubleClickDelay},set:function(t){We.DoubleClickDelay=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ExclusiveDoubleClickMode",{get:function(){return We.ExclusiveDoubleClickMode},set:function(t){We.ExclusiveDoubleClickMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(t){this._useRightHandedSystem!==t&&(this._useRightHandedSystem=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),e.prototype.setStepId=function(t){this._currentStepId=t},e.prototype.getStepId=function(){return this._currentStepId},e.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fogMode",{get:function(){return this._fogMode},set:function(t){this._fogMode!==t&&(this._fogMode=t,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(t){this._shadowsEnabled!==t&&(this._shadowsEnabled=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(t){this._lightsEnabled!==t&&(this._lightsEnabled=t,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(t){t!==this._activeCamera&&(this._activeCamera=t,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=e.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(t){this._defaultMaterial=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(t){this._texturesEnabled!==t&&(this._texturesEnabled=t,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(t){this._skeletonsEnabled!==t&&(this._skeletonsEnabled=t,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=e.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),e.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var t=0,i=this._transientComponents;t<i.length;t++){var n=i[t];n.register()}this._transientComponents=[]}},e.prototype._addComponent=function(t){this._components.push(t),this._transientComponents.push(t);var i=t;i.addFromContainer&&i.serialize&&this._serializableComponents.push(i)},e.prototype._getComponent=function(t){for(var i=0,n=this._components;i<n.length;i++){var a=n[i];if(a.name===t)return a}return null},e.prototype.getClassName=function(){return"Scene"},e.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},e.prototype._getDefaultSubMeshCandidates=function(t){return this._defaultSubMeshCandidates.data=t.subMeshes,this._defaultSubMeshCandidates.length=t.subMeshes.length,this._defaultSubMeshCandidates},e.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(t){this._inputManager.pointerX=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(t){this._inputManager.pointerY=t},enumerable:!1,configurable:!0}),e.prototype.getCachedMaterial=function(){return this._cachedMaterial},e.prototype.getCachedEffect=function(){return this._cachedEffect},e.prototype.getCachedVisibility=function(){return this._cachedVisibility},e.prototype.isCachedMaterialInvalid=function(t,i,n){return n===void 0&&(n=1),this._cachedEffect!==i||this._cachedMaterial!==t||this._cachedVisibility!==n},e.prototype.getEngine=function(){return this._engine},e.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(e.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),e.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(e.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),e.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(e.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),e.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(e.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),e.prototype.getActiveMeshes=function(){return this._activeMeshes},e.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},e.prototype.getRenderId=function(){return this._renderId},e.prototype.getFrameId=function(){return this._frameId},e.prototype.incrementRenderId=function(){this._renderId++},e.prototype._createUbo=function(){this._sceneUbo=new ni(this._engine,void 0,!0),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16)},e.prototype.simulatePointerMove=function(t,i){return this._inputManager.simulatePointerMove(t,i),this},e.prototype.simulatePointerDown=function(t,i){return this._inputManager.simulatePointerDown(t,i),this},e.prototype.simulatePointerUp=function(t,i,n){return this._inputManager.simulatePointerUp(t,i,n),this},e.prototype.isPointerCaptured=function(t){return t===void 0&&(t=0),this._inputManager.isPointerCaptured(t)},e.prototype.attachControl=function(t,i,n){t===void 0&&(t=!0),i===void 0&&(i=!0),n===void 0&&(n=!0),this._inputManager.attachControl(t,i,n)},e.prototype.detachControl=function(){this._inputManager.detachControl()},e.prototype.isReady=function(){if(this._isDisposed)return!1;var t,i=this.getEngine();if(!i.areAllEffectsReady()||this._pendingData.length>0)return!1;for(t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(!!n.isEnabled()&&!(!n.subMeshes||n.subMeshes.length===0)){if(!n.isReady(!0))return!1;for(var a=n.hasThinInstances||n.getClassName()==="InstancedMesh"||n.getClassName()==="InstancedLinesMesh"||i.getCaps().instancedArrays&&n.instances.length>0,s=0,o=this._isReadyForMeshStage;s<o.length;s++){var u=o[s];if(!u.action(n,a))return!1}}}for(t=0;t<this.geometries.length;t++){var l=this.geometries[t];if(l.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var f=0,h=this.activeCameras;f<h.length;f++){var c=h[f];if(!c.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var p=0,d=this.particleSystems;p<d.length;p++){var g=d[p];if(!g.isReady())return!1}return!0},e.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},e.prototype.registerBeforeRender=function(t){this.onBeforeRenderObservable.add(t)},e.prototype.unregisterBeforeRender=function(t){this.onBeforeRenderObservable.removeCallback(t)},e.prototype.registerAfterRender=function(t){this.onAfterRenderObservable.add(t)},e.prototype.unregisterAfterRender=function(t){this.onAfterRenderObservable.removeCallback(t)},e.prototype._executeOnceBeforeRender=function(t){var i=this,n=function(){t(),setTimeout(function(){i.unregisterBeforeRender(n)})};this.registerBeforeRender(n)},e.prototype.executeOnceBeforeRender=function(t,i){var n=this;i!==void 0?setTimeout(function(){n._executeOnceBeforeRender(t)},i):this._executeOnceBeforeRender(t)},e.prototype._addPendingData=function(t){this._pendingData.push(t)},e.prototype._removePendingData=function(t){var i=this.isLoading,n=this._pendingData.indexOf(t);n!==-1&&this._pendingData.splice(n,1),i&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},e.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),e.prototype.executeWhenReady=function(t){var i=this;this.onReadyObservable.add(t),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){i._checkIsReady()},150))},e.prototype.whenReadyAsync=function(){var t=this;return new Promise(function(i){t.executeWhenReady(function(){i()})})},e.prototype._checkIsReady=function(){var t=this;if(this._registerTransientComponents(),this.isReady()){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150)},Object.defineProperty(e.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),e.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=Ve.Now},e.prototype.getViewMatrix=function(){return this._viewMatrix},e.prototype.getProjectionMatrix=function(){return this._projectionMatrix},e.prototype.getTransformMatrix=function(){return this._transformMatrix},e.prototype.setTransformMatrix=function(t,i,n,a){this._viewUpdateFlag===t.updateFlag&&this._projectionUpdateFlag===i.updateFlag||(this._viewUpdateFlag=t.updateFlag,this._projectionUpdateFlag=i.updateFlag,this._viewMatrix=t,this._projectionMatrix=i,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?wt.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=wt.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(n,a):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.update()))},e.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},e.prototype.getUniqueId=function(){return Mr.UniqueId},e.prototype.addMesh=function(t,i){var n=this;i===void 0&&(i=!1),!this._blockEntityCollection&&(this.meshes.push(t),t._resyncLightSources(),t.parent||t._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach(function(a){n.addMesh(a)}))},e.prototype.removeMesh=function(t,i){var n=this;i===void 0&&(i=!1);var a=this.meshes.indexOf(t);return a!==-1&&(this.meshes[a]=this.meshes[this.meshes.length-1],this.meshes.pop(),t.parent||t._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(t),i&&t.getChildMeshes().forEach(function(s){n.removeMesh(s)}),a},e.prototype.addTransformNode=function(t){this._blockEntityCollection||(t._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(t),t.parent||t._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(t))},e.prototype.removeTransformNode=function(t){var i=t._indexInSceneTransformNodesArray;if(i!==-1){if(i!==this.transformNodes.length-1){var n=this.transformNodes[this.transformNodes.length-1];this.transformNodes[i]=n,n._indexInSceneTransformNodesArray=i}t._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),t.parent||t._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(t),i},e.prototype.removeSkeleton=function(t){var i=this.skeletons.indexOf(t);return i!==-1&&(this.skeletons.splice(i,1),this.onSkeletonRemovedObservable.notifyObservers(t)),i},e.prototype.removeMorphTargetManager=function(t){var i=this.morphTargetManagers.indexOf(t);return i!==-1&&this.morphTargetManagers.splice(i,1),i},e.prototype.removeLight=function(t){var i=this.lights.indexOf(t);if(i!==-1){for(var n=0,a=this.meshes;n<a.length;n++){var s=a[n];s._removeLightSource(t,!1)}this.lights.splice(i,1),this.sortLightsByPriority(),t.parent||t._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(t),i},e.prototype.removeCamera=function(t){var i=this.cameras.indexOf(t);if(i!==-1&&(this.cameras.splice(i,1),t.parent||t._removeFromSceneRootNodes()),this.activeCameras){var n=this.activeCameras.indexOf(t);n!==-1&&this.activeCameras.splice(n,1)}return this.activeCamera===t&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(t),i},e.prototype.removeParticleSystem=function(t){var i=this.particleSystems.indexOf(t);return i!==-1&&this.particleSystems.splice(i,1),i},e.prototype.removeAnimation=function(t){var i=this.animations.indexOf(t);return i!==-1&&this.animations.splice(i,1),i},e.prototype.stopAnimation=function(t,i,n){},e.prototype.removeAnimationGroup=function(t){var i=this.animationGroups.indexOf(t);return i!==-1&&this.animationGroups.splice(i,1),i},e.prototype.removeMultiMaterial=function(t){var i=this.multiMaterials.indexOf(t);return i!==-1&&this.multiMaterials.splice(i,1),this.onMultiMaterialRemovedObservable.notifyObservers(t),i},e.prototype.removeMaterial=function(t){var i=t._indexInSceneMaterialArray;if(i!==-1&&i<this.materials.length){if(i!==this.materials.length-1){var n=this.materials[this.materials.length-1];this.materials[i]=n,n._indexInSceneMaterialArray=i}t._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(t),i},e.prototype.removeActionManager=function(t){var i=this.actionManagers.indexOf(t);return i!==-1&&this.actionManagers.splice(i,1),i},e.prototype.removeTexture=function(t){var i=this.textures.indexOf(t);return i!==-1&&this.textures.splice(i,1),this.onTextureRemovedObservable.notifyObservers(t),i},e.prototype.addLight=function(t){if(!this._blockEntityCollection){this.lights.push(t),this.sortLightsByPriority(),t.parent||t._addToSceneRootNodes();for(var i=0,n=this.meshes;i<n.length;i++){var a=n[i];a.lightSources.indexOf(t)===-1&&(a.lightSources.push(t),a._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(t)}},e.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(Ze.CompareLightsPriority)},e.prototype.addCamera=function(t){this._blockEntityCollection||(this.cameras.push(t),this.onNewCameraAddedObservable.notifyObservers(t),t.parent||t._addToSceneRootNodes())},e.prototype.addSkeleton=function(t){this._blockEntityCollection||(this.skeletons.push(t),this.onNewSkeletonAddedObservable.notifyObservers(t))},e.prototype.addParticleSystem=function(t){this._blockEntityCollection||this.particleSystems.push(t)},e.prototype.addAnimation=function(t){this._blockEntityCollection||this.animations.push(t)},e.prototype.addAnimationGroup=function(t){this._blockEntityCollection||this.animationGroups.push(t)},e.prototype.addMultiMaterial=function(t){this._blockEntityCollection||(this.multiMaterials.push(t),this.onNewMultiMaterialAddedObservable.notifyObservers(t))},e.prototype.addMaterial=function(t){this._blockEntityCollection||(t._indexInSceneMaterialArray=this.materials.length,this.materials.push(t),this.onNewMaterialAddedObservable.notifyObservers(t))},e.prototype.addMorphTargetManager=function(t){this._blockEntityCollection||this.morphTargetManagers.push(t)},e.prototype.addGeometry=function(t){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[t.uniqueId]=this.geometries.length),this.geometries.push(t))},e.prototype.addActionManager=function(t){this.actionManagers.push(t)},e.prototype.addTexture=function(t){this._blockEntityCollection||(this.textures.push(t),this.onNewTextureAddedObservable.notifyObservers(t))},e.prototype.switchActiveCamera=function(t,i){i===void 0&&(i=!0);var n=this._engine.getInputElement();!n||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=t,i&&t.attachControl())},e.prototype.setActiveCameraByID=function(t){var i=this.getCameraByID(t);return i?(this.activeCamera=i,i):null},e.prototype.setActiveCameraByName=function(t){var i=this.getCameraByName(t);return i?(this.activeCamera=i,i):null},e.prototype.getAnimationGroupByName=function(t){for(var i=0;i<this.animationGroups.length;i++)if(this.animationGroups[i].name===t)return this.animationGroups[i];return null},e.prototype.getMaterialByUniqueID=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].uniqueId===t)return this.materials[i];return null},e.prototype.getMaterialByID=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].id===t)return this.materials[i];return null},e.prototype.getLastMaterialByID=function(t){for(var i=this.materials.length-1;i>=0;i--)if(this.materials[i].id===t)return this.materials[i];return null},e.prototype.getMaterialByName=function(t){for(var i=0;i<this.materials.length;i++)if(this.materials[i].name===t)return this.materials[i];return null},e.prototype.getTextureByUniqueID=function(t){for(var i=0;i<this.textures.length;i++)if(this.textures[i].uniqueId===t)return this.textures[i];return null},e.prototype.getCameraByID=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].id===t)return this.cameras[i];return null},e.prototype.getCameraByUniqueID=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].uniqueId===t)return this.cameras[i];return null},e.prototype.getCameraByName=function(t){for(var i=0;i<this.cameras.length;i++)if(this.cameras[i].name===t)return this.cameras[i];return null},e.prototype.getBoneByID=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],a=0;a<n.bones.length;a++)if(n.bones[a].id===t)return n.bones[a];return null},e.prototype.getBoneByName=function(t){for(var i=0;i<this.skeletons.length;i++)for(var n=this.skeletons[i],a=0;a<n.bones.length;a++)if(n.bones[a].name===t)return n.bones[a];return null},e.prototype.getLightByName=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].name===t)return this.lights[i];return null},e.prototype.getLightByID=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].id===t)return this.lights[i];return null},e.prototype.getLightByUniqueID=function(t){for(var i=0;i<this.lights.length;i++)if(this.lights[i].uniqueId===t)return this.lights[i];return null},e.prototype.getParticleSystemByID=function(t){for(var i=0;i<this.particleSystems.length;i++)if(this.particleSystems[i].id===t)return this.particleSystems[i];return null},e.prototype.getGeometryByID=function(t){for(var i=0;i<this.geometries.length;i++)if(this.geometries[i].id===t)return this.geometries[i];return null},e.prototype._getGeometryByUniqueID=function(t){if(this.geometriesByUniqueId){var i=this.geometriesByUniqueId[t];if(i!==void 0)return this.geometries[i]}else for(var n=0;n<this.geometries.length;n++)if(this.geometries[n].uniqueId===t)return this.geometries[n];return null},e.prototype.pushGeometry=function(t,i){return!i&&this._getGeometryByUniqueID(t.uniqueId)?!1:(this.addGeometry(t),this.onNewGeometryAddedObservable.notifyObservers(t),!0)},e.prototype.removeGeometry=function(t){var i;if(this.geometriesByUniqueId){if(i=this.geometriesByUniqueId[t.uniqueId],i===void 0)return!1}else if(i=this.geometries.indexOf(t),i<0)return!1;if(i!==this.geometries.length-1){var n=this.geometries[this.geometries.length-1];n&&(this.geometries[i]=n,this.geometriesByUniqueId&&(this.geometriesByUniqueId[n.uniqueId]=i,this.geometriesByUniqueId[t.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(t),!0},e.prototype.getGeometries=function(){return this.geometries},e.prototype.getMeshByID=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].id===t)return this.meshes[i];return null},e.prototype.getMeshesByID=function(t){return this.meshes.filter(function(i){return i.id===t})},e.prototype.getTransformNodeByID=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].id===t)return this.transformNodes[i];return null},e.prototype.getTransformNodeByUniqueID=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].uniqueId===t)return this.transformNodes[i];return null},e.prototype.getTransformNodesByID=function(t){return this.transformNodes.filter(function(i){return i.id===t})},e.prototype.getMeshByUniqueID=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].uniqueId===t)return this.meshes[i];return null},e.prototype.getLastMeshByID=function(t){for(var i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];return null},e.prototype.getLastEntryByID=function(t){var i;for(i=this.meshes.length-1;i>=0;i--)if(this.meshes[i].id===t)return this.meshes[i];for(i=this.transformNodes.length-1;i>=0;i--)if(this.transformNodes[i].id===t)return this.transformNodes[i];for(i=this.cameras.length-1;i>=0;i--)if(this.cameras[i].id===t)return this.cameras[i];for(i=this.lights.length-1;i>=0;i--)if(this.lights[i].id===t)return this.lights[i];return null},e.prototype.getNodeByID=function(t){var i=this.getMeshByID(t);if(i)return i;var n=this.getTransformNodeByID(t);if(n)return n;var a=this.getLightByID(t);if(a)return a;var s=this.getCameraByID(t);if(s)return s;var o=this.getBoneByID(t);return o||null},e.prototype.getNodeByName=function(t){var i=this.getMeshByName(t);if(i)return i;var n=this.getTransformNodeByName(t);if(n)return n;var a=this.getLightByName(t);if(a)return a;var s=this.getCameraByName(t);if(s)return s;var o=this.getBoneByName(t);return o||null},e.prototype.getMeshByName=function(t){for(var i=0;i<this.meshes.length;i++)if(this.meshes[i].name===t)return this.meshes[i];return null},e.prototype.getTransformNodeByName=function(t){for(var i=0;i<this.transformNodes.length;i++)if(this.transformNodes[i].name===t)return this.transformNodes[i];return null},e.prototype.getLastSkeletonByID=function(t){for(var i=this.skeletons.length-1;i>=0;i--)if(this.skeletons[i].id===t)return this.skeletons[i];return null},e.prototype.getSkeletonByUniqueId=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].uniqueId===t)return this.skeletons[i];return null},e.prototype.getSkeletonById=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].id===t)return this.skeletons[i];return null},e.prototype.getSkeletonByName=function(t){for(var i=0;i<this.skeletons.length;i++)if(this.skeletons[i].name===t)return this.skeletons[i];return null},e.prototype.getMorphTargetManagerById=function(t){for(var i=0;i<this.morphTargetManagers.length;i++)if(this.morphTargetManagers[i].uniqueId===t)return this.morphTargetManagers[i];return null},e.prototype.getMorphTargetById=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],a=0;a<n.numTargets;++a){var s=n.getTarget(a);if(s.id===t)return s}return null},e.prototype.getMorphTargetByName=function(t){for(var i=0;i<this.morphTargetManagers.length;++i)for(var n=this.morphTargetManagers[i],a=0;a<n.numTargets;++a){var s=n.getTarget(a);if(s.name===t)return s}return null},e.prototype.getPostProcessByName=function(t){for(var i=0;i<this.postProcesses.length;++i){var n=this.postProcesses[i];if(n.name===t)return n}return null},e.prototype.isActiveMesh=function(t){return this._activeMeshes.indexOf(t)!==-1},Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=te.RandomId()),this._uid},enumerable:!1,configurable:!0}),e.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new fi),this._externalData.add(t,i)},e.prototype.getExternalData=function(t){return this._externalData?this._externalData.get(t):null},e.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new fi),this._externalData.getOrAddWithFactory(t,i)},e.prototype.removeExternalData=function(t){return this._externalData.remove(t)},e.prototype._evaluateSubMesh=function(t,i,n){if(n.hasInstances||n.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||i.alwaysSelectAsActiveMesh||i.subMeshes.length===1||t.isInFrustum(this._frustumPlanes)){for(var a=0,s=this._evaluateSubMeshStage;a<s.length;a++){var o=s[a];o.action(i,t)}var u=t.getMaterial();u!=null&&(u.hasRenderTargetTextures&&u.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(u)===-1&&(this._processedMaterials.push(u),this._renderTargets.concatWithNoDuplicate(u.getRenderTargetTextures())),this._renderingManager.dispatch(t,i,u))}},e.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(e.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(t){this._preventFreeActiveMeshesAndRenderingGroups!==t&&(t&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=t)},enumerable:!1,configurable:!0}),e.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var t=0;t<this.activeCameras.length;t++){var i=this.activeCameras[t];i&&i._activeMeshes&&i._activeMeshes.dispose()}},e.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var t=0;t<this.textures.length;t++){var i=this.textures[t];i&&i.renderList&&i.freeRenderingGroups()}},e.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},e.prototype.freezeActiveMeshes=function(t,i,n){var a=this;return t===void 0&&(t=!1),this.executeWhenReady(function(){if(!a.activeCamera){n&&n("No active camera found");return}a._frustumPlanes||a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix()),a._evaluateActiveMeshes(),a._activeMeshesFrozen=!0,a._skipEvaluateActiveMeshesCompletely=t;for(var s=0;s<a._activeMeshes.length;s++)a._activeMeshes.data[s]._freeze();i&&i()}),this},e.prototype.unfreezeActiveMeshes=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t];i._internalAbstractMeshDataInfo&&(i._internalAbstractMeshDataInfo._isActive=!1)}for(var t=0;t<this._activeMeshes.length;t++)this._activeMeshes.data[t]._unFreeze();return this._activeMeshesFrozen=!1,this},e.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var t=this._activeMeshes.length,i=0;i<t;i++){var n=this._activeMeshes.data[i];n.computeWorldMatrix()}if(this._activeParticleSystems)for(var a=this._activeParticleSystems.length,i=0;i<a;i++)this._activeParticleSystems.data[i].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var s=0,o=this._beforeEvaluateActiveMeshStage;s<o.length;s++){var u=o[s];u.action()}for(var l=this.getActiveMeshCandidates(),f=l.length,i=0;i<f;i++){var n=l.data[i];if(n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!n.isBlocked&&(this._totalVertices.addCount(n.getTotalVertices(),!1),!(!n.isReady()||!n.isEnabled()||n.scaling.lengthSquared()===0))){n.computeWorldMatrix(),n.actionManager&&n.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(n);var h=this.customLODSelector?this.customLODSelector(n,this.activeCamera):n.getLOD(this.activeCamera);if(n._internalAbstractMeshDataInfo._currentLOD=h,n._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,h!=null&&(h!==n&&h.billboardMode!==Re.BILLBOARDMODE_NONE&&h.computeWorldMatrix(),n._preActivate(),n.isVisible&&n.visibility>0&&(n.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||n.alwaysSelectAsActiveMesh||n.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(n),this.activeCamera._activeMeshes.push(n),h!==n&&h._activate(this._renderId,!1);for(var c=0,p=this._preActiveMeshStage;c<p.length;c++){var u=p[c];u.action(n)}n._activate(this._renderId,!1)&&(n.isAnInstance?n._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=n):h._internalAbstractMeshDataInfo._onlyForInstances=!1,h._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(n,h)),n._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var d=0;d<this.particleSystems.length;d++){var g=this.particleSystems[d];if(!(!g.isStarted()||!g.emitter)){var m=g.emitter;(!m.position||m.isEnabled())&&(this._activeParticleSystems.push(g),g.animate(),this._renderingManager.dispatchParticles(g))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},e.prototype._activeMesh=function(t,i){if(this._skeletonsEnabled&&i.skeleton!==null&&i.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(i.skeleton)&&i.skeleton.prepare(),i.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(i)),i!=null&&i.subMeshes!==void 0&&i.subMeshes!==null&&i.subMeshes.length>0)for(var n=this.getActiveSubMeshCandidates(i),a=n.length,s=0;s<a;s++){var o=n.data[s];this._evaluateSubMesh(o,i,t)}},e.prototype.updateTransformMatrix=function(t){!this.activeCamera||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(t))},e.prototype._bindFrameBuffer=function(){if(this.activeCamera&&this.activeCamera._multiviewTexture)this.activeCamera._multiviewTexture._bindFrameBuffer();else if(this.activeCamera&&this.activeCamera.outputRenderTarget){var t=this.getEngine().getCaps().multiview&&this.activeCamera.outputRenderTarget&&this.activeCamera.outputRenderTarget.getViewCount()>1;if(t)this.activeCamera.outputRenderTarget._bindFrameBuffer();else{var i=this.activeCamera.outputRenderTarget.getInternalTexture();i?this.getEngine().bindFramebuffer(i):L.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},e.prototype._renderForCamera=function(t,i){if(!(t&&t._skipRendering)){var n=this._engine;if(this._activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");n.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++;var a=this.getEngine().getCaps().multiview&&t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1;a?this.setTransformMatrix(t._rigCameras[0].getViewMatrix(),t._rigCameras[0].getProjectionMatrix(),t._rigCameras[1].getViewMatrix(),t._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var s=0;s<this._softwareSkinnedMeshes.length;s++){var o=this._softwareSkinnedMeshes.data[s];o.applySkeleton(o.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),i&&i.customRenderTargets&&i.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(i.customRenderTargets);for(var u=0,l=this._gatherActiveCameraRenderTargetsStage;u<l.length;u++){var f=l[u];f.action(this._renderTargets)}var h=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){te.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var c=0;c<this._renderTargets.length;c++){var p=this._renderTargets.data[c];if(p._shouldRender()){this._renderId++;var d=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(d,this.dumpNextRenderTargets),h=!0}}te.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var g=0,m=this._cameraDrawRenderTargetStage;g<m.length;g++){var f=m[g];h=f.action(this.activeCamera)||h}this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(h=!0)}h&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!t._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var E=0,v=this._beforeCameraDrawStage;E<v.length;E++){var f=v[E];f.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var A=0,M=this._afterCameraDrawStage;A<M.length;A++){var f=M[A];f.action(this.activeCamera)}if(this.postProcessManager&&!t._multiviewTexture){var C=t.outputRenderTarget?t.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(t.isIntermediate,C)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},e.prototype._processSubCameras=function(t){if(t.cameraRigMode===J.RIG_MODE_NONE||t.outputRenderTarget&&t.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview){this._renderForCamera(t),this.onAfterRenderCameraObservable.notifyObservers(t);return}if(t._useMultiviewToSingleView)this._renderMultiviewToSingleView(t);else for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i],t);this._activeCamera=t,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(t)},e.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++){var i=this._meshesForIntersections.data[t];if(!!i.actionManager)for(var n=0;i.actionManager&&n<i.actionManager.actions.length;n++){var a=i.actionManager.actions[n];if(a.trigger===12||a.trigger===13){var s=a.getTriggerParameter(),o=s instanceof pt?s:s.mesh,u=o.intersectsMesh(i,s.usePreciseIntersection),l=i._intersectionsInProgress.indexOf(o);u&&l===-1?a.trigger===12?(a._executeCurrent(Te.CreateNew(i,void 0,o)),i._intersectionsInProgress.push(o)):a.trigger===13&&i._intersectionsInProgress.push(o):!u&&l>-1&&(a.trigger===13&&a._executeCurrent(Te.CreateNew(i,void 0,o)),(!i.actionManager.hasSpecificTrigger(13,function(f){var h=f instanceof pt?f:f.mesh;return o===h})||a.trigger===13)&&i._intersectionsInProgress.splice(l,1))}}}},e.prototype._advancePhysicsEngineStep=function(t){},e.prototype._animate=function(){},e.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var t=Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime))+this._timeAccumulator,i=this._engine.getTimeStep(),n=1e3/i/1e3,a=0,s=this._engine.getLockstepMaxSteps(),o=Math.floor(t/i);for(o=Math.min(o,s);t>0&&a<o;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=i*n,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(i),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,a++,t-=i;this._timeAccumulator=t<0?0:t}else{var t=this.useConstantAnimationDeltaTime?16:Math.max(e.MinDeltaTime,Math.min(this._engine.getDeltaTime(),e.MaxDeltaTime));this._animationRatio=t*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t)}},e.prototype.render=function(t,i){if(t===void 0&&(t=!0),i===void 0&&(i=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),i||this.animate();for(var n=0,a=this._beforeCameraUpdateStage;n<a.length;n++){var s=a[n];s.action()}if(t){if(this.activeCameras&&this.activeCameras.length>0)for(var o=0;o<this.activeCameras.length;o++){var u=this.activeCameras[o];if(u.update(),u.cameraRigMode!==J.RIG_MODE_NONE)for(var l=0;l<u._rigCameras.length;l++)u._rigCameras[l].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==J.RIG_MODE_NONE))for(var l=0;l<this.activeCamera._rigCameras.length;l++)this.activeCamera._rigCameras[l].update()}this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var f=this.getEngine(),h=this.activeCamera;if(this.renderTargetsEnabled){te.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var c=0;c<this.customRenderTargets.length;c++){var p=this.customRenderTargets[c];if(p._shouldRender()){if(this._renderId++,this.activeCamera=p.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");f.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),p.render(h!==this.activeCamera,this.dumpNextRenderTargets)}}te.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=h,this._activeCamera&&this._activeCamera.cameraRigMode!==J.RIG_MODE_CUSTOM&&!this.prePass&&this._bindFrameBuffer(),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var d=0,g=this._beforeClearStage;d<g.length;d++){var s=g[d];s.action()}(this.autoClearDepthAndStencil||this.autoClear)&&!this.prePass&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);for(var m=0,E=this._gatherRenderTargetsStage;m<E.length;m++){var s=E[m];s.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var o=0;o<this.activeCameras.length;o++)o>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[o]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var v=0,A=this._afterRenderStage;v<A.length;v++){var s=A[v];s.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var l=0;l<this._toBeDisposed.length;l++){var M=this._toBeDisposed[l];M&&M.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},e.prototype.freezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].freeze()},e.prototype.unfreezeMaterials=function(){for(var t=0;t<this.materials.length;t++)this.materials[t].unfreeze()},e.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,de._LastCreatedScene===this&&(de._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var t=0,i=this._components;t<i.length;t++){var n=i[t];n.dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var a=0,s=this._activeRequests;a<s.length;a++){var o=s[a];o.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var u=this._engine.getInputElement();if(u){var l;for(l=0;l<this.cameras.length;l++)this.cameras[l].detachControl()}for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),l=this._engine.scenes.indexOf(this),l>-1&&this._engine.scenes.splice(l,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),e.prototype.clearCachedVertexData=function(){for(var t=0;t<this.meshes.length;t++){var i=this.meshes[t],n=i.geometry;if(n){n._indices=[];for(var a in n._vertexBuffers)!n._vertexBuffers.hasOwnProperty(a)||(n._vertexBuffers[a]._buffer._data=null)}}},e.prototype.cleanCachedTextureBuffer=function(){for(var t=0,i=this.textures;t<i.length;t++){var n=i[t],a=n._buffer;a&&(n._buffer=null)}},e.prototype.getWorldExtends=function(t){var i=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return t=t||function(){return!0},this.meshes.filter(t).forEach(function(a){if(a.computeWorldMatrix(!0),!(!a.subMeshes||a.subMeshes.length===0||a.infiniteDistance)){var s=a.getBoundingInfo(),o=s.boundingBox.minimumWorld,u=s.boundingBox.maximumWorld;y.CheckExtends(o,i,n),y.CheckExtends(u,i,n)}}),{min:i,max:n}},e.prototype.createPickingRay=function(t,i,n,a,s){throw O.WarnImport("Ray")},e.prototype.createPickingRayToRef=function(t,i,n,a,s,o){throw O.WarnImport("Ray")},e.prototype.createPickingRayInCameraSpace=function(t,i,n){throw O.WarnImport("Ray")},e.prototype.createPickingRayInCameraSpaceToRef=function(t,i,n,a){throw O.WarnImport("Ray")},e.prototype.pick=function(t,i,n,a,s,o){var u=new Zt;return u._pickingUnavailable=!0,u},e.prototype.pickWithBoundingInfo=function(t,i,n,a,s){var o=new Zt;return o._pickingUnavailable=!0,o},e.prototype.pickWithRay=function(t,i,n,a){throw O.WarnImport("Ray")},e.prototype.multiPick=function(t,i,n,a,s){throw O.WarnImport("Ray")},e.prototype.multiPickWithRay=function(t,i,n){throw O.WarnImport("Ray")},e.prototype.setPointerOverMesh=function(t,i){this._inputManager.setPointerOverMesh(t,i)},e.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},e.prototype._rebuildGeometries=function(){for(var t=0,i=this.geometries;t<i.length;t++){var n=i[t];n._rebuild()}for(var a=0,s=this.meshes;a<s.length;a++){var o=s[a];o._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var u=0,l=this._components;u<l.length;u++){var f=l[u];f.rebuild()}for(var h=0,c=this.particleSystems;h<c.length;h++){var p=c[h];p.rebuild()}},e.prototype._rebuildTextures=function(){for(var t=0,i=this.textures;t<i.length;t++){var n=i[t];n._rebuild()}this.markAllMaterialsAsDirty(1)},e.prototype._getByTags=function(t,i,n){if(i===void 0)return t;var a=[];n=n||function(u){};for(var s in t){var o=t[s];$&&$.MatchesQuery(o,i)&&(a.push(o),n(o))}return a},e.prototype.getMeshesByTags=function(t,i){return this._getByTags(this.meshes,t,i)},e.prototype.getCamerasByTags=function(t,i){return this._getByTags(this.cameras,t,i)},e.prototype.getLightsByTags=function(t,i){return this._getByTags(this.lights,t,i)},e.prototype.getMaterialByTags=function(t,i){return this._getByTags(this.materials,t,i).concat(this._getByTags(this.multiMaterials,t,i))},e.prototype.getTransformNodesByTags=function(t,i){return this._getByTags(this.transformNodes,t,i)},e.prototype.setRenderingOrder=function(t,i,n,a){i===void 0&&(i=null),n===void 0&&(n=null),a===void 0&&(a=null),this._renderingManager.setRenderingOrder(t,i,n,a)},e.prototype.setRenderingAutoClearDepthStencil=function(t,i,n,a){n===void 0&&(n=!0),a===void 0&&(a=!0),this._renderingManager.setRenderingAutoClearDepthStencil(t,i,n,a)},e.prototype.getAutoClearDepthStencilSetup=function(t){return this._renderingManager.getAutoClearDepthStencilSetup(t)},Object.defineProperty(e.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(t){this._blockMaterialDirtyMechanism!==t&&(this._blockMaterialDirtyMechanism=t,t||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),e.prototype.markAllMaterialsAsDirty=function(t,i){if(!this._blockMaterialDirtyMechanism)for(var n=0,a=this.materials;n<a.length;n++){var s=a[n];i&&!i(s)||s.markAsDirty(t)}},e.prototype._loadFile=function(t,i,n,a,s,o){var u=this,l=se.LoadFile(t,i,n,a?this.offlineProvider:void 0,s,o);return this._activeRequests.push(l),l.onCompleteObservable.add(function(f){u._activeRequests.splice(u._activeRequests.indexOf(f),1)}),l},e.prototype._loadFileAsync=function(t,i,n,a){var s=this;return new Promise(function(o,u){s._loadFile(t,function(l){o(l)},i,n,a,function(l,f){u(f)})})},e.prototype._requestFile=function(t,i,n,a,s,o,u){var l=this,f=se.RequestFile(t,i,n,a?this.offlineProvider:void 0,s,o,u);return this._activeRequests.push(f),f.onCompleteObservable.add(function(h){l._activeRequests.splice(l._activeRequests.indexOf(h),1)}),f},e.prototype._requestFileAsync=function(t,i,n,a,s){var o=this;return new Promise(function(u,l){o._requestFile(t,function(f){u(f)},i,n,a,function(f){l(f)},s)})},e.prototype._readFile=function(t,i,n,a,s){var o=this,u=se.ReadFile(t,i,n,a,s);return this._activeRequests.push(u),u.onCompleteObservable.add(function(l){o._activeRequests.splice(o._activeRequests.indexOf(l),1)}),u},e.prototype._readFileAsync=function(t,i,n){var a=this;return new Promise(function(s,o){a._readFile(t,function(u){s(u)},i,n,function(u){o(u)})})},e.FOGMODE_NONE=0,e.FOGMODE_EXP=1,e.FOGMODE_EXP2=2,e.FOGMODE_LINEAR=3,e.MinDeltaTime=1,e.MaxDeltaTime=1e3,e}(br),Ei;(function(r){r[r.CW=0]="CW",r[r.CCW=1]="CCW"})(Ei||(Ei={}));var Pr=function(){function r(){}return r.Interpolate=function(e,t,i,n,a){for(var s=1-3*n+3*t,o=3*n-6*t,u=3*t,l=e,f=0;f<5;f++){var h=l*l,c=h*l,p=s*c+o*h+u*l,d=1/(3*s*h+2*o*l+u);l-=(p-e)*d,l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*i+3*(1-l)*Math.pow(l,2)*a+Math.pow(l,3)},r}(),Lt=function(){function r(e,t){this.width=e,this.height=t}return r.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},r.prototype.getClassName=function(){return"Size"},r.prototype.getHashCode=function(){var e=this.width|0;return e=e*397^(this.height|0),e},r.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},r.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},r.prototype.set=function(e,t){return this.copyFromFloats(e,t)},r.prototype.multiplyByFloats=function(e,t){return new r(this.width*e,this.height*t)},r.prototype.clone=function(){return new r(this.width,this.height)},r.prototype.equals=function(e){return e?this.width===e.width&&this.height===e.height:!1},Object.defineProperty(r.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),r.Zero=function(){return new r(0,0)},r.prototype.add=function(e){var t=new r(this.width+e.width,this.height+e.height);return t},r.prototype.subtract=function(e){var t=new r(this.width-e.width,this.height-e.height);return t},r.Lerp=function(e,t,i){var n=e.width+(t.width-e.width)*i,a=e.height+(t.height-e.height)*i;return new r(n,a)},r}(),Pi=function(){function r(){}return Object.defineProperty(r,"ForceFullSceneLoadingForIncremental",{get:function(){return r._ForceFullSceneLoadingForIncremental},set:function(e){r._ForceFullSceneLoadingForIncremental=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ShowLoadingScreen",{get:function(){return r._ShowLoadingScreen},set:function(e){r._ShowLoadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"loggingLevel",{get:function(){return r._loggingLevel},set:function(e){r._loggingLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"CleanBoneMatrixWeights",{get:function(){return r._CleanBoneMatrixWeights},set:function(e){r._CleanBoneMatrixWeights=e},enumerable:!1,configurable:!0}),r._ForceFullSceneLoadingForIncremental=!1,r._ShowLoadingScreen=!0,r._CleanBoneMatrixWeights=!1,r._loggingLevel=0,r}(),He=function(){function r(e,t,i,n,a){n===void 0&&(n=!1),a===void 0&&(a=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=e,this.uniqueId=t.getUniqueId(),this._engine=t.getEngine(),this._meshes=[],this._scene=t,this._vertexBuffers={},this._indices=[],this._updatable=n,i?this.setAllVerticesData(i,n):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),a&&(this.applyToMesh(a),a.computeWorldMatrix(!0))}return Object.defineProperty(r.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),r.CreateGeometryForMesh=function(e){var t=new r(r.RandomId(),e.getScene());return t.applyToMesh(e),t},Object.defineProperty(r.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),r.prototype.getScene=function(){return this._scene},r.prototype.getEngine=function(){return this._engine},r.prototype.isReady=function(){return this.delayLoadState===1||this.delayLoadState===0},Object.defineProperty(r.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),r.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices));for(var e in this._vertexBuffers){var t=this._vertexBuffers[e];t._rebuild()}},r.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},r.prototype.setVerticesData=function(e,t,i,n){i===void 0&&(i=!1),i&&Array.isArray(t)&&(t=new Float32Array(t));var a=new _(this._engine,t,e,i,this._meshes.length===0,n);this.setVerticesBuffer(a)},r.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e])},r.prototype.setVerticesBuffer=function(e,t){t===void 0&&(t=null);var i=e.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=e,i===_.PositionKind){var n=e.getData();t!=null?this._totalVertices=t:n!=null&&(this._totalVertices=n.length/(e.byteStride/4)),this._updateExtend(n),this._resetPointsArrayCache();for(var a=this._meshes,s=a.length,o=0;o<s;o++){var u=a[o];u._boundingInfo=new Oe(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(!1),u.computeWorldMatrix(!0)}}this.notifyUpdate(i),this._vertexArrayObjects&&(this._disposeVertexArrayObjects(),this._vertexArrayObjects={})},r.prototype.updateVerticesDataDirectly=function(e,t,i,n){n===void 0&&(n=!1);var a=this.getVertexBuffer(e);!a||(a.updateDirectly(t,i,n),this.notifyUpdate(e))},r.prototype.updateVerticesData=function(e,t,i){i===void 0&&(i=!1);var n=this.getVertexBuffer(e);!n||(n.update(t),e===_.PositionKind&&this._updateBoundingInfo(i,t),this.notifyUpdate(e))},r.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var i=this._meshes,n=0,a=i;n<a.length;n++){var s=a[n];s._boundingInfo?s._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):s._boundingInfo=new Oe(this._extend.minimum,this._extend.maximum);for(var o=s.subMeshes,u=0,l=o;u<l.length;u++){var f=l[u];f.refreshBoundingInfo()}}},r.prototype._bind=function(e,t){if(!!e){t===void 0&&(t=this._indexBuffer);var i=this.getVertexBuffers();if(!!i){if(t!=this._indexBuffer||!this._vertexArrayObjects){this._engine.bindBuffers(i,t,e);return}this._vertexArrayObjects[e.key]||(this._vertexArrayObjects[e.key]=this._engine.recordVertexArrayObject(i,t,e)),this._engine.bindVertexArrayObject(this._vertexArrayObjects[e.key],t)}}},r.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},r.prototype.getVerticesData=function(e,t,i){var n=this.getVertexBuffer(e);if(!n)return null;var a=n.getData();if(!a)return null;var s=n.getSize()*_.GetTypeByteLength(n.type),o=this._totalVertices*n.getSize();if(n.type!==_.FLOAT||n.byteStride!==s){var u=[];return n.forEach(o,function(p){return u.push(p)}),u}if(!(a instanceof Array||a instanceof Float32Array)||n.byteOffset!==0||a.length!==o)if(a instanceof Array){var l=n.byteOffset/4;return te.Slice(a,l,l+o)}else{if(a instanceof ArrayBuffer)return new Float32Array(a,n.byteOffset,o);var l=a.byteOffset+n.byteOffset;if(i||t&&this._meshes.length!==1){var f=new Float32Array(o),h=new Float32Array(a.buffer,l,o);return f.set(h),f}var c=l%4;return c&&(l=Math.max(0,l-c)),new Float32Array(a.buffer,l,o)}return i||t&&this._meshes.length!==1?te.Slice(a):a},r.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return t?t.isUpdatable():!1},r.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},r.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},r.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?this._vertexBuffers[e]!==void 0:this._delayInfo?this._delayInfo.indexOf(e)!==-1:!1},r.prototype.getVerticesDataKinds=function(){var e=[],t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)e.push(t);else for(t in this._vertexBuffers)e.push(t);return e},r.prototype.updateIndices=function(e,t,i){if(i===void 0&&(i=!1),!!this._indexBuffer)if(!this._indexBufferIsUpdatable)this.setIndices(e,null,!0);else{var n=e.length!==this._indices.length;if(i||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),n)for(var a=0,s=this._meshes;a<s.length;a++){var o=s[a];o._createGlobalSubMesh(!0)}}},r.prototype.setIndices=function(e,t,i){t===void 0&&(t=null),i===void 0&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._disposeVertexArrayObjects(),this._indices=e,this._indexBufferIsUpdatable=i,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),t!=null&&(this._totalVertices=t);for(var n=0,a=this._meshes;n<a.length;n++){var s=a[n];s._createGlobalSubMesh(!0)}this.notifyUpdate()},r.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},r.prototype.getIndices=function(e,t){if(!this.isReady())return null;var i=this._indices;if(!t&&(!e||this._meshes.length===1))return i;for(var n=i.length,a=[],s=0;s<n;s++)a.push(i[s]);return a},r.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},r.prototype._releaseVertexArrayObject=function(e){e===void 0&&(e=null),!(!e||!this._vertexArrayObjects)&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},r.prototype.releaseForMesh=function(e,t){var i=this._meshes,n=i.indexOf(e);n!==-1&&(i.splice(n,1),e._geometry=null,i.length===0&&t&&this.dispose())},r.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},r.prototype._updateExtend=function(e){e===void 0&&(e=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(e||(e=this.getVerticesData(_.PositionKind)),this._extend=Ai(e,0,this._totalVertices,this.boundingBias,3))},r.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var i in this._vertexBuffers){t===1&&this._vertexBuffers[i].create();var n=this._vertexBuffers[i].getBuffer();n&&(n.references=t),i===_.PositionKind&&(this._extend||this._updateExtend(),e._boundingInfo=new Oe(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(!1),e._updateBoundingInfo())}t===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=t),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},r.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e);for(var t=0,i=this._meshes;t<i.length;t++){var n=i[t];n._markSubMeshesAsAttributesDirty()}},r.prototype.load=function(e,t){if(this.delayLoadState!==2){if(this.isReady()){t&&t();return}this.delayLoadState=2,this._queueLoad(e,t)}},r.prototype._queueLoad=function(e,t){var i=this;!this.delayLoadingFile||(e._addPendingData(this),e._loadFile(this.delayLoadingFile,function(n){if(!!i._delayLoadingFunction){i._delayLoadingFunction(JSON.parse(n),i),i.delayLoadState=1,i._delayInfo=[],e._removePendingData(i);for(var a=i._meshes,s=a.length,o=0;o<s;o++)i._applyToMesh(a[o]);t&&t()}},void 0,!0))},r.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(e!=null&&e.length>0){for(var t=0;t<e.length;t+=3){var i=e[t+0];e[t+0]=e[t+2],e[t+2]=i}this.setIndices(e)}var n=this.getVerticesData(_.PositionKind,!1);if(n!=null&&n.length>0){for(var t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(_.PositionKind,n,!1)}var a=this.getVerticesData(_.NormalKind,!1);if(a!=null&&a.length>0){for(var t=0;t<a.length;t+=3)a[t+2]=-a[t+2];this.setVerticesData(_.NormalKind,a,!1)}},r.prototype._resetPointsArrayCache=function(){this._positions=null},r.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(_.PositionKind);if(!e||e.length===0)return!1;for(var t=this._positionsCache.length*3,i=this._positionsCache.length;t<e.length;t+=3,++i)this._positionsCache[i]=y.FromArray(e,t);for(var t=0,i=0;t<e.length;t+=3,++i)this._positionsCache[i].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0},r.prototype.isDisposed=function(){return this._isDisposed},r.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={}}},r.prototype.dispose=function(){var e=this._meshes,t=e.length,i;for(i=0;i<t;i++)this.releaseForMesh(e[i]);this._meshes=[],this._disposeVertexArrayObjects();for(var n in this._vertexBuffers)this._vertexBuffers[n].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},r.prototype.copy=function(e){var t=new Z;t.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)t.indices.push(i[n]);var a=!1,s=!1,o;for(o in this._vertexBuffers){var u=this.getVerticesData(o);if(u&&(u instanceof Float32Array?t.set(new Float32Array(u),o):t.set(u.slice(0),o),!s)){var l=this.getVertexBuffer(o);l&&(a=l.isUpdatable(),s=!a)}}var f=new r(e,this._scene,t,a);f.delayLoadState=this.delayLoadState,f.delayLoadingFile=this.delayLoadingFile,f._delayLoadingFunction=this._delayLoadingFunction;for(o in this._delayInfo)f._delayInfo=f._delayInfo||[],f._delayInfo.push(o);return f._boundingInfo=new Oe(this._extend.minimum,this._extend.maximum),f},r.prototype.serialize=function(){var e={};return e.id=this.id,e.updatable=this._updatable,$&&$.HasTags(this)&&(e.tags=$.GetTags(this)),e},r.prototype.toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},r.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(_.PositionKind)&&(e.positions=this.toNumberArray(this.getVerticesData(_.PositionKind)),this.isVertexBufferUpdatable(_.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(_.NormalKind)&&(e.normals=this.toNumberArray(this.getVerticesData(_.NormalKind)),this.isVertexBufferUpdatable(_.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(_.TangentKind)&&(e.tangets=this.toNumberArray(this.getVerticesData(_.TangentKind)),this.isVertexBufferUpdatable(_.TangentKind)&&(e.tangets._updatable=!0)),this.isVerticesDataPresent(_.UVKind)&&(e.uvs=this.toNumberArray(this.getVerticesData(_.UVKind)),this.isVertexBufferUpdatable(_.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(_.UV2Kind)&&(e.uv2s=this.toNumberArray(this.getVerticesData(_.UV2Kind)),this.isVertexBufferUpdatable(_.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(_.UV3Kind)&&(e.uv3s=this.toNumberArray(this.getVerticesData(_.UV3Kind)),this.isVertexBufferUpdatable(_.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(_.UV4Kind)&&(e.uv4s=this.toNumberArray(this.getVerticesData(_.UV4Kind)),this.isVertexBufferUpdatable(_.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(_.UV5Kind)&&(e.uv5s=this.toNumberArray(this.getVerticesData(_.UV5Kind)),this.isVertexBufferUpdatable(_.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(_.UV6Kind)&&(e.uv6s=this.toNumberArray(this.getVerticesData(_.UV6Kind)),this.isVertexBufferUpdatable(_.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(_.ColorKind)&&(e.colors=this.toNumberArray(this.getVerticesData(_.ColorKind)),this.isVertexBufferUpdatable(_.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(_.MatricesIndicesKind)&&(e.matricesIndices=this.toNumberArray(this.getVerticesData(_.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(_.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(_.MatricesWeightsKind)&&(e.matricesWeights=this.toNumberArray(this.getVerticesData(_.MatricesWeightsKind)),this.isVertexBufferUpdatable(_.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this.toNumberArray(this.getIndices()),e},r.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},r.RandomId=function(){return te.RandomId()},r._ImportGeometry=function(e,t){var i=t.getScene(),n=e.geometryId;if(n){var a=i.getGeometryByID(n);a&&a.applyToMesh(t)}else if(e instanceof ArrayBuffer){var s=t._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){var o=new Float32Array(e,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);t.setVerticesData(_.PositionKind,o,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){var u=new Float32Array(e,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);t.setVerticesData(_.NormalKind,u,!1)}if(s.tangetsAttrDesc&&s.tangetsAttrDesc.count>0){var l=new Float32Array(e,s.tangetsAttrDesc.offset,s.tangetsAttrDesc.count);t.setVerticesData(_.TangentKind,l,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){var f=new Float32Array(e,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);t.setVerticesData(_.UVKind,f,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){var h=new Float32Array(e,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);t.setVerticesData(_.UV2Kind,h,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){var c=new Float32Array(e,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);t.setVerticesData(_.UV3Kind,c,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){var p=new Float32Array(e,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);t.setVerticesData(_.UV4Kind,p,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){var d=new Float32Array(e,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);t.setVerticesData(_.UV5Kind,d,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){var g=new Float32Array(e,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);t.setVerticesData(_.UV6Kind,g,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){var m=new Float32Array(e,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);t.setVerticesData(_.ColorKind,m,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){for(var E=new Int32Array(e,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count),v=[],A=0;A<E.length;A++){var M=E[A];v.push(M&255),v.push((M&65280)>>8),v.push((M&16711680)>>16),v.push(M>>24&255)}t.setVerticesData(_.MatricesIndicesKind,v,!1)}if(s.matricesIndicesExtraAttrDesc&&s.matricesIndicesExtraAttrDesc.count>0){for(var E=new Int32Array(e,s.matricesIndicesExtraAttrDesc.offset,s.matricesIndicesExtraAttrDesc.count),v=[],A=0;A<E.length;A++){var M=E[A];v.push(M&255),v.push((M&65280)>>8),v.push((M&16711680)>>16),v.push(M>>24&255)}t.setVerticesData(_.MatricesIndicesExtraKind,v,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){var C=new Float32Array(e,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);t.setVerticesData(_.MatricesWeightsKind,C,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){var P=new Int32Array(e,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);t.setIndices(P,null)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){var S=new Int32Array(e,s.subMeshesAttrDesc.offset,s.subMeshesAttrDesc.count*5);t.subMeshes=[];for(var A=0;A<s.subMeshesAttrDesc.count;A++){var x=S[A*5+0],z=S[A*5+1],X=S[A*5+2],V=S[A*5+3],re=S[A*5+4];Ke.AddToMesh(x,z,X,V,re,t)}}}else if(e.positions&&e.normals&&e.indices){if(t.setVerticesData(_.PositionKind,e.positions,e.positions._updatable),t.setVerticesData(_.NormalKind,e.normals,e.normals._updatable),e.tangents&&t.setVerticesData(_.TangentKind,e.tangents,e.tangents._updatable),e.uvs&&t.setVerticesData(_.UVKind,e.uvs,e.uvs._updatable),e.uvs2&&t.setVerticesData(_.UV2Kind,e.uvs2,e.uvs2._updatable),e.uvs3&&t.setVerticesData(_.UV3Kind,e.uvs3,e.uvs3._updatable),e.uvs4&&t.setVerticesData(_.UV4Kind,e.uvs4,e.uvs4._updatable),e.uvs5&&t.setVerticesData(_.UV5Kind,e.uvs5,e.uvs5._updatable),e.uvs6&&t.setVerticesData(_.UV6Kind,e.uvs6,e.uvs6._updatable),e.colors&&t.setVerticesData(_.ColorKind,fe.CheckColors4(e.colors,e.positions.length/3),e.colors._updatable),e.matricesIndices)if(e.matricesIndices._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(_.MatricesIndicesKind,e.matricesIndices,e.matricesIndices._updatable);else{for(var v=[],A=0;A<e.matricesIndices.length;A++){var j=e.matricesIndices[A];v.push(j&255),v.push((j&65280)>>8),v.push((j&16711680)>>16),v.push(j>>24&255)}t.setVerticesData(_.MatricesIndicesKind,v,e.matricesIndices._updatable)}if(e.matricesIndicesExtra)if(e.matricesIndicesExtra._isExpanded)delete e.matricesIndices._isExpanded,t.setVerticesData(_.MatricesIndicesExtraKind,e.matricesIndicesExtra,e.matricesIndicesExtra._updatable);else{for(var v=[],A=0;A<e.matricesIndicesExtra.length;A++){var j=e.matricesIndicesExtra[A];v.push(j&255),v.push((j&65280)>>8),v.push((j&16711680)>>16),v.push(j>>24&255)}t.setVerticesData(_.MatricesIndicesExtraKind,v,e.matricesIndicesExtra._updatable)}e.matricesWeights&&(r._CleanMatricesWeights(e,t),t.setVerticesData(_.MatricesWeightsKind,e.matricesWeights,e.matricesWeights._updatable)),e.matricesWeightsExtra&&t.setVerticesData(_.MatricesWeightsExtraKind,e.matricesWeightsExtra,e.matricesWeights._updatable),t.setIndices(e.indices,null)}if(e.subMeshes){t.subMeshes=[];for(var F=0;F<e.subMeshes.length;F++){var B=e.subMeshes[F];Ke.AddToMesh(B.materialIndex,B.verticesStart,B.verticesCount,B.indexStart,B.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(t)},r._CleanMatricesWeights=function(e,t){var i=.001;if(!!Pi.CleanBoneMatrixWeights){var n=0;if(e.skeletonId>-1){var a=t.getScene().getLastSkeletonByID(e.skeletonId);if(!a)return;n=a.bones.length}else return;for(var s=t.getVerticesData(_.MatricesIndicesKind),o=t.getVerticesData(_.MatricesIndicesExtraKind),u=e.matricesWeights,l=e.matricesWeightsExtra,f=e.numBoneInfluencer,h=u.length,c=0;c<h;c+=4){for(var p=0,d=-1,g=0;g<4;g++){var m=u[c+g];p+=m,m<i&&d<0&&(d=g)}if(l)for(var g=0;g<4;g++){var m=l[c+g];p+=m,m<i&&d<0&&(d=g+4)}if((d<0||d>f-1)&&(d=f-1),p>i){for(var E=1/p,g=0;g<4;g++)u[c+g]*=E;if(l)for(var g=0;g<4;g++)l[c+g]*=E}else d>=4?(l[c+d-4]=1-p,o[c+d-4]=n):(u[c+d]=1-p,s[c+d]=n)}t.setVerticesData(_.MatricesIndicesKind,s),e.matricesWeightsExtra&&t.setVerticesData(_.MatricesIndicesExtraKind,o)}},r.Parse=function(e,t,i){if(t.getGeometryByID(e.id))return null;var n=new r(e.id,t,void 0,e.updatable);return $&&$.AddTagsTo(n,e.tags),e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+e.delayLoadingFile,n._boundingInfo=new Oe(y.FromArray(e.boundingBoxMinimum),y.FromArray(e.boundingBoxMaximum)),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(_.UVKind),e.hasUVs2&&n._delayInfo.push(_.UV2Kind),e.hasUVs3&&n._delayInfo.push(_.UV3Kind),e.hasUVs4&&n._delayInfo.push(_.UV4Kind),e.hasUVs5&&n._delayInfo.push(_.UV5Kind),e.hasUVs6&&n._delayInfo.push(_.UV6Kind),e.hasColors&&n._delayInfo.push(_.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(_.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(_.MatricesWeightsKind),n._delayLoadingFunction=Z.ImportVertexData):Z.ImportVertexData(e,n),t.pushGeometry(n,!0),n},r}(),ei=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i,!0)||this;return i.multiMaterials.push(n),n.subMaterials=new Array,n._storeEffectOnSubMeshes=!0,n}return Object.defineProperty(e.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(t){this._subMaterials=t,this._hookArray(t)},enumerable:!1,configurable:!0}),e.prototype.getChildren=function(){return this.subMaterials},e.prototype._hookArray=function(t){var i=this,n=t.push;t.push=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var u=n.apply(t,s);return i._markAllSubMeshesAsTexturesDirty(),u};var a=t.splice;t.splice=function(s,o){var u=a.apply(t,[s,o]);return i._markAllSubMeshesAsTexturesDirty(),u}},e.prototype.getSubMaterial=function(t){return t<0||t>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[t]},e.prototype.getActiveTextures=function(){var t;return(t=r.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map(function(i){return i?i.getActiveTextures():[]}))},e.prototype.hasTexture=function(t){var i;if(r.prototype.hasTexture.call(this,t))return!0;for(var n=0;n<this.subMaterials.length;n++)if((i=this.subMaterials[n])===null||i===void 0?void 0:i.hasTexture(t))return!0;return!1},e.prototype.getClassName=function(){return"MultiMaterial"},e.prototype.isReadyForSubMesh=function(t,i,n){for(var a=0;a<this.subMaterials.length;a++){var s=this.subMaterials[a];if(s){if(s._storeEffectOnSubMeshes){if(!s.isReadyForSubMesh(t,i,n))return!1;continue}if(!s.isReady(t))return!1}}return!0},e.prototype.clone=function(t,i){for(var n=new e(t,this.getScene()),a=0;a<this.subMaterials.length;a++){var s=null,o=this.subMaterials[a];i&&o?s=o.clone(t+"-"+o.name):s=this.subMaterials[a],n.subMaterials.push(s)}return n},e.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,$&&(t.tags=$.GetTags(this)),t.materials=[];for(var i=0;i<this.subMaterials.length;i++){var n=this.subMaterials[i];n?t.materials.push(n.id):t.materials.push(null)}return t},e.prototype.dispose=function(t,i,n){var a=this.getScene();if(!!a){if(n)for(var o=0;o<this.subMaterials.length;o++){var s=this.subMaterials[o];s&&s.dispose(t,i)}var o=a.multiMaterials.indexOf(this);o>=0&&a.multiMaterials.splice(o,1),r.prototype.dispose.call(this,t,i)}},e.ParseMultiMaterial=function(t,i){var n=new e(t.name,i);n.id=t.id,$&&$.AddTagsTo(n,t.tags);for(var a=0;a<t.materials.length;a++){var s=t.materials[a];s?n.subMaterials.push(i.getLastMaterialByID(s)):n.subMaterials.push(null)}return n},e}(ye);_e.RegisteredTypes["BABYLON.MultiMaterial"]=ei;var Rr=function(){function r(e,t){this.distance=e,this.mesh=t}return r}(),Cr=function(){function r(){this.visibleInstances={},this.batchCache=new Ir,this.instancesBufferSize=32*16*4}return r}(),Ir=function(){function r(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array}return r}(),Dr=function(){function r(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=32*16,this.boundingVectors=[],this.worldMatrices=null}return r}(),Or=function(){function r(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null}return r}(),Ae=function(r){N(e,r);function e(t,i,n,a,s,o){i===void 0&&(i=null),n===void 0&&(n=null),a===void 0&&(a=null),o===void 0&&(o=!0);var u=r.call(this,t,i)||this;if(u._internalMeshDataInfo=new Or,u.delayLoadState=0,u.instances=new Array,u._creationDataStorage=null,u._geometry=null,u._instanceDataStorage=new Cr,u._thinInstanceDataStorage=new Dr,u._effectiveMaterial=null,u._shouldGenerateFlatShading=!1,u._originalBuilderSideOrientation=e.DEFAULTSIDE,u.overrideMaterialSideOrientation=null,i=u.getScene(),a){if(a._geometry&&a._geometry.applyToMesh(u),ii.DeepCopy(a,u,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),u._internalMeshDataInfo._source=a,i.useClonedMeshMap&&(a._internalMeshDataInfo.meshMap||(a._internalMeshDataInfo.meshMap={}),a._internalMeshDataInfo.meshMap[u.uniqueId]=u),u._originalBuilderSideOrientation=a._originalBuilderSideOrientation,u._creationDataStorage=a._creationDataStorage,a._ranges){var l=a._ranges;for(var t in l)!l.hasOwnProperty(t)||!l[t]||u.createAnimationRange(t,l[t].from,l[t].to)}a.metadata&&a.metadata.clone?u.metadata=a.metadata.clone():u.metadata=a.metadata,$&&$.HasTags(a)&&$.AddTagsTo(u,$.GetTags(a,!0)),u.setEnabled(a.isEnabled()),u.parent=a.parent,u.setPivotMatrix(a.getPivotMatrix()),u.id=t+"."+a.id,u.material=a.material;var f;if(!s)for(var h=a.getDescendants(!0),c=0;c<h.length;c++){var p=h[c];p.clone&&p.clone(t+"."+p.name,u)}if(a.morphTargetManager&&(u.morphTargetManager=a.morphTargetManager),i.getPhysicsEngine){var d=i.getPhysicsEngine();if(o&&d){var g=d.getImpostorForPhysicsObject(a);g&&(u.physicsImpostor=g.clone(u))}}for(f=0;f<i.particleSystems.length;f++){var m=i.particleSystems[f];m.emitter===a&&m.clone(m.name,u)}u.refreshBoundingInfo(),u.computeWorldMatrix(!0)}return n!==null&&(u.parent=n),u._instanceDataStorage.hardwareInstancedRendering=u.getEngine().getCaps().instancedArrays,u}return e._GetDefaultSideOrientation=function(t){return t||e.FRONTSIDE},Object.defineProperty(e.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(t){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==t&&(t&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(_.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(_.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new D),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new D),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new D),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new D),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeDraw",{set:function(t){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasThinInstances",{get:function(){var t;return((t=this._thinInstanceDataStorage.instancesCount)!==null&&t!==void 0?t:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(t){this._internalMeshDataInfo._morphTargetManager!==t&&(this._internalMeshDataInfo._morphTargetManager=t,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(t){this._unIndexed!==t&&(this._unIndexed=t,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(t){this._instanceDataStorage.manualUpdate=t},enumerable:!1,configurable:!0}),e.prototype.instantiateHierarchy=function(t,i,n){t===void 0&&(t=null);var a=this.getTotalVertices()>0&&(!i||!i.doNotInstantiate)?this.createInstance("instance of "+(this.name||this.id)):this.clone("Clone of "+(this.name||this.id),t||this.parent,!0);a&&(a.parent=t||this.parent,a.position=this.position.clone(),a.scaling=this.scaling.clone(),this.rotationQuaternion?a.rotationQuaternion=this.rotationQuaternion.clone():a.rotation=this.rotation.clone(),n&&n(this,a));for(var s=0,o=this.getChildTransformNodes(!0);s<o.length;s++){var u=o[s];u.instantiateHierarchy(a,i,n)}return a},e.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(e.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(t){var i=r.prototype.toString.call(this,t);if(i+=", n vertices: "+this.getTotalVertices(),i+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var n=0;n<this.animations.length;n++)i+=", animation[0]: "+this.animations[n].toString(t);if(t)if(this._geometry){var a=this.getIndices(),s=this.getVerticesData(_.PositionKind);s&&a&&(i+=", flat shading: "+(s.length/3===a.length?"YES":"NO"))}else i+=", flat shading: UNKNOWN";return i},e.prototype._unBindEffect=function(){r.prototype._unBindEffect.call(this);for(var t=0,i=this.instances;t<i.length;t++){var n=i[t];n._unBindEffect()}},Object.defineProperty(e.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),e.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},e.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(t,i){return t.distance<i.distance?1:t.distance>i.distance?-1:0})},e.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return L.Warn("You cannot use a mesh as LOD level twice"),this;var n=new Rr(t,i);return this._internalMeshDataInfo._LODLevels.push(n),i&&(i._masterMesh=this),this._sortLODLevels(),this},e.prototype.getLODLevelAtDistance=function(t){for(var i=this._internalMeshDataInfo,n=0;n<i._LODLevels.length;n++){var a=i._LODLevels[n];if(a.distance===t)return a.mesh}return null},e.prototype.removeLODLevel=function(t){for(var i=this._internalMeshDataInfo,n=0;n<i._LODLevels.length;n++)i._LODLevels[n].mesh===t&&(i._LODLevels.splice(n,1),t&&(t._masterMesh=null));return this._sortLODLevels(),this},e.prototype.getLOD=function(t,i){var n=this._internalMeshDataInfo;if(!n._LODLevels||n._LODLevels.length===0)return this;var a;if(i)a=i;else{var s=this.getBoundingInfo();a=s.boundingSphere}var o=a.centerWorld.subtract(t.globalPosition).length();if(n._LODLevels[n._LODLevels.length-1].distance>o)return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,this),this;for(var u=0;u<n._LODLevels.length;u++){var l=n._LODLevels[u];if(l.distance<o){if(l.mesh){if(l.mesh.delayLoadState===4)return l.mesh._checkDelayState(),this;if(l.mesh.delayLoadState===2)return this;l.mesh._preActivate(),l.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,l.mesh),l.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(o,this,this),this},Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},e.prototype.getVerticesData=function(t,i,n){return this._geometry?this._geometry.getVerticesData(t,i,n):null},e.prototype.getVertexBuffer=function(t){return this._geometry?this._geometry.getVertexBuffer(t):null},e.prototype.isVerticesDataPresent=function(t){return this._geometry?this._geometry.isVerticesDataPresent(t):this._delayInfo?this._delayInfo.indexOf(t)!==-1:!1},e.prototype.isVertexBufferUpdatable=function(t){return this._geometry?this._geometry.isVertexBufferUpdatable(t):this._delayInfo?this._delayInfo.indexOf(t)!==-1:!1},e.prototype.getVerticesDataKinds=function(){if(!this._geometry){var t=new Array;return this._delayInfo&&this._delayInfo.forEach(function(i){t.push(i)}),t}return this._geometry.getVerticesDataKinds()},e.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},e.prototype.getIndices=function(t,i){return this._geometry?this._geometry.getIndices(t,i):[]},Object.defineProperty(e.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),e.prototype.isReady=function(t,i){var n,a,s,o,u,l;if(t===void 0&&(t=!1),i===void 0&&(i=!1),this.delayLoadState===2||!r.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||this.subMeshes.length===0||!t)return!0;var f=this.getEngine(),h=this.getScene(),c=i||f.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var p=this.material||h.defaultMaterial;if(p){if(p._storeEffectOnSubMeshes)for(var d=0,g=this.subMeshes;d<g.length;d++){var m=g[d],E=m.getMaterial();if(E){if(E._storeEffectOnSubMeshes){if(!E.isReadyForSubMesh(this,m,c))return!1}else if(!E.isReady(this,c))return!1}}else if(!p.isReady(this,c))return!1}for(var v=0,A=this.lightSources;v<A.length;v++){var M=A[v],C=M.getShadowGenerator();if(C&&(!((n=C.getShadowMap())===null||n===void 0?void 0:n.renderList)||((a=C.getShadowMap())===null||a===void 0?void 0:a.renderList)&&((o=(s=C.getShadowMap())===null||s===void 0?void 0:s.renderList)===null||o===void 0?void 0:o.indexOf(this))!==-1))for(var P=0,S=this.subMeshes;P<S.length;P++){var m=S[P];if(!C.isReady(m,c,(l=(u=m.getMaterial())===null||u===void 0?void 0:u.needAlphaBlendingForMesh(this))!==null&&l!==void 0?l:!1))return!1}}for(var x=0,z=this._internalMeshDataInfo._LODLevels;x<z.length;x++){var X=z[x];if(X.mesh&&!X.mesh.isReady(c))return!1}return!0},Object.defineProperty(e.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),e.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},e.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(e.prototype,"overridenInstanceCount",{set:function(t){this._instanceDataStorage.overridenInstanceCount=t},enumerable:!1,configurable:!0}),e.prototype._preActivate=function(){var t=this._internalMeshDataInfo,i=this.getScene().getRenderId();return t._preActivateId===i?this:(t._preActivateId=i,this._instanceDataStorage.visibleInstances=null,this)},e.prototype._preActivateForIntermediateRendering=function(t){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=t),this},e.prototype._registerInstanceForRenderId=function(t,i){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:i,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[i]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=i,this._instanceDataStorage.visibleInstances[i]=new Array),this._instanceDataStorage.visibleInstances[i].push(t),this},e.prototype._afterComputeWorldMatrix=function(){r.prototype._afterComputeWorldMatrix.call(this),!!this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},e.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},e.prototype.refreshBoundingInfo=function(t){if(t===void 0&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var i=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(t),i),this},e.prototype._createGlobalSubMesh=function(t){var i=this.getTotalVertices();if(!i||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var n=this.getIndices();if(!n)return null;var a=n.length,s=!1;if(t)s=!0;else for(var o=0,u=this.subMeshes;o<u.length;o++){var l=u[o];if(l.indexStart+l.indexCount>a){s=!0;break}if(l.verticesStart+l.verticesCount>i){s=!0;break}}if(!s)return this.subMeshes[0]}return this.releaseSubMeshes(),new Ke(0,0,i,0,this.getTotalIndices(),this)},e.prototype.subdivide=function(t){if(!(t<1)){for(var i=this.getTotalIndices(),n=i/t|0,a=0;n%3!==0;)n++;this.releaseSubMeshes();for(var s=0;s<t&&!(a>=i);s++)Ke.CreateFromIndices(0,a,s===t-1?i-a:n,this),a+=n;this.synchronizeInstances()}},e.prototype.setVerticesData=function(t,i,n,a){if(n===void 0&&(n=!1),this._geometry)this._geometry.setVerticesData(t,i,n,a);else{var s=new Z;s.set(i,t);var o=this.getScene();new He(He.RandomId(),o,s,n,this)}return this},e.prototype.removeVerticesData=function(t){!this._geometry||this._geometry.removeVerticesData(t)},e.prototype.markVerticesDataAsUpdatable=function(t,i){i===void 0&&(i=!0);var n=this.getVertexBuffer(t);!n||n.isUpdatable()===i||this.setVerticesData(t,this.getVerticesData(t),i)},e.prototype.setVerticesBuffer=function(t){return this._geometry||(this._geometry=He.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(t),this},e.prototype.updateVerticesData=function(t,i,n,a){return this._geometry?(a?(this.makeGeometryUnique(),this.updateVerticesData(t,i,n,!1)):this._geometry.updateVerticesData(t,i,n),this):this},e.prototype.updateMeshPositions=function(t,i){i===void 0&&(i=!0);var n=this.getVerticesData(_.PositionKind);if(!n)return this;if(t(n),this.updateVerticesData(_.PositionKind,n,!1,!1),i){var a=this.getIndices(),s=this.getVerticesData(_.NormalKind);if(!s)return this;Z.ComputeNormals(n,a,s),this.updateVerticesData(_.NormalKind,s,!1,!1)}return this},e.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var t=this._geometry,i=this._geometry.copy(He.RandomId());return t.releaseForMesh(this,!0),i.applyToMesh(this),this},e.prototype.setIndices=function(t,i,n){if(i===void 0&&(i=null),n===void 0&&(n=!1),this._geometry)this._geometry.setIndices(t,i,n);else{var a=new Z;a.indices=t;var s=this.getScene();new He(He.RandomId(),s,a,n,this)}return this},e.prototype.updateIndices=function(t,i,n){return n===void 0&&(n=!1),this._geometry?(this._geometry.updateIndices(t,i,n),this):this},e.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},e.prototype._bind=function(t,i,n){if(!this._geometry)return this;var a=this.getScene().getEngine(),s;if(this._unIndexed)s=null;else switch(n){case ye.PointFillMode:s=null;break;case ye.WireFrameFillMode:s=t._getLinesIndexBuffer(this.getIndices(),a);break;default:case ye.TriangleFillMode:s=this._geometry.getIndexBuffer();break}return this._geometry._bind(i,s),this},e.prototype._draw=function(t,i,n){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var a=this.getScene(),s=a.getEngine();return this._unIndexed||i==ye.PointFillMode?s.drawArraysType(i,t.verticesStart,t.verticesCount,n):i==ye.WireFrameFillMode?s.drawElementsType(i,0,t._linesIndexCount,n):s.drawElementsType(i,t.indexStart,t.indexCount,n),this},e.prototype.registerBeforeRender=function(t){return this.onBeforeRenderObservable.add(t),this},e.prototype.unregisterBeforeRender=function(t){return this.onBeforeRenderObservable.removeCallback(t),this},e.prototype.registerAfterRender=function(t){return this.onAfterRenderObservable.add(t),this},e.prototype.unregisterAfterRender=function(t){return this.onAfterRenderObservable.removeCallback(t),this},e.prototype._getInstancesRenderList=function(t,i){if(i===void 0&&(i=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var n=this.getScene(),a=n._isInIntermediateRendering(),s=a?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,o=this._instanceDataStorage.batchCache;if(o.mustReturn=!1,o.renderSelf[t]=i||!s&&this.isEnabled()&&this.isVisible,o.visibleInstances[t]=null,this._instanceDataStorage.visibleInstances&&!i){var u=this._instanceDataStorage.visibleInstances,l=n.getRenderId(),f=a?u.intermediateDefaultRenderId:u.defaultRenderId;o.visibleInstances[t]=u[l],!o.visibleInstances[t]&&f&&(o.visibleInstances[t]=u[f])}return o.hardwareInstancedRendering[t]=!i&&this._instanceDataStorage.hardwareInstancedRendering&&o.visibleInstances[t]!==null&&o.visibleInstances[t]!==void 0,this._instanceDataStorage.previousBatch=o,o},e.prototype._renderWithInstances=function(t,i,n,a,s){var o=n.visibleInstances[t._id];if(!o)return this;for(var u=this._instanceDataStorage,l=u.instancesBufferSize,f=u.instancesBuffer,h=o.length+1,c=h*16*4;u.instancesBufferSize<c;)u.instancesBufferSize*=2;(!u.instancesData||l!=u.instancesBufferSize)&&(u.instancesData=new Float32Array(u.instancesBufferSize/4));var p=0,d=0,g=n.renderSelf[t._id],m=!f||l!==u.instancesBufferSize;if(!this._instanceDataStorage.manualUpdate&&(!u.isFrozen||m)){var E=this._effectiveMesh.getWorldMatrix();if(g&&(E.copyToArray(u.instancesData,p),p+=16,d++),o)for(var v=0;v<o.length;v++){var A=o[v];A.getWorldMatrix().copyToArray(u.instancesData,p),p+=16,d++}}else d=(g?1:0)+o.length;return m?(f&&f.dispose(),f=new Qt(s,u.instancesData,!0,16,!1,!0),u.instancesBuffer=f,this.setVerticesBuffer(f.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(f.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(f.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(f.createVertexBuffer("world3",12,4))):this._instanceDataStorage.isFrozen||f.updateDirectly(u.instancesData,0,d),this._processInstancedBuffers(o,g),this.getScene()._activeIndices.addCount(t.indexCount*d,!1),this._bind(t,a,i),this._draw(t,i,d),s.unbindInstanceAttributes(),this},e.prototype._renderWithThinInstances=function(t,i,n,a){var s,o,u=(o=(s=this._thinInstanceDataStorage)===null||s===void 0?void 0:s.instancesCount)!==null&&o!==void 0?o:0;this.getScene()._activeIndices.addCount(t.indexCount*u,!1),this._bind(t,n,i),this._draw(t,i,u),a.unbindInstanceAttributes()},e.prototype._processInstancedBuffers=function(t,i){},e.prototype._processRendering=function(t,i,n,a,s,o,u,l){var f=this.getScene(),h=f.getEngine();if(o&&i.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(i,a,n,h),this;if(o)this._renderWithInstances(i,a,s,n,h);else{var c=0;s.renderSelf[i._id]&&(u&&u(!1,t._effectiveMesh.getWorldMatrix(),l),c++,this._draw(i,a,this._instanceDataStorage.overridenInstanceCount));var p=s.visibleInstances[i._id];if(p){var d=p.length;c+=d;for(var g=0;g<d;g++){var m=p[g],E=m.getWorldMatrix();u&&u(!0,E,l),this._draw(i,a)}}f._activeIndices.addCount(i.indexCount*c,!1)}return this},e.prototype._rebuild=function(){this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),r.prototype._rebuild.call(this)},e.prototype._freeze=function(){if(!!this.subMeshes){for(var t=0;t<this.subMeshes.length;t++)this._getInstancesRenderList(t);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},e.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},e.prototype.render=function(t,i,n){var a=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var s=this._getInstancesRenderList(t._id,!!n);if(s.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var o=a.getEngine(),u=s.hardwareInstancedRendering[t._id]||t.getRenderingMesh().hasThinInstances,l=this._instanceDataStorage,f=t.getMaterial();if(!f)return this;if(!l.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==f){if(f._storeEffectOnSubMeshes){if(!f.isReadyForSubMesh(this,t,u))return this}else if(!f.isReady(this,u))return this;this._effectiveMaterial=f}i&&o.setAlphaMode(this._effectiveMaterial.alphaMode);var h;this._effectiveMaterial._storeEffectOnSubMeshes?h=t.effect:h=this._effectiveMaterial.getEffect();for(var c=0,p=a._beforeRenderingMeshStage;c<p.length;c++){var d=p[c];d.action(this,t,s,h)}if(!h)return this;var g=n||this._effectiveMesh,m;if(!l.isFrozen&&(this._effectiveMaterial.backFaceCulling||this.overrideMaterialSideOrientation!==null)){var E=g._getWorldMatrixDeterminant();m=this.overrideMaterialSideOrientation,m==null&&(m=this._effectiveMaterial.sideOrientation),E<0&&(m=m===ye.ClockWiseSideOrientation?ye.CounterClockWiseSideOrientation:ye.ClockWiseSideOrientation),l.sideOrientation=m}else m=l.sideOrientation;var v=this._effectiveMaterial._preBind(h,m);this._effectiveMaterial.forceDepthWrite&&o.setDepthWrite(!0);var A=a.forcePointsCloud?ye.PointFillMode:a.forceWireframe?ye.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),u||this._bind(t,h,A);var M=g.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(M,this,t):this._effectiveMaterial.bind(M,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(o.setState(!0,this._effectiveMaterial.zOffset,!1,!v),this._processRendering(this,t,h,A,s,u,this._onBeforeDraw,this._effectiveMaterial),o.setState(!0,this._effectiveMaterial.zOffset,!1,v)),this._processRendering(this,t,h,A,s,u,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var C=0,P=a._afterRenderingMeshStage;C<P.length;C++){var d=P[C];d.action(this,t,s,h)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),this},e.prototype._onBeforeDraw=function(t,i,n){t&&n&&n.bindOnlyWorldMatrix(i)},e.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(_.MatricesWeightsKind)&&(this.isVerticesDataPresent(_.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},e.prototype.normalizeSkinFourWeights=function(){for(var t=this.getVerticesData(_.MatricesWeightsKind),i=t.length,n=0;n<i;n+=4){var a=t[n]+t[n+1]+t[n+2]+t[n+3];if(a===0)t[n]=1;else{var s=1/a;t[n]*=s,t[n+1]*=s,t[n+2]*=s,t[n+3]*=s}}this.setVerticesData(_.MatricesWeightsKind,t)},e.prototype.normalizeSkinWeightsAndExtra=function(){for(var t=this.getVerticesData(_.MatricesWeightsExtraKind),i=this.getVerticesData(_.MatricesWeightsKind),n=i.length,a=0;a<n;a+=4){var s=i[a]+i[a+1]+i[a+2]+i[a+3];if(s+=t[a]+t[a+1]+t[a+2]+t[a+3],s===0)i[a]=1;else{var o=1/s;i[a]*=o,i[a+1]*=o,i[a+2]*=o,i[a+3]*=o,t[a]*=o,t[a+1]*=o,t[a+2]*=o,t[a+3]*=o}}this.setVerticesData(_.MatricesWeightsKind,i),this.setVerticesData(_.MatricesWeightsKind,t)},e.prototype.validateSkinning=function(){var t=this.getVerticesData(_.MatricesWeightsExtraKind),i=this.getVerticesData(_.MatricesWeightsKind);if(i===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var n=i.length,a=0,s=0,o=0,u=0,l=t===null?4:8,f=new Array,h=0;h<=l;h++)f[h]=0;for(var c=.001,h=0;h<n;h+=4){for(var p=i[h],d=p,g=d===0?0:1,m=1;m<l;m++){var E=m<4?i[h+m]:t[h+m-4];E>p&&a++,E!==0&&g++,d+=E,p=E}if(f[g]++,g>o&&(o=g),d===0)s++;else{var v=1/d,A=0;for(m=0;m<l;m++)m<4?A+=Math.abs(i[h+m]-i[h+m]*v):A+=Math.abs(t[h+m-4]-t[h+m-4]*v);A>c&&u++}}for(var M=this.skeleton.bones.length,C=this.getVerticesData(_.MatricesIndicesKind),P=this.getVerticesData(_.MatricesIndicesExtraKind),S=0,h=0;h<n;h+=4)for(var m=0;m<l;m++){var x=m<4?C[h+m]:P[h+m-4];(x>=M||x<0)&&S++}var z="Number of Weights = "+n/4+`
Maximum influences = `+o+`
Missing Weights = `+s+`
Not Sorted = `+a+`
Not Normalized = `+u+`
WeightCounts = [`+f+`]
Number of bones = `+M+`
Bad Bone Indices = `+S;return{skinned:!0,valid:s===0&&u===0&&S===0,report:z}},e.prototype._checkDelayState=function(){var t=this.getScene();return this._geometry?this._geometry.load(t):this.delayLoadState===4&&(this.delayLoadState=2,this._queueLoad(t)),this},e.prototype._queueLoad=function(t){var i=this;t._addPendingData(this);var n=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return te.LoadFile(this.delayLoadingFile,function(a){a instanceof ArrayBuffer?i._delayLoadingFunction(a,i):i._delayLoadingFunction(JSON.parse(a),i),i.instances.forEach(function(s){s.refreshBoundingInfo(),s._syncSubMeshes()}),i.delayLoadState=1,t._removePendingData(i)},function(){},t.offlineProvider,n),this},e.prototype.isInFrustum=function(t){return this.delayLoadState===2||!r.prototype.isInFrustum.call(this,t)?!1:(this._checkDelayState(),!0)},e.prototype.setMaterialByID=function(t){var i=this.getScene().materials,n;for(n=i.length-1;n>-1;n--)if(i[n].id===t)return this.material=i[n],this;var a=this.getScene().multiMaterials;for(n=a.length-1;n>-1;n--)if(a[n].id===t)return this.material=a[n],this;return this},e.prototype.getAnimatables=function(){var t=new Array;return this.material&&t.push(this.material),this.skeleton&&t.push(this.skeleton),t},e.prototype.bakeTransformIntoVertices=function(t){if(!this.isVerticesDataPresent(_.PositionKind))return this;var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var n=this.getVerticesData(_.PositionKind),a=new Array,s;for(s=0;s<n.length;s+=3)y.TransformCoordinates(y.FromArray(n,s),t).toArray(a,s);if(this.setVerticesData(_.PositionKind,a,this.getVertexBuffer(_.PositionKind).isUpdatable()),this.isVerticesDataPresent(_.NormalKind)){for(n=this.getVerticesData(_.NormalKind),a=[],s=0;s<n.length;s+=3)y.TransformNormal(y.FromArray(n,s),t).normalize().toArray(a,s);this.setVerticesData(_.NormalKind,a,this.getVertexBuffer(_.NormalKind).isUpdatable())}return t.m[0]*t.m[5]*t.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i,this},e.prototype.bakeCurrentTransformIntoVertices=function(t){return t===void 0&&(t=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(t),this},Object.defineProperty(e.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),e.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},e.prototype._generatePointsArray=function(){return this._geometry?this._geometry._generatePointsArray():!1},e.prototype.clone=function(t,i,n,a){return t===void 0&&(t=""),i===void 0&&(i=null),a===void 0&&(a=!0),new e(t,this.getScene(),i,this,n,a)},e.prototype.dispose=function(t,i){i===void 0&&(i=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var n=this._internalMeshDataInfo;if(n._onBeforeDrawObservable&&n._onBeforeDrawObservable.clear(),n._onBeforeBindObservable&&n._onBeforeBindObservable.clear(),n._onBeforeRenderObservable&&n._onBeforeRenderObservable.clear(),n._onAfterRenderObservable&&n._onAfterRenderObservable.clear(),this._scene.useClonedMeshMap){if(n.meshMap)for(var a in n.meshMap){var s=n.meshMap[a];s&&(s._internalMeshDataInfo._source=null,n.meshMap[a]=void 0)}n._source&&n._source._internalMeshDataInfo.meshMap&&(n._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var o=this.getScene().meshes,u=0,l=o;u<l.length;u++){var f=l[u],s=f;s._internalMeshDataInfo&&s._internalMeshDataInfo._source&&s._internalMeshDataInfo._source===this&&(s._internalMeshDataInfo._source=null)}n._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),r.prototype.dispose.call(this,t,i)},e.prototype._disposeInstanceSpecificData=function(){},e.prototype._disposeThinInstanceSpecificData=function(){},e.prototype.applyDisplacementMap=function(t,i,n,a,s,o,u){var l=this;u===void 0&&(u=!1);var f=this.getScene(),h=function(c){var p=c.width,d=c.height,g=It.CreateCanvas(p,d),m=g.getContext("2d");m.drawImage(c,0,0);var E=m.getImageData(0,0,p,d).data;l.applyDisplacementMapFromBuffer(E,p,d,i,n,s,o,u),a&&a(l)};return te.LoadImage(t,h,function(){},f.offlineProvider),this},e.prototype.applyDisplacementMapFromBuffer=function(t,i,n,a,s,o,u,l){if(l===void 0&&(l=!1),!this.isVerticesDataPresent(_.PositionKind)||!this.isVerticesDataPresent(_.NormalKind)||!this.isVerticesDataPresent(_.UVKind))return L.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var f=this.getVerticesData(_.PositionKind,!0,!0),h=this.getVerticesData(_.NormalKind),c=this.getVerticesData(_.UVKind),p=y.Zero(),d=y.Zero(),g=ne.Zero();o=o||ne.Zero(),u=u||new ne(1,1);for(var m=0;m<f.length;m+=3){y.FromArrayToRef(f,m,p),y.FromArrayToRef(h,m,d),ne.FromArrayToRef(c,m/3*2,g);var E=Math.abs(g.x*u.x+o.x%1)*(i-1)%i|0,v=Math.abs(g.y*u.y+o.y%1)*(n-1)%n|0,A=(E+v*i)*4,M=t[A]/255,C=t[A+1]/255,P=t[A+2]/255,S=M*.3+C*.59+P*.11;d.normalize(),d.scaleInPlace(a+(s-a)*S),p=p.add(d),p.toArray(f,m)}return Z.ComputeNormals(f,this.getIndices(),h),l?(this.setVerticesData(_.PositionKind,f),this.setVerticesData(_.NormalKind,h)):(this.updateVerticesData(_.PositionKind,f),this.updateVerticesData(_.NormalKind,h)),this},e.prototype.convertToFlatShadedMesh=function(){var t=this.getVerticesDataKinds(),i={},n={},a={},s=!1,o,u;for(o=0;o<t.length;o++){u=t[o];var l=this.getVertexBuffer(u);if(u===_.NormalKind){s=l.isUpdatable(),t.splice(o,1),o--;continue}i[u]=l,n[u]=i[u].getData(),a[u]=[]}var f=this.subMeshes.slice(0),h=this.getIndices(),c=this.getTotalIndices(),p;for(p=0;p<c;p++){var d=h[p];for(o=0;o<t.length;o++){u=t[o];for(var g=i[u].getStrideSize(),m=0;m<g;m++)a[u].push(n[u][d*g+m])}}var E=[],v=a[_.PositionKind];for(p=0;p<c;p+=3){h[p]=p,h[p+1]=p+1,h[p+2]=p+2;for(var A=y.FromArray(v,p*3),M=y.FromArray(v,(p+1)*3),C=y.FromArray(v,(p+2)*3),P=A.subtract(M),S=C.subtract(M),x=y.Normalize(y.Cross(P,S)),z=0;z<3;z++)E.push(x.x),E.push(x.y),E.push(x.z)}for(this.setIndices(h),this.setVerticesData(_.NormalKind,E,s),o=0;o<t.length;o++)u=t[o],this.setVerticesData(u,a[u],i[u].isUpdatable());this.releaseSubMeshes();for(var X=0;X<f.length;X++){var V=f[X];Ke.AddToMesh(V.materialIndex,V.indexStart,V.indexCount,V.indexStart,V.indexCount,this)}return this.synchronizeInstances(),this},e.prototype.convertToUnIndexedMesh=function(){var t=this.getVerticesDataKinds(),i={},n={},a={},s,o;for(s=0;s<t.length;s++){o=t[s];var u=this.getVertexBuffer(o);i[o]=u,n[o]=i[o].getData(),a[o]=[]}var l=this.subMeshes.slice(0),f=this.getIndices(),h=this.getTotalIndices(),c;for(c=0;c<h;c++){var p=f[c];for(s=0;s<t.length;s++){o=t[s];for(var d=i[o].getStrideSize(),g=0;g<d;g++)a[o].push(n[o][p*d+g])}}for(c=0;c<h;c+=3)f[c]=c,f[c+1]=c+1,f[c+2]=c+2;for(this.setIndices(f),s=0;s<t.length;s++)o=t[s],this.setVerticesData(o,a[o],i[o].isUpdatable());this.releaseSubMeshes();for(var m=0;m<l.length;m++){var E=l[m];Ke.AddToMesh(E.materialIndex,E.indexStart,E.indexCount,E.indexStart,E.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},e.prototype.flipFaces=function(t){t===void 0&&(t=!1);var i=Z.ExtractFromMesh(this),n;if(t&&this.isVerticesDataPresent(_.NormalKind)&&i.normals)for(n=0;n<i.normals.length;n++)i.normals[n]*=-1;if(i.indices){var a;for(n=0;n<i.indices.length;n+=3)a=i.indices[n+1],i.indices[n+1]=i.indices[n+2],i.indices[n+2]=a}return i.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind)),this},e.prototype.increaseVertices=function(t){var i=Z.ExtractFromMesh(this),n=i.uvs,a=i.indices,s=i.positions,o=i.normals;if(!a||!s||!o||!n)L.Warn("VertexData contains null entries");else{for(var u=t+1,l=new Array,f=0;f<u+1;f++)l[f]=new Array;for(var h,c,p=new y(0,0,0),d=new y(0,0,0),g=new ne(0,0),m=new Array,E=new Array,v=new Array,A,M=s.length,C=n.length,f=0;f<a.length;f+=3){E[0]=a[f],E[1]=a[f+1],E[2]=a[f+2];for(var P=0;P<3;P++)if(h=E[P],c=E[(P+1)%3],v[h]===void 0&&v[c]===void 0?(v[h]=new Array,v[c]=new Array):(v[h]===void 0&&(v[h]=new Array),v[c]===void 0&&(v[c]=new Array)),v[h][c]===void 0&&v[c][h]===void 0){v[h][c]=[],p.x=(s[3*c]-s[3*h])/u,p.y=(s[3*c+1]-s[3*h+1])/u,p.z=(s[3*c+2]-s[3*h+2])/u,d.x=(o[3*c]-o[3*h])/u,d.y=(o[3*c+1]-o[3*h+1])/u,d.z=(o[3*c+2]-o[3*h+2])/u,g.x=(n[2*c]-n[2*h])/u,g.y=(n[2*c+1]-n[2*h+1])/u,v[h][c].push(h);for(var S=1;S<u;S++)v[h][c].push(s.length/3),s[M]=s[3*h]+S*p.x,o[M++]=o[3*h]+S*d.x,s[M]=s[3*h+1]+S*p.y,o[M++]=o[3*h+1]+S*d.y,s[M]=s[3*h+2]+S*p.z,o[M++]=o[3*h+2]+S*d.z,n[C++]=n[2*h]+S*g.x,n[C++]=n[2*h+1]+S*g.y;v[h][c].push(c),v[c][h]=new Array,A=v[h][c].length;for(var x=0;x<A;x++)v[c][h][x]=v[h][c][A-1-x]}l[0][0]=a[f],l[1][0]=v[a[f]][a[f+1]][1],l[1][1]=v[a[f]][a[f+2]][1];for(var S=2;S<u;S++){l[S][0]=v[a[f]][a[f+1]][S],l[S][S]=v[a[f]][a[f+2]][S],p.x=(s[3*l[S][S]]-s[3*l[S][0]])/S,p.y=(s[3*l[S][S]+1]-s[3*l[S][0]+1])/S,p.z=(s[3*l[S][S]+2]-s[3*l[S][0]+2])/S,d.x=(o[3*l[S][S]]-o[3*l[S][0]])/S,d.y=(o[3*l[S][S]+1]-o[3*l[S][0]+1])/S,d.z=(o[3*l[S][S]+2]-o[3*l[S][0]+2])/S,g.x=(n[2*l[S][S]]-n[2*l[S][0]])/S,g.y=(n[2*l[S][S]+1]-n[2*l[S][0]+1])/S;for(var P=1;P<S;P++)l[S][P]=s.length/3,s[M]=s[3*l[S][0]]+P*p.x,o[M++]=o[3*l[S][0]]+P*d.x,s[M]=s[3*l[S][0]+1]+P*p.y,o[M++]=o[3*l[S][0]+1]+P*d.y,s[M]=s[3*l[S][0]+2]+P*p.z,o[M++]=o[3*l[S][0]+2]+P*d.z,n[C++]=n[2*l[S][0]]+P*g.x,n[C++]=n[2*l[S][0]+1]+P*g.y}l[u]=v[a[f+1]][a[f+2]],m.push(l[0][0],l[1][0],l[1][1]);for(var S=1;S<u;S++){for(var P=0;P<S;P++)m.push(l[S][P],l[S+1][P],l[S+1][P+1]),m.push(l[S][P],l[S+1][P+1],l[S][P+1]);m.push(l[S][P],l[S+1][P],l[S+1][P+1])}}i.indices=m,i.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind))}},e.prototype.forceSharedVertices=function(){var t=Z.ExtractFromMesh(this),i=t.uvs,n=t.indices,a=t.positions,s=t.colors;if(n===void 0||a===void 0||n===null||a===null)L.Warn("VertexData contains empty entries");else{for(var o=new Array,u=new Array,l=new Array,f=new Array,h=new Array,c=0,p={},d,g,m=0;m<n.length;m+=3){g=[n[m],n[m+1],n[m+2]],h=new Array;for(var E=0;E<3;E++){h[E]="";for(var v=0;v<3;v++)Math.abs(a[3*g[E]+v])<1e-8&&(a[3*g[E]+v]=0),h[E]+=a[3*g[E]+v]+"|"}if(!(h[0]==h[1]||h[0]==h[2]||h[1]==h[2]))for(var E=0;E<3;E++){if(d=p[h[E]],d===void 0){p[h[E]]=c,d=c++;for(var v=0;v<3;v++)o.push(a[3*g[E]+v]);if(s!=null)for(var v=0;v<4;v++)f.push(s[4*g[E]+v]);if(i!=null)for(var v=0;v<2;v++)l.push(i[2*g[E]+v])}u.push(d)}}var A=new Array;Z.ComputeNormals(o,u,A),t.positions=o,t.indices=u,t.normals=A,i!=null&&(t.uvs=l),s!=null&&(t.colors=f),t.applyToMesh(this,this.isVertexBufferUpdatable(_.PositionKind))}},e._instancedMeshFactory=function(t,i){throw O.WarnImport("InstancedMesh")},e._PhysicsImpostorParser=function(t,i,n){throw O.WarnImport("PhysicsImpostor")},e.prototype.createInstance=function(t){var i=this.geometry;if(i&&i.meshes.length>1)for(var n=i.meshes.slice(0),a=0,s=n;a<s.length;a++){var o=s[a];o!==this&&o.makeGeometryUnique()}return e._instancedMeshFactory(t,this)},e.prototype.synchronizeInstances=function(){this._geometry&&this._geometry.meshes.length!==1&&this.instances.length&&this.makeGeometryUnique();for(var t=0;t<this.instances.length;t++){var i=this.instances[t];i._syncSubMeshes()}return this},e.prototype.optimizeIndices=function(t){var i=this,n=this.getIndices(),a=this.getVerticesData(_.PositionKind);if(!a||!n)return this;for(var s=new Array,o=0;o<a.length;o=o+3)s.push(y.FromArray(a,o));var u=new Array;return ar.SyncAsyncForLoop(s.length,40,function(l){for(var f=s.length-1-l,h=s[f],c=0;c<f;++c){var p=s[c];if(h.equals(p)){u[f]=c;break}}},function(){for(var l=0;l<n.length;++l)n[l]=u[n[l]]||n[l];var f=i.subMeshes.slice(0);i.setIndices(n),i.subMeshes=f,t&&t(i)}),this},e.prototype.serialize=function(t){t.name=this.name,t.id=this.id,t.uniqueId=this.uniqueId,t.type=this.getClassName(),$&&$.HasTags(this)&&(t.tags=$.GetTags(this)),t.position=this.position.asArray(),this.rotationQuaternion?t.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(t.rotation=this.rotation.asArray()),t.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?t.pivotMatrix=this.getPivotMatrix().asArray():t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(!1),t.isVisible=this.isVisible,t.infiniteDistance=this.infiniteDistance,t.pickable=this.isPickable,t.receiveShadows=this.receiveShadows,t.billboardMode=this.billboardMode,t.visibility=this.visibility,t.checkCollisions=this.checkCollisions,t.isBlocker=this.isBlocker,t.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(t.parentId=this.parent.id),t.isUnIndexed=this.isUnIndexed;var i=this._geometry;if(i){var n=i.id;t.geometryId=n,t.subMeshes=[];for(var a=0;a<this.subMeshes.length;a++){var s=this.subMeshes[a];t.subMeshes.push({materialIndex:s.materialIndex,verticesStart:s.verticesStart,verticesCount:s.verticesCount,indexStart:s.indexStart,indexCount:s.indexCount})}}if(this.material?this.material.doNotSerialize||(t.materialId=this.material.id):this.material=null,this.morphTargetManager&&(t.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(t.skeletonId=this.skeleton.id,t.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(mi.NAME_PHYSICSENGINE)){var o=this.getPhysicsImpostor();o&&(t.physicsMass=o.getParam("mass"),t.physicsFriction=o.getParam("friction"),t.physicsRestitution=o.getParam("mass"),t.physicsImpostor=o.type)}this.metadata&&(t.metadata=this.metadata),t.instances=[];for(var u=0;u<this.instances.length;u++){var l=this.instances[u];if(!l.doNotSerialize){var f={name:l.name,id:l.id,isEnabled:l.isEnabled(!1),isVisible:l.isVisible,isPickable:l.isPickable,checkCollisions:l.checkCollisions,position:l.position.asArray(),scaling:l.scaling.asArray()};if(l.parent&&(f.parentId=l.parent.id),l.rotationQuaternion?f.rotationQuaternion=l.rotationQuaternion.asArray():l.rotation&&(f.rotation=l.rotation.asArray()),this.getScene()._getComponent(mi.NAME_PHYSICSENGINE)){var o=l.getPhysicsImpostor();o&&(f.physicsMass=o.getParam("mass"),f.physicsFriction=o.getParam("friction"),f.physicsRestitution=o.getParam("mass"),f.physicsImpostor=o.type)}l.metadata&&(f.metadata=l.metadata),t.instances.push(f),H.AppendSerializedAnimations(l,f),f.ranges=l.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(t.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:te.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var h={data:{},sizes:{},strides:{}};for(var c in this._userThinInstanceBuffersStorage.data)h.data[c]=te.SliceToArray(this._userThinInstanceBuffersStorage.data[c]),h.sizes[c]=this._userThinInstanceBuffersStorage.sizes[c],h.strides[c]=this._userThinInstanceBuffersStorage.strides[c];t.thinInstances.userThinInstance=h}H.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t.layerMask=this.layerMask,t.alphaIndex=this.alphaIndex,t.hasVertexAlpha=this.hasVertexAlpha,t.overlayAlpha=this.overlayAlpha,t.overlayColor=this.overlayColor.asArray(),t.renderOverlay=this.renderOverlay,t.applyFog=this.applyFog,this.actionManager&&(t.actions=this.actionManager.serialize(this.name))},e.prototype._syncGeometryWithMorphTargetManager=function(){if(!!this.geometry){this._markSubMeshesAsAttributesDirty();var t=this._internalMeshDataInfo._morphTargetManager;if(t&&t.vertexCount){if(t.vertexCount!==this.getTotalVertices()){L.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}for(var i=0;i<t.numInfluencers;i++){var n=t.getActiveTarget(i),a=n.getPositions();if(!a){L.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(_.PositionKind+i,a,!1,3);var s=n.getNormals();s&&this.geometry.setVerticesData(_.NormalKind+i,s,!1,3);var o=n.getTangents();o&&this.geometry.setVerticesData(_.TangentKind+i,o,!1,3);var u=n.getUVs();u&&this.geometry.setVerticesData(_.UVKind+"_"+i,u,!1,2)}}else for(var i=0;this.geometry.isVerticesDataPresent(_.PositionKind+i);)this.geometry.removeVerticesData(_.PositionKind+i),this.geometry.isVerticesDataPresent(_.NormalKind+i)&&this.geometry.removeVerticesData(_.NormalKind+i),this.geometry.isVerticesDataPresent(_.TangentKind+i)&&this.geometry.removeVerticesData(_.TangentKind+i),this.geometry.isVerticesDataPresent(_.UVKind+i)&&this.geometry.removeVerticesData(_.UVKind+"_"+i),i++}},e.Parse=function(t,i,n){var a;if(t.type&&t.type==="GroundMesh"?a=e._GroundMeshParser(t,i):a=new e(t.name,i),a.id=t.id,$&&$.AddTagsTo(a,t.tags),a.position=y.FromArray(t.position),t.metadata!==void 0&&(a.metadata=t.metadata),t.rotationQuaternion?a.rotationQuaternion=W.FromArray(t.rotationQuaternion):t.rotation&&(a.rotation=y.FromArray(t.rotation)),a.scaling=y.FromArray(t.scaling),t.localMatrix?a.setPreTransformMatrix(R.FromArray(t.localMatrix)):t.pivotMatrix&&a.setPivotMatrix(R.FromArray(t.pivotMatrix)),a.setEnabled(t.isEnabled),a.isVisible=t.isVisible,a.infiniteDistance=t.infiniteDistance,a.showBoundingBox=t.showBoundingBox,a.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,t.applyFog!==void 0&&(a.applyFog=t.applyFog),t.pickable!==void 0&&(a.isPickable=t.pickable),t.alphaIndex!==void 0&&(a.alphaIndex=t.alphaIndex),a.receiveShadows=t.receiveShadows,a.billboardMode=t.billboardMode,t.visibility!==void 0&&(a.visibility=t.visibility),a.checkCollisions=t.checkCollisions,a.overrideMaterialSideOrientation=t.overrideMaterialSideOrientation,t.isBlocker!==void 0&&(a.isBlocker=t.isBlocker),a._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(a._waitingData.freezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(a._waitingParentId=t.parentId),t.actions!==void 0&&(a._waitingData.actions=t.actions),t.overlayAlpha!==void 0&&(a.overlayAlpha=t.overlayAlpha),t.overlayColor!==void 0&&(a.overlayColor=ae.FromArray(t.overlayColor)),t.renderOverlay!==void 0&&(a.renderOverlay=t.renderOverlay),a.isUnIndexed=!!t.isUnIndexed,a.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(a.delayLoadState=4,a.delayLoadingFile=n+t.delayLoadingFile,a._boundingInfo=new Oe(y.FromArray(t.boundingBoxMinimum),y.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(a._binaryInfo=t._binaryInfo),a._delayInfo=[],t.hasUVs&&a._delayInfo.push(_.UVKind),t.hasUVs2&&a._delayInfo.push(_.UV2Kind),t.hasUVs3&&a._delayInfo.push(_.UV3Kind),t.hasUVs4&&a._delayInfo.push(_.UV4Kind),t.hasUVs5&&a._delayInfo.push(_.UV5Kind),t.hasUVs6&&a._delayInfo.push(_.UV6Kind),t.hasColors&&a._delayInfo.push(_.ColorKind),t.hasMatricesIndices&&a._delayInfo.push(_.MatricesIndicesKind),t.hasMatricesWeights&&a._delayInfo.push(_.MatricesWeightsKind),a._delayLoadingFunction=He._ImportGeometry,Pi.ForceFullSceneLoadingForIncremental&&a._checkDelayState()):He._ImportGeometry(t,a),t.materialId?a.setMaterialByID(t.materialId):a.material=null,t.morphTargetManagerId>-1&&(a.morphTargetManager=i.getMorphTargetManagerById(t.morphTargetManagerId)),t.skeletonId!==void 0&&t.skeletonId!==null&&(a.skeleton=i.getLastSkeletonByID(t.skeletonId),t.numBoneInfluencers&&(a.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(var s=0;s<t.animations.length;s++){var o=t.animations[s],u=_e.GetClass("BABYLON.Animation");u&&a.animations.push(u.Parse(o))}xe.ParseAnimationRanges(a,t,i)}if(t.autoAnimate&&i.beginAnimation(a,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?a.layerMask=Math.abs(parseInt(t.layerMask)):a.layerMask=268435455,t.physicsImpostor&&e._PhysicsImpostorParser(i,a,t),t.lodMeshIds&&(a._waitingData.lods={ids:t.lodMeshIds,distances:t.lodDistances?t.lodDistances:null,coverages:t.lodCoverages?t.lodCoverages:null}),t.instances)for(var l=0;l<t.instances.length;l++){var f=t.instances[l],h=a.createInstance(f.name);if(f.id&&(h.id=f.id),$&&(f.tags?$.AddTagsTo(h,f.tags):$.AddTagsTo(h,t.tags)),h.position=y.FromArray(f.position),f.metadata!==void 0&&(h.metadata=f.metadata),f.parentId&&(h._waitingParentId=f.parentId),f.isEnabled!==void 0&&f.isEnabled!==null&&h.setEnabled(f.isEnabled),f.isVisible!==void 0&&f.isVisible!==null&&(h.isVisible=f.isVisible),f.isPickable!==void 0&&f.isPickable!==null&&(h.isPickable=f.isPickable),f.rotationQuaternion?h.rotationQuaternion=W.FromArray(f.rotationQuaternion):f.rotation&&(h.rotation=y.FromArray(f.rotation)),h.scaling=y.FromArray(f.scaling),f.checkCollisions!=null&&f.checkCollisions!=null&&(h.checkCollisions=f.checkCollisions),f.pickable!=null&&f.pickable!=null&&(h.isPickable=f.pickable),f.showBoundingBox!=null&&f.showBoundingBox!=null&&(h.showBoundingBox=f.showBoundingBox),f.showSubMeshesBoundingBox!=null&&f.showSubMeshesBoundingBox!=null&&(h.showSubMeshesBoundingBox=f.showSubMeshesBoundingBox),f.alphaIndex!=null&&f.showSubMeshesBoundingBox!=null&&(h.alphaIndex=f.alphaIndex),f.physicsImpostor&&e._PhysicsImpostorParser(i,h,f),f.animations){for(s=0;s<f.animations.length;s++){o=f.animations[s];var u=_e.GetClass("BABYLON.Animation");u&&h.animations.push(u.Parse(o))}xe.ParseAnimationRanges(h,f,i),f.autoAnimate&&i.beginAnimation(h,f.autoAnimateFrom,f.autoAnimateTo,f.autoAnimateLoop,f.autoAnimateSpeed||1)}}if(t.thinInstances){var c=t.thinInstances;if(c.matrixData?(a.thinInstanceSetBuffer("matrix",new Float32Array(c.matrixData),16,!1),a._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,a._thinInstanceDataStorage.instancesCount=c.instancesCount):a._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,t.thinInstances.userThinInstance){var p=t.thinInstances.userThinInstance;for(var d in p.data)a.thinInstanceSetBuffer(d,new Float32Array(p.data[d]),p.strides[d],!1),a._userThinInstanceBuffersStorage.sizes[d]=p.sizes[d]}}return a},e.CreateRibbon=function(t,i,n,a,s,o,u,l,f){throw O.WarnImport("MeshBuilder")},e.CreateDisc=function(t,i,n,a,s,o){throw O.WarnImport("MeshBuilder")},e.CreateBox=function(t,i,n,a,s){throw O.WarnImport("MeshBuilder")},e.CreateSphere=function(t,i,n,a,s,o){throw O.WarnImport("MeshBuilder")},e.CreateHemisphere=function(t,i,n,a){throw O.WarnImport("MeshBuilder")},e.CreateCylinder=function(t,i,n,a,s,o,u,l,f){throw O.WarnImport("MeshBuilder")},e.CreateTorus=function(t,i,n,a,s,o,u){throw O.WarnImport("MeshBuilder")},e.CreateTorusKnot=function(t,i,n,a,s,o,u,l,f,h){throw O.WarnImport("MeshBuilder")},e.CreateLines=function(t,i,n,a,s){throw O.WarnImport("MeshBuilder")},e.CreateDashedLines=function(t,i,n,a,s,o,u,l){throw O.WarnImport("MeshBuilder")},e.CreatePolygon=function(t,i,n,a,s,o,u){throw u===void 0&&(u=earcut),O.WarnImport("MeshBuilder")},e.ExtrudePolygon=function(t,i,n,a,s,o,u,l){throw l===void 0&&(l=earcut),O.WarnImport("MeshBuilder")},e.ExtrudeShape=function(t,i,n,a,s,o,u,l,f,h){throw O.WarnImport("MeshBuilder")},e.ExtrudeShapeCustom=function(t,i,n,a,s,o,u,l,f,h,c,p){throw O.WarnImport("MeshBuilder")},e.CreateLathe=function(t,i,n,a,s,o,u){throw O.WarnImport("MeshBuilder")},e.CreatePlane=function(t,i,n,a,s){throw O.WarnImport("MeshBuilder")},e.CreateGround=function(t,i,n,a,s,o){throw O.WarnImport("MeshBuilder")},e.CreateTiledGround=function(t,i,n,a,s,o,u,l,f){throw O.WarnImport("MeshBuilder")},e.CreateGroundFromHeightMap=function(t,i,n,a,s,o,u,l,f,h,c){throw O.WarnImport("MeshBuilder")},e.CreateTube=function(t,i,n,a,s,o,u,l,f,h){throw O.WarnImport("MeshBuilder")},e.CreatePolyhedron=function(t,i,n){throw O.WarnImport("MeshBuilder")},e.CreateIcoSphere=function(t,i,n){throw O.WarnImport("MeshBuilder")},e.CreateDecal=function(t,i,n,a,s,o){throw O.WarnImport("MeshBuilder")},e.CreateCapsule=function(t,i,n){throw O.WarnImport("MeshBuilder")},e.prototype.setPositionsForCPUSkinning=function(){var t=this._internalMeshDataInfo;if(!t._sourcePositions){var i=this.getVerticesData(_.PositionKind);if(!i)return t._sourcePositions;t._sourcePositions=new Float32Array(i),this.isVertexBufferUpdatable(_.PositionKind)||this.setVerticesData(_.PositionKind,i,!0)}return t._sourcePositions},e.prototype.setNormalsForCPUSkinning=function(){var t=this._internalMeshDataInfo;if(!t._sourceNormals){var i=this.getVerticesData(_.NormalKind);if(!i)return t._sourceNormals;t._sourceNormals=new Float32Array(i),this.isVertexBufferUpdatable(_.NormalKind)||this.setVerticesData(_.NormalKind,i,!0)}return t._sourceNormals},e.prototype.applySkeleton=function(t){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(_.PositionKind))return this;if(!this.isVerticesDataPresent(_.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(_.MatricesWeightsKind))return this;var i=this.isVerticesDataPresent(_.NormalKind),n=this._internalMeshDataInfo;if(!n._sourcePositions){var a=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=a}i&&!n._sourceNormals&&this.setNormalsForCPUSkinning();var s=this.getVerticesData(_.PositionKind);if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s));var o=this.getVerticesData(_.NormalKind);if(i){if(!o)return this;o instanceof Float32Array||(o=new Float32Array(o))}var u=this.getVerticesData(_.MatricesIndicesKind),l=this.getVerticesData(_.MatricesWeightsKind);if(!l||!u)return this;for(var f=this.numBoneInfluencers>4,h=f?this.getVerticesData(_.MatricesIndicesExtraKind):null,c=f?this.getVerticesData(_.MatricesWeightsExtraKind):null,p=t.getTransformMatrices(this),d=y.Zero(),g=new R,m=new R,E=0,v,A=0;A<s.length;A+=3,E+=4){var M;for(v=0;v<4;v++)M=l[E+v],M>0&&(R.FromFloat32ArrayToRefScaled(p,Math.floor(u[E+v]*16),M,m),g.addToSelf(m));if(f)for(v=0;v<4;v++)M=c[E+v],M>0&&(R.FromFloat32ArrayToRefScaled(p,Math.floor(h[E+v]*16),M,m),g.addToSelf(m));y.TransformCoordinatesFromFloatsToRef(n._sourcePositions[A],n._sourcePositions[A+1],n._sourcePositions[A+2],g,d),d.toArray(s,A),i&&(y.TransformNormalFromFloatsToRef(n._sourceNormals[A],n._sourceNormals[A+1],n._sourceNormals[A+2],g,d),d.toArray(o,A)),g.reset()}return this.updateVerticesData(_.PositionKind,s),i&&this.updateVerticesData(_.NormalKind,o),this},e.MinMax=function(t){var i=null,n=null;return t.forEach(function(a){var s=a.getBoundingInfo(),o=s.boundingBox;!i||!n?(i=o.minimumWorld,n=o.maximumWorld):(i.minimizeInPlace(o.minimumWorld),n.maximizeInPlace(o.maximumWorld))}),!i||!n?{min:y.Zero(),max:y.Zero()}:{min:i,max:n}},e.Center=function(t){var i=t instanceof Array?e.MinMax(t):t;return y.Center(i.min,i.max)},e.MergeMeshes=function(t,i,n,a,s,o){i===void 0&&(i=!0);var u;if(!n){var l=0;for(u=0;u<t.length;u++)if(t[u]&&(l+=t[u].getTotalVertices(),l>=65536))return L.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(o){var f=null,h,c;s=!1}var p=new Array,d=new Array,g=null,m,E=new Array,v=null;for(u=0;u<t.length;u++)if(t[u]){var A=t[u];if(A.isAnInstance)return L.Warn("Cannot merge instance meshes."),null;var M=A.computeWorldMatrix(!0);if(m=Z.ExtractFromMesh(A,!0,!0),m.transform(M),g?g.merge(m,n):(g=m,v=A),s&&E.push(A.getTotalIndices()),o)if(A.material){var C=A.material;if(C instanceof ei){for(c=0;c<C.subMaterials.length;c++)p.indexOf(C.subMaterials[c])<0&&p.push(C.subMaterials[c]);for(h=0;h<A.subMeshes.length;h++)d.push(p.indexOf(C.subMaterials[A.subMeshes[h].materialIndex])),E.push(A.subMeshes[h].indexCount)}else for(p.indexOf(C)<0&&p.push(C),h=0;h<A.subMeshes.length;h++)d.push(p.indexOf(C)),E.push(A.subMeshes[h].indexCount)}else for(h=0;h<A.subMeshes.length;h++)d.push(0),E.push(A.subMeshes[h].indexCount)}if(v=v,a||(a=new e(v.name+"_merged",v.getScene())),g.applyToMesh(a),a.checkCollisions=v.checkCollisions,a.overrideMaterialSideOrientation=v.overrideMaterialSideOrientation,i)for(u=0;u<t.length;u++)t[u]&&t[u].dispose();if(s||o){a.releaseSubMeshes(),u=0;for(var P=0;u<E.length;)Ke.CreateFromIndices(0,P,E[u],a),P+=E[u],u++}if(o){for(f=new ei(v.name+"_merged",v.getScene()),f.subMaterials=p,h=0;h<a.subMeshes.length;h++)a.subMeshes[h].materialIndex=d[h];a.material=f}else a.material=v.material;return a},e.prototype.addInstance=function(t){t._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(t)},e.prototype.removeInstance=function(t){var i=t._indexInSourceMeshInstanceArray;if(i!=-1){if(i!==this.instances.length-1){var n=this.instances[this.instances.length-1];this.instances[i]=n,n._indexInSourceMeshInstanceArray=i}t._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},e.FRONTSIDE=Z.FRONTSIDE,e.BACKSIDE=Z.BACKSIDE,e.DOUBLESIDE=Z.DOUBLESIDE,e.DEFAULTSIDE=Z.DEFAULTSIDE,e.NO_CAP=0,e.CAP_START=1,e.CAP_END=2,e.CAP_ALL=3,e.NO_FLIP=0,e.FLIP_TILE=1,e.ROTATE_TILE=2,e.FLIP_ROW=3,e.ROTATE_ROW=4,e.FLIP_N_ROTATE_TILE=5,e.FLIP_N_ROTATE_ROW=6,e.CENTER=0,e.LEFT=1,e.RIGHT=2,e.TOP=3,e.BOTTOM=4,e._GroundMeshParser=function(t,i){throw O.WarnImport("GroundMesh")},e}(pt);_e.RegisteredTypes["BABYLON.Mesh"]=Ae;var xr=function(){function r(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(r.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(e){this._idleRotationSpeed=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(e){this._idleRotationWaitTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(e){this._idleRotationSpinupTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(e){var t=this;this._attachedCamera=e;var i=this._attachedCamera.getScene();this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(n){if(n.type===U.POINTERDOWN){t._isPointerDown=!0;return}n.type===U.POINTERUP&&(t._isPointerDown=!1)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){var n=Ve.Now,a=0;t._lastFrameTime!=null&&(a=n-t._lastFrameTime),t._lastFrameTime=n,t._applyUserInteraction();var s=n-t._lastInteractionTime-t._idleRotationWaitTime,o=Math.max(Math.min(s/t._idleRotationSpinupTime,1),0);t._cameraRotationSpeed=t._idleRotationSpeed*o,t._attachedCamera&&(t._attachedCamera.alpha-=t._cameraRotationSpeed*(a/1e3))})},r.prototype.detach=function(){if(!!this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},r.prototype._userIsZooming=function(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1},r.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var e=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(e=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?e:this._userIsZooming()},r.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Ve.Now)},r.prototype._userIsMoving=function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},r}(),Me=function(){function r(){this._easingMode=r.EASINGMODE_EASEIN}return r.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},r.prototype.getEasingMode=function(){return this._easingMode},r.prototype.easeInCore=function(e){throw new Error("You must implement this method")},r.prototype.ease=function(e){switch(this._easingMode){case r.EASINGMODE_EASEIN:return this.easeInCore(e);case r.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-e)}return e>=.5?(1-this.easeInCore((1-e)*2))*.5+.5:this.easeInCore(e*2)*.5},r.EASINGMODE_EASEIN=0,r.EASINGMODE_EASEOUT=1,r.EASINGMODE_EASEINOUT=2,r}();(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t=Math.max(0,Math.min(1,t)),1-Math.sqrt(1-t*t)},e})(Me);var Fr=function(r){N(e,r);function e(t){t===void 0&&(t=1);var i=r.call(this)||this;return i.amplitude=t,i}return e.prototype.easeInCore=function(t){var i=Math.max(0,this.amplitude);return Math.pow(t,3)-t*i*Math.sin(3.141592653589793*t)},e}(Me);(function(r){N(e,r);function e(t,i){t===void 0&&(t=3),i===void 0&&(i=2);var n=r.call(this)||this;return n.bounces=t,n.bounciness=i,n}return e.prototype.easeInCore=function(t){var i=Math.max(0,this.bounces),n=this.bounciness;n<=1&&(n=1.001);var a=Math.pow(n,i),s=1-n,o=(1-a)/s+a*.5,u=t*o,l=Math.log(-u*(1-n)+1)/Math.log(n),f=Math.floor(l),h=f+1,c=(1-Math.pow(n,f))/(s*o),p=(1-Math.pow(n,h))/(s*o),d=(c+p)*.5,g=t-d,m=d-c;return-Math.pow(1/n,i-f)/(m*m)*(g-m)*(g+m)},e})(Me);(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t},e})(Me);(function(r){N(e,r);function e(t,i){t===void 0&&(t=3),i===void 0&&(i=3);var n=r.call(this)||this;return n.oscillations=t,n.springiness=i,n}return e.prototype.easeInCore=function(t){var i,n=Math.max(0,this.oscillations),a=Math.max(0,this.springiness);return a==0?i=t:i=(Math.exp(a*t)-1)/(Math.exp(a)-1),i*Math.sin((6.283185307179586*n+1.5707963267948966)*t)},e})(Me);var wr=function(r){N(e,r);function e(t){t===void 0&&(t=2);var i=r.call(this)||this;return i.exponent=t,i}return e.prototype.easeInCore=function(t){return this.exponent<=0?t:(Math.exp(this.exponent*t)-1)/(Math.exp(this.exponent)-1)},e}(Me);(function(r){N(e,r);function e(t){t===void 0&&(t=2);var i=r.call(this)||this;return i.power=t,i}return e.prototype.easeInCore=function(t){var i=Math.max(0,this.power);return Math.pow(t,i)},e})(Me);(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t},e})(Me);(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t*t},e})(Me);(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return t*t*t*t*t},e})(Me);(function(r){N(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.easeInCore=function(t){return 1-Math.sin(1.5707963267948966*(1-t))},e})(Me);(function(r){N(e,r);function e(t,i,n,a){t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=1),a===void 0&&(a=1);var s=r.call(this)||this;return s.x1=t,s.y1=i,s.x2=n,s.y2=a,s}return e.prototype.easeInCore=function(t){return Pr.Interpolate(t,this.x1,this.y1,this.x2,this.y2)},e})(Me);var ti;(function(r){r[r.STEP=1]="STEP"})(ti||(ti={}));var Ri=function(){function r(e,t,i){this.name=e,this.from=t,this.to=i}return r.prototype.clone=function(){return new r(this.name,this.from,this.to)},r}(),Lr=function(){function r(){}return r}(),Se=function(){function r(e,t,i,n,a,s){this.name=e,this.targetProperty=t,this.framePerSecond=i,this.dataType=n,this.loopMode=a,this.enableBlending=s,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=n,this.loopMode=a===void 0?r.ANIMATIONLOOPMODE_CYCLE:a}return r._PrepareAnimation=function(e,t,i,n,a,s,o,u){var l=void 0;if(!isNaN(parseFloat(a))&&isFinite(a)?l=r.ANIMATIONTYPE_FLOAT:a instanceof W?l=r.ANIMATIONTYPE_QUATERNION:a instanceof y?l=r.ANIMATIONTYPE_VECTOR3:a instanceof ne?l=r.ANIMATIONTYPE_VECTOR2:a instanceof ae?l=r.ANIMATIONTYPE_COLOR3:a instanceof fe?l=r.ANIMATIONTYPE_COLOR4:a instanceof Lt&&(l=r.ANIMATIONTYPE_SIZE),l==null)return null;var f=new r(e,t,i,l,o),h=[{frame:0,value:a},{frame:n,value:s}];return f.setKeys(h),u!==void 0&&f.setEasingFunction(u),f},r.CreateAnimation=function(e,t,i,n){var a=new r(e+"Animation",e,i,t,r.ANIMATIONLOOPMODE_CONSTANT);return a.setEasingFunction(n),a},r.CreateAndStartAnimation=function(e,t,i,n,a,s,o,u,l,f){var h=r._PrepareAnimation(e,i,n,a,s,o,u,l);return h?t.getScene().beginDirectAnimation(t,[h],0,a,h.loopMode===1,1,f):null},r.CreateAndStartHierarchyAnimation=function(e,t,i,n,a,s,o,u,l,f,h){var c=r._PrepareAnimation(e,n,a,s,o,u,l,f);if(!c)return null;var p=t.getScene();return p.beginDirectHierarchyAnimation(t,i,[c],0,s,c.loopMode===1,1,h)},r.CreateMergeAndStartAnimation=function(e,t,i,n,a,s,o,u,l,f){var h=r._PrepareAnimation(e,i,n,a,s,o,u,l);return h?(t.animations.push(h),t.getScene().beginAnimation(t,0,a,h.loopMode===1,1,f)):null},r.MakeAnimationAdditive=function(e,t,i,n,a){t===void 0&&(t=0),n===void 0&&(n=!1);var s=e;if(n&&(s=e.clone(),s.name=a||s.name),!s._keys.length)return s;t=t>=0?t:0;var o=0,u=s._keys[0],l=s._keys.length-1,f=s._keys[l],h={referenceValue:u.value,referencePosition:I.Vector3[0],referenceQuaternion:I.Quaternion[0],referenceScaling:I.Vector3[1],keyPosition:I.Vector3[2],keyQuaternion:I.Quaternion[1],keyScaling:I.Vector3[3]},c=!1,p=u.frame,d=f.frame;if(i){var g=s.getRange(i);g&&(p=g.from,d=g.to)}var m=u.frame===p,E=f.frame===d;if(s._keys.length===1){var v=s._getKeyValue(s._keys[0]);h.referenceValue=v.clone?v.clone():v,c=!0}else if(t<=u.frame){var v=s._getKeyValue(u.value);h.referenceValue=v.clone?v.clone():v,c=!0}else if(t>=f.frame){var v=s._getKeyValue(f.value);h.referenceValue=v.clone?v.clone():v,c=!0}for(var A=0;!c||!m||!E&&A<s._keys.length-1;){var M=s._keys[A],C=s._keys[A+1];if(!c&&t>=M.frame&&t<=C.frame){var v=void 0;if(t===M.frame)v=s._getKeyValue(M.value);else if(t===C.frame)v=s._getKeyValue(C.value);else{var P={key:A,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};v=s._interpolate(t,P)}h.referenceValue=v.clone?v.clone():v,c=!0}if(!m&&p>=M.frame&&p<=C.frame){if(p===M.frame)o=A;else if(p===C.frame)o=A+1;else{var P={key:A,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},v=s._interpolate(p,P),S={frame:p,value:v.clone?v.clone():v};s._keys.splice(A+1,0,S),o=A+1}m=!0}if(!E&&d>=M.frame&&d<=C.frame){if(d===M.frame)l=A;else if(d===C.frame)l=A+1;else{var P={key:A,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},v=s._interpolate(d,P),S={frame:d,value:v.clone?v.clone():v};s._keys.splice(A+1,0,S),l=A+1}E=!0}A++}s.dataType===r.ANIMATIONTYPE_QUATERNION?h.referenceValue.normalize().conjugateInPlace():s.dataType===r.ANIMATIONTYPE_MATRIX&&(h.referenceValue.decompose(h.referenceScaling,h.referenceQuaternion,h.referencePosition),h.referenceQuaternion.normalize().conjugateInPlace());for(var A=o;A<=l;A++){var S=s._keys[A];if(!(A&&s.dataType!==r.ANIMATIONTYPE_FLOAT&&S.value===u.value))switch(s.dataType){case r.ANIMATIONTYPE_MATRIX:S.value.decompose(h.keyScaling,h.keyQuaternion,h.keyPosition),h.keyPosition.subtractInPlace(h.referencePosition),h.keyScaling.divideInPlace(h.referenceScaling),h.referenceQuaternion.multiplyToRef(h.keyQuaternion,h.keyQuaternion),R.ComposeToRef(h.keyScaling,h.keyQuaternion,h.keyPosition,S.value);break;case r.ANIMATIONTYPE_QUATERNION:h.referenceValue.multiplyToRef(S.value,S.value);break;case r.ANIMATIONTYPE_VECTOR2:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:S.value.subtractToRef(h.referenceValue,S.value);break;case r.ANIMATIONTYPE_SIZE:S.value.width-=h.referenceValue.width,S.value.height-=h.referenceValue.height;break;default:S.value-=h.referenceValue}}return s},r.TransitionTo=function(e,t,i,n,a,s,o,u){if(u===void 0&&(u=null),o<=0)return i[e]=t,u&&u(),null;var l=a*(o/1e3);s.setKeys([{frame:0,value:i[e].clone?i[e].clone():i[e]},{frame:l,value:t}]),i.animations||(i.animations=[]),i.animations.push(s);var f=n.beginAnimation(i,0,l,!1);return f.onAnimationEnd=u,f},Object.defineProperty(r.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,t=this._runtimeAnimations;e<t.length;e++){var i=t[e];if(!i.isStopped)return!0}return!1},enumerable:!1,configurable:!0}),r.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var n in this._ranges)i&&(t+=", ",i=!1),t+=n;t+="}"}return t},r.prototype.addEvent=function(e){this._events.push(e),this._events.sort(function(t,i){return t.frame-i.frame})},r.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},r.prototype.getEvents=function(){return this._events},r.prototype.createRange=function(e,t,i){this._ranges[e]||(this._ranges[e]=new Ri(e,t,i))},r.prototype.deleteRange=function(e,t){t===void 0&&(t=!0);var i=this._ranges[e];if(!!i){if(t)for(var n=i.from,a=i.to,s=this._keys.length-1;s>=0;s--)this._keys[s].frame>=n&&this._keys[s].frame<=a&&this._keys.splice(s,1);this._ranges[e]=null}},r.prototype.getRange=function(e){return this._ranges[e]},r.prototype.getKeys=function(){return this._keys},r.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;t<i;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},r.prototype.getEasingFunction=function(){return this._easingFunction},r.prototype.setEasingFunction=function(e){this._easingFunction=e},r.prototype.floatInterpolateFunction=function(e,t,i){return G.Lerp(e,t,i)},r.prototype.floatInterpolateFunctionWithTangents=function(e,t,i,n,a){return G.Hermite(e,t,i,n,a)},r.prototype.quaternionInterpolateFunction=function(e,t,i){return W.Slerp(e,t,i)},r.prototype.quaternionInterpolateFunctionWithTangents=function(e,t,i,n,a){return W.Hermite(e,t,i,n,a).normalize()},r.prototype.vector3InterpolateFunction=function(e,t,i){return y.Lerp(e,t,i)},r.prototype.vector3InterpolateFunctionWithTangents=function(e,t,i,n,a){return y.Hermite(e,t,i,n,a)},r.prototype.vector2InterpolateFunction=function(e,t,i){return ne.Lerp(e,t,i)},r.prototype.vector2InterpolateFunctionWithTangents=function(e,t,i,n,a){return ne.Hermite(e,t,i,n,a)},r.prototype.sizeInterpolateFunction=function(e,t,i){return Lt.Lerp(e,t,i)},r.prototype.color3InterpolateFunction=function(e,t,i){return ae.Lerp(e,t,i)},r.prototype.color4InterpolateFunction=function(e,t,i){return fe.Lerp(e,t,i)},r.prototype._getKeyValue=function(e){return typeof e=="function"?e():e},r.prototype._interpolate=function(e,t){if(t.loopMode===r.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;var i=this._keys;if(i.length===1)return this._getKeyValue(i[0].value);var n=t.key;if(i[n].frame>=e)for(;n-1>=0&&i[n].frame>=e;)n--;for(var a=n;a<i.length;a++){var s=i[a+1];if(s.frame>=e){t.key=a;var o=i[a],u=this._getKeyValue(o.value);if(o.interpolation===ti.STEP)return u;var l=this._getKeyValue(s.value),f=o.outTangent!==void 0&&s.inTangent!==void 0,h=s.frame-o.frame,c=(e-o.frame)/h,p=this.getEasingFunction();switch(p!=null&&(c=p.ease(c)),this.dataType){case r.ANIMATIONTYPE_FLOAT:var d=f?this.floatInterpolateFunctionWithTangents(u,o.outTangent*h,l,s.inTangent*h,c):this.floatInterpolateFunction(u,l,c);switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return d;case r.ANIMATIONLOOPMODE_RELATIVE:return t.offsetValue*t.repeatCount+d}break;case r.ANIMATIONTYPE_QUATERNION:var g=f?this.quaternionInterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),c):this.quaternionInterpolateFunction(u,l,c);switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return g;case r.ANIMATIONLOOPMODE_RELATIVE:return g.addInPlace(t.offsetValue.scale(t.repeatCount))}return g;case r.ANIMATIONTYPE_VECTOR3:var m=f?this.vector3InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),c):this.vector3InterpolateFunction(u,l,c);switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return m;case r.ANIMATIONLOOPMODE_RELATIVE:return m.add(t.offsetValue.scale(t.repeatCount))}case r.ANIMATIONTYPE_VECTOR2:var E=f?this.vector2InterpolateFunctionWithTangents(u,o.outTangent.scale(h),l,s.inTangent.scale(h),c):this.vector2InterpolateFunction(u,l,c);switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return E;case r.ANIMATIONLOOPMODE_RELATIVE:return E.add(t.offsetValue.scale(t.repeatCount))}case r.ANIMATIONTYPE_SIZE:switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(u,l,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(u,l,c).add(t.offsetValue.scale(t.repeatCount))}case r.ANIMATIONTYPE_COLOR3:switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(u,l,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(u,l,c).add(t.offsetValue.scale(t.repeatCount))}case r.ANIMATIONTYPE_COLOR4:switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(u,l,c);case r.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(u,l,c).add(t.offsetValue.scale(t.repeatCount))}case r.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case r.ANIMATIONLOOPMODE_CYCLE:case r.ANIMATIONLOOPMODE_CONSTANT:if(r.AllowMatricesInterpolation)return this.matrixInterpolateFunction(u,l,c,t.workValue);case r.ANIMATIONLOOPMODE_RELATIVE:return u}}break}}return this._getKeyValue(i[i.length-1].value)},r.prototype.matrixInterpolateFunction=function(e,t,i,n){return r.AllowMatrixDecomposeForInterpolation?n?(R.DecomposeLerpToRef(e,t,i,n),n):R.DecomposeLerp(e,t,i):n?(R.LerpToRef(e,t,i,n),n):R.Lerp(e,t,i)},r.prototype.clone=function(){var e=new r(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(var t in this._ranges){var i=this._ranges[t];!i||(e._ranges[t]=i.clone())}}return e},r.prototype.setKeys=function(e){this._keys=e.slice(0)},r.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var t=this.dataType;e.keys=[];for(var i=this.getKeys(),n=0;n<i.length;n++){var a=i[n],s={};switch(s.frame=a.frame,t){case r.ANIMATIONTYPE_FLOAT:s.values=[a.value],a.inTangent!==void 0&&s.values.push(a.inTangent),a.outTangent!==void 0&&(a.inTangent===void 0&&s.values.push(void 0),s.values.push(a.outTangent));break;case r.ANIMATIONTYPE_QUATERNION:case r.ANIMATIONTYPE_MATRIX:case r.ANIMATIONTYPE_VECTOR3:case r.ANIMATIONTYPE_COLOR3:case r.ANIMATIONTYPE_COLOR4:s.values=a.value.asArray(),a.inTangent!=null&&s.values.push(a.inTangent.asArray()),a.outTangent!=null&&(a.inTangent===void 0&&s.values.push(void 0),s.values.push(a.outTangent.asArray()));break}e.keys.push(s)}e.ranges=[];for(var o in this._ranges){var u=this._ranges[o];if(!!u){var l={};l.name=o,l.from=u.from,l.to=u.to,e.ranges.push(l)}}return e},r._UniversalLerp=function(e,t,i){var n=e.constructor;return n.Lerp?n.Lerp(e,t,i):n.Slerp?n.Slerp(e,t,i):e.toFixed?e*(1-i)+i*t:t},r.Parse=function(e){var t=new r(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),i=e.dataType,n=[],a,s;for(e.enableBlending&&(t.enableBlending=e.enableBlending),e.blendingSpeed&&(t.blendingSpeed=e.blendingSpeed),s=0;s<e.keys.length;s++){var o=e.keys[s],u,l;switch(i){case r.ANIMATIONTYPE_FLOAT:a=o.values[0],o.values.length>=1&&(u=o.values[1]),o.values.length>=2&&(l=o.values[2]);break;case r.ANIMATIONTYPE_QUATERNION:if(a=W.FromArray(o.values),o.values.length>=8){var f=W.FromArray(o.values.slice(4,8));f.equals(W.Zero())||(u=f)}if(o.values.length>=12){var h=W.FromArray(o.values.slice(8,12));h.equals(W.Zero())||(l=h)}break;case r.ANIMATIONTYPE_MATRIX:a=R.FromArray(o.values);break;case r.ANIMATIONTYPE_COLOR3:a=ae.FromArray(o.values);break;case r.ANIMATIONTYPE_COLOR4:a=fe.FromArray(o.values);break;case r.ANIMATIONTYPE_VECTOR3:default:a=y.FromArray(o.values);break}var c={};c.frame=o.frame,c.value=a,u!=null&&(c.inTangent=u),l!=null&&(c.outTangent=l),n.push(c)}if(t.setKeys(n),e.ranges)for(s=0;s<e.ranges.length;s++)a=e.ranges[s],t.createRange(a.name,a.from,a.to);return t},r.AppendSerializedAnimations=function(e,t){H.AppendSerializedAnimations(e,t)},r.ParseFromFileAsync=function(e,t){var i=this;return new Promise(function(n,a){var s=new it;s.addEventListener("readystatechange",function(){if(s.readyState==4)if(s.status==200){var o=JSON.parse(s.responseText);if(o.length){for(var u=new Array,l=0,f=o;l<f.length;l++){var h=f[l];u.push(i.Parse(h))}n(u)}else{var u=i.Parse(o);e&&(u.name=e),n(u)}}else a("Unable to load the animation")}),s.open("GET",t),s.send()})},r.CreateFromSnippetAsync=function(e){var t=this;return new Promise(function(i,n){var a=new it;a.addEventListener("readystatechange",function(){if(a.readyState==4)if(a.status==200){var s=JSON.parse(JSON.parse(a.responseText).jsonPayload);if(s.animations){for(var o=JSON.parse(s.animations),u=new Array,l=0,f=o;l<f.length;l++){var h=f[l];u.push(t.Parse(h))}i(u)}else{var o=JSON.parse(s.animation),u=t.Parse(o);u.snippetId=e,i(u)}}else n("Unable to load the snippet "+e)}),a.open("GET",t.SnippetUrl+"/"+e.replace(/#/g,"/")),a.send()})},r.AllowMatricesInterpolation=!1,r.AllowMatrixDecomposeForInterpolation=!0,r.SnippetUrl="https://snippet.babylonjs.com",r.ANIMATIONTYPE_FLOAT=0,r.ANIMATIONTYPE_VECTOR3=1,r.ANIMATIONTYPE_QUATERNION=2,r.ANIMATIONTYPE_MATRIX=3,r.ANIMATIONTYPE_COLOR3=4,r.ANIMATIONTYPE_COLOR4=7,r.ANIMATIONTYPE_VECTOR2=5,r.ANIMATIONTYPE_SIZE=6,r.ANIMATIONLOOPMODE_RELATIVE=0,r.ANIMATIONLOOPMODE_CYCLE=1,r.ANIMATIONLOOPMODE_CONSTANT=2,r}();_e.RegisteredTypes["BABYLON.Animation"]=Se;xe._AnimationRangeFactory=function(r,e,t){return new Ri(r,e,t)};var Nr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",_IAnimationState:Lr,Animation:Se}),Br=function(){function r(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(r.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(e){var t=this;if(this._autoTransitionRange!==e){this._autoTransitionRange=e;var i=this._attachedCamera;!i||(e?this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add(function(n){if(!!n){n.computeWorldMatrix(!0);var a=n.getBoundingInfo().diagonalLength;t.lowerRadiusTransitionRange=a*.05,t.upperRadiusTransitionRange=a*.05}}):this._onMeshTargetChangedObserver&&i.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(e){var t=this;this._attachedCamera=e,this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){!t._attachedCamera||(t._isRadiusAtLimit(t._attachedCamera.lowerRadiusLimit)&&t._applyBoundRadiusAnimation(t.lowerRadiusTransitionRange),t._isRadiusAtLimit(t._attachedCamera.upperRadiusLimit)&&t._applyBoundRadiusAnimation(t.upperRadiusTransitionRange))})},r.prototype.detach=function(){!this._attachedCamera||(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},r.prototype._isRadiusAtLimit=function(e){return this._attachedCamera?this._attachedCamera.radius===e&&!this._radiusIsAnimating:!1},r.prototype._applyBoundRadiusAnimation=function(e){var t=this;if(!!this._attachedCamera){this._radiusBounceTransition||(r.EasingFunction.setEasingMode(r.EasingMode),this._radiusBounceTransition=Se.CreateAnimation("radius",Se.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var i=Se.TransitionTo("radius",this._attachedCamera.radius+e,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return t._clearAnimationLocks()});i&&this._animatables.push(i)}},r.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},r.EasingFunction=new Fr(.3),r.EasingMode=Me.EASINGMODE_EASEOUT,r}(),Ur=function(){function r(){this._mode=r.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(r.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode},set:function(e){this._mode=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(e){this._radiusScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"positionScale",{get:function(){return this._positionScale},set:function(e){this._positionScale=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(e){this._defaultElevation=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(e){this._elevationReturnTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(e){this._elevationReturnWaitTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(e){this._zoomStopsAnimation=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"framingTime",{get:function(){return this._framingTime},set:function(e){this._framingTime=e},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.attach=function(e){var t=this;this._attachedCamera=e;var i=this._attachedCamera.getScene();r.EasingFunction.setEasingMode(r.EasingMode),this._onPrePointerObservableObserver=i.onPrePointerObservable.add(function(n){if(n.type===U.POINTERDOWN){t._isPointerDown=!0;return}n.type===U.POINTERUP&&(t._isPointerDown=!1)}),this._onMeshTargetChangedObserver=e.onMeshTargetChangedObservable.add(function(n){n&&t.zoomOnMesh(n)}),this._onAfterCheckInputsObserver=e.onAfterCheckInputsObservable.add(function(){t._applyUserInteraction(),t._maintainCameraAboveGround()})},r.prototype.detach=function(){if(!!this._attachedCamera){var e=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&e.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},r.prototype.zoomOnMesh=function(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=null),e.computeWorldMatrix(!0);var n=e.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(n.minimumWorld,n.maximumWorld,t,i)},r.prototype.zoomOnMeshHierarchy=function(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=null),e.computeWorldMatrix(!0);var n=e.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(n.min,n.max,t,i)},r.prototype.zoomOnMeshesHierarchy=function(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=null);for(var n=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new y(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=0;s<e.length;s++){var o=e[s].getHierarchyBoundingVectors(!0);y.CheckExtends(o.min,n,a),y.CheckExtends(o.max,n,a)}this.zoomOnBoundingInfo(n,a,t,i)},r.prototype.zoomOnBoundingInfo=function(e,t,i,n){var a=this;i===void 0&&(i=!1),n===void 0&&(n=null);var s;if(!!this._attachedCamera){var o=e.y,u=t.y,l=o+(u-o)*this._positionScale,f=t.subtract(e).scale(.5);if(i)s=new y(0,l,0);else{var h=e.add(f);s=new y(h.x,l,h.z)}this._vectorTransition||(this._vectorTransition=Se.CreateAnimation("target",Se.ANIMATIONTYPE_VECTOR3,60,r.EasingFunction)),this._betaIsAnimating=!0;var c=Se.TransitionTo("target",s,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);c&&this._animatables.push(c);var p=0;if(this._mode===r.FitFrustumSidesMode){var d=this._calculateLowerRadiusFromModelBoundingSphere(e,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=f.length()+this._attachedCamera.minZ),p=d}else this._mode===r.IgnoreBoundsSizeMode&&(p=this._calculateLowerRadiusFromModelBoundingSphere(e,t),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var g=t.subtract(e).length();this._attachedCamera.panningSensibility=5e3/g,this._attachedCamera.wheelPrecision=100/p}this._radiusTransition||(this._radiusTransition=Se.CreateAnimation("radius",Se.ANIMATIONTYPE_FLOAT,60,r.EasingFunction)),c=Se.TransitionTo("radius",p,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){a.stopAllAnimations(),n&&n(),a._attachedCamera&&a._attachedCamera.useInputToRestoreState&&a._attachedCamera.storeState()}),c&&this._animatables.push(c)}},r.prototype._calculateLowerRadiusFromModelBoundingSphere=function(e,t){var i=t.subtract(e),n=i.length(),a=this._getFrustumSlope(),s=n*.5,o=s*this._radiusScale,u=o*Math.sqrt(1+1/(a.x*a.x)),l=o*Math.sqrt(1+1/(a.y*a.y)),f=Math.max(u,l),h=this._attachedCamera;return h?(h.lowerRadiusLimit&&this._mode===r.IgnoreBoundsSizeMode&&(f=f<h.lowerRadiusLimit?h.lowerRadiusLimit:f),h.upperRadiusLimit&&(f=f>h.upperRadiusLimit?h.upperRadiusLimit:f),f):0},r.prototype._maintainCameraAboveGround=function(){var e=this;if(!(this._elevationReturnTime<0)){var t=Ve.Now-this._lastInteractionTime,i=Math.PI*.5-this._defaultElevation,n=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>n&&t>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Se.CreateAnimation("beta",Se.ANIMATIONTYPE_FLOAT,60,r.EasingFunction));var a=Se.TransitionTo("beta",i,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){e._clearAnimationLocks(),e.stopAllAnimations()});a&&this._animatables.push(a)}}},r.prototype._getFrustumSlope=function(){var e=this._attachedCamera;if(!e)return ne.Zero();var t=e.getScene().getEngine(),i=t.getAspectRatio(e),n=Math.tan(e.fov/2),a=n*i;return new ne(a,n)},r.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},r.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=Ve.Now,this.stopAllAnimations(),this._clearAnimationLocks())},r.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(r.prototype,"isUserIsMoving",{get:function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},enumerable:!1,configurable:!0}),r.EasingFunction=new wr,r.EasingMode=Me.EASINGMODE_EASEINOUT,r.IgnoreBoundsSizeMode=0,r.FitFrustumSidesMode=1,r}(),Vr=function(r){N(e,r);function e(t,i,n,a){a===void 0&&(a=!0);var s=r.call(this,t,i,n,a)||this;return s._tmpUpVector=y.Zero(),s._tmpTargetVector=y.Zero(),s.cameraDirection=new y(0,0,0),s.cameraRotation=new ne(0,0),s.ignoreParentScaling=!1,s.updateUpVectorFromRotation=!1,s._tmpQuaternion=new W,s.rotation=new y(0,0,0),s.speed=2,s.noRotationConstraint=!1,s.invertRotation=!1,s.inverseRotationSpeed=.2,s.lockedTarget=null,s._currentTarget=y.Zero(),s._initialFocalDistance=1,s._viewMatrix=R.Zero(),s._camMatrix=R.Zero(),s._cameraTransformMatrix=R.Zero(),s._cameraRotationMatrix=R.Zero(),s._referencePoint=new y(0,0,1),s._transformedReferencePoint=y.Zero(),s._defaultUp=y.Up(),s._cachedRotationZ=0,s._cachedQuaternionRotationZ=0,s}return e.prototype.getFrontPosition=function(t){this.getWorldMatrix();var i=this.getTarget().subtract(this.position);return i.normalize(),i.scaleInPlace(t),this.globalPosition.add(i)},e.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},e.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),r.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return r.prototype._restoreStateValues.call(this)?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1},e.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache.lockedTarget=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new W(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},e.prototype._updateCache=function(t){t||r.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},e.prototype._isSynchronizedViewMatrix=function(){if(!r.prototype._isSynchronizedViewMatrix.call(this))return!1;var t=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(t):!t)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},e.prototype._computeLocalCameraSpeed=function(){var t=this.getEngine();return this.speed*Math.sqrt(t.getDeltaTime()/(t.getFps()*100))},e.prototype.setTarget=function(t){this.upVector.normalize(),this._initialFocalDistance=t.subtract(this.position).length(),this.position.z===t.z&&(this.position.z+=ue),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),R.LookAtLHToRef(this.position,t,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&W.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(e.prototype,"target",{get:function(){return this.getTarget()},set:function(t){this.setTarget(t)},enumerable:!1,configurable:!0}),e.prototype.getTarget=function(){return this._currentTarget},e.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},e.prototype._updatePosition=function(){if(this.parent){this.parent.getWorldMatrix().invertToRef(I.Matrix[0]),y.TransformNormalToRef(this.cameraDirection,I.Matrix[0],I.Vector3[0]),this.position.addInPlace(I.Vector3[0]);return}this.position.addInPlace(this.cameraDirection)},e.prototype._checkInputs=function(){var t=this.invertRotation?-this.inverseRotationSpeed:1,i=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),n){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*t,this.rotation.y+=this.cameraRotation.y*t,!this.noRotationConstraint){var a=1.570796;this.rotation.x>a&&(this.rotation.x=a),this.rotation.x<-a&&(this.rotation.x=-a)}if(this.rotationQuaternion){var s=this.rotation.lengthSquared();s&&W.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}}i&&(Math.abs(this.cameraDirection.x)<this.speed*ue&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*ue&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*ue&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<this.speed*ue&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*ue&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),r.prototype._checkInputs.call(this)},e.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):R.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},e.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return y.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},e.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),y.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?qt.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(W.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),qt.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},e.prototype._computeViewMatrix=function(t,i,n){if(this.ignoreParentScaling){if(this.parent){var a=this.parent.getWorldMatrix();y.TransformCoordinatesToRef(t,a,this._globalPosition),y.TransformCoordinatesToRef(i,a,this._tmpTargetVector),y.TransformNormalToRef(n,a,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t),this._tmpTargetVector.copyFrom(i),this._tmpUpVector.copyFrom(n);this.getScene().useRightHandedSystem?R.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):R.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?R.LookAtRHToRef(t,i,n,this._viewMatrix):R.LookAtLHToRef(t,i,n,this._viewMatrix),this.parent){var a=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(a,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(t)},e.prototype.createRigCamera=function(t,i){if(this.cameraRigMode!==J.RIG_MODE_NONE){var n=new e(t,this.position.clone(),this.getScene());return n.isRigCamera=!0,n.rigParent=this,(this.cameraRigMode===J.RIG_MODE_VR||this.cameraRigMode===J.RIG_MODE_WEBVR)&&(this.rotationQuaternion||(this.rotationQuaternion=new W),n._cameraRigParams={},n.rotationQuaternion=new W),n}return null},e.prototype._updateRigCameras=function(){var t=this._rigCameras[0],i=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case J.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case J.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.RIG_MODE_STEREOSCOPIC_INTERLACED:var n=this.cameraRigMode===J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,a=this.cameraRigMode===J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*n,t),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*a,i);break;case J.RIG_MODE_VR:t.rotationQuaternion?(t.rotationQuaternion.copyFrom(this.rotationQuaternion),i.rotationQuaternion.copyFrom(this.rotationQuaternion)):(t.rotation.copyFrom(this.rotation),i.rotation.copyFrom(this.rotation)),t.position.copyFrom(this.position),i.position.copyFrom(this.position);break}r.prototype._updateRigCameras.call(this)},e.prototype._getRigCamPositionAndTarget=function(t,i){var n=this.getTarget();n.subtractToRef(this.position,e._TargetFocalPoint),e._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var a=e._TargetFocalPoint.addInPlace(this.position);R.TranslationToRef(-a.x,-a.y,-a.z,e._TargetTransformMatrix),e._TargetTransformMatrix.multiplyToRef(R.RotationAxis(i.upVector,t),e._RigCamTransformMatrix),R.TranslationToRef(a.x,a.y,a.z,e._TargetTransformMatrix),e._RigCamTransformMatrix.multiplyToRef(e._TargetTransformMatrix,e._RigCamTransformMatrix),y.TransformCoordinatesToRef(this.position,e._RigCamTransformMatrix,i.position),i.setTarget(a)},e.prototype.getClassName=function(){return"TargetCamera"},e._RigCamTransformMatrix=new R,e._TargetTransformMatrix=new R,e._TargetFocalPoint=new y,b([Ye()],e.prototype,"rotation",void 0),b([T()],e.prototype,"speed",void 0),b([lr("lockedTargetId")],e.prototype,"lockedTarget",void 0),e}(J),gt={},kr=function(){function r(e){this.attachedToElement=!1,this.attached={},this.camera=e,this.checkInputs=function(){}}return r.prototype.add=function(e){var t=e.getSimpleName();if(this.attached[t]){L.Warn("camera input of type "+t+" already exists on camera");return}this.attached[t]=e,e.camera=this.camera,e.checkInputs&&(this.checkInputs=this._addCheckInputs(e.checkInputs.bind(e))),this.attachedToElement&&e.attachControl()},r.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[t];i===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},r.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[t];i.getClassName()===e&&(i.detachControl(),i.camera=null,delete this.attached[t],this.rebuildInputCheck())}},r.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},r.prototype.attachInput=function(e){this.attachedToElement&&e.attachControl(this.noPreventDefault)},r.prototype.attachElement=function(e){if(e===void 0&&(e=!1),!this.attachedToElement){e=J.ForceAttachControlToAlwaysPreventDefault?!1:e,this.attachedToElement=!0,this.noPreventDefault=e;for(var t in this.attached)this.attached[t].attachControl(e)}},r.prototype.detachElement=function(e){e===void 0&&(e=!1);for(var t in this.attached)this.attached[t].detachControl(),e&&(this.attached[t].camera=null);this.attachedToElement=!1},r.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var e in this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},r.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},r.prototype.serialize=function(e){var t={};for(var i in this.attached){var n=this.attached[i],a=H.Serialize(n);t[n.getClassName()]=a}e.inputsmgr=t},r.prototype.parse=function(e){var t=e.inputsmgr;if(t){this.clear();for(var i in t){var n=gt[i];if(n){var a=t[i],s=H.Parse(function(){return new n},a,null);this.add(s)}}}else for(var i in this.attached){var n=gt[this.attached[i].getClassName()];if(n){var s=H.Parse(function(){return new n},e,null);this.remove(this.attached[i]),this.add(s)}}},r}(),Wr=function(){function r(){this.buttons=[0,1,2]}return r.prototype.attachControl=function(e){var t=this;e=te.BackCompatCameraNoPreventDefault(arguments);var i=this.camera.getEngine(),n=i.getInputElement(),a=0,s=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(u,l){var f=u.event,h=f.pointerType==="touch";if(!i.isInVRExclusivePointerMode&&!(u.type!==U.POINTERMOVE&&t.buttons.indexOf(f.button)===-1)){var c=f.srcElement||f.target;if(t._altKey=f.altKey,t._ctrlKey=f.ctrlKey,t._metaKey=f.metaKey,t._shiftKey=f.shiftKey,t._buttonsPressed=f.buttons,i.isPointerLock){var p=f.movementX||f.mozMovementX||f.webkitMovementX||f.msMovementX||0,d=f.movementY||f.mozMovementY||f.webkitMovementY||f.msMovementY||0;t.onTouch(null,p,d),t.pointA=null,t.pointB=null}else if(u.type===U.POINTERDOWN&&c){try{c.setPointerCapture(f.pointerId)}catch{}t.pointA===null?t.pointA={x:f.clientX,y:f.clientY,pointerId:f.pointerId,type:f.pointerType}:t.pointB===null&&(t.pointB={x:f.clientX,y:f.clientY,pointerId:f.pointerId,type:f.pointerType}),t.onButtonDown(f),e||(f.preventDefault(),n&&n.focus())}else if(u.type===U.POINTERDOUBLETAP)t.onDoubleTap(f.pointerType);else if(u.type===U.POINTERUP&&c){try{c.releasePointerCapture(f.pointerId)}catch{}h||(t.pointB=null),i._badOS?t.pointA=t.pointB=null:t.pointB&&t.pointA&&t.pointA.pointerId==f.pointerId?(t.pointA=t.pointB,t.pointB=null):t.pointA&&t.pointB&&t.pointB.pointerId==f.pointerId?t.pointB=null:t.pointA=t.pointB=null,(a!==0||s)&&(t.onMultiTouch(t.pointA,t.pointB,a,0,s,null),a=0,s=null),t.onButtonUp(f),e||f.preventDefault()}else if(u.type===U.POINTERMOVE){if(e||f.preventDefault(),t.pointA&&t.pointB===null){var p=f.clientX-t.pointA.x,d=f.clientY-t.pointA.y;t.onTouch(t.pointA,p,d),t.pointA.x=f.clientX,t.pointA.y=f.clientY}else if(t.pointA&&t.pointB){var g=t.pointA.pointerId===f.pointerId?t.pointA:t.pointB;g.x=f.clientX,g.y=f.clientY;var m=t.pointA.x-t.pointB.x,E=t.pointA.y-t.pointB.y,v=m*m+E*E,A={x:(t.pointA.x+t.pointB.x)/2,y:(t.pointA.y+t.pointB.y)/2,pointerId:f.pointerId,type:u.type};t.onMultiTouch(t.pointA,t.pointB,a,v,s,A),s=A,a=v}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,U.POINTERDOWN|U.POINTERUP|U.POINTERMOVE),this._onLostFocus=function(){t.pointA=t.pointB=null,a=0,s=null,t.onLostFocus()},n&&n.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var o=this.camera.getScene().getEngine().getHostWindow();o&&te.RegisterTopRootEvents(o,[{name:"blur",handler:this._onLostFocus}])},r.prototype.detachControl=function(e){if(this._onLostFocus){var t=this.camera.getScene().getEngine().getHostWindow();t&&te.UnregisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var i=this.camera.getScene().getEngine().getInputElement();i&&i.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},r.prototype.getClassName=function(){return"BaseCameraPointersInput"},r.prototype.getSimpleName=function(){return"pointers"},r.prototype.onDoubleTap=function(e){},r.prototype.onTouch=function(e,t,i){},r.prototype.onMultiTouch=function(e,t,i,n,a,s){},r.prototype.onContextMenu=function(e){e.preventDefault()},r.prototype.onButtonDown=function(e){},r.prototype.onButtonUp=function(e){},r.prototype.onLostFocus=function(){},b([T()],r.prototype,"buttons",void 0),r}(),Ci=function(r){N(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.buttons=[0,1,2],t.angularSensibilityX=1e3,t.angularSensibilityY=1e3,t.pinchPrecision=12,t.pinchDeltaPercentage=0,t.useNaturalPinchZoom=!1,t.panningSensibility=1e3,t.multiTouchPanning=!0,t.multiTouchPanAndZoom=!0,t.pinchInwards=!0,t._isPanClick=!1,t._twoFingerActivityCount=0,t._isPinching=!1,t}return e.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},e.prototype.onTouch=function(t,i,n){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-i/this.panningSensibility,this.camera.inertialPanningY+=n/this.panningSensibility):(this.camera.inertialAlphaOffset-=i/this.angularSensibilityX,this.camera.inertialBetaOffset-=n/this.angularSensibilityY)},e.prototype.onDoubleTap=function(t){this.camera.useInputToRestoreState&&this.camera.restoreState()},e.prototype.onMultiTouch=function(t,i,n,a,s,o){if(!(n===0&&s===null)&&!(a===0&&o===null)){var u=this.pinchInwards?1:-1;if(this.multiTouchPanAndZoom){if(this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(n)/Math.sqrt(a):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(a-n)*.001*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(a-n)/(this.pinchPrecision*u*(this.angularSensibilityX+this.angularSensibilityY)/2),this.panningSensibility!==0&&s&&o){var l=o.x-s.x,f=o.y-s.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}else{this._twoFingerActivityCount++;var h=Math.sqrt(n),c=Math.sqrt(a);if(this._isPinching||this._twoFingerActivityCount<20&&Math.abs(c-h)>this.camera.pinchToPanMaxDistance)this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(a-n)*.001*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(a-n)/(this.pinchPrecision*u*(this.angularSensibilityX+this.angularSensibilityY)/2),this._isPinching=!0;else if(this.panningSensibility!==0&&this.multiTouchPanning&&o&&s){var l=o.x-s.x,f=o.y-s.y;this.camera.inertialPanningX+=-l/this.panningSensibility,this.camera.inertialPanningY+=f/this.panningSensibility}}}},e.prototype.onButtonDown=function(t){this._isPanClick=t.button===this.camera._panningMouseButton},e.prototype.onButtonUp=function(t){this._twoFingerActivityCount=0,this._isPinching=!1},e.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},b([T()],e.prototype,"buttons",void 0),b([T()],e.prototype,"angularSensibilityX",void 0),b([T()],e.prototype,"angularSensibilityY",void 0),b([T()],e.prototype,"pinchPrecision",void 0),b([T()],e.prototype,"pinchDeltaPercentage",void 0),b([T()],e.prototype,"useNaturalPinchZoom",void 0),b([T()],e.prototype,"panningSensibility",void 0),b([T()],e.prototype,"multiTouchPanning",void 0),b([T()],e.prototype,"multiTouchPanAndZoom",void 0),e}(Wr);gt.ArcRotateCameraPointersInput=Ci;var Ii=function(){function r(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return r.prototype.attachControl=function(e){var t=this;e=te.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){t._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(i){var n=i.event;if(!n.metaKey){if(i.type===$t.KEYDOWN){if(t._ctrlPressed=n.ctrlKey,t._altPressed=n.altKey,t.keysUp.indexOf(n.keyCode)!==-1||t.keysDown.indexOf(n.keyCode)!==-1||t.keysLeft.indexOf(n.keyCode)!==-1||t.keysRight.indexOf(n.keyCode)!==-1||t.keysReset.indexOf(n.keyCode)!==-1){var a=t._keys.indexOf(n.keyCode);a===-1&&t._keys.push(n.keyCode),n.preventDefault&&(e||n.preventDefault())}}else if(t.keysUp.indexOf(n.keyCode)!==-1||t.keysDown.indexOf(n.keyCode)!==-1||t.keysLeft.indexOf(n.keyCode)!==-1||t.keysRight.indexOf(n.keyCode)!==-1||t.keysReset.indexOf(n.keyCode)!==-1){var a=t._keys.indexOf(n.keyCode);a>=0&&t._keys.splice(a,1),n.preventDefault&&(e||n.preventDefault())}}}))},r.prototype.detachControl=function(e){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},r.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];this.keysLeft.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX-=1/this.panningSensibility:e.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset+=1/this.zoomingSensibility:e.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningX+=1/this.panningSensibility:e.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(i)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?e.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?e.inertialRadiusOffset-=1/this.zoomingSensibility:e.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(i)!==-1&&e.useInputToRestoreState&&e.restoreState()}},r.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},r.prototype.getSimpleName=function(){return"keyboard"},b([T()],r.prototype,"keysUp",void 0),b([T()],r.prototype,"keysDown",void 0),b([T()],r.prototype,"keysLeft",void 0),b([T()],r.prototype,"keysRight",void 0),b([T()],r.prototype,"keysReset",void 0),b([T()],r.prototype,"panningSensibility",void 0),b([T()],r.prototype,"zoomingSensibility",void 0),b([T()],r.prototype,"useAltToZoom",void 0),b([T()],r.prototype,"angularSpeed",void 0),r}();gt.ArcRotateCameraKeyboardMoveInput=Ii;var Di=function(){function r(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return r.prototype.computeDeltaFromMouseWheelLegacyEvent=function(e,t){var i=0,n=e*.01*this.wheelDeltaPercentage*t;return e>0?i=n/(1+this.wheelDeltaPercentage):i=n*(1+this.wheelDeltaPercentage),i},r.prototype.attachControl=function(e){var t=this;e=te.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(i,n){if(i.type===U.POINTERWHEEL){var a=i.event,s=0,o=a,u=0;if(o.wheelDelta?u=o.wheelDelta:u=-(a.deltaY||a.detail)*60,t.wheelDeltaPercentage){if(s=t.computeDeltaFromMouseWheelLegacyEvent(u,t.camera.radius),s>0){for(var l=t.camera.radius,f=t.camera.inertialRadiusOffset+s,h=0;h<20&&Math.abs(f)>.001;h++)l-=f,f*=t.camera.inertia;l=G.Clamp(l,0,Number.MAX_VALUE),s=t.computeDeltaFromMouseWheelLegacyEvent(u,l)}}else s=u/(t.wheelPrecision*40);s&&(t.camera.inertialRadiusOffset+=s),a.preventDefault&&(e||a.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,U.POINTERWHEEL)},r.prototype.detachControl=function(e){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},r.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},r.prototype.getSimpleName=function(){return"mousewheel"},b([T()],r.prototype,"wheelPrecision",void 0),b([T()],r.prototype,"wheelDeltaPercentage",void 0),r}();gt.ArcRotateCameraMouseWheelInput=Di;var zr=function(r){N(e,r);function e(t){return r.call(this,t)||this}return e.prototype.addMouseWheel=function(){return this.add(new Di),this},e.prototype.addPointers=function(){return this.add(new Ci),this},e.prototype.addKeyboard=function(){return this.add(new Ii),this},e}(kr);xe.AddNodeConstructor("ArcRotateCamera",function(r,e){return function(){return new Oi(r,0,0,1,y.Zero(),e)}});var Oi=function(r){N(e,r);function e(t,i,n,a,s,o,u){u===void 0&&(u=!0);var l=r.call(this,t,y.Zero(),o,u)||this;return l.inertialAlphaOffset=0,l.inertialBetaOffset=0,l.inertialRadiusOffset=0,l.lowerAlphaLimit=null,l.upperAlphaLimit=null,l.lowerBetaLimit=.01,l.upperBetaLimit=Math.PI-.01,l.lowerRadiusLimit=null,l.upperRadiusLimit=null,l.inertialPanningX=0,l.inertialPanningY=0,l.pinchToPanMaxDistance=20,l.panningDistanceLimit=null,l.panningOriginTarget=y.Zero(),l.panningInertia=.9,l.zoomOnFactor=1,l.targetScreenOffset=ne.Zero(),l.allowUpsideDown=!0,l.useInputToRestoreState=!0,l._viewMatrix=new R,l.panningAxis=new y(1,1,0),l.onMeshTargetChangedObservable=new D,l.checkCollisions=!1,l.collisionRadius=new y(.5,.5,.5),l._previousPosition=y.Zero(),l._collisionVelocity=y.Zero(),l._newPosition=y.Zero(),l._computationVector=y.Zero(),l._onCollisionPositionChange=function(f,h,c){c===void 0&&(c=null),c?(l.setPosition(h),l.onCollide&&l.onCollide(c)):l._previousPosition.copyFrom(l._position);var p=Math.cos(l.alpha),d=Math.sin(l.alpha),g=Math.cos(l.beta),m=Math.sin(l.beta);m===0&&(m=1e-4);var E=l._getTargetPosition();l._computationVector.copyFromFloats(l.radius*p*m,l.radius*g,l.radius*d*m),E.addToRef(l._computationVector,l._newPosition),l._position.copyFrom(l._newPosition);var v=l.upVector;l.allowUpsideDown&&l.beta<0&&(v=v.clone(),v=v.negate()),l._computeViewMatrix(l._position,E,v),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},l._target=y.Zero(),s&&l.setTarget(s),l.alpha=i,l.beta=n,l.radius=a,l.getViewMatrix(),l.inputs=new zr(l),l.inputs.addKeyboard().addMouseWheel().addPointers(),l}return Object.defineProperty(e.prototype,"target",{get:function(){return this._target},set:function(t){this.setTarget(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(t){this.setPosition(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"upVector",{get:function(){return this._upVector},set:function(t){this._upToYMatrix||(this._YToUpMatrix=new R,this._upToYMatrix=new R,this._upVector=y.Zero()),t.normalize(),this._upVector.copyFrom(t),this.setMatUp()},enumerable:!1,configurable:!0}),e.prototype.setMatUp=function(){R.RotationAlignToRef(y.UpReadOnly,this._upVector,this._YToUpMatrix),R.RotationAlignToRef(this._upVector,y.UpReadOnly,this._upToYMatrix)},Object.defineProperty(e.prototype,"angularSensibilityX",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityX:0},set:function(t){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityX=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angularSensibilityY",{get:function(){var t=this.inputs.attached.pointers;return t?t.angularSensibilityY:0},set:function(t){var i=this.inputs.attached.pointers;i&&(i.angularSensibilityY=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pinchPrecision",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchPrecision:0},set:function(t){var i=this.inputs.attached.pointers;i&&(i.pinchPrecision=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pinchDeltaPercentage",{get:function(){var t=this.inputs.attached.pointers;return t?t.pinchDeltaPercentage:0},set:function(t){var i=this.inputs.attached.pointers;i&&(i.pinchDeltaPercentage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useNaturalPinchZoom",{get:function(){var t=this.inputs.attached.pointers;return t?t.useNaturalPinchZoom:!1},set:function(t){var i=this.inputs.attached.pointers;i&&(i.useNaturalPinchZoom=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"panningSensibility",{get:function(){var t=this.inputs.attached.pointers;return t?t.panningSensibility:0},set:function(t){var i=this.inputs.attached.pointers;i&&(i.panningSensibility=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysUp",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysUp:[]},set:function(t){var i=this.inputs.attached.keyboard;i&&(i.keysUp=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysDown",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysDown:[]},set:function(t){var i=this.inputs.attached.keyboard;i&&(i.keysDown=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysLeft",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysLeft:[]},set:function(t){var i=this.inputs.attached.keyboard;i&&(i.keysLeft=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysRight",{get:function(){var t=this.inputs.attached.keyboard;return t?t.keysRight:[]},set:function(t){var i=this.inputs.attached.keyboard;i&&(i.keysRight=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelPrecision",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelPrecision:0},set:function(t){var i=this.inputs.attached.mousewheel;i&&(i.wheelPrecision=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wheelDeltaPercentage",{get:function(){var t=this.inputs.attached.mousewheel;return t?t.wheelDeltaPercentage:0},set:function(t){var i=this.inputs.attached.mousewheel;i&&(i.wheelDeltaPercentage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(t){t!==this.useBouncingBehavior&&(t?(this._bouncingBehavior=new Br,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(t){t!==this.useFramingBehavior&&(t?(this._framingBehavior=new Ur,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(t){t!==this.useAutoRotationBehavior&&(t?(this._autoRotationBehavior=new xr,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),e.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache._target=new y(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=ne.Zero()},e.prototype._updateCache=function(t){t||r.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},e.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var t=this._targetHost.absolutePosition;this._targetBoundingCenter?t.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(t)}var i=this._getLockedTargetPosition();return i||this._target},e.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),r.prototype.storeState.call(this)},e.prototype._restoreStateValues=function(){return r.prototype._restoreStateValues.call(this)?(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1},e.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronizedViewMatrix.call(this)?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},e.prototype.attachControl=function(t,i,n,a){var s=this;n===void 0&&(n=!0),a===void 0&&(a=2),i=te.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=n,this._panningMouseButton=a,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(i),this._reset=function(){s.inertialAlphaOffset=0,s.inertialBetaOffset=0,s.inertialRadiusOffset=0,s.inertialPanningX=0,s.inertialPanningY=0}},e.prototype.detachControl=function(t){this.inputs.detachElement(),this._reset&&this._reset()},e.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var t=this.inertialAlphaOffset;this.beta<=0&&(t*=-1),this.getScene().useRightHandedSystem&&(t*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.alpha+=t,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<ue&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<ue&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*ue&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){if(this._localDirection||(this._localDirection=y.Zero(),this._transformedDirection=y.Zero()),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),y.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var i=y.DistanceSquared(this._transformedDirection,this.panningOriginTarget);i<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*ue&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*ue&&(this.inertialPanningY=0)}this._checkLimits(),r.prototype._checkInputs.call(this)}},e.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},e.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&y.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var t=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var i=Math.round((t-this.alpha)/(2*Math.PI));this.alpha+=i*2*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},e.prototype.setPosition=function(t){this._position.equals(t)||(this._position.copyFrom(t),this.rebuildAnglesAndRadius())},e.prototype.setTarget=function(t,i,n){if(i===void 0&&(i=!1),n===void 0&&(n=!1),t.getBoundingInfo)i?this._targetBoundingCenter=t.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,t.computeWorldMatrix(),this._targetHost=t,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var a=t,s=this._getTargetPosition();if(s&&!n&&s.equals(a))return;this._targetHost=null,this._target=a,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},e.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),n=Math.cos(this.beta),a=Math.sin(this.beta);a===0&&(a=1e-4),this.radius===0&&(this.radius=1e-4);var s=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*t*a,this.radius*n,this.radius*i*a),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&y.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),s.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var o=this.getScene().collisionCoordinator;this._collider||(this._collider=o.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,o.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var u=this.upVector;this.allowUpsideDown&&a<0&&(u=u.negate()),this._computeViewMatrix(this._position,s,u),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=s,this._viewMatrix},e.prototype.zoomOn=function(t,i){i===void 0&&(i=!1),t=t||this.getScene().meshes;var n=Ae.MinMax(t),a=y.Distance(n.min,n.max);this.radius=a*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:a},i)},e.prototype.focusOn=function(t,i){i===void 0&&(i=!1);var n,a;if(t.min===void 0){var s=t||this.getScene().meshes;n=Ae.MinMax(s),a=y.Distance(n.min,n.max)}else{var o=t;n=o,a=o.distance}this._target=Ae.Center(n),i||(this.maxZ=a*2)},e.prototype.createRigCamera=function(t,i){var n=0;switch(this.cameraRigMode){case J.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.RIG_MODE_VR:n=this._cameraRigParams.stereoHalfAngle*(i===0?1:-1);break;case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n=this._cameraRigParams.stereoHalfAngle*(i===0?-1:1);break}var a=new e(t,this.alpha+n,this.beta,this.radius,this._target,this.getScene());return a._cameraRigParams={},a.isRigCamera=!0,a.rigParent=this,a.upVector=this.upVector,a},e.prototype._updateRigCameras=function(){var t=this._rigCameras[0],i=this._rigCameras[1];switch(t.beta=i.beta=this.beta,this.cameraRigMode){case J.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case J.RIG_MODE_STEREOSCOPIC_OVERUNDER:case J.RIG_MODE_STEREOSCOPIC_INTERLACED:case J.RIG_MODE_VR:t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}r.prototype._updateRigCameras.call(this)},e.prototype.dispose=function(){this.inputs.clear(),r.prototype.dispose.call(this)},e.prototype.getClassName=function(){return"ArcRotateCamera"},b([T()],e.prototype,"alpha",void 0),b([T()],e.prototype,"beta",void 0),b([T()],e.prototype,"radius",void 0),b([Ye("target")],e.prototype,"_target",void 0),b([T()],e.prototype,"inertialAlphaOffset",void 0),b([T()],e.prototype,"inertialBetaOffset",void 0),b([T()],e.prototype,"inertialRadiusOffset",void 0),b([T()],e.prototype,"lowerAlphaLimit",void 0),b([T()],e.prototype,"upperAlphaLimit",void 0),b([T()],e.prototype,"lowerBetaLimit",void 0),b([T()],e.prototype,"upperBetaLimit",void 0),b([T()],e.prototype,"lowerRadiusLimit",void 0),b([T()],e.prototype,"upperRadiusLimit",void 0),b([T()],e.prototype,"inertialPanningX",void 0),b([T()],e.prototype,"inertialPanningY",void 0),b([T()],e.prototype,"pinchToPanMaxDistance",void 0),b([T()],e.prototype,"panningDistanceLimit",void 0),b([Ye()],e.prototype,"panningOriginTarget",void 0),b([T()],e.prototype,"panningInertia",void 0),b([T()],e.prototype,"zoomOnFactor",void 0),b([T()],e.prototype,"targetScreenOffset",void 0),b([T()],e.prototype,"allowUpsideDown",void 0),b([T()],e.prototype,"useInputToRestoreState",void 0),e}(Vr),zt=function(){function r(){this.previousWorldMatrices={},this.previousBones={}}return r.AddUniforms=function(e){e.push("previousWorld","previousViewProjection")},r.AddSamplers=function(e){},r.prototype.bindForSubMesh=function(e,t,i,n,a){t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.getIndex(2)!==-1&&(this.previousWorldMatrices[i.uniqueId]||(this.previousWorldMatrices[i.uniqueId]=R.Identity()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix()),e.setMatrix("previousWorld",this.previousWorldMatrices[i.uniqueId]),e.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[i.uniqueId]=n.clone(),this.previousViewProjection=t.getTransformMatrix().clone())},r}(),Xr=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n._normalMatrix=new R,n._storeEffectOnSubMeshes=!0,n}return e.prototype.getEffect=function(){return this._activeEffect},e.prototype.isReady=function(t,i){return t?!t.subMeshes||t.subMeshes.length===0?!0:this.isReadyForSubMesh(t,t.subMeshes[0],i):!1},e.prototype._isReadyForSubMesh=function(t){var i=t._materialDefines;return!!(!this.checkReadyOnEveryCall&&t.effect&&i&&i._renderId===this.getScene().getRenderId())},e.prototype.bindOnlyWorldMatrix=function(t){this._activeEffect.setMatrix("world",t)},e.prototype.bindOnlyNormalMatrix=function(t){this._activeEffect.setMatrix("normalMatrix",t)},e.prototype.bind=function(t,i){!i||this.bindForSubMesh(t,i,i.subMeshes[0])},e.prototype._afterBind=function(t,i){i===void 0&&(i=null),r.prototype._afterBind.call(this,t),this.getScene()._cachedEffect=i},e.prototype._mustRebind=function(t,i,n){return n===void 0&&(n=1),t.isCachedMaterialInvalid(this,i,n)},e}(ye),Gr=function(){function r(){}return r.BindClipPlane=function(e,t){if(t.clipPlane){var i=t.clipPlane;e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane2){var i=t.clipPlane2;e.setFloat4("vClipPlane2",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane3){var i=t.clipPlane3;e.setFloat4("vClipPlane3",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane4){var i=t.clipPlane4;e.setFloat4("vClipPlane4",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane5){var i=t.clipPlane5;e.setFloat4("vClipPlane5",i.normal.x,i.normal.y,i.normal.z,i.d)}if(t.clipPlane6){var i=t.clipPlane6;e.setFloat4("vClipPlane6",i.normal.x,i.normal.y,i.normal.z,i.d)}},r}(),q=function(){function r(){}return r.BindEyePosition=function(e,t,i){if(i===void 0&&(i="vEyePosition"),t._forcedViewPosition){e.setVector3(i,t._forcedViewPosition);return}var n=t.activeCamera.globalPosition;n||(n=t.activeCamera.devicePosition),e.setVector3(i,t._mirroredCameraPosition?t._mirroredCameraPosition:n)},r.PrepareDefinesForMergedUV=function(e,t,i){t._needUVs=!0,t[i]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[i+"DIRECTUV"]=e.coordinatesIndex+1,e.coordinatesIndex===0?t.MAINUV1=!0:t.MAINUV2=!0):t[i+"DIRECTUV"]=0},r.BindTextureMatrix=function(e,t,i){var n=e.getTextureMatrix();t.updateMatrix(i+"Matrix",n)},r.GetFogState=function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==_t.FOGMODE_NONE},r.PrepareDefinesForMisc=function(e,t,i,n,a,s,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=i,o.POINTSIZE=n,o.FOG=a&&this.GetFogState(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=s)},r.PrepareDefinesForFrameBoundValues=function(e,t,i,n,a,s){a===void 0&&(a=null),s===void 0&&(s=!1);var o=!1,u=!1,l=!1,f=!1,h=!1,c=!1,p=!1;u=a==null?e.clipPlane!==void 0&&e.clipPlane!==null:a,l=a==null?e.clipPlane2!==void 0&&e.clipPlane2!==null:a,f=a==null?e.clipPlane3!==void 0&&e.clipPlane3!==null:a,h=a==null?e.clipPlane4!==void 0&&e.clipPlane4!==null:a,c=a==null?e.clipPlane5!==void 0&&e.clipPlane5!==null:a,p=a==null?e.clipPlane6!==void 0&&e.clipPlane6!==null:a,i.CLIPPLANE!==u&&(i.CLIPPLANE=u,o=!0),i.CLIPPLANE2!==l&&(i.CLIPPLANE2=l,o=!0),i.CLIPPLANE3!==f&&(i.CLIPPLANE3=f,o=!0),i.CLIPPLANE4!==h&&(i.CLIPPLANE4=h,o=!0),i.CLIPPLANE5!==c&&(i.CLIPPLANE5=c,o=!0),i.CLIPPLANE6!==p&&(i.CLIPPLANE6=p,o=!0),i.DEPTHPREPASS!==!t.getColorWrite()&&(i.DEPTHPREPASS=!i.DEPTHPREPASS,o=!0),i.INSTANCES!==n&&(i.INSTANCES=n,o=!0),i.THIN_INSTANCES!==s&&(i.THIN_INSTANCES=s,o=!0),o&&i.markAsUnprocessed()},r.PrepareDefinesForBones=function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var i=t.BONETEXTURE!==void 0;if(e.skeleton.isUsingTextureForMatrices&&i)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=i?!1:void 0;var n=e.getScene().prePassRenderer;if(n&&n.enabled){var a=n.excludedSkinnedMesh.indexOf(e)===-1;t.BONES_VELOCITY_ENABLED=a}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0},r.PrepareDefinesForMorphTargets=function(e,t){var i=e.morphTargetManager;i?(t.MORPHTARGETS_UV=i.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=i.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=i.supportsNormals&&t.NORMAL,t.MORPHTARGETS=i.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=i.numInfluencers):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)},r.PrepareDefinesForAttributes=function(e,t,i,n,a,s){if(a===void 0&&(a=!1),s===void 0&&(s=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;if(t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(_.NormalKind),t._needNormals&&e.isVerticesDataPresent(_.TangentKind)&&(t.TANGENT=!0),t._needUVs?(t.UV1=e.isVerticesDataPresent(_.UVKind),t.UV2=e.isVerticesDataPresent(_.UV2Kind)):(t.UV1=!1,t.UV2=!1),i){var o=e.useVertexColors&&e.isVerticesDataPresent(_.ColorKind);t.VERTEXCOLOR=o,t.VERTEXALPHA=e.hasVertexAlpha&&o&&s}return n&&this.PrepareDefinesForBones(e,t),a&&this.PrepareDefinesForMorphTargets(e,t),!0},r.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var i=t.MULTIVIEW;t.MULTIVIEW=e.activeCamera.outputRenderTarget!==null&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=i&&t.markAsUnprocessed()}},r.PrepareDefinesForPrePass=function(e,t,i){var n=t.PREPASS;if(!!t._arePrePassDirty){var a=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:6,define:"PREPASS_ALBEDO",index:"PREPASS_ALBEDO_INDEX"},{type:5,define:"PREPASS_DEPTHNORMAL",index:"PREPASS_DEPTHNORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&i){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(var s=0;s<a.length;s++){var o=e.prePassRenderer.getIndex(a[s].type);o!==-1?(t[a[s].define]=!0,t[a[s].index]=o):t[a[s].define]=!1}}else{t.PREPASS=!1;for(var s=0;s<a.length;s++)t[a[s].define]=!1}t.PREPASS!=n&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}},r.PrepareDefinesForLight=function(e,t,i,n,a,s,o){switch(o.needNormals=!0,a["LIGHT"+n]===void 0&&(o.needRebuild=!0),a["LIGHT"+n]=!0,a["SPOTLIGHT"+n]=!1,a["HEMILIGHT"+n]=!1,a["POINTLIGHT"+n]=!1,a["DIRLIGHT"+n]=!1,i.prepareLightSpecificDefines(a,n),a["LIGHT_FALLOFF_PHYSICAL"+n]=!1,a["LIGHT_FALLOFF_GLTF"+n]=!1,a["LIGHT_FALLOFF_STANDARD"+n]=!1,i.falloffType){case Ze.FALLOFF_GLTF:a["LIGHT_FALLOFF_GLTF"+n]=!0;break;case Ze.FALLOFF_PHYSICAL:a["LIGHT_FALLOFF_PHYSICAL"+n]=!0;break;case Ze.FALLOFF_STANDARD:a["LIGHT_FALLOFF_STANDARD"+n]=!0;break}if(s&&!i.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),a["SHADOW"+n]=!1,a["SHADOWCSM"+n]=!1,a["SHADOWCSMDEBUG"+n]=!1,a["SHADOWCSMNUM_CASCADES"+n]=!1,a["SHADOWCSMUSESHADOWMAXZ"+n]=!1,a["SHADOWCSMNOBLEND"+n]=!1,a["SHADOWCSM_RIGHTHANDED"+n]=!1,a["SHADOWPCF"+n]=!1,a["SHADOWPCSS"+n]=!1,a["SHADOWPOISSON"+n]=!1,a["SHADOWESM"+n]=!1,a["SHADOWCLOSEESM"+n]=!1,a["SHADOWCUBE"+n]=!1,a["SHADOWLOWQUALITY"+n]=!1,a["SHADOWMEDIUMQUALITY"+n]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&i.shadowEnabled){var u=i.getShadowGenerator();if(u){var l=u.getShadowMap();l&&l.renderList&&l.renderList.length>0&&(o.shadowEnabled=!0,u.prepareDefines(a,n))}}i.lightmapMode!=Ze.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,a["LIGHTMAPEXCLUDED"+n]=!0,a["LIGHTMAPNOSPECULAR"+n]=i.lightmapMode==Ze.LIGHTMAP_SHADOWSONLY):(a["LIGHTMAPEXCLUDED"+n]=!1,a["LIGHTMAPNOSPECULAR"+n]=!1)},r.PrepareDefinesForLights=function(e,t,i,n,a,s){if(a===void 0&&(a=4),s===void 0&&(s=!1),!i._areLightsDirty)return i._needNormals;var o=0,u={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!s)for(var l=0,f=t.lightSources;l<f.length;l++){var h=f[l];if(this.PrepareDefinesForLight(e,t,h,o,i,n,u),o++,o===a)break}i.SPECULARTERM=u.specularEnabled,i.SHADOWS=u.shadowEnabled;for(var c=o;c<a;c++)i["LIGHT"+c]!==void 0&&(i["LIGHT"+c]=!1,i["HEMILIGHT"+c]=!1,i["POINTLIGHT"+c]=!1,i["DIRLIGHT"+c]=!1,i["SPOTLIGHT"+c]=!1,i["SHADOW"+c]=!1,i["SHADOWCSM"+c]=!1,i["SHADOWCSMDEBUG"+c]=!1,i["SHADOWCSMNUM_CASCADES"+c]=!1,i["SHADOWCSMUSESHADOWMAXZ"+c]=!1,i["SHADOWCSMNOBLEND"+c]=!1,i["SHADOWCSM_RIGHTHANDED"+c]=!1,i["SHADOWPCF"+c]=!1,i["SHADOWPCSS"+c]=!1,i["SHADOWPOISSON"+c]=!1,i["SHADOWESM"+c]=!1,i["SHADOWCLOSEESM"+c]=!1,i["SHADOWCUBE"+c]=!1,i["SHADOWLOWQUALITY"+c]=!1,i["SHADOWMEDIUMQUALITY"+c]=!1);var p=e.getEngine().getCaps();return i.SHADOWFLOAT===void 0&&(u.needRebuild=!0),i.SHADOWFLOAT=u.shadowEnabled&&(p.textureFloatRender&&p.textureFloatLinearFiltering||p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering),i.LIGHTMAPEXCLUDED=u.lightmapMode,u.needRebuild&&i.rebuild(),u.needNormals},r.PrepareUniformsAndSamplersForLight=function(e,t,i,n,a,s){a===void 0&&(a=null),s===void 0&&(s=!1),a&&a.push("Light"+e),!s&&(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),i.push("shadowSampler"+e),i.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),n&&(i.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))},r.PrepareUniformsAndSamplersList=function(e,t,i,n){n===void 0&&(n=4);var a,s=null;if(e.uniformsNames){var o=e;a=o.uniformsNames,s=o.uniformBuffersNames,t=o.samplers,i=o.defines,n=o.maxSimultaneousLights||0}else a=e,t||(t=[]);for(var u=0;u<n&&i["LIGHT"+u];u++)this.PrepareUniformsAndSamplersForLight(u,a,t,i["PROJECTEDLIGHTTEXTURE"+u],s);i.NUM_MORPH_INFLUENCERS&&a.push("morphTargetInfluences")},r.HandleFallbacksForShadows=function(e,t,i,n){i===void 0&&(i=4),n===void 0&&(n=0);for(var a=0,s=0;s<i&&e["LIGHT"+s];s++)s>0&&(a=n+s,t.addFallback(a,"LIGHT"+s)),e.SHADOWS||(e["SHADOW"+s]&&t.addFallback(n,"SHADOW"+s),e["SHADOWPCF"+s]&&t.addFallback(n,"SHADOWPCF"+s),e["SHADOWPCSS"+s]&&t.addFallback(n,"SHADOWPCSS"+s),e["SHADOWPOISSON"+s]&&t.addFallback(n,"SHADOWPOISSON"+s),e["SHADOWESM"+s]&&t.addFallback(n,"SHADOWESM"+s),e["SHADOWCLOSEESM"+s]&&t.addFallback(n,"SHADOWCLOSEESM"+s));return a++},r.PrepareAttributesForMorphTargetsInfluencers=function(e,t,i){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=i,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)},r.PrepareAttributesForMorphTargets=function(e,t,i){var n=i.NUM_MORPH_INFLUENCERS;if(n>0&&de.LastCreatedEngine)for(var a=de.LastCreatedEngine.getCaps().maxVertexAttribs,s=t.morphTargetManager,o=s&&s.supportsNormals&&i.NORMAL,u=s&&s.supportsTangents&&i.TANGENT,l=s&&s.supportsUVs&&i.UV1,f=0;f<n;f++)e.push(_.PositionKind+f),o&&e.push(_.NormalKind+f),u&&e.push(_.TangentKind+f),l&&e.push(_.UVKind+"_"+f),e.length>a&&L.Error("Cannot add more vertex attributes for mesh "+t.name)},r.PrepareAttributesForBones=function(e,t,i,n){i.NUM_BONE_INFLUENCERS>0&&(n.addCPUSkinningFallback(0,t),e.push(_.MatricesIndicesKind),e.push(_.MatricesWeightsKind),i.NUM_BONE_INFLUENCERS>4&&(e.push(_.MatricesIndicesExtraKind),e.push(_.MatricesWeightsExtraKind)))},r.PrepareAttributesForInstances=function(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e)},r.PushAttributesForInstances=function(e){e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3")},r.BindLightProperties=function(e,t,i){e.transferToEffect(t,i+"")},r.BindLight=function(e,t,i,n,a,s){s===void 0&&(s=!1),e._bindLight(t,i,n,a,s)},r.BindLights=function(e,t,i,n,a,s){a===void 0&&(a=4),s===void 0&&(s=!1);for(var o=Math.min(t.lightSources.length,a),u=0;u<o;u++){var l=t.lightSources[u];this.BindLight(l,u,e,i,typeof n=="boolean"?n:n.SPECULARTERM,s)}},r.BindFogParameters=function(e,t,i,n){n===void 0&&(n=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==_t.FOGMODE_NONE&&(i.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),n?(e.fogColor.toLinearSpaceToRef(this._tempFogColor),i.setColor3("vFogColor",this._tempFogColor)):i.setColor3("vFogColor",e.fogColor))},r.BindBonesParameters=function(e,t,i){if(!(!t||!e)&&(e.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(e.computeBonesUsingShaders=!1),e.useBones&&e.computeBonesUsingShaders&&e.skeleton)){var n=e.skeleton;if(n.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){var a=n.getTransformMatrixTexture(e);t.setTexture("boneSampler",a),t.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var s=n.getTransformMatrices(e);s&&(t.setMatrices("mBones",s),i&&e.getScene().prePassRenderer&&e.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[e.uniqueId]&&t.setMatrices("mPreviousBones",i.previousBones[e.uniqueId]),r._CopyBonesTransformationMatrices(s,i.previousBones[e.uniqueId])))}}},r._CopyBonesTransformationMatrices=function(e,t){return t.set(e),t},r.BindMorphTargetParameters=function(e,t){var i=e.morphTargetManager;!e||!i||t.setFloatArray("morphTargetInfluences",i.influences)},r.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},r.BindClipPlane=function(e,t){Gr.BindClipPlane(e,t)},r._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},r._tempFogColor=ae.Black(),r}(),Hr=function(){function r(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Lt.Zero(),this._cachedBaseSize=Lt.Zero(),this._texture=e,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(r.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:!1},set:function(e){!this._texture||(this._texture.isCube=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"is3D",{get:function(){return this._texture?this._texture.is3D:!1},set:function(e){!this._texture||(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"is2DArray",{get:function(){return this._texture?this._texture.is2DArray:!1},set:function(e){!this._texture||(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"ThinTexture"},r.prototype.isReady=function(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1},r.prototype.delayLoad=function(){},r.prototype.getInternalTexture=function(){return this._texture},r.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},r.prototype.getBaseSize=function(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)},r.prototype.updateSamplingMode=function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)},r.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},r.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},r}(),Kr=function(r){N(e,r);function e(t){var i=r.call(this,null)||this;return i.metadata=null,i.reservedDataStore=null,i._hasAlpha=!1,i.getAlphaFromRGB=!1,i.level=1,i.coordinatesIndex=0,i._coordinatesMode=0,i.wrapR=1,i.anisotropicFilteringLevel=e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,i._isCube=!1,i._gammaSpace=!0,i.invertZ=!1,i.lodLevelInAlpha=!1,i.isRenderTarget=!1,i._prefiltered=!1,i.animations=new Array,i.onDisposeObservable=new D,i._onDisposeObserver=null,i._scene=null,i._texture=null,i._uid=null,t?e._isScene(t)?i._scene=t:i._engine=t:i._scene=de.LastCreatedScene,i._scene&&(i.uniqueId=i._scene.getUniqueId(),i._scene.addTexture(i),i._engine=i._scene.getEngine()),i._uid=null,i}return Object.defineProperty(e.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(17))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._wrapU},set:function(t){this._wrapU=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._wrapV},set:function(t){this._wrapV=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(t){this._texture?this._texture.isCube=t:this._isCube=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return this._texture?this._texture.is3D:!1},set:function(t){!this._texture||(this._texture.is3D=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is2DArray",{get:function(){return this._texture?this._texture.is2DArray:!1},set:function(t){!this._texture||(this._texture.is2DArray=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gammaSpace",{get:function(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace},set:function(t){if(this._texture){if(this._texture._gammaSpace===t)return;this._texture._gammaSpace=t}else{if(this._gammaSpace===t)return;this._gammaSpace=t}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(t){this._texture&&(this._texture._isRGBD=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(t){this._texture&&(this._texture._lodGenerationOffset=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(t){this._texture&&(this._texture._lodGenerationScale=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linearSpecularLOD",{get:function(){return this._texture?this._texture._linearSpecularLOD:!1},set:function(t){this._texture&&(this._texture._linearSpecularLOD=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(t){this._texture&&(this._texture._irradianceTexture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this._uid||(this._uid=Ti.RandomId()),this._uid},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name},e.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(e.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype._getEngine=function(){return this._engine},e.prototype.checkTransformsAreIdentical=function(t){return t!==null},e.prototype.getTextureMatrix=function(){return R.IdentityReadOnly},e.prototype.getReflectionTextureMatrix=function(){return R.IdentityReadOnly},e.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},e.prototype.scale=function(t){},Object.defineProperty(e.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype._getFromCache=function(t,i,n,a){var s=this._getEngine();if(!s)return null;for(var o=s.getLoadedTexturesCache(),u=0;u<o.length;u++){var l=o[u];if((a===void 0||a===l.invertY)&&l.url===t&&l.generateMipMaps===!i&&(!n||n===l.samplingMode))return l.incrementReferences(),l}return null},e.prototype._rebuild=function(){},e.prototype.clone=function(){return null},Object.defineProperty(e.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:5},enumerable:!1,configurable:!0}),e.prototype._markAllSubMeshesAsTexturesDirty=function(){var t=this.getScene();!t||t.markAllMaterialsAsDirty(1)},e.prototype.readPixels=function(t,i,n){if(t===void 0&&(t=0),i===void 0&&(i=0),n===void 0&&(n=null),!this._texture)return null;var a=this.getSize(),s=a.width,o=a.height,u=this._getEngine();if(!u)return null;i!=0&&(s=s/Math.pow(2,i),o=o/Math.pow(2,i),s=Math.round(s),o=Math.round(o));try{return this._texture.isCube?u._readTexturePixels(this._texture,s,o,t,i,n):u._readTexturePixels(this._texture,s,o,-1,i,n)}catch{return null}},Object.defineProperty(e.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var t=this._scene.textures.indexOf(this);t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),r.prototype.dispose.call(this)},e.prototype.serialize=function(){if(!this.name)return null;var t=H.Serialize(this);return H.AppendSerializedAnimations(this,t),t},e.WhenAllReady=function(t,i){var n=t.length;if(n===0){i();return}for(var a=0;a<t.length;a++){var s=t[a];if(s.isReady())--n===0&&i();else{var o=s.onLoadObservable;o&&o.addOnce(function(){--n===0&&i()})}}},e._isScene=function(t){return t.getClassName()==="Scene"},e.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,b([T()],e.prototype,"uniqueId",void 0),b([T()],e.prototype,"name",void 0),b([T()],e.prototype,"metadata",void 0),b([T("hasAlpha")],e.prototype,"_hasAlpha",void 0),b([T()],e.prototype,"getAlphaFromRGB",void 0),b([T()],e.prototype,"level",void 0),b([T()],e.prototype,"coordinatesIndex",void 0),b([T("coordinatesMode")],e.prototype,"_coordinatesMode",void 0),b([T()],e.prototype,"wrapU",null),b([T()],e.prototype,"wrapV",null),b([T()],e.prototype,"wrapR",void 0),b([T()],e.prototype,"anisotropicFilteringLevel",void 0),b([T()],e.prototype,"isCube",null),b([T()],e.prototype,"is3D",null),b([T()],e.prototype,"is2DArray",null),b([T()],e.prototype,"gammaSpace",null),b([T()],e.prototype,"invertZ",void 0),b([T()],e.prototype,"lodLevelInAlpha",void 0),b([T()],e.prototype,"lodGenerationOffset",null),b([T()],e.prototype,"lodGenerationScale",null),b([T()],e.prototype,"linearSpecularLOD",null),b([Ce()],e.prototype,"irradianceTexture",null),b([T()],e.prototype,"isRenderTarget",void 0),e}(Hr),jr=function(){function r(){}return r.GenerateBase64StringFromTexture=function(e,t,i){t===void 0&&(t=0),i===void 0&&(i=0);var n=e.getInternalTexture();if(!n)return null;var a=e.readPixels(t,i);if(!a)return null;var s=e.getSize(),o=s.width,u=s.height;if(a instanceof Float32Array){for(var l=a.byteLength/a.BYTES_PER_ELEMENT,f=new Uint8Array(l);--l>=0;){var h=a[l];h<0?h=0:h>1&&(h=1),f[l]=h*255}a=f}var c=document.createElement("canvas");c.width=o,c.height=u;var p=c.getContext("2d");if(!p)return null;var d=p.createImageData(o,u),g=d.data;if(g.set(a),p.putImageData(d,0,0),n.invertY){var m=document.createElement("canvas");m.width=o,m.height=u;var E=m.getContext("2d");return E?(E.translate(0,u),E.scale(1,-1),E.drawImage(c,0,0),m.toDataURL("image/png")):null}return c.toDataURL("image/png")},r}(),Pe=function(r){N(e,r);function e(t,i,n,a,s,o,u,l,f,h,c,p){n===void 0&&(n=!1),a===void 0&&(a=!0),s===void 0&&(s=e.TRILINEAR_SAMPLINGMODE),o===void 0&&(o=null),u===void 0&&(u=null),l===void 0&&(l=null),f===void 0&&(f=!1);var d=r.call(this,i)||this;d.url=null,d.uOffset=0,d.vOffset=0,d.uScale=1,d.vScale=1,d.uAng=0,d.vAng=0,d.wAng=0,d.uRotationCenter=.5,d.vRotationCenter=.5,d.wRotationCenter=.5,d.homogeneousRotationInUVTransform=!1,d.inspectableCustomProperties=null,d._noMipmap=!1,d._invertY=!1,d._rowGenerationMatrix=null,d._cachedTextureMatrix=null,d._projectionModeMatrix=null,d._t0=null,d._t1=null,d._t2=null,d._cachedUOffset=-1,d._cachedVOffset=-1,d._cachedUScale=0,d._cachedVScale=0,d._cachedUAng=-1,d._cachedVAng=-1,d._cachedWAng=-1,d._cachedProjectionMatrixId=-1,d._cachedURotationCenter=-1,d._cachedVRotationCenter=-1,d._cachedWRotationCenter=-1,d._cachedHomogeneousRotationInUVTransform=!1,d._cachedCoordinatesMode=-1,d._initialSamplingMode=e.BILINEAR_SAMPLINGMODE,d._buffer=null,d._deleteBuffer=!1,d._format=null,d._delayedOnLoad=null,d._delayedOnError=null,d.onLoadObservable=new D,d._isBlocking=!0,d.name=t||"",d.url=t,d._noMipmap=n,d._invertY=a,d._initialSamplingMode=s,d._buffer=l,d._deleteBuffer=f,d._mimeType=c,d._loaderOptions=p,h&&(d._format=h);var g=d.getScene(),m=d._getEngine();if(!m)return d;m.onBeforeTextureInitObservable.notifyObservers(d);var E=function(){d._texture&&(d._texture._invertVScale&&(d.vScale*=-1,d.vOffset+=1),d._texture._cachedWrapU!==null&&(d.wrapU=d._texture._cachedWrapU,d._texture._cachedWrapU=null),d._texture._cachedWrapV!==null&&(d.wrapV=d._texture._cachedWrapV,d._texture._cachedWrapV=null),d._texture._cachedWrapR!==null&&(d.wrapR=d._texture._cachedWrapR,d._texture._cachedWrapR=null)),d.onLoadObservable.hasObservers()&&d.onLoadObservable.notifyObservers(d),o&&o(),!d.isBlocking&&g&&g.resetCachedMaterial()};return d.url?(d._texture=d._getFromCache(d.url,n,s,a),d._texture?d._texture.isReady?jt.SetImmediate(function(){return E()}):d._texture.onLoadedObservable.add(E):!g||!g.useDelayedTextureLoading?(d._texture=m.createTexture(d.url,n,a,g,s,E,u,d._buffer,void 0,d._format,null,c,p),f&&(d._buffer=null)):(d.delayLoadState=4,d._delayedOnLoad=E,d._delayedOnError=u),d):(d._delayedOnLoad=E,d._delayedOnError=u,d)}return Object.defineProperty(e.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(t){this._isBlocking=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),e.prototype.updateURL=function(t,i,n){i===void 0&&(i=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),(!this.name||De.StartsWith(this.name,"data:"))&&(this.name=t),this.url=t,this._buffer=i,this.delayLoadState=4,n&&(this._delayedOnLoad=n),this.delayLoad()},e.prototype.delayLoad=function(){if(this.delayLoadState===4){var t=this.getScene();!t||(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?jt.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=t.getEngine().createTexture(this.url,this._noMipmap,this._invertY,t,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},e.prototype._prepareRowForTextureGeneration=function(t,i,n,a){t*=this._cachedUScale,i*=this._cachedVScale,t-=this.uRotationCenter*this._cachedUScale,i-=this.vRotationCenter*this._cachedVScale,n-=this.wRotationCenter,y.TransformCoordinatesFromFloatsToRef(t,i,n,this._rowGenerationMatrix,a),a.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,a.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,a.z+=this.wRotationCenter},e.prototype.checkTransformsAreIdentical=function(t){return t!==null&&this.uOffset===t.uOffset&&this.vOffset===t.vOffset&&this.uScale===t.uScale&&this.vScale===t.vScale&&this.uAng===t.uAng&&this.vAng===t.vAng&&this.wAng===t.wAng},e.prototype.getTextureMatrix=function(t){var i=this;if(t===void 0&&(t=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*t===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*t,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=R.Zero(),this._rowGenerationMatrix=new R,this._t0=y.Zero(),this._t1=y.Zero(),this._t2=y.Zero()),R.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(R.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,I.Matrix[0]),R.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,I.Matrix[1]),R.ScalingToRef(this._cachedUScale,this._cachedVScale,0,I.Matrix[2]),R.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,I.Matrix[3]),I.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(I.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(I.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(I.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),R.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var n=this.getScene();return n?(n.markAllMaterialsAsDirty(1,function(a){return a.hasTexture(i)}),this._cachedTextureMatrix):this._cachedTextureMatrix},e.prototype.getReflectionTextureMatrix=function(){var t=this,i=this.getScene();if(!i)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)if(this.coordinatesMode===e.PROJECTION_MODE){if(this._cachedProjectionMatrixId===i.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}else return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=R.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=R.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case e.PLANAR_MODE:R.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case e.PROJECTION_MODE:R.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var n=i.getProjectionMatrix();this._cachedProjectionMatrixId=n.updateFlag,n.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:R.IdentityToRef(this._cachedTextureMatrix);break}return i.markAllMaterialsAsDirty(1,function(a){return a.getActiveTextures().indexOf(t)!==-1}),this._cachedTextureMatrix},e.prototype.clone=function(){var t=this;return H.Clone(function(){return new e(t._texture?t._texture.url:null,t.getScene(),t._noMipmap,t._invertY,t.samplingMode,void 0,void 0,t._texture?t._texture._buffer:void 0)},this)},e.prototype.serialize=function(){var t=this.name;e.SerializeBuffers||De.StartsWith(this.name,"data:")&&(this.name=""),De.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var i=r.prototype.serialize.call(this);return i?((e.SerializeBuffers||e.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&De.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+De.EncodeArrayBufferToBase64(this._buffer):e.ForceSerializeBuffers&&(i.base64String=jr.GenerateBase64StringFromTexture(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,this.name=t,i):null},e.prototype.getClassName=function(){return"Texture"},e.prototype.dispose=function(){r.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},e.Parse=function(t,i,n){if(t.customType){var a=Dt.Instantiate(t.customType),s=a.Parse(t,i,n);return t.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==t.samplingMode&&s.updateSamplingMode(t.samplingMode),s}if(t.isCube&&!t.isRenderTarget)return e._CubeTextureParser(t,i,n);if(!t.name&&!t.isRenderTarget)return null;var o=function(){if(u&&u._texture&&(u._texture._cachedWrapU=null,u._texture._cachedWrapV=null,u._texture._cachedWrapR=null),t.samplingMode){var l=t.samplingMode;u&&u.samplingMode!==l&&u.updateSamplingMode(l)}if(u&&t.animations)for(var f=0;f<t.animations.length;f++){var h=t.animations[f],c=_e.GetClass("BABYLON.Animation");c&&u.animations.push(c.Parse(h))}},u=H.Parse(function(){var l=!0;if(t.noMipmap&&(l=!1),t.mirrorPlane){var f=e._CreateMirror(t.name,t.renderTargetSize,i,l);return f._waitingRenderList=t.renderList,f.mirrorPlane=ri.FromArray(t.mirrorPlane),o(),f}else if(t.isRenderTarget){var h=null;if(t.isCube){if(i.reflectionProbes)for(var c=0;c<i.reflectionProbes.length;c++){var p=i.reflectionProbes[c];if(p.name===t.name)return p.cubeTexture}}else h=e._CreateRenderTargetTexture(t.name,t.renderTargetSize,i,l),h._waitingRenderList=t.renderList;return o(),h}else{var d;if(t.base64String)d=e.CreateFromBase64String(t.base64String,t.name,i,!l,t.invertY,void 0,o);else{var g=void 0;t.name&&t.name.indexOf("://")>0?g=t.name:g=n+t.name,(De.StartsWith(t.url,"data:")||e.UseSerializedUrlIfAny&&t.url)&&(g=t.url),d=new e(g,i,!l,t.invertY,void 0,o)}return d}},t,i);return u},e.CreateFromBase64String=function(t,i,n,a,s,o,u,l,f){return o===void 0&&(o=e.TRILINEAR_SAMPLINGMODE),u===void 0&&(u=null),l===void 0&&(l=null),f===void 0&&(f=5),new e("data:"+i,n,a,s,o,u,l,t,!1,f)},e.LoadFromDataString=function(t,i,n,a,s,o,u,l,f,h){return a===void 0&&(a=!1),s===void 0&&(s=!1),o===void 0&&(o=!0),u===void 0&&(u=e.TRILINEAR_SAMPLINGMODE),l===void 0&&(l=null),f===void 0&&(f=null),h===void 0&&(h=5),t.substr(0,5)!=="data:"&&(t="data:"+t),new e(t,n,s,o,u,l,f,i,a,h)},e.SerializeBuffers=!0,e.ForceSerializeBuffers=!1,e._CubeTextureParser=function(t,i,n){throw O.WarnImport("CubeTexture")},e._CreateMirror=function(t,i,n,a){throw O.WarnImport("MirrorTexture")},e._CreateRenderTargetTexture=function(t,i,n,a){throw O.WarnImport("RenderTargetTexture")},e.NEAREST_SAMPLINGMODE=1,e.NEAREST_NEAREST_MIPLINEAR=8,e.BILINEAR_SAMPLINGMODE=2,e.LINEAR_LINEAR_MIPNEAREST=11,e.TRILINEAR_SAMPLINGMODE=3,e.LINEAR_LINEAR_MIPLINEAR=3,e.NEAREST_NEAREST_MIPNEAREST=4,e.NEAREST_LINEAR_MIPNEAREST=5,e.NEAREST_LINEAR_MIPLINEAR=6,e.NEAREST_LINEAR=7,e.NEAREST_NEAREST=1,e.LINEAR_NEAREST_MIPNEAREST=9,e.LINEAR_NEAREST_MIPLINEAR=10,e.LINEAR_LINEAR=2,e.LINEAR_NEAREST=12,e.EXPLICIT_MODE=0,e.SPHERICAL_MODE=1,e.PLANAR_MODE=2,e.CUBIC_MODE=3,e.PROJECTION_MODE=4,e.SKYBOX_MODE=5,e.INVCUBIC_MODE=6,e.EQUIRECTANGULAR_MODE=7,e.FIXED_EQUIRECTANGULAR_MODE=8,e.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,e.CLAMP_ADDRESSMODE=0,e.WRAP_ADDRESSMODE=1,e.MIRROR_ADDRESSMODE=2,e.UseSerializedUrlIfAny=!1,b([T()],e.prototype,"url",void 0),b([T()],e.prototype,"uOffset",void 0),b([T()],e.prototype,"vOffset",void 0),b([T()],e.prototype,"uScale",void 0),b([T()],e.prototype,"vScale",void 0),b([T()],e.prototype,"uAng",void 0),b([T()],e.prototype,"vAng",void 0),b([T()],e.prototype,"wAng",void 0),b([T()],e.prototype,"uRotationCenter",void 0),b([T()],e.prototype,"vRotationCenter",void 0),b([T()],e.prototype,"wRotationCenter",void 0),b([T()],e.prototype,"homogeneousRotationInUVTransform",void 0),b([T()],e.prototype,"isBlocking",null),e}(Kr);_e.RegisteredTypes["BABYLON.Texture"]=Pe;H._TextureParser=Pe.Parse;var ee=function(){function r(){}return Object.defineProperty(r,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(e){this._DiffuseTextureEnabled!==e&&(this._DiffuseTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(e){this._DetailTextureEnabled!==e&&(this._DetailTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(e){this._AmbientTextureEnabled!==e&&(this._AmbientTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(e){this._OpacityTextureEnabled!==e&&(this._OpacityTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(e){this._ReflectionTextureEnabled!==e&&(this._ReflectionTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(e){this._EmissiveTextureEnabled!==e&&(this._EmissiveTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(e){this._SpecularTextureEnabled!==e&&(this._SpecularTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(e){this._BumpTextureEnabled!==e&&(this._BumpTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(e){this._LightmapTextureEnabled!==e&&(this._LightmapTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(e){this._RefractionTextureEnabled!==e&&(this._RefractionTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(e){this._ColorGradingTextureEnabled!==e&&(this._ColorGradingTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(e){this._FresnelEnabled!==e&&(this._FresnelEnabled=e,ce.MarkAllMaterialsAsDirty(4))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(e){this._ClearCoatTextureEnabled!==e&&(this._ClearCoatTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(e){this._ClearCoatBumpTextureEnabled!==e&&(this._ClearCoatBumpTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(e){this._ClearCoatTintTextureEnabled!==e&&(this._ClearCoatTintTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(e){this._SheenTextureEnabled!==e&&(this._SheenTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(e){this._AnisotropicTextureEnabled!==e&&(this._AnisotropicTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(e){this._ThicknessTextureEnabled!==e&&(this._ThicknessTextureEnabled=e,ce.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),r._DiffuseTextureEnabled=!0,r._DetailTextureEnabled=!0,r._AmbientTextureEnabled=!0,r._OpacityTextureEnabled=!0,r._ReflectionTextureEnabled=!0,r._EmissiveTextureEnabled=!0,r._SpecularTextureEnabled=!0,r._BumpTextureEnabled=!0,r._LightmapTextureEnabled=!0,r._RefractionTextureEnabled=!0,r._ColorGradingTextureEnabled=!0,r._FresnelEnabled=!0,r._ClearCoatTextureEnabled=!0,r._ClearCoatBumpTextureEnabled=!0,r._ClearCoatTintTextureEnabled=!0,r._SheenTextureEnabled=!0,r._AnisotropicTextureEnabled=!0,r._ThicknessTextureEnabled=!0,r}(),Yr="defaultFragmentDeclaration",qr=`uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif`;w.IncludesShadersStore[Yr]=qr;var Qr="defaultUboDeclaration",Zr=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
float visibility;
vec4 vDiffuseColor;
vec4 vDetailInfos;
mat4 detailMatrix;
};
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
};
`;w.IncludesShadersStore[Qr]=Zr;var $r="prePassDeclaration",Jr=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
#ifdef WEBGL2
layout(location=0) out highp vec4 glFragData[{X}];
highp vec4 gl_FragColor;
#endif
#ifdef PREPASS_DEPTHNORMAL
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;
varying highp vec4 vPreviousPosition;
#endif
#endif
`;w.IncludesShadersStore[$r]=Jr;var en="helperFunctions",tn=`const float PI=3.1415926535897932384626433832795;
const float HALF_MIN=5.96046448e-08;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float toLinearSpace(float color)
{
return pow(color,LinearEncodePowerApprox);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec4 toLinearSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
vec4 toGammaSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(rgb,D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;w.IncludesShadersStore[en]=tn;var rn="lightFragmentDeclaration",nn=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;w.IncludesShadersStore[rn]=nn;var an="lightUboDeclaration",sn=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;w.IncludesShadersStore[an]=sn;var on="lightsFragmentFunctions",un=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;w.IncludesShadersStore[on]=un;var ln="shadowsFragmentFunctions",fn=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
#define inline
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;
}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
#define inline
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
#define inline
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#ifdef WEBGL2
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#ifdef WEBGL2
#define GREATEST_LESS_THAN_ONE 0.99999994

#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}





#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;w.IncludesShadersStore[ln]=fn;var hn="fresnelFunction",cn=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;w.IncludesShadersStore[hn]=cn;var dn="reflectionFunction",pn=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,1.));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;w.IncludesShadersStore[dn]=pn;var _n="imageProcessingDeclaration",gn=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;w.IncludesShadersStore[_n]=gn;var vn="imageProcessingFunctions",mn=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;w.IncludesShadersStore[vn]=mn;var yn="bumpFragmentMainFunctions",bn=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

uv=gl_FrontFacing ? uv : -uv;

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
`;w.IncludesShadersStore[yn]=bn;var En="bumpFragmentFunctions",Tn=`#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(DETAIL)
#if DETAILDIRECTUV == 1
#define vDetailUV vMainUV1
#elif DETAILDIRECTUV == 2
#define vDetailUV vMainUV2
#else
varying vec2 vDetailUV;
#endif
uniform sampler2D detailSampler;
#endif
#if defined(BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;w.IncludesShadersStore[En]=Tn;var An="clipPlaneFragmentDeclaration",Sn=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;w.IncludesShadersStore[An]=Sn;var Mn="logDepthDeclaration",Pn=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;w.IncludesShadersStore[Mn]=Pn;var Rn="fogFragmentDeclaration",Cn=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;w.IncludesShadersStore[Rn]=Cn;var In="clipPlaneFragment",Dn=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;w.IncludesShadersStore[In]=Dn;var On="bumpFragment",xn=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vBumpUV);
#else
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,vDetailUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else
mat3 TBN=cotangent_frame(normalW,vPositionW,vMainUV1,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);
vec2 detailNormalRG=detailColor.wy*2.0-1.0;
float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));
vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;

#if DETAIL_NORMALBLENDMETHOD == 0
detailNormal.xy*=vDetailInfos.z;
vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD == 1
detailNormal.xy*=vDetailInfos.z;
bumpNormal+=vec3(0.0,0.0,1.0);
detailNormal*=vec3(-1.0,-1.0,1.0);
vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;
normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif`;w.IncludesShadersStore[On]=xn;var Fn="depthPrePass",wn=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;w.IncludesShadersStore[Fn]=wn;var Ln="lightFragment",Nn=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;w.IncludesShadersStore[Ln]=Nn;var Bn="logDepthFragment",Un=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;w.IncludesShadersStore[Bn]=Un;var Vn="fogFragment",kn=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;w.IncludesShadersStore[Vn]=kn;var Wn="defaultPixelShader",zn=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vEyePosition;
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector);
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif

vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
gl_FragData[0]=color;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,1.0);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,1.0);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_DEPTHNORMAL
gl_FragData[PREPASS_DEPTHNORMAL_INDEX]=vec4(vViewPos.z,(view*vec4(normalW,0.0)).rgb);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=specularMapColor;
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
}
`;w.ShadersStore[Wn]=zn;var Xn="defaultVertexDeclaration",Gn=`
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
`;w.IncludesShadersStore[Xn]=Gn;var Hn="bonesDeclaration",Kn=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;w.IncludesShadersStore[Hn]=Kn;var jn="instancesDeclaration",Yn=`#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#ifdef THIN_INSTANCES
uniform mat4 world;
#endif
#else
uniform mat4 world;
#endif`;w.IncludesShadersStore[jn]=Yn;var qn="prePassVertexDeclaration",Qn=`#ifdef PREPASS
#ifdef PREPASS_DEPTHNORMAL
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#endif`;w.IncludesShadersStore[qn]=Qn;var Zn="bumpVertexDeclaration",$n=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;w.IncludesShadersStore[Zn]=$n;var Jn="clipPlaneVertexDeclaration",ea=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;w.IncludesShadersStore[Jn]=ea;var ta="fogVertexDeclaration",ia=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;w.IncludesShadersStore[ta]=ia;var ra="morphTargetsVertexGlobalDeclaration",na=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#endif`;w.IncludesShadersStore[ra]=na;var aa="morphTargetsVertexDeclaration",sa=`#ifdef MORPHTARGETS
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif`;w.IncludesShadersStore[aa]=sa;var oa="morphTargetsVertex",ua=`#ifdef MORPHTARGETS
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif`;w.IncludesShadersStore[oa]=ua;var la="instancesVertex",fa=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#endif
#else
mat4 finalWorld=world;
#endif`;w.IncludesShadersStore[la]=fa;var ha="bonesVertex",ca=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;w.IncludesShadersStore[ha]=ca;var da="prePassVertex",pa=`#ifdef PREPASS_DEPTHNORMAL
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif`;w.IncludesShadersStore[da]=pa;var _a="bumpVertex",ga=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;w.IncludesShadersStore[_a]=ga;var va="clipPlaneVertex",ma=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;w.IncludesShadersStore[va]=ma;var ya="fogVertex",ba=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;w.IncludesShadersStore[ya]=ba;var Ea="shadowsVertex",Ta=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;w.IncludesShadersStore[Ea]=Ta;var Aa="pointCloudVertex",Sa=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`;w.IncludesShadersStore[Aa]=Sa;var Ma="logDepthVertex",Pa=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;w.IncludesShadersStore[Ma]=Pa;var Ra="defaultVertexShader",Ca=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>

#include<instancesDeclaration>
#include<prePassVertexDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;w.ShadersStore[Ra]=Ca;var Ia=function(){function r(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return r.prototype.unBindMesh=function(){this._mesh=null},r.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},r.prototype.addCPUSkinningFallback=function(e,t){this._mesh=t,e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(r.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),r.prototype.reduce=function(e,t){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,e=e.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;for(var i=this._mesh.getScene(),n=0;n<i.meshes.length;n++){var a=i.meshes[n];if(!a.material){!this._mesh.material&&a.computeBonesUsingShaders&&a.numBoneInfluencers>0&&(a.computeBonesUsingShaders=!1);continue}if(!(!a.computeBonesUsingShaders||a.numBoneInfluencers===0)){if(a.material.getEffect()===t)a.computeBonesUsingShaders=!1;else if(a.subMeshes)for(var s=0,o=a.subMeshes;s<o.length;s++){var u=o[s],l=u.effect;if(l===t){a.computeBonesUsingShaders=!1;break}}}}}else{var f=this._defines[this._currentRank];if(f)for(var n=0;n<f.length;n++)e=e.replace("#define "+f[n],"");this._currentRank++}return e},r}(),Ct=function(){function r(e){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=ye.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e}return r.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},r.prototype.isReadyForSubMesh=function(e,t){var i=t.getEngine();return!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&ee.DetailTextureEnabled&&!this._texture.isReady())},r.prototype.prepareDefines=function(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&ee.DetailTextureEnabled&&this._isEnabled?(q.PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1},r.prototype.bindForSubMesh=function(e,t,i){!this._isEnabled||((!e.useUbo||!i||!e.isSync)&&this._texture&&ee.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),q.BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&ee.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture))},r.prototype.hasTexture=function(e){return this._texture===e},r.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},r.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},r.prototype.dispose=function(e){var t;e&&((t=this._texture)===null||t===void 0||t.dispose())},r.prototype.getClassName=function(){return"DetailMap"},r.AddUniforms=function(e){e.push("vDetailInfos")},r.AddSamplers=function(e){e.push("detailSampler")},r.PrepareUniformBuffer=function(e){e.addUniform("vDetailInfos",4),e.addUniform("detailMatrix",16)},r.prototype.copyTo=function(e){H.Clone(function(){return e},this)},r.prototype.serialize=function(){return H.Serialize(this)},r.prototype.parse=function(e,t,i){var n=this;H.Parse(function(){return n},e,t,i)},b([Ce("detailTexture"),Y("_markAllSubMeshesAsTexturesDirty")],r.prototype,"texture",void 0),b([T()],r.prototype,"diffuseBlendLevel",void 0),b([T()],r.prototype,"roughnessBlendLevel",void 0),b([T()],r.prototype,"bumpLevel",void 0),b([T(),Y("_markAllSubMeshesAsTexturesDirty")],r.prototype,"normalBlendMethod",void 0),b([T(),Y("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isEnabled",void 0),r}(),Xt={effect:null,subMesh:null},Da=function(r){N(e,r);function e(){var t=r.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.DETAIL=!1,t.DETAILDIRECTUV=0,t.DETAIL_NORMALBLENDMETHOD=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.BONES_VELOCITY_ENABLED=!1,t.INSTANCES=!1,t.THIN_INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_UV=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,t.ALPHABLEND=!0,t.PREPASS=!1,t.PREPASS_IRRADIANCE=!1,t.PREPASS_IRRADIANCE_INDEX=-1,t.PREPASS_ALBEDO=!1,t.PREPASS_ALBEDO_INDEX=-1,t.PREPASS_DEPTHNORMAL=!1,t.PREPASS_DEPTHNORMAL_INDEX=-1,t.PREPASS_POSITION=!1,t.PREPASS_POSITION_INDEX=-1,t.PREPASS_VELOCITY=!1,t.PREPASS_VELOCITY_INDEX=-1,t.PREPASS_REFLECTIVITY=!1,t.PREPASS_REFLECTIVITY_INDEX=-1,t.SCENE_MRT_COUNT=0,t.RGBDLIGHTMAP=!1,t.RGBDREFLECTION=!1,t.RGBDREFRACTION=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.MULTIVIEW=!1,t.IS_REFLECTION_LINEAR=!1,t.IS_REFRACTION_LINEAR=!1,t.EXPOSURE=!1,t.rebuild(),t}return e.prototype.setReflectionMode=function(t){for(var i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"],n=0,a=i;n<a.length;n++){var s=a[n];this[s]=s===t}},e}(Si),Nt=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n._diffuseTexture=null,n._ambientTexture=null,n._opacityTexture=null,n._reflectionTexture=null,n._emissiveTexture=null,n._specularTexture=null,n._bumpTexture=null,n._lightmapTexture=null,n._refractionTexture=null,n.ambientColor=new ae(0,0,0),n.diffuseColor=new ae(1,1,1),n.specularColor=new ae(1,1,1),n.emissiveColor=new ae(0,0,0),n.specularPower=64,n._useAlphaFromDiffuseTexture=!1,n._useEmissiveAsIllumination=!1,n._linkEmissiveWithDiffuse=!1,n._useSpecularOverAlpha=!1,n._useReflectionOverAlpha=!1,n._disableLighting=!1,n._useObjectSpaceNormalMap=!1,n._useParallax=!1,n._useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n._roughness=0,n.indexOfRefraction=.98,n.invertRefractionY=!0,n.alphaCutOff=.4,n._useLightmapAsShadowmap=!1,n._useReflectionFresnelFromSpecular=!1,n._useGlossinessFromSpecularMapAlpha=!1,n._maxSimultaneousLights=4,n._invertNormalMapX=!1,n._invertNormalMapY=!1,n._twoSidedLighting=!1,n.detailMap=new Ct(n._markAllSubMeshesAsTexturesDirty.bind(n)),n._renderTargets=new Ie(16),n._worldViewProjectionMatrix=R.Zero(),n._globalAmbientColor=new ae(0,0,0),n._rebuildInParallel=!1,n._attachImageProcessingConfiguration(null),n.prePassConfiguration=new zt,n.getRenderTargetTextures=function(){return n._renderTargets.reset(),e.ReflectionTextureEnabled&&n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),e.RefractionTextureEnabled&&n._refractionTexture&&n._refractionTexture.isRenderTarget&&n._renderTargets.push(n._refractionTexture),n._renderTargets},n}return Object.defineProperty(e.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(t){this._attachImageProcessingConfiguration(t),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),e.prototype._attachImageProcessingConfiguration=function(t){var i=this;t!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),t?this._imageProcessingConfiguration=t:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){i._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(e.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(t){this.imageProcessingConfiguration.colorCurvesEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(t){this.imageProcessingConfiguration.colorGradingEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(t){this._imageProcessingConfiguration.toneMappingEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(t){this._imageProcessingConfiguration.exposure=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(t){this._imageProcessingConfiguration.contrast=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(t){this._imageProcessingConfiguration.colorGradingTexture=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(t){this._imageProcessingConfiguration.colorCurves=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return!!(e.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||e.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(e.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(t){this._useLogarithmicDepth=t&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),e.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},e.prototype.needAlphaTesting=function(){return this._forceAlphaTest?!0:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===ye.MATERIAL_ALPHATEST)},e.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==ye.MATERIAL_OPAQUE},e.prototype._hasAlphaChannel=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null},e.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},e.prototype.isReadyForSubMesh=function(t,i,n){if(n===void 0&&(n=!1),i.effect&&this.isFrozen&&i.effect._wasPreviouslyReady)return!0;i._materialDefines||(i._materialDefines=new Da);var a=this.getScene(),s=i._materialDefines;if(this._isReadyForSubMesh(i))return!0;var o=a.getEngine();if(s._needNormals=q.PrepareDefinesForLights(a,t,s,!0,this._maxSimultaneousLights,this._disableLighting),q.PrepareDefinesForMultiview(a,s),q.PrepareDefinesForPrePass(a,s,this.canRenderToMRT),s._areTexturesDirty){if(s._needUVs=!1,s.MAINUV1=!1,s.MAINUV2=!1,a.texturesEnabled){if(this._diffuseTexture&&e.DiffuseTextureEnabled)if(this._diffuseTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._diffuseTexture,s,"DIFFUSE");else return!1;else s.DIFFUSE=!1;if(this._ambientTexture&&e.AmbientTextureEnabled)if(this._ambientTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._ambientTexture,s,"AMBIENT");else return!1;else s.AMBIENT=!1;if(this._opacityTexture&&e.OpacityTextureEnabled)if(this._opacityTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._opacityTexture,s,"OPACITY"),s.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else return!1;else s.OPACITY=!1;if(this._reflectionTexture&&e.ReflectionTextureEnabled)if(this._reflectionTexture.isReadyOrNotBlocking()){switch(s._needNormals=!0,s.REFLECTION=!0,s.ROUGHNESS=this._roughness>0,s.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,s.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Pe.INVCUBIC_MODE,s.REFLECTIONMAP_3D=this._reflectionTexture.isCube,s.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Pe.EXPLICIT_MODE:s.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Pe.PLANAR_MODE:s.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Pe.PROJECTION_MODE:s.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Pe.SKYBOX_MODE:s.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Pe.SPHERICAL_MODE:s.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Pe.EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Pe.FIXED_EQUIRECTANGULAR_MODE:s.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Pe.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:s.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Pe.CUBIC_MODE:case Pe.INVCUBIC_MODE:default:s.setReflectionMode("REFLECTIONMAP_CUBIC");break}s.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else return!1;else s.REFLECTION=!1;if(this._emissiveTexture&&e.EmissiveTextureEnabled)if(this._emissiveTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._emissiveTexture,s,"EMISSIVE");else return!1;else s.EMISSIVE=!1;if(this._lightmapTexture&&e.LightmapTextureEnabled)if(this._lightmapTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._lightmapTexture,s,"LIGHTMAP"),s.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,s.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else return!1;else s.LIGHTMAP=!1;if(this._specularTexture&&e.SpecularTextureEnabled)if(this._specularTexture.isReadyOrNotBlocking())q.PrepareDefinesForMergedUV(this._specularTexture,s,"SPECULAR"),s.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else return!1;else s.SPECULAR=!1;if(a.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&e.BumpTextureEnabled){if(this._bumpTexture.isReady())q.PrepareDefinesForMergedUV(this._bumpTexture,s,"BUMP"),s.PARALLAX=this._useParallax,s.PARALLAXOCCLUSION=this._useParallaxOcclusion;else return!1;s.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else s.BUMP=!1;if(this._refractionTexture&&e.RefractionTextureEnabled)if(this._refractionTexture.isReadyOrNotBlocking())s._needUVs=!0,s.REFRACTION=!0,s.REFRACTIONMAP_3D=this._refractionTexture.isCube,s.RGBDREFRACTION=this._refractionTexture.isRGBD;else return!1;else s.REFRACTION=!1;s.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else s.DIFFUSE=!1,s.AMBIENT=!1,s.OPACITY=!1,s.REFLECTION=!1,s.EMISSIVE=!1,s.LIGHTMAP=!1,s.BUMP=!1,s.REFRACTION=!1;s.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),s.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,s.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,s.SPECULAROVERALPHA=this._useSpecularOverAlpha,s.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,s.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,s.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(t)}if(!this.detailMap.isReadyForSubMesh(s,a))return!1;if(s._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(s),s.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,s.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if(s._areFresnelDirty&&(e.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(s.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,s.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,s.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,s.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,s.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,s.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,s._needNormals=!0,s.FRESNEL=!0):s.FRESNEL=!1),q.PrepareDefinesForMisc(t,a,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(t)||this._forceAlphaTest,s),q.PrepareDefinesForAttributes(t,s,!0,!0,!0),q.PrepareDefinesForFrameBoundValues(a,o,s,n,null,i.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines(s,a),s.isDirty){var u=s._areLightsDisposed;s.markAsProcessed();var l=new Ia;s.REFLECTION&&l.addFallback(0,"REFLECTION"),s.SPECULAR&&l.addFallback(0,"SPECULAR"),s.BUMP&&l.addFallback(0,"BUMP"),s.PARALLAX&&l.addFallback(1,"PARALLAX"),s.PARALLAXOCCLUSION&&l.addFallback(0,"PARALLAXOCCLUSION"),s.SPECULAROVERALPHA&&l.addFallback(0,"SPECULAROVERALPHA"),s.FOG&&l.addFallback(1,"FOG"),s.POINTSIZE&&l.addFallback(0,"POINTSIZE"),s.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),q.HandleFallbacksForShadows(s,l,this._maxSimultaneousLights),s.SPECULARTERM&&l.addFallback(0,"SPECULARTERM"),s.DIFFUSEFRESNEL&&l.addFallback(1,"DIFFUSEFRESNEL"),s.OPACITYFRESNEL&&l.addFallback(2,"OPACITYFRESNEL"),s.REFLECTIONFRESNEL&&l.addFallback(3,"REFLECTIONFRESNEL"),s.EMISSIVEFRESNEL&&l.addFallback(4,"EMISSIVEFRESNEL"),s.FRESNEL&&l.addFallback(4,"FRESNEL"),s.MULTIVIEW&&l.addFallback(0,"MULTIVIEW");var f=[_.PositionKind];s.NORMAL&&f.push(_.NormalKind),s.UV1&&f.push(_.UVKind),s.UV2&&f.push(_.UV2Kind),s.VERTEXCOLOR&&f.push(_.ColorKind),q.PrepareAttributesForBones(f,t,s,l),q.PrepareAttributesForInstances(f,s),q.PrepareAttributesForMorphTargets(f,t,s);var h="default",c=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],d=["Material","Scene"];Ct.AddUniforms(c),Ct.AddSamplers(p),zt.AddUniforms(c),zt.AddSamplers(c),tt&&(tt.PrepareUniforms(c,s),tt.PrepareSamplers(p,s)),q.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:d,samplers:p,defines:s,maxSimultaneousLights:this._maxSimultaneousLights});var g={};this.customShaderNameResolve&&(h=this.customShaderNameResolve(h,c,d,p,s,f,g));var m=s.toString(),E=i.effect,v=a.getEngine().createEffect(h,{attributes:f,uniformsNames:c,uniformBuffersNames:d,samplers:p,defines:m,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:s.NUM_MORPH_INFLUENCERS},processFinalCode:g.processFinalCode,multiTarget:s.PREPASS},o);if(v)if(this._onEffectCreatedObservable&&(Xt.effect=v,Xt.subMesh=i,this._onEffectCreatedObservable.notifyObservers(Xt)),this.allowShaderHotSwapping&&E&&!v.isReady()){if(v=E,this._rebuildInParallel=!0,s.markAsUnprocessed(),u)return s._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,a.resetCachedMaterial(),i.setEffect(v,s),this.buildUniformLayout()}return!i.effect||!i.effect.isReady()?!1:(s._renderId=a.getRenderId(),i.effect._wasPreviouslyReady=!0,!0)},e.prototype.buildUniformLayout=function(){var t=this._uniformBuffer;t.addUniform("diffuseLeftColor",4),t.addUniform("diffuseRightColor",4),t.addUniform("opacityParts",4),t.addUniform("reflectionLeftColor",4),t.addUniform("reflectionRightColor",4),t.addUniform("refractionLeftColor",4),t.addUniform("refractionRightColor",4),t.addUniform("emissiveLeftColor",4),t.addUniform("emissiveRightColor",4),t.addUniform("vDiffuseInfos",2),t.addUniform("vAmbientInfos",2),t.addUniform("vOpacityInfos",2),t.addUniform("vReflectionInfos",2),t.addUniform("vReflectionPosition",3),t.addUniform("vReflectionSize",3),t.addUniform("vEmissiveInfos",2),t.addUniform("vLightmapInfos",2),t.addUniform("vSpecularInfos",2),t.addUniform("vBumpInfos",3),t.addUniform("diffuseMatrix",16),t.addUniform("ambientMatrix",16),t.addUniform("opacityMatrix",16),t.addUniform("reflectionMatrix",16),t.addUniform("emissiveMatrix",16),t.addUniform("lightmapMatrix",16),t.addUniform("specularMatrix",16),t.addUniform("bumpMatrix",16),t.addUniform("vTangentSpaceParams",2),t.addUniform("pointSize",1),t.addUniform("refractionMatrix",16),t.addUniform("vRefractionInfos",4),t.addUniform("vSpecularColor",4),t.addUniform("vEmissiveColor",3),t.addUniform("visibility",1),t.addUniform("vDiffuseColor",4),Ct.PrepareUniformBuffer(t),t.create()},e.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}r.prototype.unbind.call(this)},e.prototype.bindForSubMesh=function(t,i,n){var a=this.getScene(),s=n._materialDefines;if(!!s){var o=n.effect;if(!!o){this._activeEffect=o,(!s.INSTANCES||s.THIN_INSTANCES)&&this.bindOnlyWorldMatrix(t),this.prePassConfiguration.bindForSubMesh(this._activeEffect,a,i,t,this.isFrozen),s.OBJECTSPACE_NORMALMAP&&(t.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var u=this._mustRebind(a,o,i.visibility);q.BindBonesParameters(i,o);var l=this._uniformBuffer;if(u){if(l.bindToEffect(o,"Material"),this.bindViewProjection(o),!l.useUbo||!this.isFrozen||!l.isSync){if(e.FresnelEnabled&&s.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(l.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),l.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&l.updateColor4("opacityParts",new ae(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(l.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),l.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(l.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),l.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(l.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),l.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),a.texturesEnabled){if(this._diffuseTexture&&e.DiffuseTextureEnabled&&(l.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),q.BindTextureMatrix(this._diffuseTexture,l,"diffuse")),this._ambientTexture&&e.AmbientTextureEnabled&&(l.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),q.BindTextureMatrix(this._ambientTexture,l,"ambient")),this._opacityTexture&&e.OpacityTextureEnabled&&(l.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),q.BindTextureMatrix(this._opacityTexture,l,"opacity")),this._hasAlphaChannel()&&o.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&e.ReflectionTextureEnabled&&(l.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),l.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var f=this._reflectionTexture;l.updateVector3("vReflectionPosition",f.boundingBoxPosition),l.updateVector3("vReflectionSize",f.boundingBoxSize)}if(this._emissiveTexture&&e.EmissiveTextureEnabled&&(l.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),q.BindTextureMatrix(this._emissiveTexture,l,"emissive")),this._lightmapTexture&&e.LightmapTextureEnabled&&(l.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),q.BindTextureMatrix(this._lightmapTexture,l,"lightmap")),this._specularTexture&&e.SpecularTextureEnabled&&(l.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),q.BindTextureMatrix(this._specularTexture,l,"specular")),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&(l.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),q.BindTextureMatrix(this._bumpTexture,l,"bump"),a._mirroredCameraPosition?l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):l.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&e.RefractionTextureEnabled){var h=1;this._refractionTexture.isCube||(l.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(h=this._refractionTexture.depth)),l.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,h,this.invertRefractionY?-1:1)}}this.pointsCloud&&l.updateFloat("pointSize",this.pointSize),s.SPECULARTERM&&l.updateColor4("vSpecularColor",this.specularColor,this.specularPower),l.updateColor3("vEmissiveColor",e.EmissiveTextureEnabled?this.emissiveColor:ae.BlackReadOnly),l.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}if(l.updateFloat("visibility",i.visibility),a.texturesEnabled&&(this._diffuseTexture&&e.DiffuseTextureEnabled&&o.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&e.AmbientTextureEnabled&&o.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&e.OpacityTextureEnabled&&o.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&e.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?o.setTexture("reflectionCubeSampler",this._reflectionTexture):o.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&e.EmissiveTextureEnabled&&o.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&e.LightmapTextureEnabled&&o.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&e.SpecularTextureEnabled&&o.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&a.getEngine().getCaps().standardDerivatives&&e.BumpTextureEnabled&&o.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&e.RefractionTextureEnabled)){var h=1;this._refractionTexture.isCube?o.setTexture("refractionCubeSampler",this._refractionTexture):o.setTexture("refraction2DSampler",this._refractionTexture)}this.detailMap.bindForSubMesh(l,a,this.isFrozen),q.BindClipPlane(o,a),a.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),q.BindEyePosition(o,a),o.setColor3("vAmbientColor",this._globalAmbientColor)}(u||!this.isFrozen)&&(a.lightsEnabled&&!this._disableLighting&&q.BindLights(a,i,o,s,this._maxSimultaneousLights,this._rebuildInParallel),(a.fogEnabled&&i.applyFog&&a.fogMode!==_t.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(o),q.BindFogParameters(a,i,o),s.NUM_MORPH_INFLUENCERS&&q.BindMorphTargetParameters(i,o),this.useLogarithmicDepth&&q.BindLogDepth(s,o,a),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),l.update(),this._afterBind(i,this._activeEffect)}}},e.prototype.getAnimatables=function(){var t=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&t.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&t.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&t.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&t.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&t.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&t.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&t.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&t.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&t.push(this._refractionTexture),this.detailMap.getAnimatables(t),t},e.prototype.getActiveTextures=function(){var t=r.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),this.detailMap.getActiveTextures(t),t},e.prototype.hasTexture=function(t){return r.prototype.hasTexture.call(this,t)||this._diffuseTexture===t||this._ambientTexture===t||this._opacityTexture===t||this._reflectionTexture===t||this._emissiveTexture===t||this._specularTexture===t||this._bumpTexture===t||this._lightmapTexture===t||this._refractionTexture===t?!0:this.detailMap.hasTexture(t)},e.prototype.dispose=function(t,i){var n,a,s,o,u,l,f,h,c;i&&((n=this._diffuseTexture)===null||n===void 0||n.dispose(),(a=this._ambientTexture)===null||a===void 0||a.dispose(),(s=this._opacityTexture)===null||s===void 0||s.dispose(),(o=this._reflectionTexture)===null||o===void 0||o.dispose(),(u=this._emissiveTexture)===null||u===void 0||u.dispose(),(l=this._specularTexture)===null||l===void 0||l.dispose(),(f=this._bumpTexture)===null||f===void 0||f.dispose(),(h=this._lightmapTexture)===null||h===void 0||h.dispose(),(c=this._refractionTexture)===null||c===void 0||c.dispose()),this.detailMap.dispose(i),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),r.prototype.dispose.call(this,t,i)},e.prototype.clone=function(t){var i=this,n=H.Clone(function(){return new e(t,i.getScene())},this);return n.name=t,n.id=t,n},e.prototype.serialize=function(){return H.Serialize(this)},e.Parse=function(t,i,n){return H.Parse(function(){return new e(t.name,i)},t,i,n)},Object.defineProperty(e,"DiffuseTextureEnabled",{get:function(){return ee.DiffuseTextureEnabled},set:function(t){ee.DiffuseTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DetailTextureEnabled",{get:function(){return ee.DetailTextureEnabled},set:function(t){ee.DetailTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AmbientTextureEnabled",{get:function(){return ee.AmbientTextureEnabled},set:function(t){ee.AmbientTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"OpacityTextureEnabled",{get:function(){return ee.OpacityTextureEnabled},set:function(t){ee.OpacityTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ReflectionTextureEnabled",{get:function(){return ee.ReflectionTextureEnabled},set:function(t){ee.ReflectionTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"EmissiveTextureEnabled",{get:function(){return ee.EmissiveTextureEnabled},set:function(t){ee.EmissiveTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SpecularTextureEnabled",{get:function(){return ee.SpecularTextureEnabled},set:function(t){ee.SpecularTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BumpTextureEnabled",{get:function(){return ee.BumpTextureEnabled},set:function(t){ee.BumpTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LightmapTextureEnabled",{get:function(){return ee.LightmapTextureEnabled},set:function(t){ee.LightmapTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RefractionTextureEnabled",{get:function(){return ee.RefractionTextureEnabled},set:function(t){ee.RefractionTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ColorGradingTextureEnabled",{get:function(){return ee.ColorGradingTextureEnabled},set:function(t){ee.ColorGradingTextureEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"FresnelEnabled",{get:function(){return ee.FresnelEnabled},set:function(t){ee.FresnelEnabled=t},enumerable:!1,configurable:!0}),b([Ce("diffuseTexture")],e.prototype,"_diffuseTexture",void 0),b([Y("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"diffuseTexture",void 0),b([Ce("ambientTexture")],e.prototype,"_ambientTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"ambientTexture",void 0),b([Ce("opacityTexture")],e.prototype,"_opacityTexture",void 0),b([Y("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"opacityTexture",void 0),b([Ce("reflectionTexture")],e.prototype,"_reflectionTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"reflectionTexture",void 0),b([Ce("emissiveTexture")],e.prototype,"_emissiveTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"emissiveTexture",void 0),b([Ce("specularTexture")],e.prototype,"_specularTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"specularTexture",void 0),b([Ce("bumpTexture")],e.prototype,"_bumpTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"bumpTexture",void 0),b([Ce("lightmapTexture")],e.prototype,"_lightmapTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"lightmapTexture",void 0),b([Ce("refractionTexture")],e.prototype,"_refractionTexture",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"refractionTexture",void 0),b([$e("ambient")],e.prototype,"ambientColor",void 0),b([$e("diffuse")],e.prototype,"diffuseColor",void 0),b([$e("specular")],e.prototype,"specularColor",void 0),b([$e("emissive")],e.prototype,"emissiveColor",void 0),b([T()],e.prototype,"specularPower",void 0),b([T("useAlphaFromDiffuseTexture")],e.prototype,"_useAlphaFromDiffuseTexture",void 0),b([Y("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"useAlphaFromDiffuseTexture",void 0),b([T("useEmissiveAsIllumination")],e.prototype,"_useEmissiveAsIllumination",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useEmissiveAsIllumination",void 0),b([T("linkEmissiveWithDiffuse")],e.prototype,"_linkEmissiveWithDiffuse",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"linkEmissiveWithDiffuse",void 0),b([T("useSpecularOverAlpha")],e.prototype,"_useSpecularOverAlpha",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useSpecularOverAlpha",void 0),b([T("useReflectionOverAlpha")],e.prototype,"_useReflectionOverAlpha",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useReflectionOverAlpha",void 0),b([T("disableLighting")],e.prototype,"_disableLighting",void 0),b([Y("_markAllSubMeshesAsLightsDirty")],e.prototype,"disableLighting",void 0),b([T("useObjectSpaceNormalMap")],e.prototype,"_useObjectSpaceNormalMap",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useObjectSpaceNormalMap",void 0),b([T("useParallax")],e.prototype,"_useParallax",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useParallax",void 0),b([T("useParallaxOcclusion")],e.prototype,"_useParallaxOcclusion",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useParallaxOcclusion",void 0),b([T()],e.prototype,"parallaxScaleBias",void 0),b([T("roughness")],e.prototype,"_roughness",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"roughness",void 0),b([T()],e.prototype,"indexOfRefraction",void 0),b([T()],e.prototype,"invertRefractionY",void 0),b([T()],e.prototype,"alphaCutOff",void 0),b([T("useLightmapAsShadowmap")],e.prototype,"_useLightmapAsShadowmap",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useLightmapAsShadowmap",void 0),b([ut("diffuseFresnelParameters")],e.prototype,"_diffuseFresnelParameters",void 0),b([Y("_markAllSubMeshesAsFresnelDirty")],e.prototype,"diffuseFresnelParameters",void 0),b([ut("opacityFresnelParameters")],e.prototype,"_opacityFresnelParameters",void 0),b([Y("_markAllSubMeshesAsFresnelAndMiscDirty")],e.prototype,"opacityFresnelParameters",void 0),b([ut("reflectionFresnelParameters")],e.prototype,"_reflectionFresnelParameters",void 0),b([Y("_markAllSubMeshesAsFresnelDirty")],e.prototype,"reflectionFresnelParameters",void 0),b([ut("refractionFresnelParameters")],e.prototype,"_refractionFresnelParameters",void 0),b([Y("_markAllSubMeshesAsFresnelDirty")],e.prototype,"refractionFresnelParameters",void 0),b([ut("emissiveFresnelParameters")],e.prototype,"_emissiveFresnelParameters",void 0),b([Y("_markAllSubMeshesAsFresnelDirty")],e.prototype,"emissiveFresnelParameters",void 0),b([T("useReflectionFresnelFromSpecular")],e.prototype,"_useReflectionFresnelFromSpecular",void 0),b([Y("_markAllSubMeshesAsFresnelDirty")],e.prototype,"useReflectionFresnelFromSpecular",void 0),b([T("useGlossinessFromSpecularMapAlpha")],e.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"useGlossinessFromSpecularMapAlpha",void 0),b([T("maxSimultaneousLights")],e.prototype,"_maxSimultaneousLights",void 0),b([Y("_markAllSubMeshesAsLightsDirty")],e.prototype,"maxSimultaneousLights",void 0),b([T("invertNormalMapX")],e.prototype,"_invertNormalMapX",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertNormalMapX",void 0),b([T("invertNormalMapY")],e.prototype,"_invertNormalMapY",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"invertNormalMapY",void 0),b([T("twoSidedLighting")],e.prototype,"_twoSidedLighting",void 0),b([Y("_markAllSubMeshesAsTexturesDirty")],e.prototype,"twoSidedLighting",void 0),b([T()],e.prototype,"useLogarithmicDepth",null),e}(Xr);_e.RegisteredTypes["BABYLON.StandardMaterial"]=Nt;_t.DefaultMaterialFactory=function(r){return new Nt("default material",r)};Z.CreateBox=function(r){var e=6,t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],i=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[],a=[],s=r.width||r.size||1,o=r.height||r.size||1,u=r.depth||r.size||1,l=r.wrap||!1,f=r.topBaseAt===void 0?1:r.topBaseAt,h=r.bottomBaseAt===void 0?0:r.bottomBaseAt;f=(f+4)%4,h=(h+4)%4;var c=[2,0,3,1],p=[2,0,1,3],d=c[f],g=p[h],m=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(l){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],m=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var E=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],v=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],A=[17,18,19,16],M=[22,23,20,21];d>0;)E.unshift(E.pop()),A.unshift(A.pop()),d--;for(;g>0;)v.unshift(v.pop()),M.unshift(M.pop()),g--;E=E.flat(),v=v.flat(),m=m.concat(E).concat(v),t.push(A[0],A[2],A[3],A[0],A[1],A[2]),t.push(M[0],M[2],M[3],M[0],M[1],M[2])}var C=[s/2,o/2,u/2];a=m.reduce(function(B,K,ie){return B.concat(K*C[ie%3])},[]);for(var P=r.sideOrientation===0?0:r.sideOrientation||Z.DEFAULTSIDE,S=r.faceUV||new Array(6),x=r.faceColors,z=[],X=0;X<6;X++)S[X]===void 0&&(S[X]=new Ue(0,0,1,1)),x&&x[X]===void 0&&(x[X]=new fe(1,1,1,1));for(var V=0;V<e;V++)if(n.push(S[V].z,S[V].w),n.push(S[V].x,S[V].w),n.push(S[V].x,S[V].y),n.push(S[V].z,S[V].y),x)for(var re=0;re<4;re++)z.push(x[V].r,x[V].g,x[V].b,x[V].a);Z._ComputeSides(P,a,t,i,n,r.frontUVs,r.backUVs);var j=new Z;if(j.indices=t,j.positions=a,j.normals=i,j.uvs=n,x){var F=P===Z.DOUBLESIDE?z.concat(z):z;j.colors=F}return j};Ae.CreateBox=function(r,e,t,i,n){t===void 0&&(t=null);var a={size:e,sideOrientation:n,updatable:i};return xi.CreateBox(r,a,t)};var xi=function(){function r(){}return r.CreateBox=function(e,t,i){i===void 0&&(i=null);var n=new Ae(e,i);t.sideOrientation=Ae._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;var a=Z.CreateBox(t);return a.applyToMesh(n,t.updatable),n},r}();Z.CreatePlane=function(r){var e=[],t=[],i=[],n=[],a=r.width||r.size||1,s=r.height||r.size||1,o=r.sideOrientation===0?0:r.sideOrientation||Z.DEFAULTSIDE,u=a/2,l=s/2;t.push(-u,-l,0),i.push(0,0,-1),n.push(0,0),t.push(u,-l,0),i.push(0,0,-1),n.push(1,0),t.push(u,l,0),i.push(0,0,-1),n.push(1,1),t.push(-u,l,0),i.push(0,0,-1),n.push(0,1),e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),Z._ComputeSides(o,t,e,i,n,r.frontUVs,r.backUVs);var f=new Z;return f.indices=e,f.positions=t,f.normals=i,f.uvs=n,f};Ae.CreatePlane=function(r,e,t,i,n){var a={size:e,width:e,height:e,sideOrientation:n,updatable:i};return Fi.CreatePlane(r,a,t)};var Fi=function(){function r(){}return r.CreatePlane=function(e,t,i){i===void 0&&(i=null);var n=new Ae(e,i);t.sideOrientation=Ae._GetDefaultSideOrientation(t.sideOrientation),n._originalBuilderSideOrientation=t.sideOrientation;var a=Z.CreatePlane(t);return a.applyToMesh(n,t.updatable),t.sourcePlane&&(n.translate(t.sourcePlane.normal,-t.sourcePlane.d),n.setDirection(t.sourcePlane.normal.scale(-1))),n},r}();Ae._instancedMeshFactory=function(r,e){var t=new Oa(r,e);if(e.instancedBuffers){t.instancedBuffers={};for(var i in e.instancedBuffers)t.instancedBuffers[i]=e.instancedBuffers[i]}return t};var Oa=function(r){N(e,r);function e(t,i){var n=r.call(this,t,i.getScene())||this;n._indexInSourceMeshInstanceArray=-1,i.addInstance(n),n._sourceMesh=i,n._unIndexed=i._unIndexed,n.position.copyFrom(i.position),n.rotation.copyFrom(i.rotation),n.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(n.rotationQuaternion=i.rotationQuaternion.clone()),n.animations=te.Slice(i.animations);for(var a=0,s=i.getAnimationRanges();a<s.length;a++){var o=s[a];o!=null&&n.createAnimationRange(o.name,o.from,o.to)}return n.infiniteDistance=i.infiniteDistance,n.setPivotMatrix(i.getPivotMatrix()),n.refreshBoundingInfo(),n._syncSubMeshes(),n}return e.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(e.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),e.prototype._resyncLightSources=function(){},e.prototype._resyncLightSource=function(t){},e.prototype._removeLightSource=function(t,i){},Object.defineProperty(e.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(t){!this._sourceMesh||t===this._sourceMesh.renderingGroupId||L.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),e.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},e.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(e.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),e.prototype.createInstance=function(t){return this._sourceMesh.createInstance(t)},e.prototype.isReady=function(t){return t===void 0&&(t=!1),this._sourceMesh.isReady(t,!0)},e.prototype.getVerticesData=function(t,i){return this._sourceMesh.getVerticesData(t,i)},e.prototype.setVerticesData=function(t,i,n,a){return this.sourceMesh&&this.sourceMesh.setVerticesData(t,i,n,a),this.sourceMesh},e.prototype.updateVerticesData=function(t,i,n,a){return this.sourceMesh&&this.sourceMesh.updateVerticesData(t,i,n,a),this.sourceMesh},e.prototype.setIndices=function(t,i){return i===void 0&&(i=null),this.sourceMesh&&this.sourceMesh.setIndices(t,i),this.sourceMesh},e.prototype.isVerticesDataPresent=function(t){return this._sourceMesh.isVerticesDataPresent(t)},e.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(e.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),e.prototype.refreshBoundingInfo=function(t){if(t===void 0&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var i=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(t),i),this},e.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},e.prototype._activate=function(t,i){if(this._sourceMesh.subMeshes||L.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){var n=this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0;if(n)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,t),i){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},e.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},e.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==Re.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,I.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),I.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(I.Vector3[7]),this._currentLOD._masterMesh=t,I.Matrix[0]}return r.prototype.getWorldMatrix.call(this)},Object.defineProperty(e.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.getLOD=function(t){if(!t)return this;var i=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(t,i.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},e.prototype._preActivateForIntermediateRendering=function(t){return this.sourceMesh._preActivateForIntermediateRendering(t)},e.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var t=0;t<this._sourceMesh.subMeshes.length;t++)this._sourceMesh.subMeshes[t].clone(this,this._sourceMesh);return this},e.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},e.prototype._updateBoundingInfo=function(){var t=this;return this._boundingInfo?this._boundingInfo.update(t.worldMatrixFromCache):this._boundingInfo=new Oe(this.absolutePosition,this.absolutePosition,t.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(t.worldMatrixFromCache),this},e.prototype.clone=function(t,i,n){i===void 0&&(i=null);var a=this._sourceMesh.createInstance(t);if(ii.DeepCopy(this,a,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances"],[]),this.refreshBoundingInfo(),i&&(a.parent=i),!n)for(var s=0;s<this.getScene().meshes.length;s++){var o=this.getScene().meshes[s];o.parent===this&&o.clone(o.name,a)}return a.computeWorldMatrix(!0),a},e.prototype.dispose=function(t,i){i===void 0&&(i=!1),this._sourceMesh.removeInstance(this),r.prototype.dispose.call(this,t,i)},e}(pt);Ae.prototype.edgesShareWithInstances=!1;Ae.prototype.registerInstancedBuffer=function(r,e){if(this.removeVerticesData(r),!this.instancedBuffers){this.instancedBuffers={};for(var t=0,i=this.instances;t<i.length;t++){var n=i[t];n.instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[r]=null,this._userInstancedBuffersStorage.strides[r]=e,this._userInstancedBuffersStorage.sizes[r]=e*32,this._userInstancedBuffersStorage.data[r]=new Float32Array(this._userInstancedBuffersStorage.sizes[r]),this._userInstancedBuffersStorage.vertexBuffers[r]=new _(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,e,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[r]);for(var a=0,s=this.instances;a<s.length;a++){var n=s[a];n.instancedBuffers[r]=null}};Ae.prototype._processInstancedBuffers=function(r,e){var t=r.length;for(var i in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[i],a=this._userInstancedBuffersStorage.strides[i],s=(t+1)*a;n<s;)n*=2;this._userInstancedBuffersStorage.data[i].length!=n&&(this._userInstancedBuffersStorage.data[i]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[i]=n,this._userInstancedBuffersStorage.vertexBuffers[i]&&(this._userInstancedBuffersStorage.vertexBuffers[i].dispose(),this._userInstancedBuffersStorage.vertexBuffers[i]=null));var o=this._userInstancedBuffersStorage.data[i],u=0;if(e){var l=this.instancedBuffers[i];l.toArray?l.toArray(o,u):l.copyToArray(o,u),u+=a}for(var f=0;f<t;f++){var h=r[f],l=h.instancedBuffers[i];l.toArray?l.toArray(o,u):l.copyToArray(o,u),u+=a}this._userInstancedBuffersStorage.vertexBuffers[i]?this._userInstancedBuffersStorage.vertexBuffers[i].updateDirectly(o,0):(this._userInstancedBuffersStorage.vertexBuffers[i]=new _(this.getEngine(),this._userInstancedBuffersStorage.data[i],i,!0,!1,a,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[i]))}};Ae.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var r in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[r]&&this._userInstancedBuffersStorage.vertexBuffers[r].dispose();this.instancedBuffers={}};const Gt=[0,1,2],je=Math.PI/2,xa=[[[1,1,1],[0,1,0],[je,0,0]],[[1,.8,0],[0,-1,0],[-je,0,0]],[[0,.3,.7],[1,0,0],[0,-je,0]],[[0,.6,.3],[-1,0,0],[0,je,0]],[[1,.3,0],[0,0,1],[Math.PI,0,0]],[[.7,0,.2],[0,0,-1],[0,0,0]]],Fa={F:[0,2],B:[0,0],U:[1,2],D:[1,0],R:[2,2],L:[2,0]},wa=r=>{if(!r)return null;const e=new ce(r,!0),t=new _t(e),i=f=>{t.ambientColor=new ae(f,f,f)},n=new Re("",t),a=xi.CreateBox("",{size:1},t);a.isVisible=!1,a.material=new Nt("",t),a.material.disableLighting=!0;const s=Gt.flatMap(f=>Gt.flatMap(h=>Gt.map(c=>{const p=a.createInstance("");return p.position=new y(f,h,c),p.parent=n,p}))),o=s.reduce((f,h)=>f.addInPlace(h.position),y.Zero()).scale(1/27),u=new Oi("",.4,je-.4,7,o,t);u.wheelPrecision=100,u.lowerRadiusLimit=6,u.upperRadiusLimit=8,u.attachControl(r,!0),t.clearColor=new fe(.1,.1,.1,1);for(const[f,h,c]of xa){const p=Fi.CreatePlane("",{size:.9},t);p.isVisible=!1,p.parent=n,p.material=new Nt("",t),p.material.ambientColor=new ae(...f),p.material.disableLighting=!0;for(const d of s){if(s.some(m=>m.position.equals(d.position.add(h))))continue;const g=p.createInstance("");g.parent=d,g.rotation=new y(...c),g.position=new y(...h),g.position.scaleInPlace(.501)}}return i(.1),e.runRenderLoop(()=>t.render()),{lights:i,rotate:async(f,h,c=2)=>{if(!h)return;const[p,d]=Fa[f],g=`rotation.${"xyz"[p]}`,m=je*h*(d?1:-1),E=s.filter(({position:{x:M,y:C,z:P}})=>[M,C,P][p]===d),v=new Re("",t);v.position=new y(...[0,1,2].map(M=>p===M?d:0)),v.position.addInPlace(o),v.parent=n;for(const M of E)M.setParent(v);const{Animation:A}=await si(()=>Promise.resolve().then(function(){return Nr}),void 0);await si(()=>import("./animatable.3ebe158a.js"),["animatable.3ebe158a.js","index.5c7c8a35.js","vendor.9648f80c.js"]),await new Promise(M=>{A.CreateAndStartAnimation("",v,g,60,c,0,m,0).onAnimationEnd=M});for(const M of E){M.setParent(n);const{x:C,y:P,z:S}=M.rotation;M.rotation.set(...[C,P,S].map(x=>Math.round(x/je)*je)),M.position.set(Math.round(M.position.x),Math.round(M.position.y),Math.round(M.position.z))}v.dispose()},dispose:()=>(t.dispose(),e.dispose())}};var Na=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createCube:wa});export{Se as A,ae as C,R as M,xe as N,D as O,Ve as P,W as Q,Lt as S,I as T,y as V,N as _,ne as a,ze as b,be as c,_t as d,Na as e};
