import{Q as O,V as A,a as N,S as W,C as B,A as y,M as g,_ as E,b as m,c as C,N as w,d as P,T as F,O as V,P as k}from"./cube.90b271a5.js";import"./index.20fa7db2.js";import"./vendor.15851fda.js";var Q=Object.freeze(new O(0,0,0,0)),j=Object.freeze(A.Zero()),Y=Object.freeze(N.Zero()),Z=Object.freeze(W.Zero()),z=Object.freeze(B.Black()),H=function(){function r(i,t,e,o){var n=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=t,this._target=i,this._scene=e,this._host=o,this._activeTargets=[],t._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===y.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=g.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var a={frame:0,value:this._minValue};this._keys.splice(0,0,a)}if(this._target instanceof Array){for(var s=0,f=0,l=this._target;f<l.length;f++){var u=l[f];this._preparePath(u,s),this._getOriginalValues(s),s++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var h=t.getEvents();h&&h.length>0&&h.forEach(function(c){n._events.push(c._clone())}),this._enableBlending=i&&i.animationPropertiesOverride?i.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(r.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),r.prototype._preparePath=function(i,t){t===void 0&&(t=0);var e=this._animation.targetPropertyPath;if(e.length>1){for(var o=i[e[0]],n=1;n<e.length-1;n++)o=o[e[n]];this._targetPath=e[e.length-1],this._activeTargets[t]=o}else this._targetPath=e[0],this._activeTargets[t]=i},Object.defineProperty(r.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),r.prototype.reset=function(i){if(i===void 0&&(i=!1),i)if(this._target instanceof Array)for(var t=0,e=0,o=this._target;e<o.length;e++){var n=o[e];this._originalValue[t]!==void 0&&this._setValue(n,this._activeTargets[t],this._originalValue[t],-1,t),t++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(var t=0;t<this._events.length;t++)this._events[t].isDone=!1},r.prototype.isStopped=function(){return this._stopped},r.prototype.dispose=function(){var i=this._animation.runtimeAnimations.indexOf(this);i>-1&&this._animation.runtimeAnimations.splice(i,1)},r.prototype.setValue=function(i,t){if(this._targetIsArray){for(var e=0;e<this._target.length;e++){var o=this._target[e];this._setValue(o,this._activeTargets[e],i,t,e)}return}this._setValue(this._target,this._directTarget,i,t,0)},r.prototype._getOriginalValues=function(i){i===void 0&&(i=0);var t,e=this._activeTargets[i];e.getRestPose&&this._targetPath==="_matrix"?t=e.getRestPose():t=e[this._targetPath],t&&t.clone?this._originalValue[i]=t.clone():this._originalValue[i]=t},r.prototype._setValue=function(i,t,e,o,n){if(this._currentActiveTarget=t,this._weight=o,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var a=t[this._targetPath];a.clone?this._originalBlendValue=a.clone():this._originalBlendValue=a}this._originalBlendValue.m?y.AllowMatrixDecomposeForInterpolation?this._currentValue?g.DecomposeLerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=g.DecomposeLerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue?g.LerpToRef(this._originalBlendValue,e,this._blendingFactor,this._currentValue):this._currentValue=g.Lerp(this._originalBlendValue,e,this._blendingFactor):this._currentValue=y._UniversalLerp(this._originalBlendValue,e,this._blendingFactor);var s=i&&i.animationPropertiesOverride?i.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=s}else this._currentValue=e;o!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[n]):t[this._targetPath]=this._currentValue,i.markAsDirty&&i.markAsDirty(this._animation.targetProperty)},r.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},r.prototype.goToFrame=function(i){var t=this._animation.getKeys();i<t[0].frame?i=t[0].frame:i>t[t.length-1].frame&&(i=t[t.length-1].frame);var e=this._events;if(e.length)for(var o=0;o<e.length;o++)e[o].onlyOnce||(e[o].isDone=e[o].frame<i);this._currentFrame=i;var n=this._animation._interpolate(i,this._animationState);this.setValue(n,-1)},r.prototype._prepareForSpeedRatioChange=function(i){var t=this._previousDelay*(this._animation.framePerSecond*i)/1e3;this._ratioOffset=this._previousRatio-t},r.prototype.animate=function(i,t,e,o,n,a){a===void 0&&(a=-1);var s=this._animation,f=s.targetPropertyPath;if(!f||f.length<1)return this._stopped=!0,!1;var l=!0;(t<this._minFrame||t>this._maxFrame)&&(t=this._minFrame),(e<this._minFrame||e>this._maxFrame)&&(e=this._maxFrame);var u=e-t,h,c=i*(s.framePerSecond*n)/1e3+this._ratioOffset,p=0;if(this._previousDelay=i,this._previousRatio=c,!o&&e>=t&&c>=u)l=!1,p=s._getKeyValue(this._maxValue);else if(!o&&t>=e&&c<=u)l=!1,p=s._getKeyValue(this._minValue);else if(this._animationState.loopMode!==y.ANIMATIONLOOPMODE_CYCLE){var _=e.toString()+t.toString();if(!this._offsetsCache[_]){this._animationState.repeatCount=0,this._animationState.loopMode=y.ANIMATIONLOOPMODE_CYCLE;var d=s._interpolate(t,this._animationState),v=s._interpolate(e,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),s.dataType){case y.ANIMATIONTYPE_FLOAT:this._offsetsCache[_]=v-d;break;case y.ANIMATIONTYPE_QUATERNION:this._offsetsCache[_]=v.subtract(d);break;case y.ANIMATIONTYPE_VECTOR3:this._offsetsCache[_]=v.subtract(d);case y.ANIMATIONTYPE_VECTOR2:this._offsetsCache[_]=v.subtract(d);case y.ANIMATIONTYPE_SIZE:this._offsetsCache[_]=v.subtract(d);case y.ANIMATIONTYPE_COLOR3:this._offsetsCache[_]=v.subtract(d)}this._highLimitsCache[_]=v}p=this._highLimitsCache[_],h=this._offsetsCache[_]}if(h===void 0)switch(s.dataType){case y.ANIMATIONTYPE_FLOAT:h=0;break;case y.ANIMATIONTYPE_QUATERNION:h=Q;break;case y.ANIMATIONTYPE_VECTOR3:h=j;break;case y.ANIMATIONTYPE_VECTOR2:h=Y;break;case y.ANIMATIONTYPE_SIZE:h=Z;break;case y.ANIMATIONTYPE_COLOR3:h=z}var T;if(this._host&&this._host.syncRoot){var L=this._host.syncRoot,M=(L.masterFrame-L.fromFrame)/(L.toFrame-L.fromFrame);T=t+(e-t)*M}else T=l&&u!==0?t+c%u:e;var b=this._events;if((u>0&&this.currentFrame>T||u<0&&this.currentFrame<T)&&(this._onLoop(),b.length))for(var R=0;R<b.length;R++)b[R].onlyOnce||(b[R].isDone=!1);this._currentFrame=T,this._animationState.repeatCount=u===0?0:c/u>>0,this._animationState.highLimitValue=p,this._animationState.offsetValue=h;var I=s._interpolate(T,this._animationState);if(this.setValue(I,a),b.length){for(var R=0;R<b.length;R++)if(u>0&&T>=b[R].frame&&b[R].frame>=t||u<0&&T<=b[R].frame&&b[R].frame<=t){var D=b[R];D.isDone||(D.onlyOnce&&(b.splice(R,1),R--),D.isDone=!0,D.action(T))}}return l||(this._stopped=!0),l},r}(),x=function(r){E(i,r);function i(t,e,o,n,a,s,f){o===void 0&&(o=null),n===void 0&&(n=null),a===void 0&&(a=null),s===void 0&&(s=null),f===void 0&&(f=null);var l=r.call(this,t,e.getScene())||this;return l.name=t,l.children=new Array,l.animations=new Array,l._index=null,l._absoluteTransform=new g,l._invertedAbsoluteTransform=new g,l._scalingDeterminant=1,l._worldTransform=new g,l._needToDecompose=!0,l._needToCompose=!1,l._linkedTransformNode=null,l._waitingTransformNodeId=null,l._skeleton=e,l._localMatrix=n?n.clone():g.Identity(),l._restPose=a||l._localMatrix.clone(),l._bindPose=l._localMatrix.clone(),l._baseMatrix=s||l._localMatrix.clone(),l._index=f,e.bones.push(l),l.setParent(o,!1),(s||n)&&l._updateDifferenceMatrix(),l}return Object.defineProperty(i.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(t){this._localMatrix.copyFrom(t),this._needToDecompose=!0},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"Bone"},i.prototype.getSkeleton=function(){return this._skeleton},i.prototype.getParent=function(){return this._parent},i.prototype.getChildren=function(){return this.children},i.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},i.prototype.setParent=function(t,e){if(e===void 0&&(e=!0),this._parent!==t){if(this._parent){var o=this._parent.children.indexOf(this);o!==-1&&this._parent.children.splice(o,1)}this._parent=t,this._parent&&this._parent.children.push(this),e&&this._updateDifferenceMatrix(),this.markAsDirty()}},i.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.setRestPose=function(t){this._restPose.copyFrom(t)},i.prototype.getBindPose=function(){return this._bindPose},i.prototype.setBindPose=function(t){this._bindPose.copyFrom(t)},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},i.prototype.linkTransformNode=function(t){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=t,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},i.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(i.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(t){this._decompose(),this._localPosition.copyFrom(t),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this.getRotation()},set:function(t){this.setRotation(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(t){this.setRotationQuaternion(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this.getScale()},set:function(t){this.setScale(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),i.prototype._decompose=function(){!this._needToDecompose||(this._needToDecompose=!1,this._localScaling||(this._localScaling=A.Zero(),this._localRotation=O.Zero(),this._localPosition=A.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},i.prototype._compose=function(){if(!!this._needToCompose){if(!this._localScaling){this._needToCompose=!1;return}this._needToCompose=!1,g.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)}},i.prototype.updateMatrix=function(t,e,o){e===void 0&&(e=!0),o===void 0&&(o=!0),this._baseMatrix.copyFrom(t),e&&this._updateDifferenceMatrix(),o?(this._needToCompose=!1,this._localMatrix.copyFrom(t),this._markAsDirtyAndDecompose()):this.markAsDirty()},i.prototype._updateDifferenceMatrix=function(t,e){if(e===void 0&&(e=!0),t||(t=this._baseMatrix),this._parent?t.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(t),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),e)for(var o=0;o<this.children.length;o++)this.children[o]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},i.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},i.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},i.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},i.prototype.translate=function(t,e,o){e===void 0&&(e=m.LOCAL);var n=this.getLocalMatrix();if(e==m.LOCAL)n.addAtIndex(12,t.x),n.addAtIndex(13,t.y),n.addAtIndex(14,t.z);else{var a=null;o&&(a=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0],f=i._tmpVecs[0];this._parent?o&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform()):g.IdentityToRef(s),s.setTranslationFromFloats(0,0,0),s.invert(),A.TransformCoordinatesToRef(t,s,f),n.addAtIndex(12,f.x),n.addAtIndex(13,f.y),n.addAtIndex(14,f.z)}this._markAsDirtyAndDecompose()},i.prototype.setPosition=function(t,e,o){e===void 0&&(e=m.LOCAL);var n=this.getLocalMatrix();if(e==m.LOCAL)n.setTranslationFromFloats(t.x,t.y,t.z);else{var a=null;o&&(a=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0],f=i._tmpVecs[0];this._parent?(o&&a?(s.copyFrom(this._parent.getAbsoluteTransform()),s.multiplyToRef(a,s)):s.copyFrom(this._parent.getAbsoluteTransform()),s.invert()):g.IdentityToRef(s),A.TransformCoordinatesToRef(t,s,f),n.setTranslationFromFloats(f.x,f.y,f.z)}this._markAsDirtyAndDecompose()},i.prototype.setAbsolutePosition=function(t,e){this.setPosition(t,m.WORLD,e)},i.prototype.scale=function(t,e,o,n){n===void 0&&(n=!1);var a=this.getLocalMatrix(),s=i._tmpMats[0];g.ScalingToRef(t,e,o,s),s.multiplyToRef(a,a),s.invert();for(var f=0,l=this.children;f<l.length;f++){var u=l[f],h=u.getLocalMatrix();h.multiplyToRef(s,h),h.multiplyAtIndex(12,t),h.multiplyAtIndex(13,e),h.multiplyAtIndex(14,o),u._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),n)for(var c=0,p=this.children;c<p.length;c++){var u=p[c];u.scale(t,e,o,n)}},i.prototype.setScale=function(t){this._decompose(),this._localScaling.copyFrom(t),this._markAsDirtyAndCompose()},i.prototype.getScale=function(){return this._decompose(),this._localScaling},i.prototype.getScaleToRef=function(t){this._decompose(),t.copyFrom(this._localScaling)},i.prototype.setYawPitchRoll=function(t,e,o,n,a){if(n===void 0&&(n=m.LOCAL),n===m.LOCAL){var s=i._tmpQuat;O.RotationYawPitchRollToRef(t,e,o,s),this.setRotationQuaternion(s,n,a);return}var f=i._tmpMats[0];if(!!this._getNegativeRotationToRef(f,a)){var l=i._tmpMats[1];g.RotationYawPitchRollToRef(t,e,o,l),f.multiplyToRef(l,l),this._rotateWithMatrix(l,n,a)}},i.prototype.rotate=function(t,e,o,n){o===void 0&&(o=m.LOCAL);var a=i._tmpMats[0];a.setTranslationFromFloats(0,0,0),g.RotationAxisToRef(t,e,a),this._rotateWithMatrix(a,o,n)},i.prototype.setAxisAngle=function(t,e,o,n){if(o===void 0&&(o=m.LOCAL),o===m.LOCAL){var a=i._tmpQuat;O.RotationAxisToRef(t,e,a),this.setRotationQuaternion(a,o,n);return}var s=i._tmpMats[0];if(!!this._getNegativeRotationToRef(s,n)){var f=i._tmpMats[1];g.RotationAxisToRef(t,e,f),s.multiplyToRef(f,f),this._rotateWithMatrix(f,o,n)}},i.prototype.setRotation=function(t,e,o){e===void 0&&(e=m.LOCAL),this.setYawPitchRoll(t.y,t.x,t.z,e,o)},i.prototype.setRotationQuaternion=function(t,e,o){if(e===void 0&&(e=m.LOCAL),e===m.LOCAL){this._decompose(),this._localRotation.copyFrom(t),this._markAsDirtyAndCompose();return}var n=i._tmpMats[0];if(!!this._getNegativeRotationToRef(n,o)){var a=i._tmpMats[1];g.FromQuaternionToRef(t,a),n.multiplyToRef(a,a),this._rotateWithMatrix(a,e,o)}},i.prototype.setRotationMatrix=function(t,e,o){if(e===void 0&&(e=m.LOCAL),e===m.LOCAL){var n=i._tmpQuat;O.FromRotationMatrixToRef(t,n),this.setRotationQuaternion(n,e,o);return}var a=i._tmpMats[0];if(!!this._getNegativeRotationToRef(a,o)){var s=i._tmpMats[1];s.copyFrom(t),a.multiplyToRef(t,s),this._rotateWithMatrix(s,e,o)}},i.prototype._rotateWithMatrix=function(t,e,o){e===void 0&&(e=m.LOCAL);var n=this.getLocalMatrix(),a=n.m[12],s=n.m[13],f=n.m[14],l=this.getParent(),u=i._tmpMats[3],h=i._tmpMats[4];l&&e==m.WORLD?(o?(u.copyFrom(o.getWorldMatrix()),l.getAbsoluteTransform().multiplyToRef(u,u)):u.copyFrom(l.getAbsoluteTransform()),h.copyFrom(u),h.invert(),n.multiplyToRef(u,n),n.multiplyToRef(t,n),n.multiplyToRef(h,n)):e==m.WORLD&&o?(u.copyFrom(o.getWorldMatrix()),h.copyFrom(u),h.invert(),n.multiplyToRef(u,n),n.multiplyToRef(t,n),n.multiplyToRef(h,n)):n.multiplyToRef(t,n),n.setTranslationFromFloats(a,s,f),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},i.prototype._getNegativeRotationToRef=function(t,e){var o=i._tmpMats[2];return t.copyFrom(this.getAbsoluteTransform()),e&&(t.multiplyToRef(e.getWorldMatrix(),t),g.ScalingToRef(e.scaling.x,e.scaling.y,e.scaling.z,o)),t.invert(),isNaN(t.m[0])?!1:(o.multiplyAtIndex(0,this._scalingDeterminant),t.multiplyToRef(o,t),!0)},i.prototype.getPosition=function(t,e){t===void 0&&(t=m.LOCAL),e===void 0&&(e=null);var o=A.Zero();return this.getPositionToRef(t,e,o),o},i.prototype.getPositionToRef=function(t,e,o){if(t===void 0&&(t=m.LOCAL),t==m.LOCAL){var n=this.getLocalMatrix();o.x=n.m[12],o.y=n.m[13],o.z=n.m[14]}else{var a=null;e&&(a=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=i._tmpMats[0];e&&a?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(a,s)):s=this.getAbsoluteTransform(),o.x=s.m[12],o.y=s.m[13],o.z=s.m[14]}},i.prototype.getAbsolutePosition=function(t){t===void 0&&(t=null);var e=A.Zero();return this.getPositionToRef(m.WORLD,t,e),e},i.prototype.getAbsolutePositionToRef=function(t,e){this.getPositionToRef(m.WORLD,t,e)},i.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var t=this._skeleton.getPoseMatrix();t&&this._absoluteTransform.multiplyToRef(t,this._absoluteTransform)}for(var e=this.children,o=e.length,n=0;n<o;n++)e[n].computeAbsoluteTransforms()},i.prototype.getDirection=function(t,e){e===void 0&&(e=null);var o=A.Zero();return this.getDirectionToRef(t,e,o),o},i.prototype.getDirectionToRef=function(t,e,o){e===void 0&&(e=null);var n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&n&&a.multiplyToRef(n,a),A.TransformNormalToRef(t,a,o),o.normalize()},i.prototype.getRotation=function(t,e){t===void 0&&(t=m.LOCAL),e===void 0&&(e=null);var o=A.Zero();return this.getRotationToRef(t,e,o),o},i.prototype.getRotationToRef=function(t,e,o){t===void 0&&(t=m.LOCAL),e===void 0&&(e=null);var n=i._tmpQuat;this.getRotationQuaternionToRef(t,e,n),n.toEulerAnglesToRef(o)},i.prototype.getRotationQuaternion=function(t,e){t===void 0&&(t=m.LOCAL),e===void 0&&(e=null);var o=O.Identity();return this.getRotationQuaternionToRef(t,e,o),o},i.prototype.getRotationQuaternionToRef=function(t,e,o){if(t===void 0&&(t=m.LOCAL),e===void 0&&(e=null),t==m.LOCAL)this._decompose(),o.copyFrom(this._localRotation);else{var n=i._tmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),n):n.copyFrom(a),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,o,void 0)}},i.prototype.getRotationMatrix=function(t,e){t===void 0&&(t=m.LOCAL);var o=g.Identity();return this.getRotationMatrixToRef(t,e,o),o},i.prototype.getRotationMatrixToRef=function(t,e,o){if(t===void 0&&(t=m.LOCAL),t==m.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(o);else{var n=i._tmpMats[0],a=this.getAbsoluteTransform();e?a.multiplyToRef(e.getWorldMatrix(),n):n.copyFrom(a),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(o)}},i.prototype.getAbsolutePositionFromLocal=function(t,e){e===void 0&&(e=null);var o=A.Zero();return this.getAbsolutePositionFromLocalToRef(t,e,o),o},i.prototype.getAbsolutePositionFromLocalToRef=function(t,e,o){e===void 0&&(e=null);var n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0];e&&n?(a.copyFrom(this.getAbsoluteTransform()),a.multiplyToRef(n,a)):a=this.getAbsoluteTransform(),A.TransformCoordinatesToRef(t,a,o)},i.prototype.getLocalPositionFromAbsolute=function(t,e){e===void 0&&(e=null);var o=A.Zero();return this.getLocalPositionFromAbsoluteToRef(t,e,o),o},i.prototype.getLocalPositionFromAbsoluteToRef=function(t,e,o){e===void 0&&(e=null);var n=null;e&&(n=e.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var a=i._tmpMats[0];a.copyFrom(this.getAbsoluteTransform()),e&&n&&a.multiplyToRef(n,a),a.invert(),A.TransformCoordinatesToRef(t,a,o)},i.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},i._tmpVecs=C.BuildArray(2,A.Zero),i._tmpQuat=O.Identity(),i._tmpMats=C.BuildArray(5,g.Identity),i}(w),S=function(){function r(i,t,e,o,n,a,s,f,l,u){e===void 0&&(e=0),o===void 0&&(o=100),n===void 0&&(n=!1),a===void 0&&(a=1),u===void 0&&(u=!1),this.target=t,this.fromFrame=e,this.toFrame=o,this.loopAnimation=n,this.onAnimationEnd=s,this.onAnimationLoop=l,this.isAdditive=u,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new V,this.onAnimationLoopObservable=new V,this._scene=i,f&&this.appendAnimations(t,f),this._speedRatio=a,i._activeAnimatables.push(this)}return Object.defineProperty(r.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weight",{get:function(){return this._weight},set:function(i){if(i===-1){this._weight=-1;return}this._weight=Math.min(Math.max(i,0),1)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(i){for(var t=0;t<this._runtimeAnimations.length;t++){var e=this._runtimeAnimations[t];e._prepareForSpeedRatioChange(i)}this._speedRatio=i},enumerable:!1,configurable:!0}),r.prototype.syncWith=function(i){if(this._syncRoot=i,i){var t=this._scene._activeAnimatables.indexOf(this);t>-1&&(this._scene._activeAnimatables.splice(t,1),this._scene._activeAnimatables.push(this))}return this},r.prototype.getAnimations=function(){return this._runtimeAnimations},r.prototype.appendAnimations=function(i,t){for(var e=this,o=0;o<t.length;o++){var n=t[o],a=new H(i,n,this._scene,this);a._onLoop=function(){e.onAnimationLoopObservable.notifyObservers(e),e.onAnimationLoop&&e.onAnimationLoop()},this._runtimeAnimations.push(a)}},r.prototype.getAnimationByTargetProperty=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)if(t[e].animation.targetProperty===i)return t[e].animation;return null},r.prototype.getRuntimeAnimationByTargetProperty=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)if(t[e].animation.targetProperty===i)return t[e];return null},r.prototype.reset=function(){for(var i=this._runtimeAnimations,t=0;t<i.length;t++)i[t].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},r.prototype.enableBlending=function(i){for(var t=this._runtimeAnimations,e=0;e<t.length;e++)t[e].animation.enableBlending=!0,t[e].animation.blendingSpeed=i},r.prototype.disableBlending=function(){for(var i=this._runtimeAnimations,t=0;t<i.length;t++)i[t].animation.enableBlending=!1},r.prototype.goToFrame=function(i){var t=this._runtimeAnimations;if(t[0]){var e=t[0].animation.framePerSecond,o=t[0].currentFrame,n=this.speedRatio===0?0:(i-o)/e*1e3/this.speedRatio;this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=n}for(var a=0;a<t.length;a++)t[a].goToFrame(i)},r.prototype.pause=function(){this._paused||(this._paused=!0)},r.prototype.restart=function(){this._paused=!1},r.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},r.prototype.stop=function(i,t){if(i||t){var e=this._scene._activeAnimatables.indexOf(this);if(e>-1){for(var o=this._runtimeAnimations,n=o.length-1;n>=0;n--){var a=o[n];i&&a.animation.name!=i||t&&!t(a.target)||(a.dispose(),o.splice(n,1))}o.length==0&&(this._scene._activeAnimatables.splice(e,1),this._raiseOnAnimationEnd())}}else{var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){this._scene._activeAnimatables.splice(n,1);for(var o=this._runtimeAnimations,n=0;n<o.length;n++)o[n].dispose();this._raiseOnAnimationEnd()}}},r.prototype.waitAsync=function(){var i=this;return new Promise(function(t,e){i.onAnimationEndObservable.add(function(){t(i)},void 0,void 0,i,!0)})},r.prototype._animate=function(i){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=i),!0;if(this._localDelayOffset===null?(this._localDelayOffset=i,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=i-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var t=!1,e=this._runtimeAnimations,o;for(o=0;o<e.length;o++){var n=e[o],a=n.animate(i-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);t=t||a}if(this.animationStarted=t,!t){if(this.disposeOnEnd)for(o=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(o,1),o=0;o<e.length;o++)e[o].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return t},r}();P.prototype._animate=function(){if(!!this.animationsEnabled){var r=k.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=r}this.deltaTime=this.useConstantAnimationDeltaTime?16:(r-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=r;var i=this._activeAnimatables;if(i.length!==0){this._animationTime+=this.deltaTime;for(var t=this._animationTime,e=0;e<i.length;e++){var o=i[e];!o._animate(t)&&o.disposeOnEnd&&e--}this._processLateAnimationBindings()}}};P.prototype.beginWeightedAnimation=function(r,i,t,e,o,n,a,s,f,l,u){e===void 0&&(e=1),n===void 0&&(n=1),u===void 0&&(u=!1);var h=this.beginAnimation(r,i,t,o,n,a,s,!1,f,l,u);return h.weight=e,h};P.prototype.beginAnimation=function(r,i,t,e,o,n,a,s,f,l,u){o===void 0&&(o=1),s===void 0&&(s=!0),u===void 0&&(u=!1),i>t&&o>0&&(o*=-1),s&&this.stopAnimation(r,void 0,f),a||(a=new S(this,r,i,t,e,o,n,void 0,l,u));var h=f?f(r):!0;if(r.animations&&h&&a.appendAnimations(r,r.animations),r.getAnimatables)for(var c=r.getAnimatables(),p=0;p<c.length;p++)this.beginAnimation(c[p],i,t,e,o,n,a,s,f,l);return a.reset(),a};P.prototype.beginHierarchyAnimation=function(r,i,t,e,o,n,a,s,f,l,u,h){n===void 0&&(n=1),f===void 0&&(f=!0),h===void 0&&(h=!1);var c=r.getDescendants(i),p=[];p.push(this.beginAnimation(r,t,e,o,n,a,s,f,l,void 0,h));for(var _=0,d=c;_<d.length;_++){var v=d[_];p.push(this.beginAnimation(v,t,e,o,n,a,s,f,l,void 0,h))}return p};P.prototype.beginDirectAnimation=function(r,i,t,e,o,n,a,s,f){f===void 0&&(f=!1),n===void 0&&(n=1),t>e&&n>0&&(n*=-1);var l=new S(this,r,t,e,o,n,a,i,s,f);return l};P.prototype.beginDirectHierarchyAnimation=function(r,i,t,e,o,n,a,s,f,l){l===void 0&&(l=!1);var u=r.getDescendants(i),h=[];h.push(this.beginDirectAnimation(r,t,e,o,n,a,s,f,l));for(var c=0,p=u;c<p.length;c++){var _=p[c];h.push(this.beginDirectAnimation(_,t,e,o,n,a,s,f,l))}return h};P.prototype.getAnimatableByTarget=function(r){for(var i=0;i<this._activeAnimatables.length;i++)if(this._activeAnimatables[i].target===r)return this._activeAnimatables[i];return null};P.prototype.getAllAnimatablesByTarget=function(r){for(var i=[],t=0;t<this._activeAnimatables.length;t++)this._activeAnimatables[t].target===r&&i.push(this._activeAnimatables[t]);return i};P.prototype.stopAnimation=function(r,i,t){for(var e=this.getAllAnimatablesByTarget(r),o=0,n=e;o<n.length;o++){var a=n[o];a.stop(i,t)}};P.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var r=0;r<this._activeAnimatables.length;r++)this._activeAnimatables[r].stop();this._activeAnimatables=[]}for(var i=0,t=this.animationGroups;i<t.length;i++){var e=t[i];e.stop()}};P.prototype._registerTargetForLateAnimationBinding=function(r,i){var t=r.target;this._registeredForLateAnimationBindings.pushNoDuplicate(t),t._lateAnimationHolders||(t._lateAnimationHolders={}),t._lateAnimationHolders[r.targetPath]||(t._lateAnimationHolders[r.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:i}),r.isAdditive?(t._lateAnimationHolders[r.targetPath].additiveAnimations.push(r),t._lateAnimationHolders[r.targetPath].totalAdditiveWeight+=r.weight):(t._lateAnimationHolders[r.targetPath].animations.push(r),t._lateAnimationHolders[r.targetPath].totalWeight+=r.weight)};P.prototype._processLateAnimationBindingsForMatrices=function(r){if(r.totalWeight===0&&r.totalAdditiveWeight===0)return r.originalValue;var i=1,t=F.Vector3[0],e=F.Vector3[1],o=F.Quaternion[0],n=0,a=r.animations[0],s=r.originalValue,f=1,l=!1;if(r.totalWeight<1)f=1-r.totalWeight,s.decompose(e,o,t);else{if(n=1,i=r.totalWeight,f=a.weight/i,f==1)if(r.totalAdditiveWeight)l=!0;else return a.currentValue;a.currentValue.decompose(e,o,t)}if(!l){e.scaleInPlace(f),t.scaleInPlace(f),o.scaleInPlace(f);for(var u=n;u<r.animations.length;u++){var h=r.animations[u];if(h.weight!==0){var f=h.weight/i,c=F.Vector3[2],p=F.Vector3[3],_=F.Quaternion[1];h.currentValue.decompose(p,_,c),p.scaleAndAddToRef(f,e),_.scaleAndAddToRef(f,o),c.scaleAndAddToRef(f,t)}}}for(var d=0;d<r.additiveAnimations.length;d++){var h=r.additiveAnimations[d];if(h.weight!==0){var c=F.Vector3[2],p=F.Vector3[3],_=F.Quaternion[1];h.currentValue.decompose(p,_,c),p.multiplyToRef(e,p),A.LerpToRef(e,p,h.weight,e),o.multiplyToRef(_,_),O.SlerpToRef(o,_,h.weight,o),c.scaleAndAddToRef(h.weight,t)}}var v=a?a._animationState.workValue:F.Matrix[0].clone();return g.ComposeToRef(e,o,t,v),v};P.prototype._processLateAnimationBindingsForQuaternions=function(r,i){if(r.totalWeight===0&&r.totalAdditiveWeight===0)return i;var t=r.animations[0],e=r.originalValue,o=i;if(r.totalWeight===0&&r.totalAdditiveWeight>0)o.copyFrom(e);else if(r.animations.length===1){if(O.SlerpToRef(e,t.currentValue,Math.min(1,r.totalWeight),o),r.totalAdditiveWeight===0)return o}else if(r.animations.length>1){var n=1,a=void 0,s=void 0;if(r.totalWeight<1){var f=1-r.totalWeight;a=[],s=[],a.push(e),s.push(f)}else{if(r.animations.length===2&&(O.SlerpToRef(r.animations[0].currentValue,r.animations[1].currentValue,r.animations[1].weight/r.totalWeight,i),r.totalAdditiveWeight===0))return i;a=[],s=[],n=r.totalWeight}for(var l=0;l<r.animations.length;l++){var u=r.animations[l];a.push(u.currentValue),s.push(u.weight/n)}for(var h=0,c=0;c<a.length;){if(!c){O.SlerpToRef(a[c],a[c+1],s[c+1]/(s[c]+s[c+1]),i),o=i,h=s[c]+s[c+1],c+=2;continue}h+=s[c],O.SlerpToRef(o,a[c],s[c]/h,o),c++}}for(var p=0;p<r.additiveAnimations.length;p++){var u=r.additiveAnimations[p];u.weight!==0&&(o.multiplyToRef(u.currentValue,F.Quaternion[0]),O.SlerpToRef(o,F.Quaternion[0],u.weight,o))}return o};P.prototype._processLateAnimationBindings=function(){if(!!this._registeredForLateAnimationBindings.length){for(var r=0;r<this._registeredForLateAnimationBindings.length;r++){var i=this._registeredForLateAnimationBindings.data[r];for(var t in i._lateAnimationHolders){var e=i._lateAnimationHolders[t],o=e.animations[0],n=e.originalValue,a=y.AllowMatrixDecomposeForInterpolation&&n.m,s=i[t];if(a)s=this._processLateAnimationBindingsForMatrices(e);else{var f=n.w!==void 0;if(f)s=this._processLateAnimationBindingsForQuaternions(e,s||O.Identity());else{var l=0,u=1;if(e.totalWeight<1)o&&n.scale?s=n.scale(1-e.totalWeight):o?s=n*(1-e.totalWeight):n.clone?s=n.clone():s=n;else if(o){u=e.totalWeight;var h=o.weight/u;h!==1?o.currentValue.scale?s=o.currentValue.scale(h):s=o.currentValue*h:s=o.currentValue,l=1}for(var c=l;c<e.animations.length;c++){var p=e.animations[c],_=p.weight/u;if(_)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(_,s):s+=p.currentValue*_;else continue}for(var d=0;d<e.additiveAnimations.length;d++){var p=e.additiveAnimations[d],_=p.weight;if(_)p.currentValue.scaleAndAddToRef?p.currentValue.scaleAndAddToRef(_,s):s+=p.currentValue*_;else continue}}}i[t]=s}i._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}};x.prototype.copyAnimationRange=function(r,i,t,e,o){e===void 0&&(e=!1),o===void 0&&(o=null),this.animations.length===0&&(this.animations.push(new y(this.name,"_matrix",r.animations[0].framePerSecond,y.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var n=r.animations[0].getRange(i);if(!n)return!1;for(var a=n.from,s=n.to,f=r.animations[0].getKeys(),l=r.length,u=r.getParent(),h=this.getParent(),c=e&&u&&l&&this.length&&l!==this.length,p=c&&h&&u?h.length/u.length:1,_=e&&!h&&o&&(o.x!==1||o.y!==1||o.z!==1),d=this.animations[0].getKeys(),v,T,L,M=0,b=f.length;M<b;M++)v=f[M],v.frame>=a&&v.frame<=s&&(e?(L=v.value.clone(),c?(T=L.getTranslation(),L.setTranslation(T.scaleInPlace(p))):_&&o?(T=L.getTranslation(),L.setTranslation(T.multiplyInPlace(o))):L=v.value):L=v.value,d.push({frame:v.frame+t,value:L}));return this.animations[0].createRange(i,a+t,s+t),!0};export{S as Animatable};
